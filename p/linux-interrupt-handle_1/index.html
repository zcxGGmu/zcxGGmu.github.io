<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="0 ÂâçË®Ä kernel: 4.14\narch: ARM64\nirq_chip: GICv2\nÊú¨ÊñáÈáçÁÇπÂàÜÊûê Linux ‰∏≠Êñ≠Â≠êÁ≥ªÁªüÔºå‰∏≠Êñ≠ÊòØÂ§ÑÁêÜÂô®Áî®‰∫éÂºÇÊ≠•Â§ÑÁêÜÂ§ñÂõ¥ËÆæÂ§áËØ∑Ê±ÇÁöÑ‰∏ÄÁßçÊú∫Âà∂ÔºåÂèØ‰ª•ËØ¥‰∏≠Êñ≠Â§ÑÁêÜÊòØÊìç‰ΩúÁ≥ªÁªüÁÆ°ÁêÜÂ§ñÂõ¥ËÆæÂ§áÁöÑÂü∫Áü≥ÔºåÊ≠§Â§ñÁ≥ªÁªüË∞ÉÂ∫¶„ÄÅÊ†∏Èó¥‰∫§‰∫íÁ≠âÈÉΩÁ¶ª‰∏çÂºÄ‰∏≠Êñ≠ÔºåÂÆÉÁöÑÈáçË¶ÅÊÄß‰∏çË®ÄËÄåÂñª„ÄÇÊù•‰∏ÄÂº†ÂàÜÂ±ÇÂõæÔºö\n">
<title>Linux Interrupt Handle_1</title>

<link rel='canonical' href='https://zcxggmu.github.io/p/linux-interrupt-handle_1/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="Linux Interrupt Handle_1">
<meta property='og:description' content="0 ÂâçË®Ä kernel: 4.14\narch: ARM64\nirq_chip: GICv2\nÊú¨ÊñáÈáçÁÇπÂàÜÊûê Linux ‰∏≠Êñ≠Â≠êÁ≥ªÁªüÔºå‰∏≠Êñ≠ÊòØÂ§ÑÁêÜÂô®Áî®‰∫éÂºÇÊ≠•Â§ÑÁêÜÂ§ñÂõ¥ËÆæÂ§áËØ∑Ê±ÇÁöÑ‰∏ÄÁßçÊú∫Âà∂ÔºåÂèØ‰ª•ËØ¥‰∏≠Êñ≠Â§ÑÁêÜÊòØÊìç‰ΩúÁ≥ªÁªüÁÆ°ÁêÜÂ§ñÂõ¥ËÆæÂ§áÁöÑÂü∫Áü≥ÔºåÊ≠§Â§ñÁ≥ªÁªüË∞ÉÂ∫¶„ÄÅÊ†∏Èó¥‰∫§‰∫íÁ≠âÈÉΩÁ¶ª‰∏çÂºÄ‰∏≠Êñ≠ÔºåÂÆÉÁöÑÈáçË¶ÅÊÄß‰∏çË®ÄËÄåÂñª„ÄÇÊù•‰∏ÄÂº†ÂàÜÂ±ÇÂõæÔºö\n">
<meta property='og:url' content='https://zcxggmu.github.io/p/linux-interrupt-handle_1/'>
<meta property='og:site_name' content='zcxGGmu'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2024-10-16T18:14:17&#43;08:00'/><meta property='article:modified_time' content='2024-10-16T18:14:17&#43;08:00'/>
<meta name="twitter:title" content="Linux Interrupt Handle_1">
<meta name="twitter:description" content="0 ÂâçË®Ä kernel: 4.14\narch: ARM64\nirq_chip: GICv2\nÊú¨ÊñáÈáçÁÇπÂàÜÊûê Linux ‰∏≠Êñ≠Â≠êÁ≥ªÁªüÔºå‰∏≠Êñ≠ÊòØÂ§ÑÁêÜÂô®Áî®‰∫éÂºÇÊ≠•Â§ÑÁêÜÂ§ñÂõ¥ËÆæÂ§áËØ∑Ê±ÇÁöÑ‰∏ÄÁßçÊú∫Âà∂ÔºåÂèØ‰ª•ËØ¥‰∏≠Êñ≠Â§ÑÁêÜÊòØÊìç‰ΩúÁ≥ªÁªüÁÆ°ÁêÜÂ§ñÂõ¥ËÆæÂ§áÁöÑÂü∫Áü≥ÔºåÊ≠§Â§ñÁ≥ªÁªüË∞ÉÂ∫¶„ÄÅÊ†∏Èó¥‰∫§‰∫íÁ≠âÈÉΩÁ¶ª‰∏çÂºÄ‰∏≠Êñ≠ÔºåÂÆÉÁöÑÈáçË¶ÅÊÄß‰∏çË®ÄËÄåÂñª„ÄÇÊù•‰∏ÄÂº†ÂàÜÂ±ÇÂõæÔºö\n">
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="ÂàáÊç¢ËèúÂçï">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu16968365064894999835.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">zcxGGmu</a></h1>
            <h2 class="site-description">riscv, linux-kernel/kvm, llm-app/infer</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/zcxGGmu'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>‰∏ªÈ°µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>ÂÖ≥‰∫é</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>ÊöóËâ≤Ê®°Âºè</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ÁõÆÂΩï</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#0-ÂâçË®Ä">0 ÂâçË®Ä</a></li>
    <li><a href="#1-Á°¨‰ª∂Áõ∏ÂÖ≥Â±Ç">1 Á°¨‰ª∂Áõ∏ÂÖ≥Â±Ç</a>
      <ul>
        <li><a href="#11-gicÈ©±Âä®ÂàÜÊûê">1.1 GICÈ©±Âä®ÂàÜÊûê</a>
          <ul>
            <li><a href="#ËÆæÂ§á‰ø°ÊÅØÊ∑ªÂä†">ËÆæÂ§á‰ø°ÊÅØÊ∑ªÂä†</a></li>
            <li><a href="#È©±Âä®ÊµÅÁ®ãÂàÜÊûê">È©±Âä®ÊµÅÁ®ãÂàÜÊûê</a></li>
            <li><a href="#Êï∞ÊçÆÁªìÊûÑÂàÜÊûê">Êï∞ÊçÆÁªìÊûÑÂàÜÊûê</a></li>
            <li><a href="#ÂÖ≥‰∫éirq-domain">ÂÖ≥‰∫éIRQ domain</a></li>
          </ul>
        </li>
        <li><a href="#12-Êû∂ÊûÑÁõ∏ÂÖ≥‰ª£Á†Å">1.2 Êû∂ÊûÑÁõ∏ÂÖ≥‰ª£Á†Å</a></li>
      </ul>
    </li>
    <li><a href="#2-ÈÄöÁî®Ê°ÜÊû∂Â±Ç">2 ÈÄöÁî®Ê°ÜÊû∂Â±Ç</a>
      <ul>
        <li><a href="#21-Êï∞ÊçÆÁªìÊûÑÂàÜÊûê">2.1 Êï∞ÊçÆÁªìÊûÑÂàÜÊûê</a></li>
        <li><a href="#22-‰∏≠Êñ≠Ê°ÜÊû∂ÂàÜÊûê">2.2 ‰∏≠Êñ≠Ê°ÜÊû∂ÂàÜÊûê</a>
          <ul>
            <li><a href="#‰∏≠Êñ≠Ê≥®ÂÜå">‰∏≠Êñ≠Ê≥®ÂÜå</a></li>
            <li><a href="#‰∏≠Êñ≠Â§ÑÁêÜ">‰∏≠Êñ≠Â§ÑÁêÜ</a>
              <ul>
                <li><a href="#‰∏≠Êñ≠Á∫øÁ®ãÂåñÂ§ÑÁêÜ">‰∏≠Êñ≠Á∫øÁ®ãÂåñÂ§ÑÁêÜ</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#23-ÊÄªÁªì">2.3 ÊÄªÁªì</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/linux-interrupt-handle_1/">Linux Interrupt Handle_1</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2024-10-16</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    ÈòÖËØªÊó∂Èïø: 17 ÂàÜÈíü
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="0-ÂâçË®Ä">0 ÂâçË®Ä
</h1><blockquote>
<p><strong>kernel: 4.14</strong></p>
<p><strong>arch: ARM64</strong></p>
<p><strong>irq_chip: GICv2</strong></p>
</blockquote>
<p>Êú¨ÊñáÈáçÁÇπÂàÜÊûê Linux ‰∏≠Êñ≠Â≠êÁ≥ªÁªüÔºå‰∏≠Êñ≠ÊòØÂ§ÑÁêÜÂô®Áî®‰∫éÂºÇÊ≠•Â§ÑÁêÜÂ§ñÂõ¥ËÆæÂ§áËØ∑Ê±ÇÁöÑ‰∏ÄÁßçÊú∫Âà∂ÔºåÂèØ‰ª•ËØ¥‰∏≠Êñ≠Â§ÑÁêÜÊòØÊìç‰ΩúÁ≥ªÁªüÁÆ°ÁêÜÂ§ñÂõ¥ËÆæÂ§áÁöÑÂü∫Áü≥ÔºåÊ≠§Â§ñÁ≥ªÁªüË∞ÉÂ∫¶„ÄÅÊ†∏Èó¥‰∫§‰∫íÁ≠âÈÉΩÁ¶ª‰∏çÂºÄ‰∏≠Êñ≠ÔºåÂÆÉÁöÑÈáçË¶ÅÊÄß‰∏çË®ÄËÄåÂñª„ÄÇÊù•‰∏ÄÂº†ÂàÜÂ±ÇÂõæÔºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202311101950700.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>**Á°¨‰ª∂Â±ÇÔºö**ÊúÄ‰∏ãÂ±Ç‰∏∫Á°¨‰ª∂ËøûÊé•Â±ÇÔºåÂØπÂ∫îÁöÑÊòØÂÖ∑‰ΩìÁöÑÂ§ñËÆæ‰∏éSoCÁöÑÁâ©ÁêÜËøûÊé•Ôºå‰∏≠Êñ≠‰ø°Âè∑ÊòØ‰ªéÂ§ñËÆæÂà∞‰∏≠Êñ≠ÊéßÂà∂Âô®ÔºåÁî±‰∏≠Êñ≠ÊéßÂà∂Âô®Áªü‰∏ÄÁÆ°ÁêÜÔºåÂÜçË∑ØÁî±Âà∞Â§ÑÁêÜÂô®‰∏äÔºõ</li>
<li>**Á°¨‰ª∂Áõ∏ÂÖ≥Â±ÇÔºö**Ëøô‰∏™Â±ÇÂåÖÊã¨‰∏§ÈÉ®ÂàÜ‰ª£Á†ÅÔºå‰∏ÄÈÉ®ÂàÜÊòØÊû∂ÊûÑÁõ∏ÂÖ≥ÁöÑÔºåÊØîÂ¶ÇARM64Â§ÑÁêÜÂô®Â§ÑÁêÜ‰∏≠Êñ≠Áõ∏ÂÖ≥ÔºåÂè¶‰∏ÄÈÉ®ÂàÜÊòØ‰∏≠Êñ≠ÊéßÂà∂Âô®ÁöÑÈ©±Âä®‰ª£Á†ÅÔºõ</li>
<li>**ÈÄöÁî®Â±ÇÔºö**ËøôÈÉ®ÂàÜ‰πüÂèØ‰ª•ËÆ§‰∏∫ÊòØÊ°ÜÊû∂Â±ÇÔºåÊòØÁ°¨‰ª∂Êó†ÂÖ≥Â±ÇÔºåËøôÈÉ®ÂàÜ‰ª£Á†ÅÂú®ÊâÄÊúâÁ°¨‰ª∂Âπ≥Âè∞‰∏äÊòØÈÄöÁî®ÁöÑÔºõ</li>
<li>**Áî®Êà∑Â±ÇÔºö**ËøôÈÉ®ÂàÜ‰πüÂ∞±ÊòØ‰∏≠Êñ≠ÁöÑ‰ΩøÁî®ËÄÖ‰∫ÜÔºå‰∏ªË¶ÅÊòØÂêÑÁ±ªËÆæÂ§áÈ©±Âä®ÔºåÈÄöËøá‰∏≠Êñ≠Áõ∏ÂÖ≥Êé•Âè£Êù•ËøõË°åÁî≥ËØ∑ÂíåÊ≥®ÂÜåÔºåÊúÄÁªàÂú®Â§ñËÆæËß¶Âèë‰∏≠Êñ≠Êó∂ÔºåËøõË°åÁõ∏Â∫îÁöÑÂõûË∞ÉÂ§ÑÁêÜÔºõ</li>
</ul>
<p>Êú¨Êñá‰∏ç‰ºöËØ¶ÁªÜÂàÜÊûêGICv2ÁöÑÁ°¨‰ª∂ÂéüÁêÜÔºåÂõ†‰∏∫‰∏çÂêåÊû∂ÊûÑÁöÑ‰∏≠Êñ≠ÊéßÂà∂Âô®ÂÆûÁé∞ÈÉΩ‰∏çÂ§™‰∏ÄÊ†∑Ôºå‰ΩÜËøô‰∫õ <code>irq_chip</code> Êé•ÂÖ• LinuxÂÜÖÊ†∏ÂêéÂÖ≥‰∫é‰∏≠Êñ≠ÂàùÂßãÂåñ„ÄÅ‰∏≠Êñ≠Â§ÑÁêÜÊµÅÁ®ãÁöÑÊ°ÜÊû∂ÊòØÁõ∏ÂêåÁöÑ„ÄÇ‰πãÂâçÁúã‰∫ÜÂÖ≥‰∫é riscv AIA Linux support ÁöÑ‰∏ÄÁªÑPATCHÔºåÂØπÂÖ∂‰∏≠Áõ∏ÂΩìÂ§öÁöÑÊé•Âè£‰∏çÁêÜËß£ÔºåÊâÄ‰ª•ÊÉ≥<strong>ÈÄöËøáÊú¨ÊñáÊêûÊ∏ÖÊ•ö Linux ‰∏≠Êñ≠Ê°ÜÊû∂ÔºåÂ∞ÜÊ°ÜÊû∂Âíå <code>irq_chip</code> Áõ∏ÂÖ≥ÁöÑ‰ª£Á†ÅÂàÜÁ¶ªÂºÄÊù•„ÄÇ</strong></p>
<h1 id="1-Á°¨‰ª∂Áõ∏ÂÖ≥Â±Ç">1 Á°¨‰ª∂Áõ∏ÂÖ≥Â±Ç
</h1><h2 id="11-gicÈ©±Âä®ÂàÜÊûê">1.1 GICÈ©±Âä®ÂàÜÊûê
</h2><h3 id="ËÆæÂ§á‰ø°ÊÅØÊ∑ªÂä†">ËÆæÂ§á‰ø°ÊÅØÊ∑ªÂä†
</h3><p>ARMÂπ≥Âè∞ÁöÑËÆæÂ§á‰ø°ÊÅØÔºåÈÉΩÊòØÈÄöËøá<code>Device Tree</code>ËÆæÂ§áÊ†ëÊù•Ê∑ªÂä†ÔºåËÆæÂ§áÊ†ë‰ø°ÊÅØÊîæÁΩÆÂú®<code>arch/arm64/boot/dts/</code>‰∏ãÔºö</p>
<p>‰∏ãÂõæÂ∞±ÊòØ‰∏Ä‰∏™‰∏≠Êñ≠ÊéßÂà∂Âô®ÁöÑËÆæÂ§áÊ†ë‰ø°ÊÅØÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// /arch/arm64/boot/dts/arm/foundation-v8.dts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="o">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nl">gic</span><span class="p">:</span> <span class="n">interrupt</span><span class="o">-</span><span class="n">controller</span><span class="err">@</span><span class="mi">2</span><span class="n">c001000</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">compatible</span> <span class="o">=</span> <span class="s">&#34;arm,cortex-a15-gic&#34;</span><span class="p">,</span> <span class="s">&#34;arm,cortex-a9-gic&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="cp">#interrupt-cells = &lt;3&gt;;
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>		<span class="cp">#address-cells = &lt;2&gt;;
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>		<span class="n">interrupt</span><span class="o">-</span><span class="n">controller</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">reg</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mh">0x0</span> <span class="mh">0x2c001000</span> <span class="mi">0</span> <span class="mh">0x1000</span><span class="o">&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		      <span class="o">&lt;</span><span class="mh">0x0</span> <span class="mh">0x2c002000</span> <span class="mi">0</span> <span class="mh">0x2000</span><span class="o">&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		      <span class="o">&lt;</span><span class="mh">0x0</span> <span class="mh">0x2c004000</span> <span class="mi">0</span> <span class="mh">0x2000</span><span class="o">&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		      <span class="o">&lt;</span><span class="mh">0x0</span> <span class="mh">0x2c006000</span> <span class="mi">0</span> <span class="mh">0x2000</span><span class="o">&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">interrupts</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">1</span> <span class="mi">9</span> <span class="mh">0xf04</span><span class="o">&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>**<code>compatible</code>Â≠óÊÆµÔºö**Áî®‰∫é‰∏éÂÖ∑‰ΩìÁöÑÈ©±Âä®Êù•ËøõË°åÂåπÈÖçÔºåÊØîÂ¶ÇÂõæÁâá‰∏≠ <code>arm, cortex-a15-gic</code> ÔºåÂèØ‰ª•Ê†πÊçÆËøô‰∏™ÂêçÂ≠óÂéªÂåπÈÖçÂØπÂ∫îÁöÑÈ©±Âä®Á®ãÂ∫èÔºõ</li>
<li>**<code>interrupt-cells</code>Â≠óÊÆµÔºö**Áî®‰∫éÊåáÂÆöÁºñÁ†Å‰∏Ä‰∏™‰∏≠Êñ≠Ê∫êÊâÄÈúÄË¶ÅÁöÑÂçïÂÖÉ‰∏™Êï∞ÔºåËøô‰∏™ÂÄº‰∏∫3„ÄÇÊØîÂ¶ÇÂú®Â§ñËÆæÂú®ËÆæÂ§áÊ†ë‰∏≠Ê∑ªÂä†‰∏≠Êñ≠‰ø°Âè∑Êó∂ÔºåÈÄöÂ∏∏ËÉΩÁúãÂà∞Á±ª‰ºº <code>interrupts = &lt;0 23 4&gt;;</code>ÁöÑ‰ø°ÊÅØÔºåÁ¨¨‰∏Ä‰∏™ÂçïÂÖÉ0ÔºåË°®Á§∫ÁöÑÊòØ‰∏≠Êñ≠Á±ªÂûãÔºà<code>1ÔºöPPIÔºå0ÔºöSPI</code>ÔºâÔºåÁ¨¨‰∫å‰∏™ÂçïÂÖÉ 23 Ë°®Á§∫ÁöÑÊòØ‰∏≠Êñ≠Âè∑ÔºåÁ¨¨‰∏â‰∏™ÂçïÂÖÉ 4 Ë°®Á§∫ÁöÑÊòØ‰∏≠Êñ≠Ëß¶ÂèëÁöÑÁ±ªÂûãÔºõ</li>
<li>**<code>interrupt-controller</code>Â≠óÊÆµÔºö**Ë°®Á§∫ËØ•ËÆæÂ§áÊòØ‰∏Ä‰∏™‰∏≠Êñ≠ÊéßÂà∂Âô®ÔºåÂ§ñËÆæÂèØ‰ª•ËøûÊé•Âú®ËØ•‰∏≠Êñ≠ÊéßÂà∂Âô®‰∏äÔºõ</li>
<li>**<code>reg</code>Â≠óÊÆµÔºö**ÊèèËø∞‰∏≠Êñ≠ÊéßÂà∂Âô®ÁöÑÂú∞ÂùÄ‰ø°ÊÅØ‰ª•ÂèäÂú∞ÂùÄËåÉÂõ¥ÔºåÊØîÂ¶ÇÂõæÁâá‰∏≠ÂàÜÂà´Âà∂ÂÆö‰∫Ü <code>GIC DistributorÔºàGICDÔºâ</code>Âíå<code>GIC CPU InterfaceÔºàGICCÔºâ</code>ÁöÑÂú∞ÂùÄ‰ø°ÊÅØÔºõ</li>
<li>ÂÖ≥‰∫éËÆæÂ§áÊï∞ÁöÑÂêÑ‰∏™Â≠óÊÆµÂê´‰πâÔºåËØ¶ÁªÜÂèØ‰ª•ÂèÇËÄÉ<code>Documentation/devicetree/bindings</code>‰∏ãÁöÑÂØπÂ∫î‰ø°ÊÅØÔºõ</li>
</ul>
<p>ËÆæÂ§áÊ†ëÁöÑ‰ø°ÊÅØÔºåÊòØÊÄé‰πàÊ∑ªÂä†Âà∞Á≥ªÁªü‰∏≠ÁöÑÂë¢Ôºü <code>Device Tree</code> ÊúÄÁªà‰ºöÁºñËØëÊàê <code>dtb</code> Êñá‰ª∂ÔºåÂπ∂ÈÄöËøá Uboot ‰º†ÈÄíÁªôÂÜÖÊ†∏ÔºåÂú®ÂÜÖÊ†∏ÂêØÂä®Âêé‰ºöÂ∞Ü <code>dtb</code> Êñá‰ª∂Ëß£ÊûêÊàê <code>device_node</code> ÁªìÊûÑ„ÄÇÂÖ≥‰∫éËÆæÂ§áÊ†ëÁöÑÁõ∏ÂÖ≥Áü•ËØÜÔºåÊú¨ÊñáÂÖà‰∏çÂ±ïÂºÄÔºåÂêéÁª≠ÂÜçÊâæÊú∫‰ºöË°•ÂÖÖ„ÄÇÊù•‰∏ÄÂº†ÂõæÔºåÂÖàÁÆÄË¶Å‰ªãÁªç‰∏ãÂÖ≥ÈîÆË∑ØÂæÑÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">start_kernel</span>
</span></span><span class="line"><span class="cl">    <span class="o">+-&gt;</span> <span class="n">setup_arch</span>
</span></span><span class="line"><span class="cl">    	<span class="o">+-&gt;</span> <span class="n">unflatten_device_stree</span> <span class="c1">//Ëß£ÊûêdtbÊñá‰ª∂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    		<span class="o">+-&gt;</span> <span class="n">unflatten_dt_nodes</span>
</span></span><span class="line"><span class="cl">    			<span class="o">+-&gt;</span> <span class="n">populate_node</span>
</span></span><span class="line"><span class="cl">    				<span class="o">+-&gt;</span> <span class="n">unflatten_dt_alloc</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËÆæÂ§áÊ†ëÁöÑËäÇÁÇπ‰ø°ÊÅØÔºåÊúÄÁªà‰ºöÂèòÊàê<code>device_node</code>ÁªìÊûÑÔºåÂú®ÂÜÖÂ≠ò‰∏≠Áª¥ÊåÅ‰∏Ä‰∏™Ê†ëÁä∂ÁªìÊûÑ„ÄÇ<strong>ËÆæÂ§á‰∏éÈ©±Âä®Ôºå‰ºöÊ†πÊçÆ<code>compatible</code> Â≠óÊÆµËøõË°åÂåπÈÖç „ÄÇ</strong></p>
<h3 id="È©±Âä®ÊµÅÁ®ãÂàÜÊûê">È©±Âä®ÊµÅÁ®ãÂàÜÊûê
</h3><p>GICÈ©±Âä®ÁöÑÊâßË°åÊµÅÁ®ãÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="https://img2020.cnblogs.com/blog/1771657/202005/1771657-20200531111308070-739998455.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>ÂÖ≥‰∫éÈìæÊé•ËÑöÊú¨<code>vmlinux.lds</code>ÔºåËÑöÊú¨‰∏≠ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™ <code>__irqchip_of_table</code> ÊÆµÔºåËØ•ÊÆµÁî®‰∫éÂ≠òÊîæ‰∏≠Êñ≠ÊéßÂà∂Âô®‰ø°ÊÅØÔºåÁî®‰∫éÊúÄÁªàÊù•ÂåπÈÖçËÆæÂ§áÔºõ</li>
<li>Âú®GICÈ©±Âä®Á®ãÂ∫è‰∏≠Ôºå‰ΩøÁî® <code>IRQCHIP_DECLARE</code> ÂÆèÊù•Â£∞ÊòéÁªìÊûÑ‰ø°ÊÅØÔºåÂåÖÊã¨ <code>compatible</code> Â≠óÊÆµÂíåÂõûË∞ÉÂáΩÊï∞ÔºåËØ•ÂÆè‰ºöÂ∞ÜËøô‰∏™ÁªìÊûÑÊîæÁΩÆÂà∞ <code>__irqchip_of_table</code> ÊÆµ‰∏≠Ôºõ</li>
<li>Âú®ÂÜÖÊ†∏ÂêØÂä®ÂàùÂßãÂåñ‰∏≠Êñ≠ÁöÑÂáΩÊï∞‰∏≠Ôºå<code>of_irq_init</code> ÂáΩÊï∞‰ºöÂéªÊü•ÊâæËÆæÂ§áËäÇÁÇπ‰ø°ÊÅØÔºåËØ•ÂáΩÊï∞ÁöÑ‰º†ÂÖ•ÂèÇÊï∞Â∞±ÊòØ<code>__irqchip_of_table</code> ÊÆµÔºåÁî±‰∫é <code>IRQCHIP_DECLARE</code> Â∑≤ÁªèÂ∞Ü‰ø°ÊÅØÂ°´ÂÖÖÂ•Ω‰∫ÜÔºå<code>of_irq_init</code> ÂáΩÊï∞‰ºöÊ†πÊçÆ<code>arm,gic-400</code> ÂéªÊü•ÊâæÂØπÂ∫îÁöÑËÆæÂ§áËäÇÁÇπÔºåÂπ∂Ëé∑ÂèñËÆæÂ§áÁöÑ‰ø°ÊÅØ„ÄÇ‰∏≠Êñ≠ÊéßÂà∂Âô®‰πüÂ≠òÂú®Á∫ßËÅîÁöÑÊÉÖÂÜµÔºå<code>of_irq_init</code> ÂáΩÊï∞‰∏≠‰πüÂ§ÑÁêÜ‰∫ÜËøôÁßçÊÉÖÂÜµÔºõ</li>
<li><code>or_irq_init</code> ÂáΩÊï∞‰∏≠ÔºåÊúÄÁªà‰ºöÂõûË∞É<code>IRQCHIP_DECLARE</code>Â£∞ÊòéÁöÑÂõûË∞ÉÂáΩÊï∞Ôºå‰πüÂ∞±ÊòØ<code>gic_of_init</code>ÔºåËÄåËøô‰∏™ÂáΩÊï∞Â∞±ÊòØ<strong>GICÈ©±Âä®ÁöÑÂàùÂßãÂåñÂÖ•Âè£ÂáΩÊï∞</strong>‰∫ÜÔºõ</li>
</ul>
<p>GICÁöÑÂ∑•‰ΩúÔºåÊú¨Ë¥®‰∏äÊòØÁî±‰∏≠Êñ≠‰ø°Âè∑Êù•È©±Âä®ÔºåÂõ†Ê≠§**È©±Âä®Êú¨Ë∫´ÁöÑÂ∑•‰ΩúÂ∞±ÊòØÂÆåÊàêÂêÑÁ±ª‰ø°ÊÅØÁöÑÂàùÂßãÂåñÔºå**Ê≥®ÂÜåÂ•ΩÁõ∏Â∫îÁöÑÂõûË∞ÉÂáΩÊï∞Ôºå‰ª•‰æøËÉΩÂú®‰ø°Âè∑Âà∞Êù•‰πãÊó∂ÂéªÊâßË°åÔºõ</p>
<blockquote>
<ol>
<li>
<p><code>set_smp_process_call</code> ËÆæÁΩÆ <code>__smp_cross_call</code> ÂáΩÊï∞ÊåáÂêë <code>gic_raise_softirq</code>ÔºåÊú¨Ë¥®‰∏äÂ∞±ÊòØÈÄöËøáËΩØ‰ª∂Êù•Ëß¶ÂèëGICÁöÑ <code>SGI‰∏≠Êñ≠</code> ÔºåÁî®‰∫éÊ†∏Èó¥‰∫§‰∫íÔºõ</p>
</li>
<li>
<p><code>cpuhp_setup_state_nocalls</code> ÂáΩÊï∞ÔºåËÆæÁΩÆÂ•ΩCPUËøõË°åÁÉ≠ÊèíÊãîÊó∂GICÁöÑÂõûË∞ÉÂáΩÊï∞Ôºå‰ª•‰æøÂú®CPUÁÉ≠ÊèíÊãîÊó∂ÂÅöÁõ∏Â∫îÂ§ÑÁêÜÔºõ</p>
</li>
<li>
<p><code>set_handle_irq</code> ÂáΩÊï∞ÁöÑËÆæÁΩÆÂæàÂÖ≥ÈîÆÔºåÂÆÉÂ∞ÜÂÖ®Â±ÄÂáΩÊï∞ÊåáÈíà <code>handle_arch_irq</code> ÊåáÂêë‰∫Ü <code>gic_handle_irq</code>ÔºåËÄåÂ§ÑÁêÜÂô®Âú®ËøõÂÖ•‰∏≠Êñ≠ÂºÇÂ∏∏Êó∂Ôºå‰ºöË∑≥ËΩ¨Âà∞ <code>handle_arch_irq</code> ÊâßË°åÔºåÊâÄ‰ª•ÔºåÂèØ‰ª•ËÆ§‰∏∫ÂÆÉÂ∞±ÊòØ‰∏≠Êñ≠Â§ÑÁêÜÁöÑÂÖ•Âè£ÂáΩÊï∞‰∫ÜÔºõ</p>
</li>
</ol>
</blockquote>
<p>È©±Âä®‰∏≠ÂÆåÊàê‰∫ÜÂêÑÁ±ªÂáΩÊï∞ÁöÑÊ≥®ÂÜåÔºåÊ≠§Â§ñËøòÂÆåÊàê‰∫Ü <code>irq_chip</code>, <code>irq_domain</code> Á≠âÁªìÊûÑ‰ΩìÁöÑÂàùÂßãÂåñÔºåËøô‰∫õÁªìÊûÑÂú®‰∏ãÊñá‰ºöËøõ‰∏ÄÊ≠•ÂàÜÊûê„ÄÇÊúÄÂêéÔºåÂÆåÊàêGICÁ°¨‰ª∂Ê®°ÂùóÁöÑÂàùÂßãÂåñËÆæÁΩÆÔºå‰ª•ÂèäÁîµÊ∫êÁÆ°ÁêÜÁõ∏ÂÖ≥ÁöÑÊ≥®ÂÜåÁ≠âÂ∑•‰ΩúÔºõ</p>
<p>Êàë‰ª¨ÂèØ‰ª•ÁúãÂà∞Ôºå<code>gic_*</code> ‰Ωú‰∏∫ÂâçÁºÄÁöÑÂáΩÊï∞ÈÉΩÊòØÂíåÁâπÂÆöÁöÑGIC‰∏≠Êñ≠ÊéßÂà∂Âô®Áõ∏ÂÖ≥ÁöÑÔºåÂ¶ÇÊûúÊç¢‰ΩúRISC-VÊû∂ÊûÑÔºåËøô‰∫õÂáΩÊï∞Â∞±‰ºöË¢´ÊõøÊç¢‰∏∫ <code>plic_*/aplic_*</code> Á≠âÁ≠â„ÄÇ</p>
<h3 id="Êï∞ÊçÆÁªìÊûÑÂàÜÊûê">Êï∞ÊçÆÁªìÊûÑÂàÜÊûê
</h3><p><strong>ÂêÑÊï∞ÊçÆÁªìÊûÑÁöÑ‰æùËµñÂÖ≥Á≥ªÂ¶Ç‰∏ãÂõæÔºö</strong></p>
<p><img src="https://img2020.cnblogs.com/blog/1771657/202005/1771657-20200531111554895-528341955.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>GICÈ©±Âä®‰∏≠Ôºå‰ΩøÁî® <code>struct gic_chip_data</code> ÁªìÊûÑ‰ΩìÊù•ÊèèËø∞GICÊéßÂà∂Âô®ÁöÑ‰ø°ÊÅØÔºåÊï¥‰∏™È©±Âä®ÈÉΩÊòØÂõ¥ÁªïÁùÄËØ•ÁªìÊûÑ‰ΩìÁöÑÂàùÂßãÂåñÔºå<strong>È©±Âä®‰∏≠Â∞ÜÂáΩÊï∞ÊåáÈíàÈÉΩÂàùÂßãÂåñÂ•ΩÔºåÂÆûÈôÖÁöÑÂ∑•‰ΩúÊòØÁî±‰∏≠Êñ≠‰ø°Âè∑Ëß¶ÂèëÔºå‰πüÂ∞±ÊòØÂú®‰∏≠Êñ≠Êù•‰∏¥ÁöÑÊó∂ÂÄôÂéªËøõË°åÂõûË∞É„ÄÇ</strong></p>
<ul>
<li><code>struct irq_chip</code> ÁªìÊûÑÔºåÊèèËø∞ÁöÑÊòØ‰∏≠Êñ≠ÊéßÂà∂Âô®ÁöÑÂ∫ïÂ±ÇÊìç‰ΩúÂáΩÊï∞ÈõÜÔºåËøô‰∫õÂáΩÊï∞ÈõÜÊúÄÁªàÂÆåÊàêÂØπÊéßÂà∂Âô®Á°¨‰ª∂ÁöÑÊìç‰Ωú</li>
<li><code>struct irq_domain</code>ÁªìÊûÑÔºåÁî®‰∫éÁ°¨‰ª∂‰∏≠Êñ≠Âè∑ÂíåLinux IRQ‰∏≠Êñ≠Âè∑ÔºàvirqÔºåËôöÊãü‰∏≠Êñ≠Âè∑Ôºâ‰πãÈó¥ÁöÑÊò†Â∞ÑÔºõ</li>
</ul>
<p>ËøòÊòØ‰∏ä‰∏Ä‰∏ãÂÖ∑‰ΩìÁöÑÊï∞ÊçÆÁªìÊûÑ‰ª£Á†ÅÂêßÔºåÂÖ≥ÈîÆÊ≥®ÈáäÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span><span class="lnt">99
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">irq_chip</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">struct</span> <span class="n">device</span>	<span class="o">*</span><span class="n">parent_device</span><span class="p">;</span>     <span class="c1">//ÊåáÂêëÁà∂ËÆæÂ§á
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">const</span> <span class="kt">char</span>	<span class="o">*</span><span class="n">name</span><span class="p">;</span>      <span class="c1">//  /proc/interrupts‰∏≠ÊòæÁ§∫ÁöÑÂêçÂ≠ó
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">unsigned</span> <span class="nf">int</span>	<span class="p">(</span><span class="o">*</span><span class="n">irq_startup</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>  <span class="c1">//ÂêØÂä®‰∏≠Êñ≠ÔºåÂ¶ÇÊûúËÆæÁΩÆÊàêNULLÔºåÂàôÈªòËÆ§‰∏∫enable
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_shutdown</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>     <span class="c1">//ÂÖ≥Èó≠‰∏≠Êñ≠ÔºåÂ¶ÇÊûúËÆæÁΩÆÊàêNULLÔºåÂàôÈªòËÆ§‰∏∫disable
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_enable</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>   <span class="c1">//‰∏≠Êñ≠‰ΩøËÉΩÔºåÂ¶ÇÊûúËÆæÁΩÆÊàêNULLÔºåÂàôÈªòËÆ§‰∏∫chip-&gt;unmask
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_disable</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>  <span class="c1">//‰∏≠Êñ≠Á¶ÅÊ≠¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_ack</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>  <span class="c1">//ÂºÄÂßãÊñ∞ÁöÑ‰∏≠Êñ≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_mask</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span> <span class="c1">//‰∏≠Êñ≠Ê∫êÂ±èËîΩ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_mask_ack</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span> <span class="c1">//Â∫îÁ≠îÂπ∂Â±èËîΩ‰∏≠Êñ≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_unmask</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>   <span class="c1">//Ëß£Èô§‰∏≠Êñ≠Â±èËîΩ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_eoi</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>  <span class="c1">//‰∏≠Êñ≠Â§ÑÁêÜÁªìÊùüÂêéË∞ÉÁî®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_set_affinity</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">cpumask</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">force</span><span class="p">);</span> <span class="c1">//Âú®SMP‰∏≠ËÆæÁΩÆCPU‰∫≤ÂíåÂäõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_retrigger</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>    <span class="c1">//ÈáçÊñ∞ÂèëÈÄÅ‰∏≠Êñ≠Âà∞CPU
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_set_type</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">flow_type</span><span class="p">);</span> <span class="c1">//ËÆæÁΩÆ‰∏≠Êñ≠Ëß¶ÂèëÁ±ªÂûã
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_set_wake</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">on</span><span class="p">);</span>    <span class="c1">//‰ΩøËÉΩ/Á¶ÅÊ≠¢ÁîµÊ∫êÁÆ°ÁêÜ‰∏≠ÁöÑÂî§ÈÜíÂäüËÉΩ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_bus_lock</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span> <span class="c1">//ÊÖ¢ÈÄüËäØÁâáÊÄªÁ∫ø‰∏äÁöÑÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_bus_sync_unlock</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>  <span class="c1">//ÂêåÊ≠•ÈáäÊîæÊÖ¢ÈÄüÊÄªÁ∫øËäØÁâáÁöÑÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_cpu_online</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_cpu_offline</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_suspend</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_resume</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_pm_shutdown</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_calc_mask</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_print_chip</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_request_resources</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_release_resources</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_compose_msi_msg</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="k">struct</span> <span class="n">msi_msg</span> <span class="o">*</span><span class="n">msg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_write_msi_msg</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="k">struct</span> <span class="n">msi_msg</span> <span class="o">*</span><span class="n">msg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_get_irqchip_state</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="k">enum</span> <span class="n">irqchip_irq_state</span> <span class="n">which</span><span class="p">,</span> <span class="kt">bool</span> <span class="o">*</span><span class="n">state</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_set_irqchip_state</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="k">enum</span> <span class="n">irqchip_irq_state</span> <span class="n">which</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">state</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">irq_set_vcpu_affinity</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">vcpu_info</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">ipi_send_single</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cpu</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">ipi_send_mask</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">cpumask</span> <span class="o">*</span><span class="n">dest</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">flags</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">irq_domain</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">link</span><span class="p">;</span>  <span class="c1">//Áî®‰∫éÊ∑ªÂä†Âà∞ÂÖ®Â±ÄÈìæË°®irq_domain_list‰∏≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>   <span class="c1">//IRQ domainÁöÑÂêçÂ≠ó
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">const</span> <span class="k">struct</span> <span class="n">irq_domain_ops</span> <span class="o">*</span><span class="n">ops</span><span class="p">;</span>   <span class="c1">//IRQ domainÊò†Â∞ÑÊìç‰ΩúÂáΩÊï∞ÈõÜ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="o">*</span><span class="n">host_data</span><span class="p">;</span>    <span class="c1">//Âú®GICÈ©±Âä®‰∏≠ÔºåÊåáÂêë‰∫Üirq_gic_data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mapcount</span><span class="p">;</span>  <span class="c1">//Êò†Â∞Ñ‰∏≠Êñ≠ÁöÑ‰∏™Êï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="cm">/* Optional data */</span>
</span></span><span class="line"><span class="cl">	<span class="k">struct</span> <span class="n">fwnode_handle</span> <span class="o">*</span><span class="n">fwnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">enum</span> <span class="n">irq_domain_bus_token</span> <span class="n">bus_token</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">struct</span> <span class="n">irq_domain_chip_generic</span> <span class="o">*</span><span class="n">gc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#ifdef	CONFIG_IRQ_DOMAIN_HIERARCHY
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>	<span class="k">struct</span> <span class="n">irq_domain</span> <span class="o">*</span><span class="n">parent</span><span class="p">;</span>  <span class="c1">//ÊîØÊåÅÁ∫ßËÅîÁöÑËØùÔºåÊåáÂêëÁà∂ËÆæÂ§á
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#endif
</span></span></span><span class="line"><span class="cl"><span class="cp">#ifdef CONFIG_GENERIC_IRQ_DEBUGFS
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>	<span class="k">struct</span> <span class="n">dentry</span>		<span class="o">*</span><span class="n">debugfs_file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#endif
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">	<span class="cm">/* reverse map data. The linear map gets appended to the irq_domain */</span>
</span></span><span class="line"><span class="cl">	<span class="kt">irq_hw_number_t</span> <span class="n">hwirq_max</span><span class="p">;</span>  <span class="c1">//IRQ domainÊîØÊåÅ‰∏≠Êñ≠Êï∞ÈáèÁöÑÊúÄÂ§ßÂÄº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">revmap_direct_max_irq</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">revmap_size</span><span class="p">;</span>   <span class="c1">//Á∫øÊÄßÊò†Â∞ÑÁöÑÂ§ßÂ∞è
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">struct</span> <span class="n">radix_tree_root</span> <span class="n">revmap_tree</span><span class="p">;</span> <span class="c1">//Radix TreeÊò†Â∞ÑÁöÑÊ†πËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">linear_revmap</span><span class="p">[];</span>   <span class="c1">//Á∫øÊÄßÊò†Â∞ÑÁî®Âà∞ÁöÑÊü•ÊâæË°®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">irq_domain_ops</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">match</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_domain</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_node</span> <span class="o">*</span><span class="n">node</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		     <span class="k">enum</span> <span class="n">irq_domain_bus_token</span> <span class="n">bus_token</span><span class="p">);</span>      <span class="c1">// Áî®‰∫é‰∏≠Êñ≠ÊéßÂà∂Âô®ËÆæÂ§á‰∏éIRQ domainÁöÑÂåπÈÖç
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">select</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_domain</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="k">struct</span> <span class="n">irq_fwspec</span> <span class="o">*</span><span class="n">fwspec</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		      <span class="k">enum</span> <span class="n">irq_domain_bus_token</span> <span class="n">bus_token</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">map</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_domain</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">virq</span><span class="p">,</span> <span class="kt">irq_hw_number_t</span> <span class="n">hw</span><span class="p">);</span>    <span class="c1">//Áî®‰∫éÁ°¨‰ª∂‰∏≠Êñ≠Âè∑‰∏éLinux‰∏≠Êñ≠Âè∑ÁöÑÊò†Â∞Ñ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">unmap</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_domain</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">virq</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">xlate</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_domain</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_node</span> <span class="o">*</span><span class="n">node</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		     <span class="k">const</span> <span class="n">u32</span> <span class="o">*</span><span class="n">intspec</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">intsize</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		     <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">out_hwirq</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">out_type</span><span class="p">);</span>     <span class="c1">//ÈÄöËøádevice_nodeÔºåËß£ÊûêÁ°¨‰ª∂‰∏≠Êñ≠Âè∑ÂíåËß¶ÂèëÊñπÂºè
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#ifdef	CONFIG_IRQ_DOMAIN_HIERARCHY
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>	<span class="cm">/* extended V2 interfaces to support hierarchy irq_domains */</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">alloc</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_domain</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">virq</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		     <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nr_irqs</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">free</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_domain</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">virq</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		     <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nr_irqs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">activate</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_domain</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">irq_data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">deactivate</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_domain</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">irq_data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">translate</span><span class="p">)(</span><span class="k">struct</span> <span class="n">irq_domain</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="k">struct</span> <span class="n">irq_fwspec</span> <span class="o">*</span><span class="n">fwspec</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			 <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">out_hwirq</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">out_type</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">#endif
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ÂÖ≥‰∫éirq-domain">ÂÖ≥‰∫éIRQ domain
</h3><p>IRQ domainÁî®‰∫éÂ∞ÜÁ°¨‰ª∂ÁöÑ‰∏≠Êñ≠Âè∑ÔºåËΩ¨Êç¢ÊàêLinuxÁ≥ªÁªü‰∏≠ÁöÑ‰∏≠Êñ≠Âè∑Ôºà<code>virtual irq, virq</code>ÔºâÔºåÊù•Âº†ÂõæÔºö</p>
<p><img src="https://img2020.cnblogs.com/blog/1771657/202005/1771657-20200531111647851-1005315068.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>ÊØè‰∏™‰∏≠Êñ≠ÊéßÂà∂Âô®ÈÉΩÂØπÂ∫î‰∏Ä‰∏™IRQ DomainÔºõ</li>
<li>‰∏≠Êñ≠ÊéßÂà∂Âô®È©±Âä®ÈÄöËøá <code>irq_domain_add_*()</code> Êé•Âè£Êù•ÂàõÂª∫ IRQ DomainÔºõ</li>
<li>IRQ DomainÊîØÊåÅ‰∏âÁßçÊò†Â∞ÑÊñπÂºèÔºölinear mapÔºàÁ∫øÊÄßÊò†Â∞ÑÔºâÔºåtree mapÔºàÊ†ëÊò†Â∞ÑÔºâÔºåno mapÔºà‰∏çÊò†Â∞ÑÔºâ
<ul>
<li><code>linear map</code>: Áª¥Êä§Âõ∫ÂÆöÂ§ßÂ∞èÁöÑË°®ÔºåÁ¥¢ÂºïÊòØÁ°¨‰ª∂‰∏≠Êñ≠Âè∑ÔºåÂ¶ÇÊûúÁ°¨‰ª∂‰∏≠Êñ≠ÊúÄÂ§ßÊï∞ÈáèÂõ∫ÂÆöÔºåÂπ∂‰∏îÊï∞ÂÄº‰∏çÂ§ßÔºåÂèØ‰ª•ÈÄâÊã©Á∫øÊÄßÊò†Â∞ÑÔºõ</li>
<li><code>tree map</code>: Á°¨‰ª∂‰∏≠Êñ≠Âè∑ÂèØËÉΩÂæàÂ§ßÔºåÂèØ‰ª•ÈÄâÊã©Ê†ëÊò†Â∞ÑÔºõ</li>
<li><code>no map</code>: Á°¨‰ª∂‰∏≠Êñ≠Âè∑Áõ¥Êé•Â∞±ÊòØLinuxÁöÑ‰∏≠Êñ≠Âè∑Ôºõ</li>
</ul>
</li>
</ul>
<p>‰∏âÁßçÊò†Â∞ÑÁöÑÊñπÂºèÂ¶Ç‰∏ãÂõæÔºö</p>
<p><img src="https://img2020.cnblogs.com/blog/1771657/202005/1771657-20200531111718514-879227841.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>Âõæ‰∏≠ÊèèËø∞‰∫Ü‰∏â‰∏™‰∏≠Êñ≠ÊéßÂà∂Âô®ÔºåÂØπÂ∫îÂà∞‰∏âÁßç‰∏çÂêåÁöÑÊò†Â∞ÑÊñπÂºè„ÄÇÂêÑ‰∏™ÊéßÂà∂Âô®ÁöÑÁ°¨‰ª∂‰∏≠Êñ≠Âè∑ÂèØ‰ª•‰∏ÄÊ†∑ÔºåÊúÄÁªàÂú®LinuxÂÜÖÊ†∏‰∏≠Êò†Â∞ÑÁöÑ‰∏≠Êñ≠Âè∑ÊòØÂîØ‰∏ÄÁöÑ„ÄÇ</p>
<h2 id="12-Êû∂ÊûÑÁõ∏ÂÖ≥‰ª£Á†Å">1.2 Êû∂ÊûÑÁõ∏ÂÖ≥‰ª£Á†Å
</h2><p>‰∏≠Êñ≠‰πüÊòØÂºÇÂ∏∏Ê®°ÂºèÁöÑ‰∏ÄÁßçÔºåÂΩì<strong>Â§ñËÆæËß¶Âèë‰∏≠Êñ≠</strong>Êó∂ÔºåÂ§ÑÁêÜÂô®‰ºöÂàáÊç¢Âà∞ÁâπÂÆöÁöÑÂºÇÂ∏∏Ê®°ÂºèËøõË°åÂ§ÑÁêÜÔºåËÄåËøôÈÉ®ÂàÜ‰ª£Á†ÅÈÉΩÊòØÊû∂ÊûÑÁõ∏ÂÖ≥ÁöÑ„ÄÇARM64ÁöÑ‰ª£Á†Å‰Ωç‰∫é <code>arch/arm64/kernel/entry.S</code>„ÄÇ</p>
<p>ARM64 Â§ÑÁêÜÂô®ÊúâÂõõ‰∏™ÂºÇÂ∏∏Á∫ßÂà´ Exception LevelÔºö0~3Ôºå<code>EL0</code> ÂØπÂ∫îÁî®Êà∑ÊÄÅÁ®ãÂ∫èÔºå<code>EL1</code> ÂØπÂ∫îÊìç‰ΩúÁ≥ªÁªüÂÜÖÊ†∏ÊÄÅÔºå<code>EL2</code>ÂØπÂ∫îHypervisorÔºå<code>EL3</code> ÂØπÂ∫îSecure Monitor„ÄÇ</p>
<p>ÂΩìÂºÇÂ∏∏Ëß¶ÂèëÊó∂ÔºåÂ§ÑÁêÜÂô®ËøõË°åÊ®°ÂºèÂàáÊç¢ÔºåÂπ∂‰∏îË∑≥ËΩ¨Âà∞ÂºÇÂ∏∏ÂêëÈáèË°®ÂºÄÂßãÊâßË°åÔºåÈíàÂØπ‰∏≠Êñ≠ÂºÇÂ∏∏ÔºåÊúÄÁªà‰ºöË∑≥ËΩ¨Âà∞<code>irq_handler</code> ‰∏≠„ÄÇ‰ª£Á†ÅÊØîËæÉÁÆÄÂçïÔºåÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Interrupt handling.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl">	<span class="p">.</span><span class="n">macro</span>	<span class="n">irq_handler</span>
</span></span><span class="line"><span class="cl">	<span class="n">ldr_l</span>	<span class="n">x1</span><span class="p">,</span> <span class="n">handle_arch_irq</span> <span class="c1">//‰πãÂâçGICÈ©±Âä®Ê≥®ÂÜåÂ•ΩÁöÑgic_handle_irq
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">mov</span>	<span class="n">x0</span><span class="p">,</span> <span class="n">sp</span>
</span></span><span class="line"><span class="cl">	<span class="n">irq_stack_entry</span>
</span></span><span class="line"><span class="cl">	<span class="n">blr</span>	<span class="n">x1</span>
</span></span><span class="line"><span class="cl">	<span class="n">irq_stack_exit</span>
</span></span><span class="line"><span class="cl">	<span class="p">.</span><span class="n">endm</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÜÖÊ†∏Êï¥‰∏™‰∏≠Êñ≠Â§ÑÁêÜÊµÅÁ®ã‰∏∫Ôºö</p>
<p><img src="https://img2020.cnblogs.com/blog/1771657/202005/1771657-20200531111755704-1231972965.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>‰∏≠Êñ≠Ëß¶ÂèëÔºåÂ§ÑÁêÜÂô®ÂéªÂºÇÂ∏∏ÂêëÈáèË°®ÊâæÂà∞ÂØπÂ∫îÁöÑÂÖ•Âè£ÔºåÊØîÂ¶ÇEL0ÁöÑ‰∏≠Êñ≠Ë∑≥ËΩ¨Âà∞ <code>el0_irq</code> Â§ÑÔºåEL1 ÂàôË∑≥ËΩ¨Âà∞ <code>el1_irq</code>Â§Ñ„ÄÇÂú®GICÈ©±Âä®‰∏≠Ôºå‰ºöË∞ÉÁî® <code>set_handle_irq</code> Êé•Âè£Êù•ËÆæÁΩÆ <code>handle_arch_irq</code> ÁöÑÂáΩÊï∞ÊåáÈíàÔºåËÆ©ÂÆÉÊåáÂêë<code>gic_handle_irq</code>ÔºåÂõ†Ê≠§‰∏≠Êñ≠Ëß¶ÂèëÁöÑÊó∂ÂÄô‰ºöË∑≥ËΩ¨Âà∞ <code>gic_handle_irq</code> Â§ÑÊâßË°åÔºõ</p>
<ul>
<li><code>gic_handle_irq</code> ÂáΩÊï∞Â§ÑÁêÜÊó∂ÔºåÂàÜ‰∏∫‰∏§ÁßçÊÉÖÂÜµÔºå‰∏ÄÁßçÊòØÂ§ñËÆæËß¶ÂèëÁöÑ‰∏≠Êñ≠ÔºåÁ°¨‰ª∂‰∏≠Êñ≠Âè∑Âú® <code>16 ~ 1020</code> ‰πãÈó¥Ôºå‰∏ÄÁßçÊòØËΩØ‰ª∂Ëß¶ÂèëÁöÑ‰∏≠Êñ≠ÔºåÁî®‰∫éÂ§ÑÁêÜÂô®‰πãÈó¥ÁöÑ‰∫§‰∫íÔºåÁ°¨‰ª∂‰∏≠Êñ≠Âè∑Âú®16‰ª•ÂÜÖÔºõ</li>
<li>Â§ñËÆæËß¶Âèë‰∏≠Êñ≠ÂêéÔºåÊ†πÊçÆ <code>irq domain</code> ÂéªÊü•ÊâæÂØπÂ∫îÁöÑLinux IRQ‰∏≠Êñ≠Âè∑ÔºåËøõËÄåÂæóÂà∞‰∏≠Êñ≠ÊèèËø∞Á¨¶<code>irq_desc</code>ÔºåÊúÄÁªà‰πüÂ∞±ËÉΩË∞ÉÁî®Âà∞Â§ñËÆæÁöÑ‰∏≠Êñ≠Â§ÑÁêÜÂáΩÊï∞‰∫Ü„ÄÇ</li>
</ul>
<p><code>GIC/Arch</code> Áõ∏ÂÖ≥ÁöÑ‰ªãÁªçÂ∞±Ê≠§Êâì‰ΩèÔºåÊé•‰∏ãÊù•ÊòØLinuxÂÜÖÊ†∏ÁöÑÈÄöÁî®‰∏≠Êñ≠Â§ÑÁêÜÊ°ÜÊû∂„ÄÇ</p>
<h1 id="2-ÈÄöÁî®Ê°ÜÊû∂Â±Ç">2 ÈÄöÁî®Ê°ÜÊû∂Â±Ç
</h1><p>‰∏ä‰∏ÄÁ´†‰∏ªË¶ÅËÆ≤‰∫ÜÂ∫ïÂ±ÇÁ°¨‰ª∂GICÈ©±Âä®Ôºå‰ª•ÂèäArch-SpecificÁöÑ‰∏≠Êñ≠‰ª£Á†ÅÔºåÊú¨ÊñáÂ∞ÜÁ†îÁ©∂‰∏ã<strong>ÈÄöÁî®ÁöÑ‰∏≠Êñ≠Â§ÑÁêÜÁöÑËøáÁ®ã</strong>ÔºåÂ±û‰∫éÁ°¨‰ª∂Êó†ÂÖ≥Â±Ç„ÄÇ‰∏ãÈù¢ÁöÑÂÜÖÂÆπÂ∞ÜÂõ¥Áªï‰∏§‰∏™ÈóÆÈ¢òÔºö</p>
<ol>
<li><strong>Áî®Êà∑ÊòØÊÄé‰πà‰ΩøÁî®‰∏≠Êñ≠ÁöÑÔºà<code>‰∏≠Êñ≠Ê≥®ÂÜå</code>ÔºâÔºü</strong></li>
<li><strong>Â§ñËÆæËß¶Âèë‰∏≠Êñ≠‰ø°Âè∑Êó∂ÔºåÊúÄÁªàÊòØÊÄé‰πàË∞ÉÁî®Âà∞‰∏≠Êñ≠handlerÁöÑÔºà<code>‰∏≠Êñ≠Â§ÑÁêÜ</code>ÔºâÔºü</strong></li>
</ol>
<h2 id="21-Êï∞ÊçÆÁªìÊûÑÂàÜÊûê">2.1 Êï∞ÊçÆÁªìÊûÑÂàÜÊûê
</h2><p>ÂÖàÊù•Áúã‰∏Ä‰∏ãÊÄªÁöÑÊï∞ÊçÆÁªìÊûÑÔºåÊ†∏ÂøÉÊòØÂõ¥ÁªïÁùÄ <code>struct irq_desc</code> Êù•Â±ïÂºÄÔºö</p>
<p><img src="https://img2020.cnblogs.com/blog/1771657/202006/1771657-20200605223624401-1747243848.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>LinuxÂÜÖÊ†∏ÁöÑ‰∏≠Êñ≠Â§ÑÁêÜÔºåÂõ¥ÁªïÁùÄ‰∏≠Êñ≠ÊèèËø∞Á¨¶ÁªìÊûÑ <code>struct irq_desc</code> Â±ïÂºÄÔºåÂÜÖÊ†∏Êèê‰æõ‰∫Ü‰∏§Áßç<strong>‰∏≠Êñ≠ÊèèËø∞Á¨¶ÁªÑÁªáÂΩ¢Âºè</strong>Ôºö</p>
<blockquote>
<ol>
<li>ÊâìÂºÄ <code>CONFIG_SPARSE_IRQ</code> ÂÆèÔºà‰∏≠Êñ≠ÁºñÂè∑‰∏çËøûÁª≠ÔºâÔºå‰∏≠Êñ≠ÊèèËø∞Á¨¶‰ª• <code>radix-tree </code> Êù•ÁªÑÁªáÔºåÁî®Êà∑Âú®ÂàùÂßãÂåñÊó∂ËøõË°åÂä®ÊÄÅÂàÜÈÖçÔºåÁÑ∂ÂêéÂÜçÊèíÂÖ• <code>radix-tree</code> ‰∏≠Ôºõ</li>
<li>ÂÖ≥Èó≠ <code>CONFIG_SPARSE_IRQ</code> ÂÆèÔºà‰∏≠Êñ≠ÁºñÂè∑ËøûÁª≠ÔºâÔºå‰∏≠Êñ≠ÊèèËø∞Á¨¶‰ª•Êï∞ÁªÑÁöÑÂΩ¢ÂºèÁªÑÁªáÔºåÂπ∂‰∏îÂ∑≤ÁªèÂàÜÈÖçÂ•ΩÔºõ</li>
<li>‰∏çÁÆ°Âì™ÁßçÂΩ¢ÂºèÔºåÊúÄÁªàÈÉΩÂèØ‰ª•ÈÄöËøá <code>linux irq</code> Âè∑Êù•ÊâæÂà∞ÂØπÂ∫îÁöÑ‰∏≠Êñ≠ÊèèËø∞Á¨¶Ôºõ</li>
</ol>
</blockquote>
<p>ÂõæÁöÑÂ∑¶‰æßÁÅ∞Ëâ≤ÈÉ®ÂàÜÔºå‰∏ä‰∏ÄÁ´†Â∑≤Áªè‰ªãÁªçËøáÔºå‰∏ªË¶Å**Âú®‰∏≠Êñ≠ÊéßÂà∂Âô®È©±Âä®‰∏≠ËøõË°åÂàùÂßãÂåñËÆæÁΩÆÔºå**ÂåÖÊã¨ÂêÑ‰∏™ÁªìÊûÑ‰∏≠ÂáΩÊï∞ÊåáÈíàÁöÑÊåáÂêëÁ≠âÔºåÂÖ∂‰∏≠ <code>struct irq_chip</code> Áî®‰∫éÂØπ‰∏≠Êñ≠ÊéßÂà∂Âô®ÁöÑÁ°¨‰ª∂Êìç‰ΩúÔºå<code>struct irq_domain</code> ‰∏é‰∏≠Êñ≠ÊéßÂà∂Âô®ÂØπÂ∫îÔºåÂÆåÊàêÁöÑÂ∑•‰ΩúÊòØÁ°¨‰ª∂‰∏≠Êñ≠Âè∑Âà∞ <code>Linux irq</code> ÁöÑÊò†Â∞Ñ„ÄÇ</p>
<p>ÂõæÁöÑ‰∏ä‰æßÁÅ∞Ëâ≤ÈÉ®ÂàÜÔºå<strong>‰∏≠Êñ≠ÊèèËø∞Á¨¶ÁöÑÂàõÂª∫</strong>ÔºàËøôÈáåÊåá <code>CONFIG_SPARSE_IRQ</code> ÔºâÔºå‰∏ªË¶ÅÂú®Ëé∑ÂèñËÆæÂ§á‰∏≠Êñ≠‰ø°ÊÅØÁöÑËøáÁ®ã‰∏≠ÂÆåÊàêÁöÑÔºå‰ªéËÄåËÆ©ËÆæÂ§áÊ†ë‰∏≠ÁöÑ‰∏≠Êñ≠ËÉΩ‰∏éÂÖ∑‰ΩìÁöÑ‰∏≠Êñ≠ÊèèËø∞Á¨¶ <code>irq_desc</code> ÂåπÈÖçÔºåÂú®ÂêéÊñáÁöÑ<strong>‰∏≠Êñ≠Ê≥®ÂÜå</strong>‰∏≠‰ºö‰ªãÁªç„ÄÇ</p>
<p>Âõæ‰∏≠Ââ©‰ΩôÈÉ®ÂàÜÔºåÂú®ËÆæÂ§áÁî≥ËØ∑Ê≥®ÂÜå‰∏≠Êñ≠ÁöÑËøáÁ®ã‰∏≠ËøõË°åËÆæÁΩÆÔºåÊØîÂ¶Ç <code>struct irqaction</code> ‰∏≠ <code>handler</code> ÁöÑËÆæÁΩÆÔºåËøô‰∏™Áî®‰∫é<strong>ÊåáÂêëÊàë‰ª¨ËÆæÂ§áÈ©±Âä®Á®ãÂ∫è‰∏≠ÁöÑ‰∏≠Êñ≠Â§ÑÁêÜÂáΩÊï∞</strong>‰∫Ü„ÄÇ</p>
<p>‰∏≠Êñ≠ÁöÑÂ§ÑÁêÜ‰∏ªË¶ÅÊúâ‰ª•‰∏ãÂá†‰∏™<strong>Ê†∏ÂøÉÂäüËÉΩÊ®°Âùó</strong>Ôºö</p>
<blockquote>
<ol>
<li>Á°¨‰ª∂‰∏≠Êñ≠Âè∑Âà∞ <code>Linux irq</code> ‰∏≠Êñ≠Âè∑ÁöÑÊò†Â∞ÑÔºåÂπ∂ÂàõÂª∫Â•Ω <code>irq_desc</code> ‰∏≠Êñ≠ÊèèËø∞Á¨¶Ôºõ</li>
<li>‰∏≠Êñ≠Ê≥®ÂÜåÊó∂ÔºåÂÖàËé∑ÂèñËÆæÂ§áÁöÑ‰∏≠Êñ≠Âè∑ÔºåÊ†πÊçÆ‰∏≠Êñ≠Âè∑ÊâæÂà∞ÂØπÂ∫îÁöÑ <code>irq_desc</code> ÔºåÂπ∂Â∞ÜËÆæÂ§áÁöÑ‰∏≠Êñ≠Â§ÑÁêÜÂáΩÊï∞Ê∑ªÂä†Âà∞ <code>irq_desc</code> ‰∏≠Ôºõ</li>
<li>ËÆæÂ§áËß¶Âèë‰∏≠Êñ≠‰ø°Âè∑Êó∂ÔºåÊ†πÊçÆÁ°¨‰ª∂‰∏≠Êñ≠Âè∑ÂæóÂà∞ <code>Linux irq</code> ‰∏≠Êñ≠Âè∑ÔºåÊâæÂà∞ÂØπÂ∫îÁöÑ <code>irq_desc</code> ÔºåÊúÄÁªàË∞ÉÁî®Âà∞ËÆæÂ§áÁöÑ‰∏≠Êñ≠Â§ÑÁêÜÂáΩÊï∞„ÄÇ</li>
</ol>
</blockquote>
<p>‰ª•‰∏äÂäüËÉΩÊ®°ÂùóÊûÑÊàê‰∫ÜLinux‰∏≠Êñ≠Ê°ÜÊû∂ÁöÑÊ†∏ÂøÉÈÉ®ÂàÜÔºå‰∏ãÈù¢ËØ¶ÁªÜÂàÜÊûê„ÄÇ</p>
<h2 id="22-‰∏≠Êñ≠Ê°ÜÊû∂ÂàÜÊûê">2.2 ‰∏≠Êñ≠Ê°ÜÊû∂ÂàÜÊûê
</h2><h3 id="‰∏≠Êñ≠Ê≥®ÂÜå">‰∏≠Êñ≠Ê≥®ÂÜå
</h3><p>È¶ñÂÖàÊÄùËÄÉ‰∏Ä‰∏™ÈóÆÈ¢ò: <em><strong>Áî®Êà∑ÊòØÊÄé‰πà‰ΩøÁî®‰∏≠Êñ≠ÁöÑÔºü</strong></em></p>
<ul>
<li>ÁÜüÊÇâËÆæÂ§áÈ©±Âä®ÁöÑÂêåÂ≠¶Â∫îËØ•ÈÉΩÊ∏ÖÊ•öÔºåÁªèÂ∏∏‰ºöÂú®È©±Âä®Á®ãÂ∫è‰∏≠Ë∞ÉÁî® <code>request_irq()</code> Êé•Âè£ÊàñËÄÖ<code>request_threaded_irq()</code> Êé•Âè£Êù•Ê≥®ÂÜåËÆæÂ§áÁöÑ‰∏≠Êñ≠Â§ÑÁêÜÂáΩÊï∞Ôºõ</li>
<li><code>request_irq()/request_threaded_irq</code> Êé•Âè£‰∏≠ÔºåÈÉΩÈúÄË¶ÅÁî®Âà∞ <code>irq</code>Ôºå‰πüÂ∞±ÊòØ‰∏≠Êñ≠Âè∑ÔºåÈÇ£‰πàËøô‰∏™‰∏≠Êñ≠Âè∑ÊòØ‰ªéÂì™ÈáåÊù•ÁöÑÂë¢ÔºüÂÆÉÊòØ <code>Linux irq</code>ÔºåÂÆÉÂèàÊòØÂ¶Ç‰ΩïÊò†Â∞ÑÂà∞ÂÖ∑‰ΩìÁöÑÁ°¨‰ª∂ËÆæÂ§áÁöÑ‰∏≠Êñ≠Âè∑ÁöÑÂë¢Ôºü</li>
</ul>
<p>‰ºº‰πéÊúâ‰∫õË∑ëÈ¢ò‰∫ÜÔºå‰ΩÜÂÆûÈôÖ‰∏äÂú®Áî®Êà∑ËøõË°å**‰∏≠Êñ≠Ê≥®ÂÜå‰πãÂâçÂÜÖÊ†∏ÂøÖÁÑ∂‰ºöËøõË°å‰∏Ä‰∫õÂü∫Êú¨ÁöÑËÆæÁΩÆ„ÄÇ**ËøôÊ†∑Â∞±Êù•Âà∞‰∫ÜLinux‰∏≠Êñ≠Ê°ÜÊû∂‰∏≠‰∏Ä‰∏™ÈáçË¶ÅÂäüËÉΩÊ®°Âùó: <strong>ËÆæÂ§áÁ°¨‰ª∂‰∏≠Êñ≠Âà∞ <code>Linux irq</code> ‰∏≠Êñ≠Âè∑ÁöÑÊò†Â∞Ñ</strong>„ÄÇ</p>
<hr>
<blockquote>
<p><em><strong>‰∏∫‰ªÄ‰πàÈúÄË¶Å‰∏≠Êñ≠Êò†Â∞ÑÔºü</strong></em></p>
<ul>
<li><strong>Á°¨‰ª∂‰∏≠Êñ≠Âè∑:</strong> GIC‰∏∫ÊØè‰∏Ä‰∏™Á°¨‰ª∂‰∏≠Êñ≠Ê∫êÈÉΩÂàÜÈÖç‰∫Ü‰∏Ä‰∏™ÂîØ‰∏ÄÁºñÂè∑ÔºåÁß∞‰∏∫Á°¨‰ª∂‰∏≠Êñ≠Âè∑ÔºåÁî®‰∫éÂå∫ÂàÜ‰∏çÂêåÁöÑ‰∏≠Êñ≠Ê∫ê„ÄÇGIC-v3ÊîØÊåÅÁöÑÁ°¨‰ª∂‰∏≠Êñ≠Á±ªÂûãÂíåÂàÜÈÖçÁöÑÁ°¨‰ª∂‰∏≠Êñ≠Âè∑ËåÉÂõ¥Â¶Ç‰∏ã:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nl">SGI</span><span class="p">:</span> <span class="mi">0</span><span class="o">-</span><span class="mi">15</span>
</span></span><span class="line"><span class="cl"><span class="nl">PPI</span><span class="p">:</span> <span class="mi">16</span><span class="o">-</span><span class="mi">31</span>
</span></span><span class="line"><span class="cl"><span class="nl">SPI</span><span class="p">:</span> <span class="mi">21</span><span class="o">-</span><span class="mi">1019</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>ËΩØ‰ª∂‰∏≠Êñ≠Âè∑:</strong> Á≥ªÁªüÂú®‰∏≠Êñ≠Ê≥®ÂÜåÂíå‰∏≠Êñ≠Â§ÑÁêÜËøáÁ®ã‰∏≠‰ΩøÁî®Âà∞ÁöÑ‰∏≠Êñ≠Âè∑„ÄÇÊúâÁöÑÂú∞Êñπ‰πüÁß∞‰∏∫ËôöÊãü‰∏≠Êñ≠Âè∑„ÄÇ</li>
</ul>
<p>‰∏∫‰ªÄ‰πàË¶ÅËøõË°å‰∏≠Êñ≠Êò†Â∞ÑÂë¢ÔºüÁÆÄÂçïÊù•ËÆ≤ÔºåËΩØ‰ª∂ÂèØ‰ª•‰∏çÈúÄË¶ÅÂÖ≥Ê≥®ËØ•‰∏≠Êñ≠Âú®Á°¨‰ª∂‰∏äÊòØÂì™‰∏™‰∏≠Êñ≠Êù•Ê∫ê„ÄÇÁÆÄÂçïÁöÑSOCÂÜÖÈÉ®ÂØπ‰∏≠Êñ≠ÁöÑÁÆ°ÁêÜ‰πüÊØîËæÉÁÆÄÂçïÔºåÈÄöÂ∏∏‰ºöÊúâ‰∏Ä‰∏™ÂÖ®Â±ÄÁöÑ‰∏≠Êñ≠Áä∂ÊÄÅÂØÑÂ≠òÂô®Êù•ËÆ∞ÂΩïÂ§ñËÆæ‰∏≠Êñ≠ÔºåËøôÊ†∑Áõ¥Êé•Â∞ÜÁ°¨‰ª∂‰∏≠Êñ≠Âè∑Á∫øÊÄßÊò†Â∞ÑÂà∞ËΩØ‰ª∂‰∏≠Êñ≠Âè∑Âç≥ÂèØ„ÄÇ‰ΩÜÊòØÈöèÁùÄËäØÁâáÊäÄÊúØÁöÑÂèëÂ±ïÔºåSOCË∂äÊù•Ë∂äÂ§çÊùÇÔºåÈÄöÂ∏∏ÂÜÖÈÉ®‰ºöÊúâÂ§ö‰∏™‰∏≠Êñ≠ÊéßÂà∂Âô®ÔºàÊØîÂ¶ÇGIC interrupt controller, GPIO interrupt controllerÔºâ, ÊØè‰∏Ä‰∏™‰∏≠Êñ≠ÊéßÂà∂Âô®ÂØπÂ∫îÂ§ö‰∏™‰∏≠Êñ≠Âè∑ÔºåËÄåÁ°¨‰ª∂‰∏≠Êñ≠Âè∑Âú®‰∏çÂêåÁöÑ‰∏≠Êñ≠ÊéßÂà∂Âô®‰∏äÊòØ‰ºöÈáçÂ§çÁºñÁ†ÅÔºå ËøôÊó∂‰ªÖ‰ªÖÁî®Á°¨‰∏≠Êñ≠Âè∑Â∑≤Áªè‰∏çËÉΩÂîØ‰∏ÄÊ†áËØÜ‰∏Ä‰∏™Â§ñËÆæ‰∏≠Êñ≠„ÄÇÂ∞§ÂÖ∂Âú®Â§ö‰∏™<strong>‰∏≠Êñ≠ÊéßÂà∂Âô®Á∫ßËÅî</strong>ÁöÑÊÉÖÂÜµ‰∏ãÔºå‰ºöÂèòÂæóÊõ¥Âä†Â§çÊùÇ„ÄÇËøôÊ†∑ÂØπËΩØ‰ª∂ÁºñÁ®ãÊù•ËÆ≤ÊûÅ‰∏çÂèãÂ•ΩÔºå‰Ωú‰∏∫ËΩØ‰ª∂Â∑•Á®ãÂ∏àÔºåÊàë‰ª¨Êõ¥ÊÑøÊÑèÈõÜ‰∏≠Á≤æÂäõÂÖ≥Ê≥®ËΩØ‰ª∂Â±ÇÈù¢ÁöÑÂÜÖÂÆπ„ÄÇ</p>
</blockquote>
<p>‰∏≠Êñ≠Êò†Â∞ÑÁöÑËøáÁ®ãÂ¶Ç‰∏ãÂõæ:</p>
<p><img src="https://img2020.cnblogs.com/blog/1771657/202006/1771657-20200605222653356-1874117507.png"
	
	
	
	loading="lazy"
	
	
></p>
<blockquote>
<ul>
<li>Á°¨‰ª∂ËÆæÂ§áÁöÑ‰∏≠Êñ≠‰ø°ÊÅØÈÉΩÂú®ËÆæÂ§áÊ†ë <code>device tree</code> ‰∏≠ËøõË°å‰∫ÜÊèèËø∞ÔºåÂú®Á≥ªÁªüÂêØÂä®ËøáÁ®ã‰∏≠ÔºåËøô‰∫õ‰ø°ÊÅØÈÉΩÂ∑≤ÁªèÂä†ËΩΩÂà∞ÂÜÖÂ≠ò‰∏≠Âπ∂ÂæóÂà∞‰∫ÜËß£ÊûêÔºõ</li>
<li>È©±Âä®‰∏≠ÈÄöÂ∏∏‰ºö‰ΩøÁî® <code>platform_get_irq</code> Êàñ <code>irq_of_parse_and_map</code> Êé•Âè£ÔºåÂéªÊ†πÊçÆËÆæÂ§áÊ†ëÁöÑ‰ø°ÊÅØÂéªÂàõÂª∫Êò†Â∞ÑÂÖ≥Á≥ªÔºàÁ°¨‰ª∂‰∏≠Êñ≠Âè∑Âà∞<code>linux irq</code>‰∏≠Êñ≠Âè∑Êò†Â∞ÑÔºâÔºõ</li>
</ul>
</blockquote>
<p>‰πãÂâçÊèêÂà∞Ëøá <code>struct irq_domain</code> Áî®‰∫éÂÆåÊàêÊò†Â∞ÑÂ∑•‰ΩúÔºåÂõ†Ê≠§Âú® <code>irq_create_fwspec_mapping</code> Êé•Âè£‰∏≠Ôºå‰ºöÂÖàÂéªÊâæÂà∞ÂåπÈÖçÁöÑ <code>irq domain</code>ÔºåÂÜçÂéªÂõûË∞ÉËØ• <code>irq domain</code> ‰∏≠ÁöÑÂáΩÊï∞ÈõÜ (<code>irq_domain_ops</code>)ÔºåÈÄöÂ∏∏ <code>irq domain</code> ÈÉΩÊòØÂú®‰∏≠Êñ≠ÊéßÂà∂Âô®È©±Âä®‰∏≠ÂàùÂßãÂåñÁöÑÔºå‰ª• <code>ARM GICv2</code> ‰∏∫‰æãÔºåÊúÄÁªàÂõûË∞ÉÂà∞ <code>gic_irq_domain_hierarchy_ops</code> ‰∏≠ÁöÑÂáΩÊï∞Ôºõ</p>
<p>Â¶ÇÊûúÂ∑≤ÁªèÂàõÂª∫Â•Ω‰∫ÜÊò†Â∞ÑÔºåÈÇ£‰πàÂèØ‰ª•Áõ¥Êé•ËøõË°åËøîÂõû <code>linux irq</code> ‰∏≠Êñ≠Âè∑‰∫ÜÔºåÂê¶ÂàôÁöÑËØùÈúÄË¶Å <code>irq_domain_alloc_irqs</code>Êù•ÂàõÂª∫Êò†Â∞ÑÂÖ≥Á≥ª„ÄÇ<code>irq_domain_alloc_irqs</code> ÂÆåÊàê‰∏§‰∏™Â∑•‰Ωú:</p>
<ol>
<li>ÈíàÂØπ <code>linux irq</code> ‰∏≠Êñ≠Âè∑ÂàõÂª∫‰∏Ä‰∏™ <code>irq_desc</code> ‰∏≠Êñ≠ÊèèËø∞Á¨¶Ôºõ</li>
<li>Ë∞ÉÁî® <code>domain-&gt;ops-&gt;alloc</code> ÂáΩÊï∞Êù•ÂÆåÊàêÊò†Â∞ÑÔºåÂú® <code>ARM GICv2</code> È©±Âä®‰∏≠ÂØπÂ∫î <code>gic_irq_domain_alloc</code> ÂáΩÊï∞ÔºåËøô‰∏™ÂáΩÊï∞ÂæàÂÖ≥ÈîÆÔºåÊâÄ‰ª•‰∏ãÊñáÈáçÁÇπ‰ªãÁªç‰∏Ä‰∏ã„ÄÇ</li>
</ol>
<p><strong><code>gic_irq_domain_alloc</code> ÂáΩÊï∞Â¶Ç‰∏ã:</strong></p>
<p><img src="https://img2020.cnblogs.com/blog/1771657/202006/1771657-20200605222839660-1799351554.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li><code>gic_irq_domain_translate</code>ÔºöË¥üË¥£Ëß£ÊûêÂá∫ËÆæÂ§áÊ†ë‰∏≠ÊèèËø∞ÁöÑ‰∏≠Êñ≠Âè∑Âíå‰∏≠Êñ≠Ëß¶ÂèëÁ±ªÂûãÔºàËæπÁºòËß¶Âèë„ÄÅÁîµÂπ≥Ëß¶ÂèëÁ≠âÔºâÔºõ</li>
<li><code>gic_irq_domain_map</code>ÔºöÂ∞ÜÁ°¨‰ª∂‰∏≠Êñ≠Âè∑ÂíålinuxËΩØ‰∏≠Êñ≠Âè∑ÁªëÂÆöÂà∞‰∏Ä‰∏™ÁªìÊûÑ‰∏≠Ôºå‰πüÂ∞±ÂÆåÊàê‰∫ÜÊò†Â∞ÑÔºåÊ≠§Â§ñËøòÁªëÂÆö‰∫Ü<code>irq_desc</code> ÁªìÊûÑ‰∏≠ÁöÑÂÖ∂‰ªñÂ≠óÊÆµÔºå**ÊúÄÈáçË¶ÅÁöÑÊòØËÆæÁΩÆ‰∫Ü <code>irq_desc-&gt;handle_irq</code> ÁöÑÂáΩÊï∞ÊåáÈíàÔºåËøô‰∏™ÊúÄÁªàÊòØ‰∏≠Êñ≠ÂìçÂ∫îÊó∂ÂæÄ‰∏äÊâßË°åÁöÑÂÖ•Âè£Ôºå**Ëøô‰∏™ÊòØÂÖ≥ÈîÆÔºå‰∏ãÊñáËÆ≤Ëø∞‰∏≠Êñ≠Â§ÑÁêÜËøáÁ®ãÊó∂Ëøò‰ºöÊèêÂà∞Ôºõ</li>
<li>Ê†πÊçÆÁ°¨‰ª∂‰∏≠Êñ≠Âè∑ÁöÑËåÉÂõ¥ËÆæÁΩÆ <code>irq_desc-&gt;handle_irq</code> ÁöÑÊåáÈíàÔºåÂÖ±‰∫´‰∏≠Êñ≠ÂÖ•Âè£‰∏∫ <code>handle_fasteoi_irq</code>ÔºåÁßÅÊúâ‰∏≠Êñ≠ÂÖ•Âè£‰∏∫ <code>handle_percpu_devid_irq</code>Ôºõ</li>
</ul>
<p>‰∏äËø∞ÂáΩÊï∞ÊâßË°åÂÆåÊàêÂêéÔºåÂÆåÊàê‰∫Ü‰∏§Â§ßÂ∑•‰ΩúÔºö</p>
<blockquote>
<ol>
<li><strong>Á°¨‰ª∂‰∏≠Êñ≠Âè∑‰∏éLinux‰∏≠Êñ≠Âè∑ÂÆåÊàêÊò†Â∞ÑÔºåÂπ∂‰∏∫Linux‰∏≠Êñ≠Âè∑ÂàõÂª∫‰∫Ü<code>irq_desc</code>‰∏≠Êñ≠ÊèèËø∞Á¨¶Ôºõ</strong></li>
<li><strong>Êï∞ÊçÆÁªìÊûÑÁöÑÁªëÂÆöÂèäÂàùÂßãÂåñÔºåÂÖ≥ÈîÆÁöÑÂú∞ÊñπÊòØËÆæÁΩÆ‰∫Ü‰∏≠Êñ≠Â§ÑÁêÜÊâßË°åÊµÅÁ®ãÁöÑÂÖ•Âè£Ôºõ</strong></li>
</ol>
</blockquote>
<hr>
<p>ÂÜÖÊ†∏Â∑≤ÁªèÂÆåÊàê‰∫ÜÂü∫Êú¨ÁöÑËÆæÁΩÆÔºåÂç≥‰∏∫‰∏≠Êñ≠Ê≥®ÂÜåÂÅöÂ•Ω‰∫ÜÂÖÖÂàÜÂáÜÂ§áÔºåÊàë‰ª¨Áé∞Âú®ÂèØ‰ª•<strong>Ê≠£ÂºèÂºÄÂêØ‰∏≠Êñ≠Ê≥®ÂÜåÁöÑÊµÅÁ®ã</strong>‰∫ÜÔºö</p>
<p>ËÆæÂ§áÈ©±Âä®‰∏≠ÔºåËé∑ÂèñÂà∞‰∫Ü <code>irq</code> ‰∏≠Êñ≠Âè∑ÂêéÔºåÈÄöÂ∏∏Â∞±‰ºöÈááÁî® <code>request_irq/request_threaded_irq</code> Êù•Ê≥®ÂÜå‰∏≠Êñ≠ÔºåÂÖ∂‰∏≠<code>request_irq</code> Áî®‰∫éÊ≥®ÂÜåÊôÆÈÄöÂ§ÑÁêÜÁöÑ‰∏≠Êñ≠Ôºå<code>request_threaded_irq</code> Áî®‰∫éÊ≥®ÂÜåÁ∫øÁ®ãÂåñÂ§ÑÁêÜÁöÑ‰∏≠Êñ≠„ÄÇÂú®ËÆ≤ÂÖ∑‰ΩìÁöÑÊ≥®ÂÜåÊµÅÁ®ãÂâçÔºåÂÖàÁúã‰∏Ä‰∏ã‰∏ªË¶ÅÁöÑ‰∏≠Êñ≠Ê†áÂøó‰ΩçÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="cp">#define IRQF_SHARED		0x00000080              </span><span class="c1">//Â§ö‰∏™ËÆæÂ§áÂÖ±‰∫´‰∏Ä‰∏™‰∏≠Êñ≠Âè∑ÔºåÈúÄË¶ÅÂ§ñËÆæÁ°¨‰ª∂ÊîØÊåÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define IRQF_PROBE_SHARED	0x00000100              </span><span class="c1">//‰∏≠Êñ≠Â§ÑÁêÜÁ®ãÂ∫èÂÖÅËÆ∏sharing mismatchÂèëÁîü
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define __IRQF_TIMER		0x00000200              </span><span class="c1">//Êó∂Èíü‰∏≠Êñ≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define IRQF_PERCPU		0x00000400              </span><span class="c1">//Â±û‰∫éÁâπÂÆöCPUÁöÑ‰∏≠Êñ≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define IRQF_NOBALANCING	0x00000800              </span><span class="c1">//Á¶ÅÊ≠¢Âú®CPU‰πãÈó¥ËøõË°å‰∏≠Êñ≠ÂùáË°°Â§ÑÁêÜ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define IRQF_IRQPOLL		0x00001000              </span><span class="c1">//‰∏≠Êñ≠Ë¢´Áî®‰ΩúËΩÆËÆ≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define IRQF_ONESHOT		0x00002000              </span><span class="c1">//‰∏ÄÊ¨°ÊÄßËß¶ÂèëÁöÑ‰∏≠Êñ≠Ôºå‰∏çËÉΩÂµåÂ•óÔºå1ÔºâÂú®Á°¨‰ª∂‰∏≠Êñ≠Â§ÑÁêÜÂÆåÊàêÂêéÊâçËÉΩÊâìÂºÄ‰∏≠Êñ≠Ôºõ2ÔºâÂú®‰∏≠Êñ≠Á∫øÁ®ãÂåñ‰∏≠‰øùÊåÅÂÖ≥Èó≠Áä∂ÊÄÅÔºåÁõ¥Âà∞ËØ•‰∏≠Êñ≠Ê∫ê‰∏äÁöÑÊâÄÊúâthread_fnÂáΩÊï∞ÈÉΩÊâßË°åÂÆå
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define IRQF_NO_SUSPEND		0x00004000              </span><span class="c1">//Á≥ªÁªü‰ºëÁú†Âî§ÈÜíÊìç‰Ωú‰∏≠Ôºå‰∏çÂÖ≥Èó≠ËØ•‰∏≠Êñ≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define IRQF_FORCE_RESUME	0x00008000              </span><span class="c1">//Á≥ªÁªüÂî§ÈÜíËøáÁ®ã‰∏≠ÂøÖÈ°ªÂº∫Âà∂ÊâìÂºÄËØ•‰∏≠Êñ≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define IRQF_NO_THREAD		0x00010000              </span><span class="c1">//Á¶ÅÊ≠¢‰∏≠Êñ≠Á∫øÁ®ãÂåñ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define IRQF_EARLY_RESUME	0x00020000              </span><span class="c1">//Á≥ªÁªüÂî§ÈÜíËøáÁ®ã‰∏≠Âú®syscoreÈò∂ÊÆµresumeÔºåËÄå‰∏çÁî®Á≠âÂà∞ËÆæÂ§áresumeÈò∂ÊÆµ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define IRQF_COND_SUSPEND	0x00040000              </span><span class="c1">//‰∏éNO_SUSPENDÁöÑÁî®Êà∑ÂÖ±‰∫´‰∏≠Êñ≠Êó∂ÔºåÊâßË°åÊú¨ËÆæÂ§áÁöÑ‰∏≠Êñ≠Â§ÑÁêÜÂáΩÊï∞
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>‰∏≠Êñ≠Ê≥®ÂÜåÊµÅÁ®ã</strong>Â¶Ç‰∏ãÂõæÔºö</p>
<p><img src="https://img2020.cnblogs.com/blog/1771657/202006/1771657-20200605223042609-247616444.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li><code>request_irq</code> ‰πüÊòØË∞ÉÁî® <code>request_threaded_irq</code>ÔºåÂè™ÊòØÂú®‰º†ÂèÇÁöÑÊó∂ÂÄôÔºåÁ∫øÁ®ãÂ§ÑÁêÜÂáΩÊï∞ <code>thread_fn</code> ÂáΩÊï∞ËÆæÁΩÆÊàê NULLÔºõ</li>
<li>Áî±‰∫éÂú®Á°¨‰ª∂‰∏≠Êñ≠Âè∑ÂíåLinux‰∏≠Êñ≠Âè∑ÂÆåÊàêÊò†Â∞ÑÂêéÔºå<code>irq_desc</code> Â∑≤ÁªèÂàõÂª∫Â•ΩÔºåÂèØ‰ª•ÈÄöËøá <code>irq_to_desc</code> Êé•Âè£ÂéªËé∑ÂèñÂØπÂ∫îÁöÑ <code>irq_desc</code>Ôºõ</li>
<li>ÂàõÂª∫ <code>irqaction</code>ÔºåÂπ∂ÂàùÂßãÂåñËØ•ÁªìÊûÑ‰Ωì‰∏≠ÁöÑÂêÑ‰∏™Â≠óÊÆµÔºåÂÖ∂‰∏≠ÂåÖÊã¨‰º†ÂÖ•ÁöÑ‰∏≠Êñ≠Â§ÑÁêÜÂáΩÊï∞ËµãÂÄºÁªôÂØπÂ∫îÁöÑÂ≠óÊÆµÔºõ</li>
<li><code>__setup_irq</code> Áî®‰∫éÂÆåÊàê‰∏≠Êñ≠ÁöÑÁõ∏ÂÖ≥ËÆæÁΩÆÔºåÂåÖÊã¨‰∏≠Êñ≠Á∫øÁ®ãÂåñÁöÑÂ§ÑÁêÜÔºö
<ul>
<li>‰∏≠Êñ≠Á∫øÁ®ãÂåñÁî®‰∫éÂáèÂ∞ëÁ≥ªÁªüÂÖ≥‰∏≠Êñ≠ÁöÑÊó∂Èó¥ÔºåÂ¢ûÂº∫Á≥ªÁªüÁöÑÂÆûÊó∂ÊÄßÔºõ</li>
<li>ARM64 ÈªòËÆ§ÂºÄÂêØ‰∫Ü <code>CONFIG_IRQ_FORCED_THREADING</code>ÔºåÂºïÂØºÂèÇÊï∞‰º†ÂÖ• <code>threadirqs</code> Êó∂ÔºåÂàôÈô§‰∫Ü<code>IRQF_NO_THREAD</code>Â§ñÁöÑ‰∏≠Êñ≠ÔºåÂÖ∂‰ªñÁöÑÈÉΩÂ∞ÜÂº∫Âà∂Á∫øÁ®ãÂåñÂ§ÑÁêÜÔºõ</li>
<li>‰∏≠Êñ≠Á∫øÁ®ãÂåñ‰ºö‰∏∫ÊØè‰∏™‰∏≠Êñ≠ÈÉΩÂàõÂª∫‰∏Ä‰∏™ÂÜÖÊ†∏Á∫øÁ®ãÔºåÂ¶ÇÊûú‰∏≠Êñ≠ËøõË°åÂÖ±‰∫´ÔºåÂØπÂ∫î<code>irqaction</code>Â∞ÜËøûÊé•ÊàêÈìæË°®ÔºåÊØè‰∏™<code>irqaction</code> ÈÉΩÊúâ <code>thread_mask </code>‰ΩçÂõæÂ≠óÊÆµÔºåÂΩìÊâÄÊúâÂÖ±‰∫´‰∏≠Êñ≠ÈÉΩÂ§ÑÁêÜÂÆåÊàêÂêéÊâçËÉΩ <code>unmask</code> ‰∏≠Êñ≠ÔºåËß£Èô§‰∏≠Êñ≠Â±èËîΩÔºõ</li>
</ul>
</li>
</ul>
<h3 id="‰∏≠Êñ≠Â§ÑÁêÜ">‰∏≠Êñ≠Â§ÑÁêÜ
</h3><p>ÂΩìÂÆåÊàê‰∏≠Êñ≠ÁöÑÊ≥®ÂÜåÂêéÔºåÊâÄÊúâÁªìÊûÑÁöÑÁªÑÁªáÂÖ≥Á≥ªÈÉΩÂ∑≤ÁªèÂª∫Á´ãÂ•ΩÔºåÂâ©‰∏ãÁöÑÂ∑•‰ΩúÂ∞±ÊòØÂΩìËÆæÂ§á‰∏≠Êñ≠‰ø°Âè∑Êù•‰∏¥Êó∂ÔºåËøõË°å‰∏≠Êñ≠ÁöÑÂ§ÑÁêÜÂ∑•‰Ωú„ÄÇÂõûÈ°æ‰∏ã <code>Arch-specific</code> ÁöÑ‰∏≠Êñ≠Â§ÑÁêÜÊµÅÁ®ãÔºö</p>
<p><img src="https://img2020.cnblogs.com/blog/1771657/202006/1771657-20200605223246669-1755658498.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>‰∏≠Êñ≠Êî∂Âà∞‰πãÂêéÔºåÈ¶ñÂÖà‰ºöË∑≥ËΩ¨Âà∞ÂºÇÂ∏∏ÂêëÈáèË°®ÁöÑÂÖ•Âè£Â§ÑÔºåËøõËÄåÈÄêÁ∫ßËøõË°åÂõûË∞ÉÂ§ÑÁêÜÔºåÊúÄÁªàË∞ÉÁî®Âà∞ <code>generic_handle_irq</code>Êù•ËøõË°å‰∏≠Êñ≠Â§ÑÁêÜ„ÄÇ<code>generic_handle_irq</code>Â§ÑÁêÜÂ¶Ç‰∏ãÂõæÔºö</p>
<p><img src="https://img2020.cnblogs.com/blog/1771657/202006/1771657-20200605223306409-238446169.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>
<p><code>generic_handle_irq</code> ÂáΩÊï∞ÊúÄÁªà‰ºöË∞ÉÁî®Âà∞ <code>desc-&gt;handle_irq()</code>ÔºåËøô‰∏™‰πüÂ∞±ÊòØÂØπÂ∫îÂà∞‰∏äÊñá‰∏≠Âú®Âª∫Á´ãÊò†Â∞ÑÂÖ≥Á≥ªÁöÑËøáÁ®ã‰∏≠ÔºåË∞ÉÁî® <code>irq_domain_set_info</code> ÂáΩÊï∞ÔºåËÆæÁΩÆÂ•Ω‰∫ÜÂáΩÊï∞ÊåáÈíàÔºå‰πüÂ∞±ÊòØ <code>handle_fasteoi_irq</code> Âíå<code>handle_percpu_devid_irq</code>Ôºå‰∏ãÈù¢ÁúãËøô‰∏§‰∏™ÂáΩÊï∞Ôºö</p>
<blockquote>
<ul>
<li>**<code>handle_fasteoi_irq</code>Ôºö**Â§ÑÁêÜÂÖ±‰∫´‰∏≠Êñ≠ÔºåÂπ∂‰∏îÈÅçÂéÜ <code>irqaction</code> ÈìæË°®ÔºåÈÄê‰∏™Ë∞ÉÁî® <code>action-&gt;handler()</code>ÂáΩÊï∞ÔºåËøô‰∏™ÂáΩÊï∞Ê≠£ÊòØËÆæÂ§áÈ©±Âä®Á®ãÂ∫èË∞ÉÁî®<code>request_irq/request_threaded_irq</code>Êé•Âè£Ê≥®ÂÜåÁöÑ‰∏≠Êñ≠Â§ÑÁêÜÂáΩÊï∞ÔºåÊ≠§Â§ñÂ¶ÇÊûú‰∏≠Êñ≠Á∫øÁ®ãÂåñÂ§ÑÁêÜÁöÑËØùÔºåËøò‰ºöË∞ÉÁî®<code>__irq_wake_thread()</code>Âî§ÈÜíÂÜÖÊ†∏Á∫øÁ®ãÔºõ</li>
<li>**<code>handle_percpu_devid_irq</code>Ôºö**Â§ÑÁêÜper-CPU‰∏≠Êñ≠Â§ÑÁêÜÔºåÂú®Ëøô‰∏™ËøáÁ®ã‰∏≠‰ºöÂàÜÂà´Ë∞ÉÁî®‰∏≠Êñ≠ÊéßÂà∂Âô®ÁöÑÂ§ÑÁêÜÂáΩÊï∞ËøõË°åÁ°¨‰ª∂Êìç‰ΩúÔºåËØ•ÂáΩÊï∞ÂêåÊ†∑‰πü‰ºöË∞ÉÁî® <code>action-&gt;handler()</code> Êù•ËøõË°å‰∏≠Êñ≠Â§ÑÁêÜÔºõ</li>
</ul>
</blockquote>
</li>
</ul>
<h4 id="‰∏≠Êñ≠Á∫øÁ®ãÂåñÂ§ÑÁêÜ">‰∏≠Êñ≠Á∫øÁ®ãÂåñÂ§ÑÁêÜ
</h4><p>‰∏≠Êñ≠Á∫øÁ®ãÂåñÂ§ÑÁêÜÂêéÁöÑÂî§ÈÜíÊµÅÁ®ã <code>__handle_irq_event_percpu-&gt;__irq_wake_thread</code>Ôºö</p>
<p><img src="https://img2020.cnblogs.com/blog/1771657/202006/1771657-20200605223341892-243579938.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li><strong>‰∏≠Êñ≠Á∫øÁ®ãÂàùÂßãÂåñÔºö</strong><code>irq_thread</code> ÂÜÖÊ†∏Á∫øÁ®ãÔºåÂ∞ÜÊ†πÊçÆÊòØÂê¶‰∏∫Âº∫Âà∂‰∏≠Êñ≠Á∫øÁ®ãÂåñÂØπÂáΩÊï∞ÊåáÈíà <code>handler_fn</code> ËøõË°åÂàùÂßãÂåñÔºå‰ª•‰æøÂêéÁª≠ËøõË°åË∞ÉÁî®„ÄÇ</li>
<li><strong>‰∏≠Êñ≠Á∫øÁ®ãÊâßË°åÔºö</strong><code>irq_thread</code> ÂÜÖÊ†∏Á∫øÁ®ãÂ∞ÜÂú® <code>while(!irq_wait_for_interrupt)</code> Âæ™ÁéØ‰∏≠ËøõË°å‰∏≠Êñ≠ÁöÑÂ§ÑÁêÜÔºåÂΩìÊª°Ë∂≥Êù°‰ª∂Êó∂ÔºåÊâßË°å<code>handler_fn</code>ÔºåÂú®ËØ•ÂáΩÊï∞‰∏≠ÊúÄÁªàË∞ÉÁî® <code>action-&gt;thread_fn</code>Ôºå‰πüÂ∞±ÊòØÂÆåÊàê‰∫Ü‰∏≠Êñ≠ÁöÑÂ§ÑÁêÜÔºõ</li>
<li><strong>‰∏≠Êñ≠Á∫øÁ®ãÂî§ÈÜíÊù°‰ª∂Âà§ÂÆöÔºö</strong><code>irq_wait_for_interrupt</code> ÂáΩÊï∞ÔºåÂ∞Ü‰ºöÂà§Êñ≠‰∏≠Êñ≠Á∫øÁ®ãÁöÑÂî§ÈÜíÊù°‰ª∂ÔºåÂ¶ÇÊûúÊª°Ë∂≥‰∫ÜÔºåÂàôÂ∞ÜÂΩìÂâç‰ªªÂä°ËÆæÁΩÆÊàê<code>TASK_RUNNING</code> Áä∂ÊÄÅÔºåÂπ∂ËøîÂõû 0ÔºåËøôÊ†∑Â∞±ËÉΩÊâßË°å‰∏≠Êñ≠ÁöÑÂ§ÑÁêÜÔºåÂê¶ÂàôÂ∞±Ë∞ÉÁî® <code>schedule()</code> ËøõË°åË∞ÉÂ∫¶ÔºåËÆ©Âá∫CPUÔºåÂπ∂Â∞Ü‰ªªÂä°ËÆæÁΩÆÊàê <code>TASK_INTERRUPTIBLE</code> ÂèØ‰∏≠Êñ≠Áù°Áú†Áä∂ÊÄÅÔºõ</li>
</ul>
<h2 id="23-ÊÄªÁªì">2.3 ÊÄªÁªì
</h2><p>‰∏≠Êñ≠ÁöÑÂ§ÑÁêÜÔºåÊÄª‰ΩìÊù•ËØ¥ÂèØ‰ª•ÂàÜ‰∏∫<strong>‰∏§ÈÉ®ÂàÜ</strong>Êù•ÁúãÔºö</p>
<ol>
<li>**<em>Ëá™È°∂Âêë‰∏ãÔºö<em><strong>Âõ¥Áªï <code>irq_desc</code> ‰∏≠Êñ≠ÊèèËø∞Á¨¶Âª∫Á´ãÂ•ΩËøûÊé•ÂÖ≥Á≥ªÔºåËøô‰∏™ËøáÁ®ãÂ∞±ÂåÖÊã¨Ôºö‰∏≠Êñ≠Ê∫ê‰ø°ÊÅØÁöÑËß£ÊûêÔºàËÆæÂ§áÊ†ëÔºâÔºåÁ°¨‰ª∂‰∏≠Êñ≠Âè∑Âà∞Linux‰∏≠Êñ≠Âè∑ÁöÑÊò†Â∞Ñ„ÄÅ<code>irq_desc</code> ÁªìÊûÑÁöÑÂàÜÈÖçÂèäÂàùÂßãÂåñÔºàÂÜÖÈÉ®ÂêÑ‰∏™ÁªìÊûÑÁöÑÁªÑÁªáÂÖ≥Á≥ªÔºâ„ÄÅ‰∏≠Êñ≠ÁöÑÊ≥®ÂÜåÔºàÂ°´ÂÖÖ <code>irq_desc</code> ÁªìÊûÑÔºåÂåÖÊã¨handlerÂ§ÑÁêÜÂáΩÊï∞ÔºâÁ≠âÔºåÊÄªËÄåË®Ä‰πãÔºåÂ∞±ÊòØ</strong>ÂÆåÊàêÈùôÊÄÅÂÖ≥Á≥ªÂàõÂª∫Ôºå‰∏∫‰∏≠Êñ≠Â§ÑÁêÜÂÅöÂ•ΩÂáÜÂ§áÔºõ</em></em></li>
<li>***Ëá™Â∫ïÂêë‰∏äÔºö***ÂΩìÂ§ñËÆæËß¶Âèë‰∏≠Êñ≠‰ø°Âè∑Êó∂Ôºå‰∏≠Êñ≠ÊéßÂà∂Âô®Êé•Êî∂Âà∞‰ø°Âè∑Âπ∂ÂèëÈÄÅÂà∞Â§ÑÁêÜÂô®ÔºåÊ≠§Êó∂Â§ÑÁêÜÂô®ËøõË°åÂºÇÂ∏∏Ê®°ÂºèÂàáÊç¢ÔºåÂπ∂ÈÄêÊ≠•‰ªéÂ§ÑÁêÜÂô®Êû∂ÊûÑÁõ∏ÂÖ≥‰ª£Á†ÅÈÄêÁ∫ßÂõûË∞É„ÄÇÂ¶ÇÊûúÊ∂âÂèäÂà∞‰∏≠Êñ≠Á∫øÁ®ãÂåñÔºåÂàôËøòÈúÄË¶ÅËøõË°å‰∏≠Êñ≠ÂÜÖÊ†∏Á∫øÁ®ãÁöÑÂî§ÈÜíÊìç‰ΩúÔºåÊúÄÁªàÂÆåÊàê‰∏≠Êñ≠Â§ÑÁêÜÂáΩÊï∞ÁöÑÊâßË°å„ÄÇ</li>
</ol>

</section>


    <footer class="article-footer">
    

    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2024 zcxGGmu
    </section>
    
    <section class="powerby">
        ‰ΩøÁî® <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> ÊûÑÂª∫ <br />
        ‰∏ªÈ¢ò <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.27.0">Stack</a></b> Áî± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> ËÆæËÆ°
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>
<div id="particles-js"></div>

<script src=https://zcxggmu.github.io/background/particles.min.js></script>
<script>
  particlesJS.load('particles-js', "https://zcxggmu.github.io/background/particlesjs-config.json", function() {
    console.log('particles.js loaded - callback');
  });
</script>

<style>
  #particles-js {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: -1;
  }
</style>


    </body>
</html>
