<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="0 ËµÑÊñô KVMËôöÊãüÊú∫ÁÉ≠ËøÅÁßª‰ºòÂåñÁ≠ñÁï•Á†îÁ©∂ - ‰∏≠ÂõΩÁü•ÁΩë (cnki.net) KVMËôöÊãüÊú∫ÁÉ≠ËøÅÁßªÁÆóÊ≥ïÂàÜÊûêÂèä‰ºòÂåñ - ‰∏≠ÂõΩÁü•ÁΩë (cnki.net) QEMU/KVMÊ∫êÁ†ÅËß£Êûê‰∏éÂ∫îÁî®-ÊùéÂº∫ÁºñËëó-ÂæÆ‰ø°ËØª‰π¶ (qq.com) x86 kvmÂíåqemuËôöÊãüÂåñ‰ªãÁªç-ËÖæËÆØ‰∫ëÂºÄÂèëËÄÖÁ§æÂå∫-ËÖæËÆØ‰∫ë (tencent.com) qemu live migration‰ª£Á†ÅÂàÜÊûê-ËÖæËÆØ‰∫ëÂºÄÂèëËÄÖÁ§æÂå∫-ËÖæËÆØ‰∫ë (tencent.com) 1 ËôöÊãüÂåñÁÉ≠ËøÅÁßªÊäÄÊúØÊ¶ÇËø∞ ËôöÊãüÊú∫ËøÅÁßªÂåÖÊã¨‰∏§Áßç Ôºå Âç≥ ËôöÊãüÊú∫ÂÜ∑ËøÅÁßª Âíå ËôöÊãüÊú∫ÁÉ≠ËøÅÁßª „ÄÇ\n">
<title>Vm Live Migration 1</title>

<link rel='canonical' href='https://zcxggmu.github.io/p/vm-live-migration-1/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="Vm Live Migration 1">
<meta property='og:description' content="0 ËµÑÊñô KVMËôöÊãüÊú∫ÁÉ≠ËøÅÁßª‰ºòÂåñÁ≠ñÁï•Á†îÁ©∂ - ‰∏≠ÂõΩÁü•ÁΩë (cnki.net) KVMËôöÊãüÊú∫ÁÉ≠ËøÅÁßªÁÆóÊ≥ïÂàÜÊûêÂèä‰ºòÂåñ - ‰∏≠ÂõΩÁü•ÁΩë (cnki.net) QEMU/KVMÊ∫êÁ†ÅËß£Êûê‰∏éÂ∫îÁî®-ÊùéÂº∫ÁºñËëó-ÂæÆ‰ø°ËØª‰π¶ (qq.com) x86 kvmÂíåqemuËôöÊãüÂåñ‰ªãÁªç-ËÖæËÆØ‰∫ëÂºÄÂèëËÄÖÁ§æÂå∫-ËÖæËÆØ‰∫ë (tencent.com) qemu live migration‰ª£Á†ÅÂàÜÊûê-ËÖæËÆØ‰∫ëÂºÄÂèëËÄÖÁ§æÂå∫-ËÖæËÆØ‰∫ë (tencent.com) 1 ËôöÊãüÂåñÁÉ≠ËøÅÁßªÊäÄÊúØÊ¶ÇËø∞ ËôöÊãüÊú∫ËøÅÁßªÂåÖÊã¨‰∏§Áßç Ôºå Âç≥ ËôöÊãüÊú∫ÂÜ∑ËøÅÁßª Âíå ËôöÊãüÊú∫ÁÉ≠ËøÅÁßª „ÄÇ\n">
<meta property='og:url' content='https://zcxggmu.github.io/p/vm-live-migration-1/'>
<meta property='og:site_name' content='zcxGGmu'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2024-10-17T09:58:02&#43;08:00'/><meta property='article:modified_time' content='2024-10-17T09:58:02&#43;08:00'/>
<meta name="twitter:title" content="Vm Live Migration 1">
<meta name="twitter:description" content="0 ËµÑÊñô KVMËôöÊãüÊú∫ÁÉ≠ËøÅÁßª‰ºòÂåñÁ≠ñÁï•Á†îÁ©∂ - ‰∏≠ÂõΩÁü•ÁΩë (cnki.net) KVMËôöÊãüÊú∫ÁÉ≠ËøÅÁßªÁÆóÊ≥ïÂàÜÊûêÂèä‰ºòÂåñ - ‰∏≠ÂõΩÁü•ÁΩë (cnki.net) QEMU/KVMÊ∫êÁ†ÅËß£Êûê‰∏éÂ∫îÁî®-ÊùéÂº∫ÁºñËëó-ÂæÆ‰ø°ËØª‰π¶ (qq.com) x86 kvmÂíåqemuËôöÊãüÂåñ‰ªãÁªç-ËÖæËÆØ‰∫ëÂºÄÂèëËÄÖÁ§æÂå∫-ËÖæËÆØ‰∫ë (tencent.com) qemu live migration‰ª£Á†ÅÂàÜÊûê-ËÖæËÆØ‰∫ëÂºÄÂèëËÄÖÁ§æÂå∫-ËÖæËÆØ‰∫ë (tencent.com) 1 ËôöÊãüÂåñÁÉ≠ËøÅÁßªÊäÄÊúØÊ¶ÇËø∞ ËôöÊãüÊú∫ËøÅÁßªÂåÖÊã¨‰∏§Áßç Ôºå Âç≥ ËôöÊãüÊú∫ÂÜ∑ËøÅÁßª Âíå ËôöÊãüÊú∫ÁÉ≠ËøÅÁßª „ÄÇ\n">
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="ÂàáÊç¢ËèúÂçï">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu16968365064894999835.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">zcxGGmu</a></h1>
            <h2 class="site-description">riscv, linux-kernel/kvm, llm-app/infer</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/zcxGGmu'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>‰∏ªÈ°µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>ÂÖ≥‰∫é</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>ÊöóËâ≤Ê®°Âºè</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ÁõÆÂΩï</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#11-ÁÉ≠ËøÅÁßªÊÄßËÉΩÊåáÊ†á">1.1 ÁÉ≠ËøÅÁßªÊÄßËÉΩÊåáÊ†á</a></li>
    <li><a href="#12-ÁÉ≠ËøÅÁßªÂ∫îÁî®Âú∫ÊôØ">1.2 ÁÉ≠ËøÅÁßªÂ∫îÁî®Âú∫ÊôØ</a></li>
    <li><a href="#13-‰∏§Áßç‰∏ªÊµÅÁöÑÁÉ≠ËøÅÁßªÁÆóÊ≥ï">1.3 ‰∏§Áßç‰∏ªÊµÅÁöÑÁÉ≠ËøÅÁßªÁÆóÊ≥ï</a>
      <ol>
        <li><a href="#È¢ÑÊã∑Ë¥ùÁÉ≠ËøÅÁßªÁÆóÊ≥ï-pre_copy">È¢ÑÊã∑Ë¥ùÁÉ≠ËøÅÁßªÁÆóÊ≥ï: pre_copy</a></li>
        <li><a href="#ÂêéÊã∑Ë¥ùÁÉ≠ËøÅÁßªÁÆóÊ≥ï-post_copy">ÂêéÊã∑Ë¥ùÁÉ≠ËøÅÁßªÁÆóÊ≥ï: post_copy</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#21-qemuÂú®kvm‰∏≠ÁöÑÂ∫îÁî®">2.1 QEMUÂú®KVM‰∏≠ÁöÑÂ∫îÁî®</a>
      <ol>
        <li><a href="#qemuÂ§öÁ∫øÁ®ã‰∫ã‰ª∂È©±Âä®Ê®°Âûã">QEMUÂ§öÁ∫øÁ®ã‰∫ã‰ª∂È©±Âä®Ê®°Âûã</a>
          <ol>
            <li><a href="#qemu‰∫ã‰ª∂È©±Âä®">QEMU‰∫ã‰ª∂È©±Âä®</a></li>
            <li><a href="#qemuÂ§öÁ∫øÁ®ã">QEMUÂ§öÁ∫øÁ®ã</a></li>
          </ol>
        </li>
        <li><a href="#ÂÆ¢Êà∑Êú∫‰ª£Á†ÅÁöÑÊâßË°å">ÂÆ¢Êà∑Êú∫‰ª£Á†ÅÁöÑÊâßË°å</a></li>
      </ol>
    </li>
    <li><a href="#22-cpuËôöÊãüÂåñ">2.2 CPUËôöÊãüÂåñ</a>
      <ol>
        <li><a href="#intelÁöÑvt-xÊäÄÊúØ">IntelÁöÑVT-xÊäÄÊúØ</a></li>
        <li><a href="#kvm-cpuËôöÊãüÂåñÂÆûÁé∞">KVM: CPUËôöÊãüÂåñÂÆûÁé∞</a>
          <ol>
            <li><a href="#kvmÁî®Êà∑Êé•Âè£">KVMÁî®Êà∑Êé•Âè£</a></li>
            <li><a href="#kvmËôöÊãüÊú∫ÁöÑÂàõÂª∫ÂíåËøêË°å">KVMËôöÊãüÊú∫ÁöÑÂàõÂª∫ÂíåËøêË°å</a></li>
          </ol>
        </li>
        <li><a href="#kvm-cpuÁÉ≠ËøÅÁßª">KVM: CPUÁÉ≠ËøÅÁßª</a></li>
      </ol>
    </li>
    <li><a href="#23-ÂÜÖÂ≠òËôöÊãüÂåñ">2.3 ÂÜÖÂ≠òËôöÊãüÂåñ</a>
      <ol>
        <li><a href="#intelÁöÑeptÊäÄÊúØ">IntelÁöÑEPTÊäÄÊúØ</a></li>
        <li><a href="#kvm-ÂÜÖÂ≠òËôöÊãüÂåñÂÆûÁé∞">KVM: ÂÜÖÂ≠òËôöÊãüÂåñÂÆûÁé∞</a>
          <ol>
            <li><a href="#qemuÂÜÖÂ≠òÊ®°Âûã">QEMUÂÜÖÂ≠òÊ®°Âûã</a></li>
            <li><a href="#eptÈ°µË°®ÁöÑÊûÑÂª∫">EPTÈ°µË°®ÁöÑÊûÑÂª∫</a></li>
          </ol>
        </li>
        <li><a href="#kvm-ÂÜÖÂ≠òÁÉ≠ËøÅÁßª">KVM: ÂÜÖÂ≠òÁÉ≠ËøÅÁßª</a></li>
      </ol>
    </li>
    <li><a href="#24-ioËôöÊãüÂåñ">2.4 IOËôöÊãüÂåñ</a>
      <ol>
        <li><a href="#ioÂÖ®ËôöÊãüÂåñ">IOÂÖ®ËôöÊãüÂåñ</a></li>
        <li><a href="#ioÂçäËôöÊãüÂåñ">IOÂçäËôöÊãüÂåñ</a></li>
        <li><a href="#kvm-ioÁÉ≠ËøÅÁßª">KVM: IOÁÉ≠ËøÅÁßª</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#31-kvmÁÉ≠ËøÅÁßªÁöÑÂÜÖÂÆπ">3.1 KVMÁÉ≠ËøÅÁßªÁöÑÂÜÖÂÆπ</a>
      <ol>
        <li><a href="#cpuÁÉ≠ËøÅÁßª">CPUÁÉ≠ËøÅÁßª</a></li>
        <li><a href="#ÂÜÖÂ≠òÁÉ≠ËøÅÁßª">ÂÜÖÂ≠òÁÉ≠ËøÅÁßª</a></li>
        <li><a href="#ioËÆæÂ§áÁöÑËøÅÁßª">IOËÆæÂ§áÁöÑËøÅÁßª</a>
          <ol>
            <li><a href="#Á£ÅÁõòÁöÑËøÅÁßª">Á£ÅÁõòÁöÑËøÅÁßª</a></li>
            <li><a href="#ÁΩëÁªúÁöÑËøÅÁßª">ÁΩëÁªúÁöÑËøÅÁßª</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#32-kvmÁÉ≠ËøÅÁßªÁöÑÂÖ∑‰ΩìÂÆûÁé∞">3.2 KVMÁÉ≠ËøÅÁßªÁöÑÂÖ∑‰ΩìÂÆûÁé∞</a>
      <ol>
        <li><a href="#kvmÁÉ≠ËøÅÁßªÊµÅÁ®ã">KVMÁÉ≠ËøÅÁßªÊµÅÁ®ã</a></li>
        <li><a href="#ÈáçË¶ÅÊï∞ÊçÆÁªìÊûÑ">ÈáçË¶ÅÊï∞ÊçÆÁªìÊûÑ</a></li>
        <li><a href="#ËÑèÈ°µ‰ΩçÂõæ">ËÑèÈ°µ‰ΩçÂõæ</a></li>
        <li><a href="#Ëø≠‰ª£È¢ÑÊã∑Ë¥ùÈò∂ÊÆµ">Ëø≠‰ª£È¢ÑÊã∑Ë¥ùÈò∂ÊÆµ</a></li>
        <li><a href="#ÂÅúÊú∫Êã∑Ë¥ùÈò∂ÊÆµ">ÂÅúÊú∫Êã∑Ë¥ùÈò∂ÊÆµ</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/vm-live-migration-1/">Vm Live Migration 1</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2024-10-17</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    ÈòÖËØªÊó∂Èïø: 36 ÂàÜÈíü
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="0-ËµÑÊñô">0 ËµÑÊñô
</h1><ul>
<li><a class="link" href="https://kns.cnki.net/kcms2/article/abstract?v=ipUboLYjcOXEHBN0AlEk_KKXSUxnt10wQMFI85wTMherf27eA0kpd4CogdsiGR6Oh0yCY6E0cbCbPOEcQkcBeqIe_AGtiV2QadH6UpDqaa4jPWxgZWFBI2_8X4rlM1m4iz_VGKy452BPKrX_PHNW0w==&amp;uniplatform=NZKPT&amp;language=CHS"  target="_blank" rel="noopener"
    >KVMËôöÊãüÊú∫ÁÉ≠ËøÅÁßª‰ºòÂåñÁ≠ñÁï•Á†îÁ©∂ - ‰∏≠ÂõΩÁü•ÁΩë (cnki.net)</a></li>
<li><a class="link" href="https://kns.cnki.net/kcms2/article/abstract?v=ipUboLYjcOUCpMbra6pvsVq6vfUC3xSaczpcxkC7iD14FlMzTjVq81horFHho8-VUXQklynIDqCKm31k1YH4pJys3obPPGAaTsRQGS9M6j9QHWcNiUy6prYUoUROzDYxaWW9pBB9WVwabbyUB2SC_3inSINdJyKrHHF9O1Dx8fY=&amp;uniplatform=NZKPT&amp;language=CHS"  target="_blank" rel="noopener"
    >KVMËôöÊãüÊú∫ÁÉ≠ËøÅÁßªÁÆóÊ≥ïÂàÜÊûêÂèä‰ºòÂåñ - ‰∏≠ÂõΩÁü•ÁΩë (cnki.net)</a></li>
<li><a class="link" href="https://weread.qq.com/web/reader/ec132be07263ffc1ec1dc10ka1d32a6022aa1d0c6e83eb4"  target="_blank" rel="noopener"
    >QEMU/KVMÊ∫êÁ†ÅËß£Êûê‰∏éÂ∫îÁî®-ÊùéÂº∫ÁºñËëó-ÂæÆ‰ø°ËØª‰π¶ (qq.com)</a></li>
<li><a class="link" href="https://cloud.tencent.com/developer/article/1792349"  target="_blank" rel="noopener"
    >x86 kvmÂíåqemuËôöÊãüÂåñ‰ªãÁªç-ËÖæËÆØ‰∫ëÂºÄÂèëËÄÖÁ§æÂå∫-ËÖæËÆØ‰∫ë (tencent.com)</a></li>
<li><a class="link" href="https://cloud.tencent.com/developer/article/1792351"  target="_blank" rel="noopener"
    >qemu live migration‰ª£Á†ÅÂàÜÊûê-ËÖæËÆØ‰∫ëÂºÄÂèëËÄÖÁ§æÂå∫-ËÖæËÆØ‰∫ë (tencent.com)</a></li>
</ul>
<h1 id="1-ËôöÊãüÂåñÁÉ≠ËøÅÁßªÊäÄÊúØÊ¶ÇËø∞">1 ËôöÊãüÂåñÁÉ≠ËøÅÁßªÊäÄÊúØÊ¶ÇËø∞
</h1><p>ËôöÊãüÊú∫ËøÅÁßªÂåÖÊã¨‰∏§Áßç Ôºå Âç≥ ËôöÊãüÊú∫ÂÜ∑ËøÅÁßª Âíå ËôöÊãüÊú∫ÁÉ≠ËøÅÁßª „ÄÇ</p>
<ul>
<li>**ËôöÊãüÊú∫ÂÜ∑ËøÅÁßªÔºå**È°æÂêçÊÄù‰πâ ÔºåËøÅÁßªÊó∂ÈúÄË¶ÅÂÖ≥Èó≠ËôöÊãüÊú∫ÔºåÂÅúÊú∫Êó∂Èó¥ÊØîËæÉÊº´ÈïøÔºå‰∏öÂä°ËøûÁª≠ÊÄßÂæó‰∏çÂà∞‰øùËØÅ„ÄÇËôöÊãüÊú∫ÂÜ∑ËøÅÁßªÔºåÈ¶ñÂÖàÈúÄË¶ÅÂÖ≥Èó≠ËôöÊãüÊú∫Ôºå ÁÑ∂ÂêéÈÄöËøáÁ¶ªÁ∫øÁΩëÁªúÂ∞ÜËôöÊãüÊú∫ÁöÑÈÖçÁΩÆÂíåÁ£ÅÁõòÈïúÂÉèÊñá‰ª∂Êã∑Ë¥ùËá≥ÁõÆÁöÑ‰∏ªÊú∫ÔºåÁÑ∂ÂêéÂú®ÁõÆÁöÑÂÆø‰∏ªÊú∫‰∏äÂºÄÂêØËôöÊãüÊú∫ÔºåÊúçÂä°ÈáçÊñ∞ÂêØÂä®„ÄÇÁî±‰∫é‰∏öÂä°‰∏≠Êñ≠ÁöÑÊó∂Èó¥ÊØîËæÉÈïøÔºåÂõ†Ê≠§Â∏∏Áî®‰∫éÈùûÂÖ±‰∫´Â≠òÂÇ®„ÄÅË∑®Êï∞ÊçÆ‰∏≠ÂøÉÁöÑËøÅÁßª„ÄÇ</li>
<li>**ËôöÊãüÊú∫ÁÉ≠ËøÅÁßªÔºå**ÂèàÁß∞‰∏∫ËôöÊãüÊú∫Âä®ÊÄÅËøÅÁßªÔºå‰∏ªË¶ÅÊåáÂ∞Ü‰∏ÄÂè∞ËôöÊãüÊú∫‰ªé‰∏ÄÂè∞ÊúçÂä°Âô®ËøÅÁßªËá≥Âè¶Â§ñ‰∏ÄÂè∞ÊúçÂä°Âô®‰∏ä„ÄÇÂú®ËøÅÁßªËøáÁ®ã‰∏≠ÔºåËôöÊãüÊú∫‰ªçÁÑ∂Ê≠£Â∏∏ËøêË°åÔºåÊúçÂä°‰æùÁÑ∂Ê≠£Â∏∏ÂØπÂ§ñÊèê‰æõÔºåÁî®Êà∑ÊÑüËßâ‰∏çÂà∞ÊúçÂä°ÁöÑ‰∏≠Ôºå ‰πüÂ∞±ÊòØËØ¥ÁÉ≠ËøÅÁßªÂØπ‰∫éÊìç‰ΩúÁ≥ªÁªü„ÄÅÂ∫îÁî® ËΩØ‰ª∂„ÄÅËôöÊãüÊú∫ÁöÑÁî®Êà∑Êù•ËØ¥ÔºåÈÉΩÊòØÂÆåÂÖ®ÈÄèÊòéÁöÑ„ÄÇ</li>
</ul>
<h2 id="11-ÁÉ≠ËøÅÁßªÊÄßËÉΩÊåáÊ†á">1.1 ÁÉ≠ËøÅÁßªÊÄßËÉΩÊåáÊ†á
</h2><p>ËôöÊãüÊú∫ÁÉ≠ËøÅÁßªÁªôËôöÊãüÊú∫ÁöÑÁÆ°ÁêÜ„ÄÅÁª¥Êä§Â∏¶Êù•‰∫ÜÊñπ‰æøÔºå‰ΩÜËôöÊãüÊú∫ÁÉ≠ËøÅÁßªÊú¨Ë∫´‰πüÊòØÈúÄË¶ÅÂç†Áî®ËµÑÊ∫êÁöÑÔºåÊàë‰ª¨ËØ•Â¶Ç‰ΩïÊù•ËØÑ‰º∞ÁÉ≠ËøÅÁßªÂë¢ÔºüËØÑ‰º∞ÁÉ≠ËøÅÁßªÁöÑÊåáÊ†á‰∏ªË¶ÅÂåÖÊã¨ÊÄªËøÅÁßªÊó∂Èó¥ (<code>total migration time</code>) „ÄÅÂÅúÊú∫Êó∂Èó¥ (<code>migration downtime</code>) „ÄÅËøÅÁßª‰º†ËæìÊï∞ÊçÆÈáè„ÄÅÂØπÂ∫îÁî®Á®ãÂ∫èÁöÑÊÄßËÉΩÂΩ±ÂìçÁ≠â„ÄÇ</p>
<ol>
<li>**<font color='red'>ÊÄªËøÅÁßªÊó∂Èó¥„ÄÇ</font>**ÊÄªËøÅÁßªÊó∂Èó¥ÊòØÊåáÔºå‰ªéÂú®Ê∫êÂÆø‰∏ªÊú∫‰∏äÂèëËµ∑ËøÅÁßªÂëΩ‰ª§Âà∞ËôöÊãüÊú∫Âú®ÁõÆÁöÑÂÆø‰∏ªÊú∫‰∏äÊÅ¢Â§çËøêË°åÊâÄËÄóË¥πÁöÑÊÄªÊó∂Èó¥„ÄÇÁÉ≠ËøÅÁßªÂåÖÊã¨Â§ö‰∏™Èò∂ÊÆµÔºåÂ¶ÇÂÜÖ Â≠òËø≠‰ª£Êã∑Ë¥ù„ÄÅÂÅúÊú∫Êã∑Ë¥ù„ÄÅËôöÊãüÊú∫ÊÅ¢Â§çÁ≠âÈò∂ÊÆµÔºåÊÄªËøÅÁßªÊó∂Èó¥ÂåÖÊã¨‰∫ÜËøô‰∫õÈò∂ÊÆµÁöÑÊÄªÊó∂Èó¥„ÄÇÁî±‰∫éÁÉ≠ËøÅÁßªÊäÄÊúØÂæÄÂæÄÁî®‰∫éË¥üËΩΩÂùáË°°„ÄÅÊúçÂä°Âô®Âú®Á∫øÁª¥Êä§Á≠âÔºå ËøôË¶ÅÊ±ÇÊÄªËøÅÁßªÁöÑÊó∂Èó¥ËÉΩÂ§üÂ∞ΩÂèØËÉΩÁü≠„ÄÇÁÉ≠ËøÅÁßªÊú¨Ë∫´ÂØπÂ§ñÁïåÊù°‰ª∂Ë¶ÅÊ±Ç‰πüÈ´òÔºå‰∏Ä‰∫õÁ™ÅÂèëÊÉÖÂÜµÔºàÂ¶ÇÁΩëÁªú‰∏≠Êñ≠ÔºâÂæÄÂæÄ‰ºöÂØºËá¥ËøÅÁßªÂ§±Ë¥•ÔºåËøô‰πüË¶ÅÊ±ÇËøÅÁßªÁöÑÊó∂ Èó¥Â∞ΩÂèØËÉΩÁü≠„ÄÇ</li>
<li>**<font color='red'>ÂÅúÊú∫Êó∂Èó¥„ÄÇ</font>**ÂÅúÊú∫Êó∂Èó¥‰∏ªË¶ÅÊåáÔºåËôöÊãüÊú∫Âú®ÁÉ≠ËøÅÁßªËøáÁ®ã‰∏≠ÔºåÂØπÂ§ñÊèê‰æõÊúçÂä°‰∏≠Êñ≠ÁöÑÊó∂Èó¥„ÄÇÂú®ËøôÊÆµÊó∂Èó¥ÂÖßÔºåËôöÊãüÊú∫ÂÜÖÈÉ®ÁöÑÂ∫îÁî®Á®ãÂ∫è„ÄÅÊúçÂä°„ÄÅÁΩëÁªúÂ§Ñ‰∫éÂÅúÊ≠¢Áä∂ÊÄÅÔºåËôöÊãüÊú∫‰∏ç‰ºöÂìçÂ∫îÂ§ñÁïåÁöÑ‰ªª‰ΩïËØ∑Ê±Ç„ÄÇÂÅúÊú∫Êó∂Èó¥ÊòØËØÑ‰º∞ËôöÊãüÊú∫ÁÉ≠ËøÅÁßªÁöÑÈáçË¶ÅÊåáÊ†áÔºåÁâπÂà´ÊòØÂú®‰∫íËÅîÁΩëÊó∂‰ª£ÔºåÂæàÂ§ö‰∏öÂä°ÁöÑËøûÁª≠ÊÄß„ÄÅÂÆûÊó∂ÊÄßË¶ÅÊ±ÇÈÉΩÂæàÈ´òÔºåËøôÂØπËôöÊãüÊú∫ÁÉ≠ËøÅÁßªÊèêÂá∫‰∫ÜÊõ¥È´òÁöÑË¶ÅÊ±Ç„ÄÇ</li>
<li><font color='red'><strong>ËøÅÁßªÊï∞ÊçÆ‰º†ËæìÈáè„ÄÇ</strong></font>ËøÅÁßªÊï∞ÊçÆ‰º†ËæìÈáèÔºåÊòØÊåáÂú®ÁÉ≠ËøÅÁßªËøáÁ®ã‰∏≠ÔºåÂú®Ê∫êÂÆø‰∏ªÊú∫ÂíåÁõÆÁöÑÂÆø‰∏ªÊú∫‰πãÈó¥ÈúÄË¶Å‰º†ËæìÁöÑÊï∞ÊçÆÊÄªÈáè„ÄÇ‰º†ËæìÁöÑÊï∞ÊçÆ‰∏ªË¶ÅÂåÖÊã¨ËøÅÁßªÂçèËÆÆÊéßÂà∂‰ø°ÊÅØ„ÄÅÂÜÖÂ≠òÊï∞ÊçÆ„ÄÅCPUÁä∂ÊÄÅÊï∞ÊçÆ„ÄÅÂ§ñËÆæÁä∂ÊÄÅÊï∞ÊçÆÁ≠âÔºåÂÅáÂ¶ÇÊòØÂùóËÆæÂ§áÁÉ≠ËøÅÁßªÁöÑËØùÔºåËøòÂåÖÊã¨ËôöÊãüÊú∫ËôöÊãüÁ£ÅÁõòÊï∞ÊçÆ„ÄÇÁî±‰∫éÊï∞ÊçÆ‰∏≠ÂøÉÂæÄÂæÄÊâòÁÆ°‰∫Ü‰∏ä‰∏áÂè∞ËôöÊãüÊú∫Ôºå‰∏ÄÂè∞ÊúçÂä°Âô®‰∏äÂæÄÂæÄ‰πüÊúâ‰∫å‰∏âÂçÅÂè∞ËôöÊãüÊú∫Ôºå‰ªñ‰ª¨ÂØπÁΩëÁªúËµÑÊ∫êÁöÑÁ´û‰∫âËæÉ‰∏∫ÊøÄÁÉàÔºåËøÅÁßªËøáÁ®ã‰∏≠ÔºåÈúÄË¶ÅÂç†Áî®ÁΩëÁªúËµÑÊ∫êÔºåÂÅáÂ¶ÇÂêåÊó∂ËøÅÁßªÂ§öÂè∞ËôöÂ∑ßÊú∫ÔºåÂ∞ÜÂç†Áî®Êõ¥Â§öÁöÑÂ∏¶ÂÆΩËµÑÊ∫ê„ÄÇÂõ†Ê≠§ËøÅÁßªÊó∂Â∫îÂ∞ΩÈáèÂáèÂ∞ëÊï∞ÊçÆ‰º†ËæìÈáè„ÄÇ</li>
<li>**<font color='red'>ÂØπÂ∫îÁî®Á®ãÂ∫èÁöÑÊÄßËÉΩÂΩ±Âìç„ÄÇ</font>**ÁÉ≠ËøÅÁßªÊú¨Ë∫´Èô§‰∫ÜÂç†Áî®ÁΩëÁªúÂ∏¶ÂÆΩËµÑÊ∫êÔºå‰πüÈúÄË¶ÅÂç†Áî®‰∏ÄÂÆöÁöÑCPUËµÑÊ∫êÔºåÂõ†Ê≠§Âú®ËøÅÁßªËøáÁ®ã‰∏≠ÔºåÂèØËÉΩÂΩ±ÂìçË¢´ËøÅÁßªËôöÊãüÊú∫ÁöÑÊÄßËÉΩÔºå‰πüÊúâÂèØËÉΩÂΩ±ÂìçÊ∫êÂÆø‰∏ªÊú∫‰∏äÁöÑÂÖ∂‰ªñËôöÊãüÊú∫„ÄÇËøÅÁßªËøáÁ®ã‰∏≠ÔºåÂ∫îÂ∞ΩÈáèÂáèÂ∞ëÂØπËôöÊãüÊú∫Â∫îÁî®Á®ãÂ∫èÁöÑÊÄßËÉΩÂΩ±Âìç„ÄÇ</li>
</ol>
<h2 id="12-ÁÉ≠ËøÅÁßªÂ∫îÁî®Âú∫ÊôØ">1.2 ÁÉ≠ËøÅÁßªÂ∫îÁî®Âú∫ÊôØ
</h2><p>ËôöÊãüÊú∫ÁÉ≠ËøÅÁßª‰Ωú‰∏∫ËôöÊãüÂåñÊäÄÊúØÁöÑÈáçË¶ÅÂäüËÉΩÔºå‰∏ªË¶ÅÁî®‰∫éË¥üËΩΩÂùáË°°„ÄÅËÉΩËÄóÊéßÂà∂„ÄÅÊúçÂä°Âô®Âú®Á∫øÁª¥Êä§Á≠âÈ¢ÜÂüü„ÄÇ</p>
<ol>
<li>**<font color='red'>Ë¥üËΩΩÂùáË°°„ÄÇ</font>**Âú®Êï∞ÊçÆ‰∏≠ÂøÉÔºåÂ∫îËØ•Â∞ΩÈáè‰øùËØÅÊúçÂä°ÁöÑÊÄßËÉΩÂùáË°°ÔºåÈÅøÂÖçË¥üËΩΩÁöÑËøáÈ´òÊàñËøá‰Ωé„ÄÇË¥üËΩΩÂÅáÂ¶ÇËøáÈ´òÔºåËôöÊãüÊú∫Á´û‰∫âÊøÄÁÉàÔºåÊÄßËÉΩÂèóÂà∞‰∏•ÈáçÂΩ±Âìç„ÄÇÂèç‰πãË¥üËΩΩËøá‰ΩéÔºåÁâ©ÁêÜËµÑÊ∫ê‰ΩøÁî®Áéá‰∏çÈ´òÔºåÊµ™Ë¥πËÆ°ÁÆóÊú∫ËµÑÊ∫ê„ÄÇÈÄöËøáËôöÊãüÊú∫ÁÉ≠ËøÅÁßªÔºåÊàë‰ª¨ÂèØÂ∞ÜËôöÊãüÊú∫‰ªéË¥üËΩΩÈ´òÁöÑÊú∫Âô®ËøÅÁßªËá≥Ë¥üËΩΩ‰ΩéÁöÑÊú∫Âô®ÔºåËøôÊ†∑‰øùËØÅ‰∫ÜËôöÊãüÊú∫ÁöÑÊÄßËÉΩÔºå‰πüÊèêÈ´ò‰∫ÜËµÑÊ∫êÂà©Áî®Áéá„ÄÇ</li>
<li>**<font color='red'>ËÉΩËÄóÊéßÂà∂„ÄÇ</font>**Âà©Áî®ÁÉ≠ËøÅÁßªÔºåÊàë‰ª¨ÂèØÂ∞Ü‰ΩéË¥üËΩΩÊúçÂä°Âô®‰∏äÁöÑËôöÊãüÊú∫ËøÅÁßªËá≥Âêå‰∏ÄÁâ©ÁêÜÊú∫ÔºåÁÑ∂ÂêéÂÖ≥Èó≠Á©∫Èó≤Âá∫Êù•ÁöÑÁâ©ÁêÜÊúçÂä°Âô®ÔºåËøôÊ†∑Êó¢ÂèØÂáèÂ∞ëÁâ©ÁêÜÊú∫ÁöÑÊçüËÄóÔºå‰πüÂèØÈôç‰ΩéÊï¥‰∏™Êï∞ÊçÆ‰∏≠ÂøÉÁöÑËÉΩËÄóÔºåÊèêÈ´ò‰∫ÜÊï∞ÊçÆ‰∏≠ÂøÉÁöÑËµÑÊ∫êÂà©Áî®ÁéáÔºå‰ªéËÄåËææÂà∞ËäÇËÉΩÂáèÊéíÁöÑÁõÆÁöÑ„ÄÇ</li>
<li><font color='red'><strong>ÊúçÂä°Âô®Âú®Á∫øÁª¥Êä§„ÄÇ</strong></font>Âú®Êï∞ÊçÆ‰∏≠ÂøÉÔºåÂæÄÂæÄÈúÄË¶ÅÂØπÁ°¨‰ª∂ËøõË°åÁª¥‰øÆÔºåÂ¶ÇÂ¢ûÂä†ÁΩëÂç°„ÄÅÁ£ÅÁõò„ÄÅÂÜÖÂ≠òÁ≠âÔºåÊúâÊó∂ÂÄôËøòÈúÄË¶ÅÂØπÊìç‰ΩúÁ≥ªÁªü„ÄÅÂ∫îÁî®ËΩØ‰ª∂ËøõË°åÂçáÁ∫ßÔºåËøôÊó∂ÂèØÂÖàÂ∞Ü‰∏äÈù¢ÁöÑËôöÊãüÊú∫ÁÉ≠ËøÅÁßªËá≥ÂÖ∂‰ªñÊú∫Âô®Ôºå‰ΩøÊúçÂä°Âô®Âú®Á∫øÁª¥Êä§Êàê‰∏∫ÂèØËÉΩÔºåÂêåÊó∂Ôºå‰πü‰øùËØÅ‰∫ÜËôöÊãüÊú∫ÁöÑÊÄßËÉΩÁ®≥ÂÆö„ÄÇ</li>
</ol>
<h2 id="13-‰∏§Áßç‰∏ªÊµÅÁöÑÁÉ≠ËøÅÁßªÁÆóÊ≥ï">1.3 ‰∏§Áßç‰∏ªÊµÅÁöÑÁÉ≠ËøÅÁßªÁÆóÊ≥ï
</h2><p>ÁÉ≠ËøÅÁßª‰∏ªË¶ÅÂåÖÊã¨ÂÖßÂ≠òËøÅÁßª„ÄÅËÆæÂ§áÁä∂ÊÄÅËøÅÁßª„ÄÅÂÖ≥Èó≠ËôöÊãüÊú∫„ÄÅÊÅ¢Â§çËôöÊãüÊú∫Âá†‰∏™Èò∂ÊÆµÔºåÊ†πÊçÆËøôÂá†‰∏™Èò∂ÊÆµÁöÑ‰∏çÂêåÈ°∫Â∫èÔºåÁÉ≠ËøÅÁßªÁÆóÊ≥ï‰∏ªË¶ÅÂèØÂàÜ‰∏∫‰∏§Á±ªÔºåÂç≥È¢ÑÊã∑Ë¥ùÔºàpre-copyÔºâÁÉ≠ËøÅÁßªÁÆóÊ≥ïÂíåÂêéÊã∑Ë¥ùÔºàpost-copyÔºâÁÉ≠ËøÅÁßªÁÆóÊ≥ï„ÄÇ</p>
<h3 id="È¢ÑÊã∑Ë¥ùÁÉ≠ËøÅÁßªÁÆóÊ≥ï-pre_copy">È¢ÑÊã∑Ë¥ùÁÉ≠ËøÅÁßªÁÆóÊ≥ï: pre_copy
</h3><p>2005Âπ¥ÔºåClarkÁ≠â‰∫∫È¶ñÂÖàÂú®XenÂπ≥Âè∞‰∏äÂÆûÁé∞‰∫ÜËôöÊãüÊú∫ÁÉ≠ËøÅÁßªÂäüËÉΩÔºåÂÆÉÂ∞±Â±û‰∫éÈ¢ÑÊã∑Ë¥ùÁÉ≠ËøÅÁßªÁÆóÊ≥ï„ÄÇÈ¢ÑÊã∑Ë¥ùÁÉ≠ËøÅÁßªÁÆóÊ≥ïÊòØÁõÆÂâçÂ≠¶ÊúØÁïå„ÄÅÂ∑•‰∏öÁïåÊúÄÊàêÁÜüÁöÑËôöÊãüÊú∫ÁÉ≠ËøÅÁßªÁÆóÊ≥ïÔºå‰∏ªÊµÅÁöÑËôöÊãüÂåñÂπ≥Âè∞Xen„ÄÅKVMÂÖ∂ÁÉ≠ËøÅÁßªÁÆóÊ≥ïÈÉΩÊòØÂü∫‰∫éÈ¢ÑÊã∑Ë¥ùÁÆóÊ≥ïÂÆûÁé∞ÁöÑ„ÄÇ</p>
<p>‰∏ÄÂè∞ËÆ°ÁÆóÊú∫ÁöÑËµÑÊ∫ê‰∏ªË¶ÅÂåÖÊã¨CPU„ÄÅÂÜÖÂ≠ò„ÄÅÂ§ñËÆæÔºåÂõ†Ê≠§ÂØπËôöÊãüÊú∫ËøõË°åËøÅÁßª‰πüÂ∞±ÊòØÂØπËøô‰∫õËµÑÊ∫êËøõË°åËøÅÁßª„ÄÇÈ¢ÑÊã∑Ë¥ùÁÉ≠ËøÅÁßªÊú∫Âà∂Â¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312281625912.png"
	
	
	
	loading="lazy"
	
		alt="image-20231228162526869"
	
	
></p>
<p>È¶ñÂÖàÂ∞ÜÊâÄÊúâÁöÑÂÜÖÂ≠òÈÉΩÊã∑Ë¥ùËøáÂéªÔºåÂú®Êã∑Ë¥ùËøáÁ®ã‰∏≠ÔºåËôöÊãüÊú∫‰ªçÁÑ∂Âú®ËøêË°åÔºå‰ºö‰∏çÂÅúÂú∞‰øÆÊîπÂÜÖÂ≠òÈ°µÔºåËÆ∞ÂΩïËøô‰∫õË¢´‰øÆÊîπÁöÑÂÜÖÂ≠òÈ°µÔºåËøõÂÖ•Ëø≠‰ª£È¢ÑÊã∑Ë¥ùÈò∂ÊÆµ„ÄÇÂú®Ëøô‰∏ÄÈò∂ÊÆµÔºåÈáçÂ§çÊã∑Ë¥ù‰∏ä‰∏ÄËΩÆÁöÑËÑèÈ°µ„ÄÇÈöèÁùÄËø≠‰ª£ÁöÑËøõË°åÔºåËÑèÈ°µÂ∞ÜË∂äÊù•Ë∂äÂ∞ëÔºåÂΩìËÑèÈ°µ‰Ωé‰∫éÊüê‰∏™ÈòÄÂÄºÊó∂ÔºåÊöÇÂÅúÊ∫êÂÆø‰∏ªÊú∫‰∏äÁöÑËôöÊãüÊú∫ÔºåÂ∞ÜÂâ©‰ΩôÁöÑËÑèÈ°µ„ÄÅCPUÁä∂ÊÄÅ‰ª•ÂèäÂ§ñËÆæÁä∂ÊÄÅÊã∑Ë¥ùËá≥ÁõÆÁöÑÂÆø‰∏ªÊú∫ÔºåÈÄÅ‰∏ÄÈò∂ÊÆµÁß∞‰∏∫ÂÅúÊú∫Êã∑Ë¥ùÈò∂ÊÆµ„ÄÇÊúÄÂêéÂú®ÁõÆÁöÑÂÆø‰∏ªÊú∫‰∏äÊÅ¢Â§çËôöÊãüÊú∫ÁöÑËøêË°å„ÄÇÂÅáÂ¶ÇÂú®ËøÅÁßªËøáÁ®ã‰∏≠ÂèëÁîüÊïÖÈöúÔºåÂàôÁ´ãÂç≥Âú®Ê∫êÂÆø‰∏ªÊú∫‰∏äÊÅ¢Â§çËôöÊãüÊú∫ËøêË°å„ÄÇ</p>
<p>ÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ãÔºåÂú®Ëø≠‰ª£Êã∑Ë¥ùÈò∂ÊÆµÔºåËÑèÈ°µ‰ºöË∂äÊù•Ë∂äÂ∞ëÔºå‰ΩÜÂÅáÂ¶ÇÂÜÖÂ≠òË¢´È¢ëÁπÅËÆøÈóÆÔºåÊàñÊòØÁΩëÁªúÂ∏¶ÂÆΩËæÉ‰Ωé„ÄÅÁΩëÁªúÊã•Â†µÔºåËÑèÈ°µÂæÄÂæÄËææ‰∏çÂà∞ÂÅúÊ≠¢Êã∑Ë¥ùÁöÑÈòÄÂÄºÔºåËøôÂ∞ÜÂØºËá¥ËøÅÁßªÊó∂Èó¥ËøáÈïøÔºåÁîöËá≥ËøÅÁßªÊ∞∏‰∏çÁªìÊùüÁ≠âÈóÆÈ¢ò„ÄÇ</p>
<h3 id="ÂêéÊã∑Ë¥ùÁÉ≠ËøÅÁßªÁÆóÊ≥ï-post_copy">ÂêéÊã∑Ë¥ùÁÉ≠ËøÅÁßªÁÆóÊ≥ï: post_copy
</h3><p>ÂêéÊã∑Ë¥ùÁÉ≠ËøÅÁßªÁÆóÊ≥ïÊúÄÊó©‰∫é2009Âπ¥ÔºåÁî±HinesiwÂú®XenÂπ≥Âè∞‰∏äÂÆûÁé∞‰∫ÜÔºåÂêéÊã∑Ë¥ùÁÉ≠ËøÅÁßªÁÆóÊ≥ïÊõ¥Â§öÁöÑÂè™ÊòØÂú®Â≠¶ÊúØÁïåËøõË°åËÆ®ËÆ∫ÔºåÂú®Â∑•‰∏öÁïåÂπ∂Ê≤°ÊúâÂ§ßËßÑÊ®°‰ΩøÁî®„ÄÇÂêéÊã∑Ë¥ùÁÉ≠ËøÅÁßªÁÆóÊ≥ïÔºåÁõ∏ÊØî‰∫éÈ¢ÑÊã∑Ë¥ùÁÉ≠ËøÅÁßªÁÆóÊ≥ïÔºåÂÆÉÂ∞ÜÂÜÖÂ≠òÊã∑Ë¥ùËøô‰∏ÄÈò∂ÊÆµÊîæÁΩÆÂú®CPUÁä∂ÊÄÅÁöÑÊã∑Ë¥ù‰πãÂêé„ÄÇÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312281625783.png"
	
	
	
	loading="lazy"
	
		alt="image-20231228162558756"
	
	
></p>
<p>ËøÅÁßªÊó∂È¶ñÂÖàÊöÇÂÅúËôöÊãüÊú∫ËøêË°åÔºåÂ∞ÜËôöÊãüÊú∫ÁöÑCPU„ÄÅÂ§ñËÆæÁä∂ÊÄÅÊã∑Ë¥ùËá≥ÁõÆÁöÑÂÆø‰∏ªÊú∫ÔºåÁÑ∂ÂêéÁõ¥Êé•Âú®ÂÆø‰∏ªÊú∫‰∏äÊÅ¢Â§çËôöÊãüÊú∫ÁöÑËøêË°åÔºåÂ∞ÜËôöÊãüÊú∫ÁöÑÂÜÖÂ≠òÈÄêÊ≠•Êã∑Ë¥ùËá≥ÁõÆÁöÑÂÆø‰∏ªÊú∫ÔºåÂú®ËøôËøáÁ®ã‰∏≠ÔºåËôöÊãüÊú∫ÁªèÂ∏∏‰ºöÂá∫Áé∞Áº∫È°µÔºàPAGE_FAULTÔºâÔºåËøôÊòØÁî±‰∫éÊâÄËÆøÈóÆÁöÑÈ°µÈù¢ËøòÊ≤°ÊúâÊã∑Ë¥ùËá≥ÁõÆÁöÑÂÆø‰∏ªÊú∫ÔºåÁº∫È°µÊó∂Â∫îËØ•‰ºòÂÖàÊääÊâÄÁº∫ÂÜÖÂ≠òÈ°µÊã∑Ë¥ùËá≥ÁõÆÁöÑÂÆø‰∏ªÊú∫„ÄÇÂêéÊã∑Ë¥ùËøÅÁßªÁÆóÊ≥ïÔºå‰øùËØÅ‰∫ÜÊâÄÊúâÁöÑÂÜÖÂ≠òÈ°µÊúÄÂ§öÊã∑Ë¥ù‰∏ÄÊ¨°ÔºåËøôÈÅøÂÖç‰∫ÜÈ¢ÑÊã∑Ë¥ùÊó∂ÂÜÖÂ≠òÈ°µÁöÑÈáçÂ§ç‰º†Ëæì„ÄÇ</p>
<p>ÂêéÊã∑Ë¥ùËøÅÁßªÁÆóÊ≥ïÔºåÁî±‰∫éÈ¶ñÂÖàÂ∞ÜCPU„ÄÅÂ§ñËÆæÁä∂ÊÄÅÊã∑Ë¥ùËá≥ÁõÆÁöÑÂÆø‰∏ªÊú∫ÔºåÈöèÂêéÁõ¥Êé•Âú®ÁõÆÁöÑÂÆø‰∏ªÊú∫‰∏äÊÅ¢Â§çËôöÊãüÊú∫ÁöÑËøêË°åÔºåÂõ†Ê≠§ÂÖ∂ÂÅúÊú∫Êó∂Èó¥ÂæàÁü≠„ÄÇ‰ΩÜÁî±‰∫éÂÜÖÂ≠òÊú™Êã∑Ë¥ùËá≥ÁõÆÁöÑÂÆø‰∏ªÊú∫ÔºåÂõ†Ê≠§ËøêË°åËøáÁ®ã‰∏≠‰ºö‰∫ßÁîüÁº∫È°µÔºåÁº∫È°µÈúÄË¶ÅÈÄöËøáÁΩëÁªú‰º†ËæìÔºåËøô‰∏ÄËøáÁ®ã‰∏≠ÔºåËôöÊãüÊú∫ÂøÖÈ°ªÊöÇÂÅúËøêË°å„ÄÇËÄåÁΩëÁªúÈÄüÂ∫¶‰∏éÂÜÖÂ≠òËÆøÈóÆÈÄüÂ∫¶Áõ∏Â∑ÆÂ∑®Â§ßÔºåËøôÂäøÂøÖÂØºËá¥ËøÅÁßªÂàùÊúüÔºåËôöÊãüÊú∫‰∏äÁöÑÂ∫îÁî®Á®ãÂ∫èÊÄßËÉΩÊçüÂ§±Â∑®Â§ßÔºåÂΩìÁÑ∂‰πüÊúâ‰∫∫ÊèêÂá∫‰∫ÜÂÜÖÂ≠òÈ°µÈ¢ÑÁºìÂ≠òÁ≠âÊäÄÊúØËøõË°åÊîπÂñÑ„ÄÇÂêéÊã∑Ë¥ùÁÉ≠ËøÅÁßªÁÆóÊ≥ïËøòÂ≠òÂú®‰∏Ä‰∏™‰∏•ÈáçÁöÑÈóÆÈ¢òÔºåÁî±‰∫éËøÅÁßªÊó∂ÔºåËôöÊãüÊú∫ÁöÑÁä∂ÊÄÅÂ∑±ÁªèÂàÜÊàê‰∏§ÈÉ®ÂàÜÔºåÁõÆÁöÑÂÆø‰∏ªÊú∫Êã•ÊúâCPU„ÄÅÂ§ñËÆæÁä∂ÊÄÅ„ÄÅÈÉ®ÂàÜÂÜÖÂ≠òÁä∂ÊÄÅÔºåËÄåÊ∫êÂÆø‰∏ªÊú∫Êã•ÊúâÈÉ®ÂàÜÂÜÖÂ≠òÁä∂ÊÄÅÔºåÂÅáÂ¶ÇÁΩëÁªú‰∏≠Êñ≠„ÄÅÊàñÊòØÁõÆÁöÑÂÆø‰∏ªÊú∫„ÄÅÊ∫êÂÆø‰∏ªÊú∫Âá∫Áé∞ÂÅúÊú∫ÊÉÖÂÜµÔºå‰∏ç‰ªÖÁÉ≠ËøÅÁßªËøáÁ®ãÂ§±Ë¥•ÔºåËôöÊãüÊú∫Áî±‰∫éÁä∂ÊÄÅ‰∏çÂÆåÊï¥ÔºåÂ∞Ü‰ºöÂá∫Áé∞Â¥©Ê∫É„ÄÇ</p>
<h1 id="2-Âü∫‰∫éx86ÁöÑkvmËôöÊãüÂåñÊäÄÊúØ">2 Âü∫‰∫éx86ÁöÑKVMËôöÊãüÂåñÊäÄÊúØ
</h1><p>ËôöÊãüÊú∫ÁöÑËøÅÁßª‰∏ªË¶ÅÊ∏âÂèäÂà∞CPU„ÄÅÂÜÖÂ≠ò„ÄÅÂ§ñËÆæ‰∏âÊñπÈù¢ÁöÑËøÅÁßªÔºåËÄå‰πüÊ≠£ÊòØËøô‰∏âÊñπÈù¢ÊûÑÂª∫‰∫Ü‰∏ÄÂè∞ÂÆåÊï¥ÁöÑËôöÊãüÊú∫„ÄÇÊØ´Êó†ÁñëÈóÆÔºåÂâñÊûêKVMÁöÑËôöÊãüÂåñÂÆûÁé∞Â∞ÜÊúâÂä©‰∫éÊàë‰ª¨Êõ¥Â•ΩÂú∞ÁêÜËß£ËôöÊãüÊú∫ÁÉ≠ËøÅÁßªÂÆûÁé∞Ôºå‰∏∫ËôöÊãüÊú∫ÁÉ≠ËøÅÁßª‰ºòÂåñÂÅöÂáÜÂ§á„ÄÇKVMËôöÊãüÂåñÁöÑÂÆûÁé∞‰∏ªË¶Å‰æùÈù†ÂÜÖÊ†∏KVMÊ®°Âùó‰ª•ÂèäQEMUÔºåÂÖ∂‰∏≠KVMÊ®°ÂùóË¥üË¥£ËôöÊãüCPU„ÄÅÂÜÖÂ≠òÂèäÈÉ®ÂàÜ‰∏≠Êñ≠ÂäüËÉΩÔºåËÄåQEMUÂàôË¥üË¥£IOÁöÑËôöÊãüÂåñÔºåÊú¨Á´†ËäÇÈ¶ñÂÖàÂ∞ÜÂâñÊûêQEMUÔºå‰ªãÁªçQEMUÁöÑÂ§öÁ∫øÁ®ã‰∫ã‰ª∂È©±Âä®Ê®°ÂûãÔºåÊé•ÁùÄÊàë‰ª¨Â∞ÜÂâñÊûêKVMÊ®°ÂùóÔºå‰ªãÁªçKVMÁöÑCPU„ÄÅÂÜÖÂ≠òËôöÊãüÂåñÔºåÊúÄÂêé‰ªãÁªçQEMUÊòØÂ¶Ç‰ΩïÂÆûÁé∞IOËôöÊãüÂåñÁöÑ„ÄÇ</p>
<h2 id="21-qemuÂú®kvm‰∏≠ÁöÑÂ∫îÁî®">2.1 QEMUÂú®KVM‰∏≠ÁöÑÂ∫îÁî®
</h2><p>QEMUÊòØ‰∏Ä‰∏™ÂºÄÊ∫êÁöÑÂø´ÈÄüÊ®°ÊãüËÆ°ÁÆóÊú∫ÔºåÁ±ª‰ººÁöÑÊ®°ÊãüÂô®ËøòÊúâBochs„ÄÅPearPCÁ≠âÔºå‰ΩÜQEMUÂÖ∑ÊúâÈ´òÈÄüÂ∫¶‰ª•ÂèäË∑®Âπ≥Âè∞Á≠âÁâπÂæÅ„ÄÇÂÆÉÊîØÊåÅÂú®‰∏ÄÁßç‰ΩìÁ≥ªÁªìÊûÑ‰∏äÔºàx86„ÄÅARMÁ≠âÔºâÊ®°ÊãüÂè¶Â§ñ‰∏ÄÁßç‰ΩìÁ≥ªÁªìÊûÑÔºåÂπ∂Âú®‰∏äÈù¢ËøêË°åÁõ∏Â∫î‰ΩìÁ≥ªÁªìÊûÑÁöÑÊìç‰ΩúÁ≥ªÁªü„ÄÅÂ∫îÁî®ËΩØ‰ª∂„ÄÇQEMUÊîØÊåÅ‰∏§ÁßçÂ∑•‰ΩúÊ®°ÂºèÔºåÂàÜÂà´‰∏∫Á≥ªÁªüÊ®°ÂºèÔºàsystem modeÔºâÂíåÁî®Êà∑Ê®°ÂºèÔºàuser modeÔºâ„ÄÇ</p>
<ul>
<li>Âú®Á≥ªÁªüÊ®°Âºè‰∏ãÔºåQEMUÂèØÊ®°ÊãüÂ§öÁßç‰∏çÂêå‰ΩìÁ≥ªÁªìÊûÑ‰∏ãÂÆåÊï¥ÁöÑÁ°¨‰ª∂Âπ≥Âè∞ÔºåÂåÖÊã¨CPU„ÄÅÂÜÖÂ≠ò‰ª•ÂèäÂ§ñÂõ¥ËÆæÂ§áÔºåÂú®‰∏äÈù¢ÂèØËøêË°åÊú™Áªè‰øÆÊîπÁöÑÊìç‰ΩúÁ≥ªÁªüÔºåÊòØ‰∏ÄÂè∞ÂÆåÊï¥ÁöÑËôöÊãüÊú∫Ôºõ</li>
<li>Âú®Áî®Êà∑Ê®°Âºè‰∏ãÔºå‰∏ªË¶ÅÂ∫îÁî®‰∫éLinuxÁéØÂ¢É‰∏ãÔºåÂÆÉÊîØÊåÅÂ∞ÜÊüê‰∫õCPU‰ΩìÁ≥ªÁªìÊûÑ‰∏ãÁöÑLinuxÁ®ãÂ∫èËøêË°åÂú®ÂÖ∂‰ªñ‰∏çÂêå‰ΩìÁ≥ªÁªìÊûÑÁöÑCPU‰∏äÔºåÂ∏∏Áî®‰∫é‰∫§ÂèâÁºñËØëÂô®ÁöÑÊµãËØï‰ª•ÂèäCPUÊ®°ÊãüÂô®ÁöÑÊµãËØï„ÄÇ</li>
</ul>
<p>Êàë‰ª¨Â∞Ü‰∏ªË¶ÅËÆ®ËÆ∫Á≥ªÁªüÊ®°Âºè‰∏ãÁöÑQEMU„ÄÇ</p>
<h3 id="qemuÂ§öÁ∫øÁ®ã‰∫ã‰ª∂È©±Âä®Ê®°Âûã">QEMUÂ§öÁ∫øÁ®ã‰∫ã‰ª∂È©±Âä®Ê®°Âûã
</h3><p>ËøêË°å‰∏ÄÂè∞ÂÆåÊï¥ÁöÑËôöÊãüÊú∫ÔºåÈúÄË¶ÅËøêË°åÂÆ¢Êà∑Êú∫‰ª£Á†Å„ÄÅÂ§ÑÁêÜÊó∂Èíü„ÄÅÂ§ÑÁêÜIOÔºåÂêåÊó∂ÂØπÁî®Êà∑ÁöÑÂëΩ‰ª§ËøõË°åÂèäÊó∂ÂìçÂ∫îÁ≠â„ÄÇË¶ÅÂèäÊó∂ÂÆåÊàêËøô‰∫õÂ∑•‰ΩúÔºåËøôÈúÄË¶Å‰∏ÄÁßçËâØÂ•ΩÁöÑËΩØ‰ª∂Êû∂ÊûÑËÉΩÂ§üÂêàÁêÜÂú∞ÂçèË∞ÉÂêÑÁßçËµÑÊ∫êÔºåÂΩì‰∏Ä‰∫õÊØîËæÉËÄóÊó∂ÁöÑ‰ªªÂä°ÔºàÂ¶ÇÁ£ÅÁõòIOÊ®°Êãü„ÄÅÁÉ≠ËøÅÁßªËôöÊãüÊú∫Á≠âÔºâÊ≠£Âú®ËøõË°åÊó∂ÔºåËôöÊãüÊú∫‰∏çËÉΩÂÅúÊ≠¢ÔºåÂÆ¢Êà∑Êú∫ÁöÑ‰ª£Á†Å‰æùÁÑ∂Ê≠£Â∏∏ÊâßË°å„ÄÇ</p>
<p>ÂØπ‰∫éËøôÁ±ªÈúÄË¶ÅÂ§ÑÁêÜÂ§öÁßçËµÑÊ∫êËØ∑Ê±ÇÁöÑËΩØ‰ª∂Ôºå‰∏öÁïåÊúâ‰∏§ÁßçÊØîËæÉÊµÅË°åÁöÑÊû∂ÊûÑÔºöÂπ∂Ë°åÊû∂ÊûÑÔºàParallel architectureÔºâÂíå‰∫ã‰ª∂È©±Âä®Êû∂ÊûÑÔºàEvent-driven archtectureÔºâ„ÄÇQEMU‰ΩøÁî®‰∫ÜÊ∑∑ÂêàÊ®°ÂºèÔºåÂç≥ÂÆÉÁöÑÊû∂ÊûÑÊó¢ÈááÁî®‰∫ÜÂ§öÁ∫øÁ®ãÔºå‰πüÈááÁî®‰∫Ü‰∫ã‰ª∂È©±Âä®ÔºåÊàë‰ª¨Áß∞ÂÆÉ‰∏∫<strong>Â§öÁ∫øÁ®ã‰∫ã‰ª∂È©±Âä®Ê®°Âûã„ÄÇ</strong></p>
<ul>
<li>Âà©Áî®‰∫ã‰ª∂È©±Âä®ÔºåÂèØ‰ª•ÂêåÊó∂ÂØπÂ§öÁßç‰∫ã‰ª∂ËøõË°åÁõëÂê¨ÂìçÂ∫îÔºõ</li>
<li>Âà©Áî®Â§öÁ∫øÁ®ãÔºåÂèØ‰ª•ÂÖÖÂàÜÂà©Áî®ÊúçÂä°Âô®ÁöÑÂ§öÊ†∏ÁªìÊûÑÔºåÂ∞Ü‰∏Ä‰∫õËÄóÊó∂ÁöÑ‰ªªÂä°ÔºåÂ¶ÇËôöÊãüÊú∫ËøÅÁßªÔºåÂßîÊâòÁªô‰∏ìÈó®ÁöÑÁ∫øÁ®ãÊâßË°åÔºåËøôÊ†∑Â∞±‰∏ç‰ºöÈòªÂ°û‰∫ÜÊï¥Âè∞ËôöÊãüÊú∫ÁöÑËøêË°å„ÄÇ</li>
</ul>
<h4 id="qemu‰∫ã‰ª∂È©±Âä®">QEMU‰∫ã‰ª∂È©±Âä®
</h4><p>QEMUÁöÑ‰∏ªÁ∫øÁ®ãÔºåË¥üË¥£Êï¥‰∏™ËΩØ‰ª∂ÁöÑ‰∫ã‰ª∂È©±Âä®Ôºå‰∏ªË¶ÅÂÄüÂä©ÂáΩÊï∞ <code>main_loop_wait</code>„ÄÇÂÆÉ‰∏ªË¶ÅÁî®Êù•ÊâßË°å‰ª•‰∏ã‰ªªÂä°Ôºö</p>
<ol>
<li>**ÊâßË°åpollÊìç‰ΩúÔºå**Êü•ËØ¢Êñá‰ª∂ÊèèËø∞Á¨¶ÊòØÂê¶ÂèØËØªÊàñÂèØÂÜô„ÄÇQEMU‰∏≠Ê£ÄÊµãÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶‰∏ªË¶ÅÂåÖÊã¨‰ª•‰∏ãÂá†Á±ªÔºö
<ul>
<li>block ioÔºåËôöÊãüÁ£ÅÁõòÁõ∏ÂÖ≥ÁöÑioÔºå‰∏∫‰∫Ü‰øùËØÅÈ´òÊÄßËÉΩÔºå‰∏ªË¶ÅÈááÁî®ÂºÇÊ≠•IOÂÆûÁé∞Ôºõ</li>
<li>eventfdÔºå‰∏ªË¶ÅÁî®‰∫éQEMU‰∏éKVM‰πãÈó¥ÁöÑÈÄö‰ø°‰∫§ÊµÅÔºõ</li>
<li>socketÔºå‰∏ªË¶ÅÁî®‰∫éËôöÊãüÊú∫ËøÅÁßª„ÄÅËôöÊãüÊú∫ÁîüÂëΩÂë®ÊúüÁÆ°ÁêÜÁ≠â„ÄÇ</li>
</ul>
</li>
<li>**ÊâßË°åÂà∞ÊúüÁöÑÂÆöÊó∂Âô®„ÄÇ**QEMUÈáåÈù¢Êúâ‰∏âÁßçÊó∂ÈíüÔºörealtime clock„ÄÅvirtual clock„ÄÅhost clock„ÄÇQEMUÂà©Áî®Ëøô‰∏âÁßçÊó∂ÈíüÁöÑÂÆöÊó∂Âô®ÔºåÊâßË°å‰∏Ä‰∫õÂë®ÊúüÊÄßÁöÑ‰ªªÂä°ÔºåÂ¶ÇÂà©Áî®ÂÆöÊó∂Âô®ÂÆöÊúüÂèëÂá∫SIGALRM‰ø°Âè∑ÔºåÈÄöÁü•QEMUÂ§ÑÁêÜÂºÇÂ∏∏Âíå‰∏≠Êñ≠„ÄÇ</li>
<li>**ÊâßË°å‰∏ãÂçäÈÉ®Ôºàbottom-halvesÔºâ„ÄÇ**‰∏ãÂçäÈÉ®Êú¨Ë¥®‰∏äÊòØ‰∏ÄÁßçÂõûË∞ÉÂáΩÊï∞„ÄÇQEMUÈÄöËøáÂºÇÊ≠•IOÊù•Ê®°ÊãüÁ£ÅÁõòIOÔºåQEMUÊà™Ëé∑‰∫ÜËôöÊãüÊú∫ÁöÑÁ£ÅÁõòËÆøÈóÆËØ∑Ê±ÇÂêéÔºå‰ΩøÁî®Áã¨Á´ãÁöÑÁ∫øÁ®ãÊ®°ÊãüIOÔºåÂΩìÁ∫øÁ®ãÂÆåÊàêIOÊó∂ÔºåÈúÄË¶ÅÈÄöÁü•ËôöÊè™Êú∫ÔºåÈÄöÁü•ËôöÊãüÊú∫ÁöÑÂ∑•‰ΩúÂ∞±ÊîæÂú®‰∏ãÂçäÈÉ®ÂÆåÊàê„ÄÇËôöÊãüÊú∫ËøÅÁßª‰ªªÂä°ÔºåÂΩìËôöÊãüÊú∫ËøÅÁßªÂÆåÊàêÊó∂ÔºåÈúÄË¶ÅÂÅöÂÖ≥Èó≠Â•óÊé•Â≠óÁ≠âÊ∏ÖÁêÜÂ∑•‰ΩúÔºåËøôÈÉ®ÂàÜÂ∑•‰Ωú‰πüÊîæÂú®‰∏ãÂçäÈÉ®‰∏≠„ÄÇ</li>
</ol>
<h4 id="qemuÂ§öÁ∫øÁ®ã">QEMUÂ§öÁ∫øÁ®ã
</h4><p>QEMUÊòØ‰∏Ä‰∏™Â§öÁ∫øÁ®ãÊ®°ÂûãÔºåÂ¶ÇÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312280910466.png"
	
	
	
	loading="lazy"
	
		alt="image-20231227152015813"
	
	
></p>
<p>‰∏Ä‰∏™QEMUËøõÁ®ãÂæÄÂæÄÂåÖÊã¨Â§ö‰∏™Á∫øÁ®ãÔºåÂ¶Ç‰∏ªÁ∫øÁ®ã„ÄÅVCPUÁ∫øÁ®ã„ÄÅVNCÁ∫øÁ®ã„ÄÅÂ∑•‰ΩúÁ∫øÁ®ã„ÄÅËøÅÁßªÁ∫øÁ®ãÔºö</p>
<ol>
<li>**‰∏ªÁ∫øÁ®ãÔºö**‰∏ªË¶ÅË¥üË¥£ËôöÊãüÊú∫ÁöÑÂàùÂßãÂåñÔºåÂêÑÁßçËôöÊãüÊú∫ËÆæÂ§áÁöÑÂàùÂßãÂåñÔºåÂÖ∂‰ªñÁ∫øÁ®ãÈÉΩÁî±Ëøô‰∏™Á∫øÁ®ãÂàõÂª∫ÁöÑ„ÄÇ‰∏ªÁ∫øÁ®ãÂú®ËôöÊãüÊú∫ËøêË°åËøáÁ®ã‰∏≠ÔºåËøêË°åÁùÄmain loopÔºåË¥üË¥£ÁõëÂê¨„ÄÅÂìçÂ∫îÂêÑÁ±ªÊñá‰ª∂ÊèèËø∞Á¨¶„ÄÇ</li>
<li>**VCPUÁ∫øÁ®ãÔºö**Ë¥üË¥£Ê®°ÊãüCPUÔºåVCPUÁ∫øÁ®ãÂæÄÂæÄÊúâÂ§ö‰∏™ÔºåVCPUÁ∫øÁ®ãÁöÑ‰∏™Êï∞Á≠â‰∫éËôöÊãüÊú∫Ê†∏Êï∞„ÄÇVCPUÁ∫øÁ®ãË¥üË¥£ÂÆ¢Êà∑Êú∫‰ª£Á†ÅËøêË°åÔºåÊó¢ÂèØ‰ª•ÈÄöËøáTCGÊú∫Âà∂ÁøªËØëÊâßË°åÂÆ¢Êà∑Êú∫‰ª£Á†ÅÔºå‰πüÂèØ‰ª•ÈÄöËøáKVM„ÄÅXenÁ≠âÁ°¨‰ª∂ËæÖÂä©ËôöÊãüÂåñÁöÑÊñπÂºèÊâßË°å„ÄÇ</li>
<li><strong>VNCÁ∫øÁ®ã</strong>Ôºö‰∏ªË¶ÅË¥üË¥£ËÆ°ÁÆóÂØÜÈõÜÂûãÂõæÂÉèÂä†Á†ÅËß£Á†ÅÂ∑•‰ΩúÔºåÈº†Ê†á„ÄÅÈîÆÁõòÁöÑËæìÂÖ•ÊçïÊçâ‰ª•ÂèäËôöÊãüÊú∫ÁöÑÂõæÂΩ¢ÂåñÁïåÈù¢ÈÉΩÊòØÁî±Ëøô‰∏™Á∫øÁ®ãÂÆåÊàêÁöÑÔºåËøôÁÆóÊòØ‰∏Ä‰∏™ÁâπÊÆäÁöÑÂ∑•‰ΩúÁ∫øÁ®ã„ÄÇ</li>
<li>**Â∑•‰ΩúÁ∫øÁ®ãÔºö**Âç≥worker threadÔºåËøô‰∏ÄÁ±ªÁ∫øÁ®ã‰∏ªË¶ÅË¥üË¥£IOÊ®°ÊãüÔºåQEMUÈÄöËøáÁ∫øÁ®ãÊ±†ÁöÑÊñπÂºèÊ®°ÊãüÁ£ÅÁõòIOÔºåÁ£ÅÁõòIOËØ∑Ê±ÇÁªÑÊàê‰∏Ä‰∏™ÈòüÂàóÔºåÂ∑•‰ΩúÁ∫øÁ®ãÂèñÂá∫ÈòüÂàó‰∏≠ÁöÑËØ∑Ê±ÇÔºåËøõË°åÊ®°ÊãüÔºåÂ∑•‰ΩúÁ∫øÁ®ãÊ†πÊçÆË¥üËΩΩÊÉÖÂÜµÊúâÂ§ö‰∏™ÔºåÂä®ÊÄÅÂàõÂª∫„ÄÅÈîÄÊØÅ„ÄÇ</li>
<li>**ËøÅÁßªÁ∫øÁ®ãÔºö**ÂΩìÁî®Êà∑ÈúÄË¶ÅËøÅÁßªËôöÊãüÊú∫Êó∂Ôºå‰∏ªÁ∫øÁ®ã‰ºöÂàõÂª∫‰∏Ä‰∏™ËøÅÁßªÁ∫øÁ®ãÔºå‰∏ìÈó®Ë¥üË¥£ÂÆåÊàêËøÅÁßªÂ∑•‰Ωú„ÄÇ</li>
</ol>
<h3 id="ÂÆ¢Êà∑Êú∫‰ª£Á†ÅÁöÑÊâßË°å">ÂÆ¢Êà∑Êú∫‰ª£Á†ÅÁöÑÊâßË°å
</h3><p>ÂÆ¢Êà∑Êú∫‰ª£Á†ÅÁöÑÊâßË°åÔºåÊåáËôöÊãüÊú∫Êìç‰ΩúÁ≥ªÁªü„ÄÅÂ∫îÁî®ËΩØ‰ª∂‰ª£Á†ÅÁöÑÊâßË°åÔºå‰πüÂ∞±ÊòØCPUÁöÑËôöÊãüÂåñ„ÄÇQEMU‰∏≠ÔºåÂÆ¢Êà∑Êú∫‰ª£Á†ÅÁöÑÊâßË°å‰∏ªË¶ÅÁî±‰∏§ÁßçÊú∫Âà∂ÔºöTCGÂíåKVM„ÄÇ</p>
<p>TCGÔºåÂÖ®Áß∞‰∏∫Tiny Code GeneratorÔºåÂç≥ÂæÆÊåá‰ª§ÁøªËØëÂô®ÔºåÊúÄÂàùÊòØ‰Ωú‰∏∫‰∏Ä‰∏™Ôº£ÁºñËØëÂô®ÁöÑÈÄöÁî®ÂêéÁ´ØÔºåÂêéÈù¢Ë¢´ÁÆÄÂåñÂêéÁî®‰∫éQEMU‰∏≠„ÄÇÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312271551429.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>TCGÂèØ‰ª•ÂàÜ‰∏∫‰∏âÈÉ®ÂàÜÔºåÂç≥ÂâçÁ´ØËß£Á†ÅÂô®„ÄÅ‰∏≠Á´ØÂàÜÊûêÂô®„ÄÅ‰ª•ÂèäÂêéÁ´ØÁøªËØëÂô®„ÄÇÂÖ∂‰∏≠Ôºö</p>
<ul>
<li>ÂâçÁ´ØËß£Á†ÅÂô®ËØªÂèñÂÆ¢Êà∑Êú∫Êåá‰ª§ÔºåÊ†πÊçÆÂÆ¢Êà∑Êú∫Êåá‰ª§Êû∂ÊûÑÔºåÂ∞ÜÂÖ∂ÁøªËØë‰∏∫‰∏≠Èó¥Á†ÅÔºàTCG instructionsÔºåÁ±ª‰ººRISCÊåá‰ª§ÁöÑÂæÆÊåá‰ª§ÔºâÔºõ</li>
<li>‰∏≠Á´ØÂàÜÊûêÂô®ËØªÂèñÁøªËØëÁöÑ‰∏≠Èó¥Á†ÅÔºåËøõË°å‰ºòÂåñÔºåÂ¶ÇÂéªÈô§‰∏Ä‰∫õÂÜó‰ΩôÁöÑÊåá‰ª§Ôºõ</li>
<li>‰ºòÂåñÂêéÁöÑ‰∏≠Èó¥Á†ÅÔºåËæìÂÖ•ÂêéÁ´ØÁøªËØëÂô®ÔºåÂêéÁ´ØÁøªËØëÂô®Ê†πÊçÆÂÆø‰∏ªÊú∫ÁöÑCPU‰ΩìÁ≥ªÊû∂ÊûÑÔºåÂ∞Ü‰∏≠Èó¥Á†ÅÁøªËØë‰∏∫ÂÆø‰∏ªÊú∫ÁõÆÊ†á‰ª£Á†ÅÔºõ</li>
</ul>
<p>TCGÂÄüÂä©Âä®ÊÄÅÁøªËØëÊâßË°åÂÆ¢Êà∑Êú∫Ê∫ê‰ª£Á†ÅÔºåÂèØ‰ª•ÂÆûÁé∞Ë∑®CPU‰ΩìÁ≥ªÊû∂ÊûÑÔºå‰ΩÜÁî±‰∫éÊòØÁøªËØëÊâßË°åÔºåÂõ†Ê≠§QEMUÁöÑÊïàÁéáÂπ∂‰∏çÊòØÂæàÈ´òÔºåÂÅáÂ¶ÇÂÆ¢Êà∑Êú∫ÁöÑ‰ª£Á†ÅËÉΩÁõ¥Êé•Âú®Áâ©ÁêÜCPU‰∏äËøêË°åÔºåÊïàÁéáÂèØ‰ª•ÊûÅÂ§ßÊèêÈ´ò„ÄÇKVMÂ∞±ÊòØ‰ª•ËøôÁßçÊñπÂºèÊ®°ÊãüCPUÔºåKVM‰∏ªË¶ÅÂÄüÂä©Á°¨‰ª∂ËæÖÂä©ËôöÊãüÂåñÊäÄÊúØÔºåËÆ©ÂÆ¢Êà∑Êú∫ÁöÑ‰ª£Á†ÅÁõ¥Êé•Âú®Áâ©ÁêÜÔº£PU‰∏äËøêË°åÔºåÊÄßËÉΩÊé•ËøëË£∏Êú∫ÊÄßËÉΩÔºåÊàë‰ª¨Êé•‰∏ãÊù•Â∞ÜÂâñÊûêKVMÁöÑCPUËôöÊãüÂåñÂÆûÁé∞„ÄÇ</p>
<h2 id="22-cpuËôöÊãüÂåñ">2.2 CPUËôöÊãüÂåñ
</h2><h3 id="intelÁöÑvt-xÊäÄÊúØ">IntelÁöÑVT-xÊäÄÊúØ
</h3><p>‰º†ÁªüÁöÑx86Êû∂ÊûÑÂØπËôöÊãüÂåñÂπ∂‰∏çÂèãÂ•ΩÔºåx86Â§ÑÁêÜÂô®ÈÄöËøáRingÁ∫ßÂà´ÊéßÂà∂ËÆøÈóÆÊùÉÈôêÔºåÂàÜ‰∏∫Ring0„ÄÅRing1„ÄÅRing2„ÄÅRing3ÔºåÂÖ∂‰∏≠Ring0Á∫ßÂà´ÊúÄÈ´òÔºåÂèØ‰ª•ÊâßË°åÁâπÊùÉÊåá‰ª§ÔºåRing3Á∫ßÂà´ÊúÄ‰Ωé„ÄÇÂ¶ÇÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312280910432.png"
	
	
	
	loading="lazy"
	
		alt="image-20231227160019292"
	
	
></p>
<p>Êìç‰ΩúÁ≥ªÁªüËøêË°å‰∫éRing0Á∫ßÂà´ÔºåÂèØ‰ª•ÊéßÂà∂ÂêÑÁßçÁâ©ÁêÜËµÑÊ∫êÔºåËÄåÂ∫îÁî®ËΩØ‰ª∂ËøêË°åÂú®Ring3Á∫ßÂà´ÔºåÂØπËµÑÊ∫êÁöÑËÆøÈóÆÈúÄË¶ÅÂêëÊìç‰ΩúÁ≥ªÁªüËØ∑Ê±Ç„ÄÇ‰∏∫‰∫ÜÂÆûÁé∞ËôöÊãüÂåñÔºåÈÄöÂ∏∏ÈááÁî®ÁâπÊùÉÁ≠âÁ∫ß‰∏ãÈôçÔºàRing deprivilegingÔºâÁöÑÊñπÂºèÂÆûÁé∞„ÄÇÂ¶Ç‰∏äÂõæÊâÄÁ§∫ÔºåÂÖ∂‰∏≠VMMËøêË°å‰∫éRING0Á∫ßÂà´ÔºåÂÆ¢Êà∑Êú∫Êìç‰ΩúÁ≥ªÁªüËøêË°å‰∫éRING1Á∫ßÂà´ÔºåËÄåÂÆ¢Êà∑Êú∫Â∫îÁî®ËΩØ‰ª∂ËøêË°å‰∫éRING3Á∫ßÂà´Ôºå‰ΩÜËøôÁßçËôöÊãüÂåñÂÆûÁé∞ÊñπÂºèÂ≠òÂú®ÂÜÖÂ≠òÂú∞ÂùÄÁ©∫Èó¥Áº©Â∞è„ÄÅÈÉ®ÂàÜÊåá‰ª§‰∏çËÉΩËôöÊãüÂåñ„ÄÅRING AliasingÁ≠âÈóÆÈ¢ò„ÄÇ‰∏∫‰∫ÜËß£ÂÜ≥‰∏äËø∞ÈóÆÈ¢òÔºåÊèêÈ´òËôöÊãüÂåñÊïàÁéáÔºåIntelÂíåAMDÂàÜÂà´Êâ©Â±ï‰∫Üx86Â§ÑÁêÜÂô®ÁöÑÊåá‰ª§ÈõÜÔºåÂú®Á°¨‰ª∂Â±ÇÈù¢Ê∑ªÂä†‰∫ÜÈÉ®ÂàÜËôöÊãüÂåñÊåá‰ª§ÔºåÁß∞‰∏∫Á°¨‰ª∂ËæÖÂä©ËôöÊãüÂåñÔºåIntelÊé®Âá∫‰∫ÜVT-xÊäÄÊúØÔºåËÄåAMDÁõ∏Â∫îÁöÑÊé®Âá∫‰∫ÜAMD-vÊäÄÊúØÔºåËøôÈáåÊàë‰ª¨Â∞Ü‰∏ªË¶ÅÂàÜÊûêIntelÁöÑVT-xÊäÄÊúØ„ÄÇ</p>
<p>IntelÊãìÂ±ï‰∫ÜÂéüÊúâÁöÑx86Êû∂ÊûÑÔºåÂºïÂÖ•‰∫Ü‰∏§Áßç‰∏ìÈó®‰∏∫ËôöÊãüÂåñÊâìÈÄ†ÁöÑÊìç‰ΩúÊ®°ÂºèÔºåÂç≥VMXÊ†πÊìç‰ΩúÊ®°ÂºèÂíåVMXÈùûÊ†πÊìç‰ΩúÊ®°ÂºèÔºåÂ¶ÇÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312280911177.png"
	
	
	
	loading="lazy"
	
		alt="image-20231227160818072"
	
	
></p>
<p>VMXÊ†πÊìç‰ΩúÊ®°ÂºèÁ±ª‰ºº‰∫éÂéüÊúâÁöÑx86Êû∂ÊûÑÔºåÂèØÂÉèÂéüÂÖà‰∏ÄÊ†∑ËøêË°åÊìç‰ΩúÁ≥ªÁªüÂíåÂ∫îÁî®ËΩØ‰ª∂Ôºå‰πüÂèØ‰ª•ËøêË°åËôöÊãüÊú∫ÁõëËßÜÂô®ÔºõËÄåVMXÈùûÊ†πÊìç‰ΩúÊ®°ÂºèÔºåÂàô‰∏ìÈó®Áî®‰∫éËøêË°åÂÆ¢Êà∑Êú∫Êìç‰ΩúÁ≥ªÁªüÔºåÈáåÈù¢ËÆ∏Â§öÊåá‰ª§ÁöÑÁâπÊùÉÁ∫ßÂà´ÈÉΩ‰∏ãÈôç‰∫Ü„ÄÇËøô‰∏§ÁßçCPUÊìç‰ΩúÊ®°ÂºèÈÉΩÊúâÂÆåÊï¥ÁöÑÂõõ‰∏™RINGÁ∫ßÂà´ÔºåËøôÊ†∑ÂÆ¢Êà∑Êú∫ÁöÑÊâÄÊúâÊåá‰ª§ÂèØ‰ª•Âú®ÂéüÂÖàÁöÑRINGÁ∫ßÂà´‰∏ãÊâßË°åÔºåËÄåËôöÊãüÊú∫ÁõëÊéßÂô®‰πüÊúâË∂≥Â§üÁöÑÁÅµÊ¥ªÂ∫¶ÊéßÂà∂ÂêÑÁ±ªËµÑÊ∫ê„ÄÇ</p>
<p>Áî±‰∫éCPUÊã•Êúâ‰∫ÜÂ§öÁßçÊìç‰ΩúÊ®°ÂºèÔºåÂõ†Ê≠§VT-xÊäÄÊúØ‰πüÂÆö‰πâ‰∫Ü‰∏éÊ≠§Áõ∏ÂØπÂ∫îÁöÑÁä∂ÊÄÅÂàáÊç¢Êåá‰ª§ÔºåÂåÖÊã¨VMXON„ÄÅVMXOFF„ÄÅVMENTRYÂíåVMEXIT„ÄÇÂÖ∂‰∏≠Ôºö</p>
<ul>
<li>VMXONÂíåVMXOFFÊòØÂàÜÂà´Áî®Êù•ÂºÄÂêØÂíåÂÖ≥Èó≠ËØ•È°πÊäÄÊúØÔºõ</li>
<li>VMENTRYÊòØÊåáCPU‰ªéVMXÊ†πÊìç‰ΩúÊ®°ÂºèÂàáÊç¢Âà∞VMXÈùûÊ†πÊìç‰ΩúÊ®°ÂºèÔºåÂÆ¢Êà∑Êú∫Âç†ÊúâCPUÔºåÂÆ¢Êà∑Êú∫Êìç‰ΩúÁ≥ªÁªüÂèäÂ∫îÁî®ËΩØ‰ª∂ÂºÄÂßãÊâßË°åÔºõ</li>
<li>VMEXITÊòØÊåáCPUÁî±‰∫éÂºÇÂ∏∏‰ªéVMXÈùûÊ†πÊìç‰ΩúÊ®°ÂºèÈÄÄÂõûÂà∞VMXÊ†πÊìç‰ΩúÊ®°ÂºèÔºåËøôÊó∂ËôöÊãüÊú∫ÁõëËßÜÂô®ÂºÄÂßãÊâßË°åÔºõ</li>
</ul>
<hr>
<p>Â∞±ÂÉèLinuxËøõÁ®ãÂàáÊç¢Êó∂ÈúÄË¶ÅÂ∞Ü‰∏ä‰∏ãÊñá‰ø°ÊÅØ‰øùÂ≠òÂú®ËøõÁ®ãÊéßÂà∂Âùó‰∏≠ÔºåËôöÊãüÊú∫ÁõëÊéßÂô®‰∏éÂÆ¢Êà∑Êú∫Áî±‰∫éÂÖ±‰∫´‰∫ÜÂ§ÑÁêÜÂô®ÔºåÂõ†Ê≠§‰πüÈúÄË¶Å‰∏Ä‰∏™ÂÜÖÂ≠òÂå∫ÂüüÊù•Ëá™Âä®‰øùÂ≠òÂíåÊÅ¢Â§çÊâßË°åÂÆ¢Êà∑Êú∫ÂíåÂÆø‰∏ªÊú∫ÁöÑËøêË°å‰∏ä‰∏ãÊñá„ÄÇÂú®Intel VT-xÊäÄÊúØ‰∏≠ÔºåÊàë‰ª¨Áß∞ËØ•ÂÜÖÂ≠òÂå∫Âüü‰∏∫ËôöÊãüÊú∫ÊéßÂà∂ÂùóÔºàVMCSÔºâÔºåÈÄÅÊòØ‰∏Ä‰∏™ÊûÅ‰∏∫ÂÖ≥ÈîÆÁöÑÁªìÊûÑÔºåÈÄöÂ∏∏Âç†Áî®‰∏Ä‰∏™pageÁöÑÂ§ßÂ∞èÔºåÂÆÉÁî±ËôöÊãüÊú∫ÁõëÊéßÂô®ÔºàVMMÔºâÂàÜÈÖçÔºå‰∏Ä‰∏™ËôöÊãüCPUÔºàVCPUÔºâÈúÄË¶ÅÂàÜÈÖç‰∏Ä‰∏™VMCSÔºåVMCSÁî±Á°¨‰ª∂ËøõË°åËØªÂÜôÔºåÁ±ª‰ºº‰∫éÈ°µË°®ÔºåÂõ†Ê≠§ÈÄüÂ∫¶ÊûÅÂø´„ÄÇVMCS‰∏ªË¶ÅÁî±‰ª•‰∏ãÂÖ≠‰∏™ÈÉ®ÂàÜÁªÑÊàêÔºöÂÆ¢Êà∑Êú∫Áä∂ÊÄÅÂå∫„ÄÅÂÆø‰∏ªÊú∫Áä∂ÊÄÅÂå∫„ÄÅÊâßË°åÊéßÂà∂Âüü„ÄÅVM-EntryÊéßÂà∂Âüü„ÄÅVM-ExitÊéßÂà∂Âüü„ÄÅVM-Exit‰ø°ÊÅØÂüü„ÄÇ</p>
<ul>
<li>ÂÖ∂‰∏≠ÂÆ¢Êà∑Êú∫Áä∂ÊÄÅÂå∫ÂíåÂÆø‰∏ªÊú∫Áä∂ÊÄÅÂå∫Áî®‰∫é‰øùÂ≠òÂÆ¢Êà∑Êú∫ÂíåÂÆø‰∏ªÊú∫‰∏ä‰∏ãÊñáÁöÑÁä∂ÊÄÅÔºõ</li>
<li>ÊâßË°åÊéßÂà∂ÂüüÂèØ‰ª•ÁÅµÊ¥ªÁöÑÊåáÂÆöÂì™‰∫õÊåá‰ª§Âíå‰∫ã‰ª∂Â∞ÜÂØºËá¥VM ExitÔºåÈÄöËøáIO bitmapÂèØ‰ª•Ëá™ÂÆö‰πâÂì™‰∫õIOËÆøÈóÆÂ∞ÜÂØºËá¥VM ExitÔºõ</li>
<li>VM-EntryÊéßÂà∂ÂüüÂíåVM-ExitÊéßÂà∂Âüü‰∏ªË¶ÅÁî®Êù•ÊéßÂà∂ÂèëÁîüVM-EntryÂíåVM-ExitÊó∂ÂØπCPUÊ®°ÂºèÁöÑ‰∏Ä‰∫õÊìç‰ΩúÔºåÂ¶ÇÊòØÂ§Ñ‰∫é32‰ΩçËøòÊòØ64‰ΩçÊ®°ÂºèÔºõ</li>
<li>VM-Exit‰ø°ÊÅØÂüü‰∏ªË¶ÅËÆ∞ÂΩïVM-Exit‰∫ßÁîüÁöÑÂéüÂõ†ÂíåÂÖ∑‰Ωì‰ø°ÊÅØ„ÄÇ</li>
</ul>
<p>ÈÄöËøáVMCSÔºåÂΩìÂèëÁîüVM-EntryÊó∂ÔºåÁ°¨‰ª∂Â∞ÜËá™Âä®‰ªéVMCSÁöÑÂÆ¢Êà∑Áä∂ÊÄÅÂå∫Âä†ËΩΩÂÆ¢Êà∑Êú∫Êìç‰ΩúÁ≥ªÁªüÁöÑ‰∏ä‰∏ãÊñáÔºåÊÅ¢Â§çÂÆ¢Êà∑Êú∫ÁöÑÊâßË°åÔºõÂêåÊó∂Ê†πÊçÆVM-EntryÊéßÂà∂ÂüüÁöÑÂÜÖÂÆπÔºåÂÜ≥ÂÆöÂêëÂÆ¢Êà∑Êú∫Â°ûÂÖ•Âì™Áßç‰∏≠Êñ≠ÊàñÂºÇÂ∏∏ÔºõÂú®ÂÆ¢Êà∑Êú∫ÊâßË°åÊúüÈó¥ÔºåÂ∞ÜÊ†πÊçÆÊâßË°åÊéßÂà∂ÂüüÁöÑ‰ø°ÊÅØÔºåÂÜ≥ÂÆöÂì™‰∫õÊåá‰ª§Âíå‰∫ã‰ª∂Â∞ÜËß¶ÂèëVM-ExitÔºõVMX-ExitÊó∂ÔºåÂ∞ÜÈÄÄÂá∫ÂéüÂõ†ÂÜôÂÖ•VM-Exit‰ø°ÊÅØÂüüÔºåÂ∞ÜËôöÊãüÊú∫‰∏ä‰∏ãÊñá‰øùÂ≠òËá≥ÂÆ¢Êà∑Êú∫Áä∂ÊÄÅÂüüÔºåÂä†ËΩΩÂÆø‰∏ªÊú∫Áä∂ÊÄÅÂüü‰ø°ÊÅØÔºåÁÑ∂ÂêéÊ†πÊçÆVM-ExitÁöÑÂéüÂõ†ËøõË°åÁõ∏Â∫îÂ§ÑÁêÜ„ÄÇ</p>
<h3 id="kvm-cpuËôöÊãüÂåñÂÆûÁé∞">KVM: CPUËôöÊãüÂåñÂÆûÁé∞
</h3><h4 id="kvmÁî®Êà∑Êé•Âè£">KVMÁî®Êà∑Êé•Âè£
</h4><p>KVMÊòØ‰Ωú‰∏∫LinuxÂÜÖÊ†∏ÁöÑ‰∏Ä‰∏™Â≠óÁ¨¶ËÆæÂ§áÊèê‰æõÂá∫Êù•ÁöÑÔºåÂÆÉÂåÖÂê´‰∏§‰∏™ÂÜÖÊ†∏Ê®°Âùó <code>kvm.ko</code> Âíå <code>kvm-intel.ko</code> Êàñ <code>kvm-amd.ko</code>ÔºåÂÖ∂‰∏≠<code>kvm.ko</code> Êèê‰æõ‰∫ÜÊ†∏ÂøÉËôöÊãüÂåñÊû∂ÊûÑÔºåËÄå <code>kvm-intel.ko</code> Âíå <code>kvm-amd.ko</code> ‰∏éÂ§ÑÁêÜÂô®ÁöÑÊû∂ÊûÑÁõ∏ÂÖ≥„ÄÇ</p>
<p>ÂΩìÂÜÖÊ†∏Âä†ËΩΩKVMÊ®°ÂùóÊó∂ÔºåÂ∞ÜÂá∫Áé∞‰∏Ä‰∏™ <code>/dev/kvm</code> ÁöÑÂ≠óÁ¨¶ËÆæÂ§áÔºå‰∏ÄÂè∞ÂÆåÊï¥ÁöÑËôöÊãüÊú∫Áî±QEMUÂíåKVMÊûÑÊàêÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p>
<p>‚Äã        								<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312280912368.png"
	
	
	
	loading="lazy"
	
		alt="image-20231227170301379"
	
	
></p>
<p>QEMU Âú®Áî®Êà∑Á©∫Èó¥Ê®°ÊãüPCIÊÄªÁ∫ø„ÄÅBIOS„ÄÅVGA„ÄÅÈîÆÁõò„ÄÅÈº†Ê†á„ÄÅÁΩëÂç°„ÄÅÁ£ÅÁõòÁ≠âÂ§ñËÆæÔºåËÄåKVM‰∏ªË¶ÅËôöÊãüCPUÂíåÂÜÖÂ≠òÔºåQEMUÈÄöËøá‰∏ÄÁ≥ªÂàóÁöÑ <code>ioctl</code> Á≥ªÁªüË∞ÉÁî®Êù•Êìç‰Ωú <code>/dev/kvm</code> ÂÆåÊàêÂØπCPUÂíåÂÜÖÂ≠òÁöÑËôöÊãüÂåñ„ÄÇ</p>
<hr>
<p>KVM‰∏ªË¶ÅÊèê‰æõ‰∫Ü‰∏âÁ±ªÊé•Âè£Ôºö<code>kvm_dev_ioctl/kvm_vm_ioctl/kvm_vcpu_ioctl</code>ÔºåÂ¶Ç‰∏ãË°®ÊâÄÁ§∫Ôºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312280912171.png"
	
	
	
	loading="lazy"
	
		alt="image-20231227170908176"
	
	
></p>
<ul>
<li>QEMUÊâìÂºÄ <code>/dev/kvm</code> ËÆæÂ§áÂêé‰ºöËé∑Âæó‰∏Ä‰∏™KVMÊñá‰ª∂ÊèèËø∞Á¨¶ÔºåÂ∞ÜËøô‰∏™Êñá‰ª∂ÊèèËø∞Á¨¶ÂèäÁõ∏Â∫îÁöÑÂëΩ‰ª§ÔºàÂ¶ÇKVM_CREATE_VMÔºâ‰º†ÂÖ• <code>kvm_dev_ioctl</code>Ôºå‰ºöÂàõÂª∫‰∏ÄÂè∞ËôöÊãüÊú∫ÔºåÂª∫Á´ãÁõ∏Â∫îÁöÑÊï∞ÊçÆÁªìÊûÑÔºåÂêåÊó∂ËøîÂõû‰∏Ä‰∏™ kvm-vm Êñá‰ª∂ÊèèËø∞Á¨¶Ôºõ</li>
<li>ÈÄöËøá <code>kvm_vm_ioctl</code> ÂèØ‰ª•ÂØπËøôÂè∞ËôöÊãüÊú∫ËøõË°åÊìçÊéßÔºåÊØîÂ¶ÇÂàõÂª∫VCPU„ÄÅËÆæÁΩÆÂÖ∂ÂÜÖÂ≠òÁ©∫Èó¥„ÄÅÂàõÂª∫IRQCHIP„ÄÅPIT„ÄÅÊó∂ÈíüÁ≠â„ÄÇÂàõÂª∫VCPUÂêéÔºå‰ºöËøîÂõû‰∏Ä‰∏™ kvm-vcpu Êñá‰ª∂ÊèèËø∞Á¨¶Ôºõ</li>
<li>Â∞Ü kvm-vcpu Êñá‰ª∂ÊèèËø∞Á¨¶‰º†ÂÖ• <code>kvm_vcpu_ioctl</code> ÂèØ‰ª•ÂØπËôöÊãüCPUËøõË°åÊéßÂà∂ÔºåÊØîÂ¶ÇÂèØ‰ª•ËøêË°åCPU„ÄÅËé∑ÂèñËÆæÁΩÆCPUÁöÑËÆæÂ§áÂØÑÂ≠òÂô®„ÄÅÁªôCPUÊ≥®ÂÖ•‰∏≠Êñ≠Âíå‰∫ã‰ª∂Á≠â„ÄÇ</li>
</ul>
<h4 id="kvmËôöÊãüÊú∫ÁöÑÂàõÂª∫ÂíåËøêË°å">KVMËôöÊãüÊú∫ÁöÑÂàõÂª∫ÂíåËøêË°å
</h4><p>QEMUÂ±û‰∫éÁî®Êà∑ÊÄÅÔºåÂÆÉÂàùÂßãÂåñÂÆåÂêÑÁßçÂ§ñËÆæÂêéÔºåÂ∞ÜÂºÄÂßãË∞ÉÁî®KVMÊèê‰æõÁöÑÁî®Êà∑ÊÄÅÊé•Âè£ÔºåÂàõÂª∫ËôöÊãüÊú∫ÁöÑCPUÈÉ®ÂàÜ„ÄÇQEMUÈ¶ñÂÖà‰ºöÊâìÂºÄ <code>/dev/kvm</code>Ôºå‰ºöËøîÂõû‰∏Ä‰∏™kvm fdÔºåÈÄöËøá‰º†ÈÄíËøô‰∏™Êñá‰ª∂ÊèèËø∞Á¨¶‰ª•ÂèäKVM_CREATE_VMÁªô <code>kvm_dev_ioctl</code>ÔºåKVMÂ∞ÜÂàõÂª∫‰∏ÄÂè∞ËôöÊãüÊú∫ÔºåÊâßË°åÂáΩÊï∞‰∏∫ <code>kvm_dev_ioctl_create_vm</code> ÂáΩÊï∞ÔºåËØ•ÂáΩÊï∞‰ºöÂàÜÈÖç‰∏Ä‰∏™ kvm ÁªìÊûÑ‰ΩìÔºå‰∏Ä‰∏™ kvm ÁªìÊûÑ‰ΩìÂ∞±‰ª£Ë°®‰∏ÄÂè∞ËôöÊãüÊú∫ÔºåÂàùÂßãÂåñËØ•ÁªìÊûÑ‰ΩìÔºåÂπ∂Â∞ÜËØ•ÁªìÊûÑ‰ΩìÂä†ÂÖ•ËôöÊãüÊú∫ÈìæË°®‰∏≠ÔºåÂêåÊó∂ËøîÂõûÁî®Êà∑ÊÄÅ‰∏Ä‰∏™ kvm-vm Êñá‰ª∂ÊèèËø∞Á¨¶„ÄÇ</p>
<p>ËøôÊó∂ÁöÑËôöÊãüÊú∫ÊòØ‰∏ÄÂè∞Áº∫Â∞ëCPUÁöÑËôöÊãüÊú∫„ÄÇQEMU‰ºöÊ†πÊçÆËôöÊãüÊú∫ÁöÑCPU‰∏™Êï∞ÂàõÂª∫Â§ö‰∏™VCPUÁ∫øÁ®ã„ÄÇÊØè‰∏™VCPUÁ∫øÁ®ãÂ∞Ükvm-vm fdÂíåKVM_CREATE_VCPU‰º†ÈÄíÁªô <code>kvm_vm_ioctl</code> ÂàõÂª∫ vcpuÔºåÂÜÖÊ†∏‰∏≠Â∞ÜË∞ÉÁî® <code>kvm_vm_ioctl_create_vcpu</code> ÂáΩÊï∞ÂàõÂª∫ vcpuÔºåËØ•ÂáΩÊï∞Â∞Ü‰∏∫ÊØè‰∏Ä‰∏™vcpuÂàÜÈÖç‰∏Ä‰∏™VMCSÁöÑÁªìÊûÑÔºåÂπ∂ËøõË°åÂàùÂßãÂåñÔºåÂπ∂ËøîÂõû‰∏Ä‰∏™kvm-vcpuÊñá‰ª∂ÊèèËø∞Á¨¶ÁªôÁî®Êà∑ÊÄÅ„ÄÇ</p>
<p>VCPUÂàõÂª∫ÂÆåÊàêÂêéÔºåËôöÊãüÊú∫Â∞±ÂºÄÂßãËøêË°å‰∫Ü„ÄÇQEMUÁöÑVCPUÁ∫øÁ®ã‰∏ªË¶ÅÂåÖÂê´‰∏Ä‰∏™‰∏ªÂæ™ÁéØÔºåQEMUÈÄöËøáKVM_RUNËøô‰∏™ <code>ioctl</code> Ë∞ÉÁî®ËøõÂÖ•ÂÆ¢Êà∑Êú∫„ÄÇÂÜÖÊ†∏‰∏≠ÁöÑKVMÈÉ®ÂàÜÂÖ∑‰ΩìË∞ÉÁî®ÂáΩÊï∞ <code>vcpu_enter_guest</code> ËøõÂÖ•ÂÆ¢Êà∑Êú∫ÔºåÂÖ∂Â∫ïÂ±ÇÊòØÈÄöËøáËôöÊãüÂåñÊåá‰ª§VMRESUMEÂàáÊç¢Âà∞VMXÈùûÊ†πÊìç‰ΩúÊ®°Âºè„ÄÇÂÆ¢Êà∑Êú∫‰ª£Á†ÅÂºÄÂßãËøêË°åÔºåÁõ¥Âà∞ÈÅáÂà∞ÊïèÊÑüÊåá‰ª§ÊàñIOÊåá‰ª§ÔºåËøôÊó∂Â∞Ü‰∫ßÁîüVM-Exit‰∫ã‰ª∂ÔºåÂÆ¢Êà∑Êú∫ÈÄÄÂá∫ÔºåÁî±KVMËøõË°åÂºÇÂ∏∏Â§ÑÁêÜ„ÄÇ‰∏ÄËà¨ÁöÑÂºÇÂ∏∏ÔºåÂ¶ÇÂØπÊüê‰∫õÊéßÂà∂ÂØÑÂ≠òÂô®ÁöÑËÆøÈóÆ„ÄÅEPTÁº∫È°µÂºÇÂ∏∏Á≠âÂú®KVMËøô‰∏ÄÂ±ÇÂ∞±ÂèØ‰ª•ÂæóÂà∞Â§ÑÁêÜÔºåCPUÂ∞ÜÈáçÊñ∞ËøõÂÖ•ÂÆ¢Êà∑Êú∫Ê®°ÂºèÊâßË°åÔºå‰ΩÜËøòÊúâ‰∏ÄÁ±ªÂºÇÂ∏∏ÔºåÂ¶ÇÈÉ®ÂàÜIOÊåá‰ª§ÔºåKVM‰∏çËÉΩÂ§ÑÁêÜÔºåÈúÄË¶ÅQEMUËøõË°åÂ§ÑÁêÜÔºåÂõ†Ê≠§Â∞ÜËøîÂõûÁî®Êà∑ÊÄÅÔºåÁî±Áî®Êà∑ÊÄÅÁöÑQEMUËøõË°åÂ§ÑÁêÜÔºåQEMUÂ§ÑÁêÜÂÆåIOÂêéÔºåÂ∞ÜËøõÂÖ•ÂÜÖÊ†∏ÊÄÅÔºåÂÆ¢Êà∑Êú∫ÂèàÈáçÊñ∞ÊÅ¢Â§çËøêË°åÔºåÊ∞∏ËøúÂæ™ÁéØ‰∏ãÂéªÔºåÊï¥‰∏™ÊâßË°åËøáÁ®ãÂ¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312271707279.png"
	
	
	
	loading="lazy"
	
		alt="image-20231227170759251"
	
	
></p>
<h3 id="kvm-cpuÁÉ≠ËøÅÁßª">KVM: CPUÁÉ≠ËøÅÁßª
</h3><p>VMCSËøô‰∏™ÁªìÊûÑ‰ΩìÁöÑÂÆ¢Êà∑Êú∫Áä∂ÊÄÅÂüü‰øùÂ≠ò‰∫ÜÂÆ¢Êà∑Êú∫CPUÁöÑ‰∏ä‰∏ãÊñáÔºåÂõ†Ê≠§CPUÁöÑËøÅÁßªÊÄùË∑ØÂæàÁÆÄÂçï„ÄÇÊàë‰ª¨ÂèØ‰ª•‰ªéVMCSËé∑ÂèñÊâÄÊúâÂÆ¢Êà∑Êú∫ÊâÄÊúâÂØÑÂ≠òÂô®ÁöÑÁä∂ÊÄÅÔºå‰º†ÈÄíÂà∞ÁõÆÊ†áÊú∫Âô®ÂêéÔºåÂÜçÂÜôÂÖ•VMCSÁõ∏Â∫îÁöÑÂüüÔºåÊÅ¢Â§çËôöÊãüÊú∫ÁöÑËøêË°åÂç≥ÂèØÔºåËÄåKVM‰πüÊèê‰æõ‰∫ÜÁõ∏Â∫îÁöÑÊé•Âè£KVM_GET_REGS„ÄÅKVM_SET_REGSÁ≠âÔºåÂèØ‰ª•‰æõQEMUÁöÑËøÅÁßªÁ∫øÁ®ãË∞ÉÁî®„ÄÇ</p>
<h2 id="23-ÂÜÖÂ≠òËôöÊãüÂåñ">2.3 ÂÜÖÂ≠òËôöÊãüÂåñ
</h2><h3 id="intelÁöÑeptÊäÄÊúØ">IntelÁöÑEPTÊäÄÊúØ
</h3><p>‰∏∫‰∫Ü‰øùËØÅÂÆ¢Êà∑Êú∫Êìç‰ΩúÁ≥ªÁªüÁúãÂà∞ÁöÑÂÜÖÂ≠òÁ©∫Èó¥Â∏ÉÂ±Ä‰∏éÂÆûÈôÖÁâ©ÁêÜÁéØÂ¢ÉÁõ∏‰∏ÄËá¥Ôºå‰πüÂ∞±ÊòØÂÆ¢Êà∑Êú∫Êã•Êúâ‰ªéÈõ∂ÂºÄÂßã„ÄÅËøûÁª≠ÁöÑÂÜÖÂ≠òÁ©∫Èó¥ÔºåÂêåÊó∂‰∏éÂÖ∂‰ªñËôöÊãüÊú∫ÈöîÁ¶ªÔºåÊàë‰ª¨ÈúÄË¶ÅÂÆûÁé∞ÂÜÖÂ≠òÁöÑËôöÊãüÂåñ„ÄÇÂú®ÂÜÖÂ≠òÁöÑËôöÊãüÂåñ‰∏≠Ôºå‰∏ªË¶ÅÊ∂âÂèäÂà∞ÂõõÁßçÂú∞ÂùÄÔºöÂÆ¢Êà∑Êú∫ËôöÊãüÂú∞ÂùÄGVA„ÄÅÂÆ¢Êà∑Êú∫Áâ©ÁêÜÂú∞ÂùÄGPA„ÄÅÂÆø‰∏ªÊú∫ËôöÊãüÂú∞ÂùÄHVAÂíåÂÆø‰∏ªÊú∫Áâ©ÁêÜÂú∞ÂùÄHPA„ÄÇÂØπ‰∫éËôöÊãüÊú∫Êù•ËØ¥ÔºåÂÆÉÁöÑÂÜÖÂ≠òÁâ©ÁêÜÂú∞ÂùÄÁ©∫Èó¥Ë¶ÅÊ±ÇÂøÖÈ°ªÊòØËøûÁª≠ÁöÑÔºå‰ΩÜÂØπ‰∫éÂÆø‰∏ªÊú∫Êù•ËØ¥ÔºåÂç¥Âπ∂‰∏çÊòØËøûÁª≠ÁöÑ„ÄÇÂ¶Ç‰∏ãÂõæÊâÄÁ§∫ÔºåËôöÊãüÊú∫ÁöÑÂÜÖÂ≠òÁ©∫Èó¥ÊòØÁî±ÂÆø‰∏ªÊú∫ÁöÑËã•Âπ≤ÊÆµ‰∏çËøûÁª≠ÁöÑÂÜÖÂ≠òÁâáÊÆµÊãºÂáëËÄåÊàê„ÄÇ</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312280919080.png"
	
	
	
	loading="lazy"
	
		alt="image-20231228091953038"
	
	
></p>
<p>ÂÆ¢Êà∑Êú∫È°µË°®ÂèØ‰ª•Â∞ÜGVAËΩ¨Êç¢‰∏∫GPAÔºå‰ΩÜGPA‰∏çËÉΩÁõ¥Êé•Áî®‰∫éÂÆø‰∏ªÊú∫ÁöÑMMUÔºàÂÜÖÂ≠òÁÆ°ÁêÜÂçïÂÖÉÔºâËøõË°åÂØªÂùÄÔºåÂøÖÈ°ªÂ∞ÜGPAËΩ¨Êç¢‰∏∫HPAÔºåÂú®KVM‰∏≠Êúâ‰∏Ä‰∏™ <code>kvm_memory_slot</code> ÁöÑÊï∞ÊçÆÁªìÊûÑ‰ΩìÔºåÂÆÉËÆ∞ÂΩï‰∫ÜGPA‰∏éHVAÁöÑÂØπÂ∫îÂÖ≥Á≥ªÔºåÂèØ‰ª•ÂÆûÁé∞GPAÂà∞HVAÁöÑËΩ¨Êç¢ÔºåÁÑ∂ÂêéÂÜçÈÄöËøáÂÆø‰∏ªÊú∫ÁöÑÈ°µË°®ËΩ¨Êç¢‰∏∫HPAÔºåËøõË°åÂÆûÈôÖÁöÑÂÜÖÂ≠òËÆøÈóÆ„ÄÇ</p>
<p>‰º†ÁªüÁöÑÂÜÖÂ≠òËôöÊãüÂåñÊòØÈÄöËøáÁ∫ØËΩØ‰ª∂ÁöÑÊñπÂºèÂÆûÁé∞ÁöÑÔºåÂç≥ÈÄöËøáÂΩ±Â≠êÈ°µË°®ÔºàShadow Page TableÔºâÂÆûÁé∞ÁöÑÔºåÂΩ±Â≠êÈ°µË°®Áõ¥Êé•ÂÆåÊàêÂÆ¢Êà∑Êú∫ËôöÊãüÂú∞ÂùÄÁ©∫Èó¥Âà∞ÂÆø‰∏ªÊú∫Áâ©ÁêÜÁ©∫Èó¥ÁöÑÊò†Â∞Ñ„ÄÇÂÆ¢Êà∑Êú∫Âú®ËÆøÂ≠òÁöÑÊó∂ÂÄôÔºåÂÆø‰∏ªÊú∫ÁöÑMMUÂ∞ÜÁõ¥Êé•Âä†ËΩΩÂÆ¢Êà∑Êú∫È°µË°®ÊâÄÂØπÂ∫îÁöÑÂΩ±Â≠êÈ°µË°®Ôºå‰ªéËÄåÂÆûÁé∞GVAÂà∞HPAÁöÑÁõ¥Êé•ËΩ¨Êç¢ÔºåTLBÁºìÂ≠òÁöÑ‰πüÊòØGVAÂà∞HPAÁöÑËΩ¨Êç¢„ÄÇÂΩ±Â≠êÈ°µË°®Â≠òÂú®ÂæàÂ§ßÁöÑÁº∫Èô∑ÔºåÂ¶ÇÔºö</p>
<ul>
<li>ÈúÄË¶Å‰∏∫ÂÆ¢Êà∑Êú∫ÁöÑÊØè‰∏™ËøõÁ®ãÈÉΩÁª¥Êä§‰∏ÄÂ•óÂΩ±Â≠êÈ°µË°®ÔºåÂõ†Ê≠§‰ºöÊ∂àËÄóËæÉÂ§ßÁöÑÂÜÖÂ≠òÁ©∫Èó¥Ôºõ</li>
<li>ÊØè‰∏ÄÊ¨°ÂèëÁîüVM-Exit„ÄÅVM-EntryÊó∂ÔºåÈÉΩ‰ºöÂØºËá¥TLBÁöÑÊ∏ÖÁ©∫Ôºõ</li>
<li>Ê≠§Â§ñÂΩ±Â≠êÈ°µË°®‰∏éÂÆ¢Êà∑Êú∫È°µË°®Èó¥ÁöÑÂêåÊ≠•‰πüÊØîËæÉÂ§çÊùÇÔºõ</li>
</ul>
<p>‰∏∫Ê≠§IntelÊé®Âá∫‰∫ÜEPTÊäÄÊúØÔºåAMD‰πüÁõ∏Â∫îÊé®Âá∫‰∫ÜNPTÊäÄÊúØÔºå‰∏∫ÂÜÖÂ≠òËôöÊãüÂåñÊèê‰æõÁ°¨‰ª∂ÊîØÊåÅÔºå‰∫åËÄÖÂéüÁêÜÁõ∏Âêå„ÄÇ</p>
<hr>
<p>EPTÊäÄÊúØÂú®ÂéüÊúâÁöÑÂÆ¢Êà∑Êú∫È°µË°®Âü∫Á°Ä‰∏äÔºåÂºïÂÖ•‰∫ÜEPTÈ°µË°®„ÄÇÂÆ¢Êà∑Êú∫ËôöÊãüÂú∞ÂùÄÂà∞ÂÆ¢Êà∑Êú∫Áâ©ÁêÜÂú∞ÂùÄÁöÑËΩ¨Êç¢ÂÄüÂä©ÂÆ¢Êà∑Êú∫È°µË°®Êù•ÂÆåÊàêÔºåËÄåÂÆ¢Êà∑Êú∫Áâ©ÁêÜÂú∞ÂùÄÂà∞ÂÆø‰∏ªÊú∫Áâ©ÁêÜÂú∞ÂùÄÁöÑËΩ¨Êç¢ÂàôÂÄüÂä©EPTÈ°µË°®Êù•ÂÆåÊàêÔºå‰∏§Ê¨°ËΩ¨Êç¢ÁöÑÊú∫Âà∂Áõ∏ÂêåÔºå‰∏îÈÉΩÊòØÁî±Á°¨‰ª∂Ëá™Âä®ÂÆåÊàêÁöÑ„ÄÇÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312280934431.png"
	
	
	
	loading="lazy"
	
		alt="image-20231228093405407"
	
	
></p>
<p>ÂÆ¢Êà∑Êú∫ËøêË°åÊó∂Ôºå<code>CR3</code> ÂØÑÂ≠òÂô®‰øùÂ≠òÊúâÂÆ¢Êà∑Êú∫È°µË°®Âü∫ÂùÄÔºåË¥üË¥£ËΩΩÂÖ•ÂÆ¢Êà∑Êú∫È°µË°®Ôºå<code>EPTP</code> ÂØÑÂ≠òÂô®‰øùÂ≠òÊúâEPTÈ°µË°®Âü∫ÂùÄÔºåË¥üË¥£ËΩΩÂÖ•EPTÈ°µË°®Ôºå‰∏§Â•óÈ°µË°®ÂÆûÁé∞‰∫ÜÂØπÂÜÖÂ≠òÂú∞ÂùÄÁöÑËΩ¨Êç¢„ÄÇÂú®ÂÆ¢Êà∑Êú∫ËøêË°åËøáÁ®ã‰∏≠ÔºåÂÆ¢Êà∑Êú∫È°µË°®Áî±ÂÆ¢Êà∑Êú∫Êìç‰ΩúÁ≥ªÁªüËøõË°åÁª¥Êä§ÔºåÂÆ¢Êà∑Êú∫ÂÜÖÈÉ®‰∫ßÁîüÁöÑÁº∫È°µÂπ∂‰∏ç‰ºöÂØºËá¥ÂÆ¢Êà∑Êú∫ÈÄÄÂá∫ÔºõËÄåEPTÈ°µË°®ÂàôÁî±ËôöÊãüÊú∫ÁõëËßÜÂô®ÔºàVMMÔºâÁª¥Êä§ÔºåEPTÈ°µË°®‰∫ßÁîüÁöÑÂºÇÂ∏∏ÔºåÂ¶ÇÁº∫È°µ„ÄÅÂÜôÊùÉÈôê‰∏çË∂≥ÔºåÂ∞ÜÂØºËá¥ÂÆ¢Êà∑Êú∫ÈÄÄÂá∫Ôºå‰∫ßÁîüEPTÂºÇÂ∏∏ÔºåÁî±ËôöÊãüÊú∫ÁõëËßÜÂô®ÔºàVMMÔºâËøõË°åÂ§ÑÁêÜ„ÄÇEPTÊäÄÊúØÁî±‰∫éÂÄüÂä©Á°¨‰ª∂ÊñπÂºèÂÆûÁé∞ÔºåÁõ∏ÊØîÂΩ±Â≠êÈ°µË°®ÁöÑËΩØ‰ª∂ÊñπÂºèÔºå‰ºòÂäøÂú®Ôºö</p>
<ul>
<li>ÂÆûÁé∞Â§çÊùÇÂ∫¶Èôç‰ΩéÂæàÂ§öÔºå‰∏îÊïàÁéáÈ´òÔºõ</li>
<li>ÂÆ¢Êà∑Êú∫ÂÜÖÈÉ®ÁöÑÁº∫È°µÂºÇÂ∏∏Âπ∂‰∏ç‰ºöÂØºËá¥ÂÆ¢Êà∑Êú∫ÈÄÄÂá∫ÔºåÊèêÈ´ò‰∫ÜÂÆ¢Êà∑Êú∫ÁöÑËøêË°åÊÄßËÉΩÔºõ</li>
<li>ÊØè‰∏ÄÂè∞ËôöÊãüÊú∫Âè™ÈúÄË¶ÅÁª¥Êä§‰∏ÄÂ•óEPTÈ°µË°®Ôºå‰πüËäÇÁúÅ‰∫ÜËÆ∏Â§öÂÜÖÂ≠òÁ©∫Èó¥Ôºõ</li>
</ul>
<h3 id="kvm-ÂÜÖÂ≠òËôöÊãüÂåñÂÆûÁé∞">KVM: ÂÜÖÂ≠òËôöÊãüÂåñÂÆûÁé∞
</h3><p>KVMÁöÑÂÖßÂ≠òËôöÊãüÊú∫Êúâ‰∏§ÁßçÊñπÂºèÂÆûÁé∞ÔºåÂç≥ÂΩ±Â≠êÈ°µË°®ÂíåEPTÊäÄÊúØÔºåÊàë‰ª¨Â∞Ü‰∏ªË¶ÅÊé¢ËÆ®KVMÂ¶Ç‰Ωï‰ΩøÁî®EPTÊäÄÊúØÂÆåÊàêÂÜÖÂ≠òÁöÑËôöÊãüÂåñ„ÄÇ</p>
<h4 id="qemuÂÜÖÂ≠òÊ®°Âûã">QEMUÂÜÖÂ≠òÊ®°Âûã
</h4><p>QEMUÁöÑÂÜÖÂ≠òÊ®°ÂûãÔºåÊòØÊåáKVMËôöÊãüÊú∫ÁöÑÂÜÖÂ≠òÊòØÁî±QEMUÂú®Áî®Êà∑ÊÄÅËøõË°åÁî≥ËØ∑ÁÆ°ÁêÜÔºåÂπ∂Â∞ÜÈÉ®ÂàÜÁî≥ËØ∑ÁöÑÂÜÖÂ≠òÊ≥®ÂÜåÂà∞KVMÊ®°Âùó‰∏≠„ÄÇËøôÁßçÊ®°ÂûãÁöÑÂ•ΩÂ§ÑÂú®‰∫éÔºö</p>
<ul>
<li>Á≠ñÁï•‰∏éÊú∫Âà∂ÂàÜÁ¶ªÔºåÂä†ÈÄüÁöÑÊú∫Âà∂ÂèØ‰ª•Áî±KVMÂÆûÁé∞ÔºåQEMUÂè™ÈúÄË¥üË¥£Â¶Ç‰ΩïË∞ÉÁî®Ôºõ</li>
<li>QEMUÂèØ‰ª•ËÆæÁΩÆÂ§öÁßçÂÜÖÂ≠òÊ®°ÂûãÔºåÂ¶ÇUMA„ÄÅNUMAÁ≠âÔºõ</li>
<li>Êñπ‰æøQEMUÂØπÁâπÊÆäÂÜÖÂ≠òÁöÑÁÆ°ÁêÜÔºåÂ¶ÇMMIOÔºõ</li>
<li>ÂÜÖÂ≠òÁöÑÂàÜÈÖç„ÄÅÂõûÊî∂„ÄÅ‰∫§Êç¢ÈÉΩÂèØ‰ª•ÈááÁî®LinuxÂéüÊúâÁöÑÂÜÖÂ≠òÁÆ°ÁêÜÊú∫Âà∂ÔºåKVM‰∏çÈúÄË¶ÅÂçïÁã¨ÂºÄÂèë„ÄÇ</li>
</ul>
<p>QEMU‰∏ªË¶ÅÈÄöËøáAddressSpaceËøô‰∏™Êï∞ÊçÆÁªìÊûÑÊù•Áª¥Êä§ÂÜÖÂ≠ò„ÄÇAddressSpaceÂåÖÂê´‰∏Ä‰∏™MemoryRegionÁ±ªÂûãÁöÑÂèòÈáèÔºåMemoryRegionÂ≠òÂÇ®‰∫Ü‰∏Ä‰∏™ÂÜÖÂ≠òÂùóÁöÑÂÖ∑‰Ωì‰ø°ÊÅØÔºåÂåÖÊã¨ËØ•ÂÜÖÂ≠òÂùóÁöÑÂÆø‰∏ªÊú∫ËôöÊãüÂú∞ÂùÄ„ÄÅËØ•ÂÜÖÂ≠òÂùóÁöÑÂ§ßÂ∞è‰ª•ÂèäËØ•ÂÜÖÂ≠òÂùóÊâÄÂØπÂ∫îÁöÑÂÆ¢Êà∑Êú∫Áâ©ÁêÜÂú∞ÂùÄ„ÄÇQEMU‰∏§‰∏™‰∏ªË¶ÅÁöÑMemoryRegion‰∏∫ <code>system_memory</code> Âíå <code>system_io</code>ÔºåÂç≥Á≥ªÁªüÂÜÖÂ≠òÂíåMMIO„ÄÇËøô‰∫õÂÜÖÂ≠òÂùóÈÄöËøáKVM_SET_USER_MEMORY_REGIONËøô‰∏™ioctlË∞ÉÁî®‰º†ÈÄíÁªôKVMÔºåKVMÊ†πÊçÆ‰º†ÈÄíÁöÑ‰ø°ÊÅØÂª∫Á´ã‰∏Ä‰∏™kvm_memory_slotÁªìÊûÑ‰ΩìÔºåËØ•ÁªìÊûÑ‰Ωì‰∏≠ÁöÑ <code>base_gfn</code>„ÄÅ<code>npages</code>„ÄÅ<code>userspace_addr</code> ÂàÜÂà´‰ª£Ë°®ÂÆ¢Êà∑Êú∫Âú∞ÂùÄ„ÄÅÈ°µÈù¢Êï∞‰ª•ÂèäQEMUÁöÑÁî®Êà∑ÊÄÅÂú∞ÂùÄÔºåËøôÊ†∑Â∞±Âª∫Á´ãËµ∑ÂÆ¢Êà∑Êú∫Áâ©ÁêÜÂú∞ÂùÄÂíåÂÆø‰∏ªÊú∫ËôöÊãüÊú∫Âú∞ÂùÄÁöÑÊò†Â∞ÑÂÖ≥Á≥ªÔºåKVMÂèØ‰ª•ÂºÄÂßãÁÆ°ÁêÜËøô‰∫õÂÜÖÂ≠òÂùó„ÄÇ</p>
<h4 id="eptÈ°µË°®ÁöÑÊûÑÂª∫">EPTÈ°µË°®ÁöÑÊûÑÂª∫
</h4><blockquote>
<p>ÈÄöËøáEPTÊäÄÊúØÔºåËôöÊãüÊú∫ËÆøÂ≠òÊó∂ÔºåÂÄüÂä©ÂÆ¢Êà∑Êú∫È°µË°®ÂíåEPTÈ°µË°®ËøõË°åÂú∞ÂùÄËΩ¨Êç¢Ôºå‰∏îËøôÁßçËΩ¨Êç¢ÊòØÁî±Á°¨‰ª∂Ëá™Âä®ÂÆåÊàêÁöÑÔºåÊïàÁéáÊûÅÈ´ò„ÄÇÈÇ£‰πàÂ¶Ç‰ΩïÊûÑÂª∫‰∏äËø∞‰∏§ÁßçÈ°µË°®Âë¢Ôºü</p>
</blockquote>
<p>ÂÖ∂‰∏≠ÂÆ¢Êà∑Êú∫È°µË°®ÊòØÁî±ÂÆ¢Êà∑Êú∫Êìç‰ΩúÁ≥ªÁªüË¥üË¥£ÊûÑÂª∫ÔºåËÄåEPTÈ°µË°®ÂàôÁî±KVMË¥üË¥£ÊûÑÂª∫„ÄÇÂíåÊôÆÈÄöÈ°µË°®ÁöÑÂª∫Á´ãËøáÁ®ãÁ±ª‰ººÔºåEPTÈ°µË°®‰∏ªË¶ÅÈÄöËøáÁº∫È°µÂºÇÂ∏∏ËøõË°åÂ§ÑÁêÜÈÄêÊ≠•Âª∫Á´ãÁöÑ„ÄÇ</p>
<p>ÂÆ¢Êà∑Êú∫Ê≠£Â∏∏ËøêË°åÔºåÂΩìÈÅáÂà∞Áº∫È°µÂºÇÂ∏∏Êó∂ÔºåÂÆ¢Êà∑Êú∫Âπ∂‰∏ç‰ºöÈÄÄÂá∫ÈùûÊ†πÊìç‰ΩúÊ®°ÂºèÔºåËÄåÊòØÁî±ÂÆ¢Êà∑Êú∫Áº∫È°µÂºÇÂ∏∏Â§ÑÁêÜÁ®ãÂ∫èËøõË°åÂ§ÑÁêÜÔºåÂÆÉÂ∞Ü‰∏∫ÂÆ¢Êà∑Êú∫ÂàÜÈÖç‰∏Ä‰∏™ÂÆ¢Êà∑Êú∫Áâ©ÁêÜÂÜÖÂ≠òÈ°µÔºåÂπ∂Â∞ÜÂÆ¢Êà∑Êú∫Áâ©ÁêÜÂú∞ÂùÄÂ°´ÂÜôËá≥ÂÆ¢Êà∑Êú∫È°µË°®ÔºåËøôÊó∂ÂÄôGVAÂíåGPAÁöÑÊò†Â∞ÑÂÖ≥Á≥ªÂª∫Á´ã‰∫ÜÔºå‰ΩÜÂÆåÊàê‰∏ÄÊ¨°ÂÆåÊï¥ÁöÑÂú∞ÂùÄËΩ¨Êç¢ÔºåËøòÈúÄË¶ÅÂ∞ÜGPAËΩ¨Êç¢‰∏∫HPAÔºåÂõ†Ê≠§Â∞ÜËÆøÈóÆEPTÈ°µË°®ÔºåËøôÊó∂EPTÈ°µË°®‰∏∫Á©∫ÔºåËôöÊãüÊú∫Â∞ÜÈÄÄÂá∫ÈùûÊ†πÊìç‰ΩúÊ®°ÂºèÔºåÂπ∂‰∫ßÁîü‰∏Ä‰∏™ <code>ept_violtion</code> ÂºÇÂ∏∏ÔºåKVMÊà™Ëé∑Âà∞ËØ•ÂºÇÂ∏∏ÔºåÂ∞ÜË∞ÉÁî®Áõ∏Â∫îÁöÑÂºÇÂ∏∏Â§ÑÁêÜÂáΩÊï∞ÔºåÂÆåÊàêEPTÈ°µË°®ÁöÑÂª∫Á´ã„ÄÇKVMÂª∫Á´ãEPTÈ°µË°®ÁöÑËøáÁ®ãÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312280954087.png"
	
	
	
	loading="lazy"
	
		alt="image-20231228095454059"
	
	
></p>
<p>ÂèØ‰ª•ÁúãÂà∞ÔºåËôöÊãüÊú∫Áî±‰∫éEPTÁº∫È°µÂºÇÂ∏∏ÈÄÄÂá∫ÂêéÔºåÂ∞ÜÁî± <code>handle_ept_violation</code> Ëøô‰∏™ÂáΩÊï∞ÂéªÂ§ÑÁêÜËØ•ÂºÇÂ∏∏ÔºåËØ•ÂáΩÊï∞Â∞ÜË∞ÉÁî® <code>tdp_page_fault</code> Ëøô‰∏™ÂáΩÊï∞ÂéªÂ§ÑÁêÜEPTÁº∫È°µÂºÇÂ∏∏ÔºåÂÖ∑‰ΩìÁöÑÂ§ÑÁêÜËøáÁ®ãÁî± <code>gfn_to_pfn</code> Âíå <code>__direct_map</code> ÂáΩÊï∞ÂÆåÊàê„ÄÇÂÖ∂‰∏≠Ôºö</p>
<ul>
<li>
<p><code>gfn_pfn</code> ÂÆåÊàêGPAÂà∞HPAÁöÑËΩ¨Êç¢ÔºåËØ•ËøáÁ®ãÁî± <code>gfn_to_hva</code> Âíå <code>hva_to_pfn</code> ‰∏§‰∏™ÂáΩÊï∞ÂÆåÊàê„ÄÇ</p>
<ul>
<li><code>gfn_to_hva</code> ÈÄöËøákvm_memory_slotÂæóÂà∞GPAÂà∞HVAÁöÑÊò†Â∞ÑÔºõ</li>
<li><code>hva_to_pfn</code> ÂèØÂÆåÊàêHVAÂà∞HPAÁöÑËΩ¨Êç¢ÔºåÊúÄÁªàÂæóÂà∞GPAÂà∞HPAÁöÑÊò†Â∞Ñ„ÄÇ</li>
</ul>
</li>
<li>
<p><code>__direct_map</code> Ë¥üË¥£Âª∫Á´ãÂÖ∑‰ΩìÁöÑEPTÈ°µË°®È°πÔºåEPTÈ°µË°®ÂíåÂÆ¢Êà∑Êú∫È°µË°®‰∏ÄÊ†∑‰πüÊòØÂõõÁ∫ßÈ°µË°®ÔºåÊµÅÁ®ãÂ¶Ç‰∏ãÔºö</p>
<ul>
<li><code>__direct_map</code> Â∞Ü‰ªéEPTÈ°µË°®Âü∫Âú∞ÂùÄÔºåÂç≥Á¨¨ÔºîÁ∫ßÈ°µË°®ÂºÄÂßãÈÅçÂéÜÔºåÂÅáÂ¶ÇÂΩìÂâçÂ±ÇÊòØÊúÄÂêé‰∏ÄÂ±ÇÔºàÁ¨¨ÔºëÁ∫ßÔºâÔºåÂàôÁõ¥Êé•Ë∞ÉÁî® <code>mmu_set_spte</code> ËÆæÁΩÆÈ°µË°®È°πÔºå<code>__direct_map</code> ÂáΩÊï∞ÁªìÊùüÔºõ</li>
<li>Âèç‰πãÂÅáÂ¶ÇÂΩìÂâçÂ±Ç‰∏çÊòØÊúÄÂêé‰∏ÄÂ±ÇÔºå‰∏îËØ•Â±ÇEPTÈ°µË°®È°πÊ≤°ÊúâÂàùÂßãÂåñÔºåÂàôË∞ÉÁî® <code>kvm_mmu_get_page</code> Áî≥ËØ∑‰∏Ä‰∏™EPTÈ°µË°®ÔºåË∞ÉÁî® <code>link_shadow_page</code> Êñ∞Áî≥ËØ∑ÁöÑEPTÈ°µË°®Ê∑ªÂä†Âà∞Êú™ÂàùÂßãÂåñÁöÑÈ°µË°®È°πÔºåÊé•ÁùÄÈÅçÂéÜ‰∏ã‰∏ÄÁ∫ßÈ°µË°®ÔºåÁõ¥Ëá≥ÈÅçÂéÜËá≥ÊúÄÂêé‰∏ÄÁ∫ßÈ°µË°®ÔºàÁ¨¨ÔºëÁ∫ßÔºâ„ÄÇ</li>
</ul>
</li>
</ul>
<h3 id="kvm-ÂÜÖÂ≠òÁÉ≠ËøÅÁßª">KVM: ÂÜÖÂ≠òÁÉ≠ËøÅÁßª
</h3><blockquote>
<p>ÂÜÖÂ≠òÁöÑÁÉ≠ËøÅÁßªÊòØÁÉ≠ËøÅÁßª‰∏≠ÊúÄËÄóË¥πÊó∂Èó¥„ÄÅÊúÄÂÆπÊòìÂá∫ÈîôÁöÑÂú∞Êñπ„ÄÇ</p>
</blockquote>
<p>ÂÜÖÂ≠òÁÉ≠ËøÅÁßªÊúÄÁÆÄÂçïÁöÑÊñπÂºèÔºåÂèØ‰ª•ÈÄâÊã©ÂºÄÂßãÊó∂Â∞±ÊåÇËµ∑ËôöÊãüÊú∫ÔºåÁÑ∂ÂêéÊã∑Ë¥ùÊâÄÊúâÁöÑÂÜÖÂ≠òÂà∞ÁõÆÁöÑÂÆø‰∏ªÊú∫‰∏äÔºåÂÜçÊÅ¢Â§çËøêË°åËôöÊãüÊú∫Ôºå‰ΩÜËøôÊ†∑‰ºöÂØºËá¥ÂÅúÊú∫Êó∂Èó¥ËæÉÈïø„ÄÇ‰∏∫‰∫ÜÂáèÂ∞ëÂÅúÊú∫Êó∂Èó¥ÔºåÊàë‰ª¨ÂøÖÈ°ªÂú®ËôöÊãüÊú∫ÊåÇËµ∑ÂâçÂ∞±ÂÆåÊàêÂ§ßÈÉ®ÂàÜÂÜÖÂ≠òÁöÑÊã∑Ë¥ù‰ªªÂä°„ÄÇÂÖ∏ÂûãÊÄùË∑ØÊòØÈ¶ñÂÖàÂ∞ÜËôöÊãüÊú∫ÁöÑÊâÄÊúâÂÜÖÂ≠òÊã∑Ë¥ùËøáÂéªÔºå‰ΩÜÂú®Êã∑Ë¥ùËøáÁ®ã‰∏≠ÔºåËôöÊãüÊú∫ËÆøÈóÆÂÜÖÂ≠ò‰∫ßÁîüËÑèÈ°µÔºå‰∏∫‰∫Ü‰øùËØÅËôöÊãüÊú∫ÁöÑÁä∂ÊÄÅ‰∏ÄËá¥ÔºåËøôÈÉ®ÂàÜËÑèÈ°µÂøÖÈ°ªÈáçÊñ∞Êã∑Ë¥ùËøáÂéªÔºåÈöèÁùÄ‰∏ÄËΩÆ‰∏ÄËΩÆÁöÑÊã∑Ë¥ùÔºåÂÜôËÑèÁöÑÂÜÖÂ≠òÈ°µË∂äÊù•Ë∂äÂ∞ëÔºåÂΩì‰Ωé‰∫éÊüê‰∏™ÈòÄÂÄºÊó∂ÔºåÊåÇËµ∑ËôöÊãüÊú∫ÔºåÂ∞ÜËÑèÈ°µ‰º†ËæìËøáÂéªÔºåÂú®ÁõÆÁöÑÂÆø‰∏ªÊú∫‰∏äÊÅ¢Â§çËôöÊãüÊú∫ÁöÑËøêË°å„ÄÇËøô‰∏™ÊÄùË∑ØÁöÑÂÖ≥ÈîÆÂú®‰∫é**Â¶Ç‰ΩïËÆ∞ÂΩïÂì™‰∫õÂÜÖÂ≠òÈ°µË¢´ÂÜôËÑè‰∫ÜÔºå**KVM‰∏∫Êàë‰ª¨Êèê‰æõ‰∫ÜÁõ∏Â∫îÁöÑÁî®Êà∑Êé•Âè£Ôºö</p>
<ul>
<li>ÈÄöËøá‰º†ÈÄíKVM_MEM_LOG_DIRTY_PAGESÁªôËøô‰∏™ <code>ioctl(KVM_SET_USER_MEMORY_REGION)</code> Ë∞ÉÁî®ÔºåÂ∞±ÂèØ‰ª•ÂºÄÂêØÂÜÖÂ≠òËÑèÈ°µËÆ∞ÂΩïÔºåÊú¨Ë¥®‰∏äÊòØÈÄöËøáÂØπÂÆ¢Êà∑Êú∫È°µË°®ÂÜô‰øùÊä§Ôºàwrite protectionÔºâÔºåÂΩìÂÆ¢Êà∑Êú∫ÂÜôÂÜÖÂ≠òÈ°µÊó∂Ôºå‰ºö‰∫ßÁîüwrite faultÔºå‰ªéËÄåËÆ∞ÂΩïËÑèÈ°µÔºõ</li>
<li>Ê≠§Â§ñKVMËøòÊèê‰æõËé∑ÂèñËÑèÈ°µ‰ΩçÂõæ‰ø°ÊÅØÁöÑÊé•Âè£ÔºåÂç≥ÈÄöËøáKVM_GET_DIRTY_LOGËøô‰∏™ioctlË∞ÉÁî®ÔºåÊàë‰ª¨ÂèØ‰ª•Ëé∑ÂèñËôöÊãüÊú∫ÁöÑÁöÑËÑèÈ°µ‰ΩçÂõæ„ÄÇ</li>
</ul>
<h2 id="24-ioËôöÊãüÂåñ">2.4 IOËôöÊãüÂåñ
</h2><h3 id="ioÂÖ®ËôöÊãüÂåñ">IOÂÖ®ËôöÊãüÂåñ
</h3><p>KVMÁöÑIOËôöÊãüÂåñÁî±QEMUÂíåKVMÊ®°ÂùóÈÖçÂêàÂÆåÊàê„ÄÇÂÖ∂‰∏≠IOËÆæÂ§áÔºåÂ¶ÇÊòæÁ§∫Âô®„ÄÅÈº†Ê†á„ÄÅÈîÆÁõò„ÄÅÁ£ÅÁõò„ÄÅÁΩëÂç°„ÄÅÂ£∞Âç°„ÄÅÂÖâÈ©±Á≠âËÆæÂ§áÁî±QEMUÂú®Áî®Êà∑ÊÄÅËøõË°åÊ®°ÊãüÔºåQEMU‰∏∫Ëøô‰∫õËÆæÂ§áÂª∫Á´ãÁõ∏Â∫îÁöÑÊï∞ÊçÆÁªìÊûÑÔºåËÄåKVMÂàôË¥üË¥£Êã¶Êà™ËôöÊãüÊú∫ÁöÑIOËØ∑Ê±ÇÔºåÂ∞ÜËøô‰∫õËØ∑Ê±Ç‰º†ÈÄíÁªôQEMUÔºåÁî±QEMUÂéªÊ®°ÊãüIOÊâßË°åÔºåÊï¥‰∏™IOÂ§ÑÁêÜÊµÅÁ®ãÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312281019256.png"
	
	
	
	loading="lazy"
	
		alt="image-20231228101905230"
	
	
></p>
<p>È¶ñÂÖàKVMËôöÊãüÊú∫ÊâßË°åIOÊåá‰ª§ÔºåÂ¶ÇËØªÂèñËôöÊãüÁ£ÅÁõòÁöÑÊüê‰∏™sectorÔºåÂèëÁîüVM-ExitÔºåCPUÂêåÊó∂‰ºöÂ∞ÜÈÄÄÂá∫ÁöÑÂéüÂõ†ÂÜôÂÖ•VMCSÁªìÊûÑ‰Ωì„ÄÇKVMÊçïËé∑Âà∞ËØ•IOÊåá‰ª§ÔºåÈÄöËøáVMCSÁü•ÈÅìÊòØÁî±‰∫éIOÊìç‰ΩúÂºïËµ∑ËôöÊãüÊú∫ÈÄÄÂá∫„ÄÇKVMÈ¶ñÂÖà‰ºöÂú®ÂÜÖÊ†∏ÊÄÅÈÅçÂéÜÊ≥®ÂÜåÁöÑËÆæÂ§áÔºåÁúãÁúãËÉΩÂê¶Âú®ÂÜÖÊ†∏ÊÄÅÂ§ÑÁêÜËØ•ËØ∑Ê±ÇÔºåÂÅáÂ¶ÇËÉΩÂú®ÂÜÖÊ†∏ÊÄÅÂÆåÊàêÂ§ÑÁêÜÔºåÂ§ÑÁêÜÂêéËøîÂõûËôöÊãüÊú∫ÂÜÖÈÉ®„ÄÇËã•‰∏çËÉΩÂ§ÑÁêÜÔºåÂàôËøîÂõûÂà∞Áî®Êà∑ÊÄÅÔºåÁî±QEMUÂéªÊ®°ÊãüÁõ∏ÂÖ≥ÁöÑIOËØ∑Ê±Ç„ÄÇÊúÄÂêéQEMUÂ∞ÜÈÄöËøáKVM_RUNËøô‰∏™ioctlÈáçÊñ∞ËøõÂÖ•ËôöÊãüÊú∫„ÄÇ</p>
<h3 id="ioÂçäËôöÊãüÂåñ">IOÂçäËôöÊãüÂåñ
</h3><p>‰∏äËø∞‰º†ÁªüÁöÑIOËôöÊãüÂåñÊñπÊ≥ïÔºåÊàë‰ª¨ÈúÄË¶Å‰∏∫ËôöÊãüÊú∫Êèê‰æõ‰∏Ä‰∏™ÂÆåÊï¥ÁöÑËôöÊãüËÆæÂ§á„ÄÇËôöÊãüÊú∫Êìç‰ΩúÁ≥ªÁªüÈÄöËøáÊ†áÂáÜÁöÑIOÊé•Âè£ÂØπËôöÊãüËÆæÂ§áËøõË°åÊìç‰ΩúÔºåKVMÊà™Ëé∑IOÊåá‰ª§ÔºåÂèëÁîüVM-ExitÔºåÁî±QEMUÂéªÊ®°Êãü„ÄÇËøôÁßçÊñπÂºèÁöÑÂ•ΩÂ§ÑÊòØÔºåÁî±‰∫éQEMUÊ®°ÊãüÁöÑËÆæÂ§áÈÉΩÊòØÁé∞Âú®Áâ©ÁêÜÊú∫Â∑≤ÊúâÁöÑÈÄöÁî®ËÆæÂ§áÔºåÂõ†Ê≠§ËôöÊãüÊú∫Êìç‰ΩúÁ≥ªÁªüÂèØ‰ª•‰ΩøÁî®ÂéüÂÖàÁöÑÈ©±Âä®Áõ¥Êé•Êìç‰ΩúËôöÊãüËÆæÂ§áÔºå‰ΩÜÁî±‰∫éÈúÄË¶ÅÊà™Ëé∑ÊØè‰∏ÄÊù°IOËØ∑Ê±ÇÔºåÂΩìËôöÊãüÊú∫IOÁπÅÂøôÊó∂ÔºåVMXÊ®°Âºè‰ºöÂèëÁîüÈ¢ëÁπÅÁöÑÂàáÊç¢ÔºåÂØºËá¥IOÊÄßËÉΩ‰Ωé‰∏ã„ÄÇ</p>
<p>‰∏∫‰∫ÜËß£ÂÜ≥‰∏äËø∞ÈóÆÈ¢òÔºåvirtioÈ©±Âä®Ë¢´ÂºïÂÖ•ÔºåËøôÊòØ‰∏ÄÁßçÈÄöÁî®ÁöÑÂçäËôöÊãüÂåñÈ©±Âä®„ÄÇÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312281023861.png"
	
	
	
	loading="lazy"
	
		alt="image-20231228102347806"
	
	
></p>
<p>virtio‰∏ªË¶ÅÁî±‰∏âÈÉ®ÂàÜÁªÑÊàêÔºövirtioÂâçÁ´ØÈ©±Âä®„ÄÅvirtioÂêéÁ´ØÈ©±Âä®‰ª•Âèävirtio_ring„ÄÇ</p>
<ul>
<li>virtioÂâçÁ´ØÈ©±Âä®‰Ωç‰∫éËôöÊãüÊú∫Êìç‰ΩúÁ≥ªÁªüÂÜÖÈÉ®ÔºåLinuxÂÜÖÊ†∏ÈªòËÆ§ÈõÜÊàê‰∫ÜvirtioÂâçÁ´ØÈ©±Âä®ÔºåËÄåwindowsËôöÊãüÊú∫ÈúÄË¶ÅÊâãÂä®ÂÆâË£ÖvirtioÂâçÁ´ØÈ©±Âä®Ôºõ</li>
<li>virtioÂêéÁ´ØÈ©±Âä®‰Ωç‰∫éVMM‰∏≠ÔºåÂáÜÁ°ÆÊù•ËØ¥virtioÂêéÁ´ØÈ©±Âä®‰Ωç‰∫éQEMU‰∏≠Ôºõ</li>
<li>virtio_ringÊòØ‰∏Ä‰∏™ÂÖ±‰∫´ÁºìÂÜ≤Âå∫ÔºåÂØπ‰∫éËôöÊãüÊú∫Êìç‰ΩúÁ≥ªÁªüÂíåVMMÊù•ËØ¥ÈÉΩÊòØÂèØËßÅÁöÑÔºõ</li>
</ul>
<p>ÂΩìËôöÊãüÊú∫ÈúÄË¶ÅÂÅöIOÔºàÁ£ÅÁõò„ÄÅÁΩëÁªúÁ≠âÔºâÊó∂ÔºåÈÄöËøávirtioÂâçÁ´ØÈ©±Âä®Â∞ÜIO RequestÊîæÂÖ•virtio_ringÔºåËôöÊãüÊú∫Âπ∂‰∏ç‰ºöÁ´ãÂç≥ÂèëÁîüVM-ExitÔºåÂΩìIO RequestËææÂà∞‰∏ÄÂÆöÊï∞ÁõÆÊàñvirtio_ringÊª°Êó∂ÔºåËôöÊãüÊú∫ÊâßË°å‰∏ÄÊ¨°kickÔºåËôöÊãüÊú∫ÂèëÁîüVM-ExitÔºåÈÄöÁü•VMMÂ§ÑÁêÜIO Requests„ÄÇÈöèÂêévirtioÂêéÁ´ØÈ©±Âä®‰ªévirtio_ringÂèñÂá∫IOËØ∑Ê±ÇÔºåÈÄê‰∏ÄËøõË°åÊ®°ÊãüÔºåÂÆåÊàêËØ∑Ê±ÇÂêéÂÜçÈÄöÁü•ËôöÊãüÊú∫„ÄÇ</p>
<p>virtioÈ©±Âä®ÈÅøÂÖç‰∫ÜËôöÊãüÊú∫ÁöÑÈ¢ëÁπÅÈÄÄÂá∫ÔºåÊÄßËÉΩÂæóÂà∞ÊòæËëóÊèêÂçá„ÄÇÂÄºÂæóÊ≥®ÊÑèÁöÑÊòØÔºåvirtioÊòØ‰∏ÄÂ•óÈÄöÁî®Ê°ÜÊû∂ÔºåÈíàÂØπÊØè‰∏ÄÁßçÂ§ñËÆæÔºàÁ£ÅÁõò„ÄÅÁΩëÁªúËÆæÂ§áÔºâÔºåÈÉΩÊúâÂÖ∑‰ΩìÁöÑÂÆûÁé∞„ÄÇÁõÆÂâçÂ∑±ÁªèÂÆûÁé∞‰∫ÜÁ£ÅÁõò <code>virtio-blk</code>„ÄÅÁΩëÁªúËÆæÂ§á <code>virtio-net</code>„ÄÅpciËÆæÂ§á <code>virtio-pci</code>„ÄÅÊéßÂà∂Âè∞ËÆæÂ§á <code>virtio-console</code>„ÄÅballoonËÆæÂ§á <code>virtio-balloon</code> Á≠âÔºå‰Ω†‰πüÂèØ‰ª•Âà©Áî®ËøôÂ•óÊ°ÜÊû∂Ëá™Â∑±ÂÆûÁé∞‰∏Ä‰∏™ËÆæÂ§á„ÄÇ</p>
<h3 id="kvm-ioÁÉ≠ËøÅÁßª">KVM: IOÁÉ≠ËøÅÁßª
</h3><p>KVMËôöÊãüÊú∫ÁöÑÂ§ñËÆæÊòØÁî±QEMUÊ®°ÊãüÁöÑÔºåÂ§ñËÆæÁöÑÁä∂ÊÄÅÈÉΩÊúâÁõ∏Â∫îÁöÑÊï∞ÊçÆÁªìÊûÑ‰øùÂ≠òÔºåÂõ†Ê≠§IOÁöÑËøÅÁßªÊØîËæÉÁÆÄÂçïÔºåÂè™ÈúÄË¶Å‰øùÂ≠òËÆæÂ§áÁöÑÁä∂ÊÄÅÂêéÔºå‰º†ÈÄíÂà∞ÁõÆÁöÑÂÆø‰∏ªÊú∫‰∏äÊÅ¢Â§çÂç≥ÂèØÔºåÂÄºÂæóÊ≥®ÊÑèÁöÑÊòØ‰∏§Á±ªIOËµÑÊ∫êÔºö<strong>Á£ÅÁõòÂíåÁΩëÁªú„ÄÇ</strong></p>
<ul>
<li>È¶ñÂÖàÁ£ÅÁõòÔºåÁ£ÅÁõòÊã•ÊúâÂ§ßÈáèÁöÑÊï∞ÊçÆÔºåÊàë‰ª¨ÂèØ‰ª•ÈááÁî®ÂÖ±‰∫´Â≠òÂÇ®ÁöÑÊñπÂºèÔºåÈÅøÂÖç‰∫ÜÁ£ÅÁõòÊï∞ÊçÆÁöÑÂ§ßÈáèËøÇÁßªÔºåÂØπ‰∫éÂÅúÊú∫ÂêéÂâ©‰ΩôÁöÑIOËØ∑Ê±ÇÔºåQEMU‰ºöÂÆåÊàêËøô‰∫õIOËØ∑Ê±ÇÂêéÂÜçËøõË°åËÆæÂ§áËøÅÁßªÔºõ</li>
<li>ÁΩëÁªúËøÅÁßªË¶ÅËß£ÂÜ≥ÁöÑÈóÆÈ¢òÊòØÔºåËøÅÁßªÂêéÊï¥‰∏™Â±ÄÂüüÁΩëË¶ÅËøÖÈÄüÊÑüÁü•Âà∞ËøôÁßçÂèòÂåñÔºåÂ∞ÜÊï∞ÊçÆÂåÖÈáçÂÆöÂêëÂà∞Êñ∞ÁöÑÂÆø‰∏ªÊú∫‰∏äÔºåËøô‰∏™ÂèØ‰ª•ÈÄöËøáÁõÆÁöÑÂÆø‰∏ªÊú∫‰∏ªÂä®ÂèëÈÄÅÔº°ARPÔºåÂÆûÁé∞ËôöÊãüÊú∫IP‰∏éÁõÆÁöÑÂÆø‰∏ªÊú∫MACÂú∞ÂùÄÁöÑÈáçÊñ∞ÁªëÂÆöÔºõ</li>
</ul>
<h1 id="3-kvmËôöÊãüÊú∫ÁÉ≠ËøÅÁßªÂÆûÁé∞">3 KVMËôöÊãüÊú∫ÁÉ≠ËøÅÁßªÂÆûÁé∞
</h1><h2 id="31-kvmÁÉ≠ËøÅÁßªÁöÑÂÜÖÂÆπ">3.1 KVMÁÉ≠ËøÅÁßªÁöÑÂÜÖÂÆπ
</h2><p>ËôöÊãüÊú∫ÁöÑÁÉ≠ËøÅÁßªÈúÄË¶ÅÂ∞Ü‰∏ÄÂè∞Ê≠£Âú®ËøêË°åÁöÑËôöÊãüÊú∫‰ªé‰∏ÄÂè∞ÂÆø‰∏ªÊú∫ÂÆåÊï¥Âú∞ËøÅÁßªÂà∞Âè¶Â§ñ‰∏ÄÂè∞ÂÆø‰∏ªÊú∫‰∏äÔºå‰∏îËøÅÁßªÊúüÈó¥ÔºåËôöÊãüÊú∫ÂØπÂ§ñÊèê‰æõÁöÑÊúçÂä°‰∏çËÉΩ‰∏≠Êñ≠„ÄÇ‰∏∫‰∫ÜÁ°Æ‰øùËôöÊãüÊú∫ÁÉ≠ËøÅÁßªÂêé‰æùÁÑ∂ËÉΩÂ§üÊ≠£Â∏∏ËøêË°åÔºåÊàë‰ª¨ÂøÖÈ°ª‰º†ÈÄíÂ∞ΩÂèØËÉΩÂ§öÁöÑÁä∂ÊÄÅ‰ø°ÊÅØÔºåÂ¶ÇCPU„ÄÅÂÜÖÂ≠ò„ÄÅÂêÑÁßçIOËÆæÂ§áÁ≠â„ÄÇ‰∏ãÈù¢Êàë‰ª¨Â∞ÜÂàÜÂà´‰ªãÁªçKVMËôöÊãüÊú∫CPU„ÄÅÂÜÖÂ≠ò„ÄÅIOËÆæÂ§áÁöÑËøÅÁßª„ÄÇ</p>
<h3 id="cpuÁÉ≠ËøÅÁßª">CPUÁÉ≠ËøÅÁßª
</h3><p>KVMËôöÊãüÊú∫‰∏≠ÁöÑCPUËôöÊãüÂåñÊòØÁî±KVMÂÜÖÊ†∏Ê®°ÂùóÂÆåÊàêÁöÑÔºåÂáÜÁ°ÆÁöÑÊù•ËØ¥ÔºåÊòØQEMUË∞ÉÁî®KVMÊ®°ÂùóÂÆåÊàê‰∫ÜCPUÁöÑËôöÊãüÂåñ„ÄÇÂú®QEMU‰∏≠ÔºåÊúâ‰∏Ä‰∏™ÈáçË¶ÅÁöÑÊï∞ÊçÆÁªìÊûÑ‰ΩìCPUState‰ª£Ë°®‰∫ÜCPUÁöÑÁä∂ÊÄÅÔºåCPUStateÊúâ‰∏Ä‰∏™Êï∞ÊçÆÊàêÂëò‰∏∫ <code>kvm_run</code>ÔºåËøô‰∏™Êï∞ÊçÆÊàêÂëòÊòØÂØπkvm-vcpuÊñá‰ª∂ÊèèËø∞Á¨¶ËøõË°å‰∏Ä‰∏™ <code>mmap</code> Êìç‰ΩúËé∑ÂæóÁöÑÔºå‰πüÂ∞±ÊòØVMCSÁªìÊûÑ‰ΩìÔºåËÄåVMCSÁªìÊûÑ‰ΩìÁöÑÂÆ¢Êà∑Êú∫Áä∂ÊÄÅÂüü‰øùÂ≠ò‰∫ÜKVMËôöÊãüÊú∫CPUÁöÑËøêË°åÁä∂ÊÄÅÔºå‰πüÂ∞±ÊòØËØ¥ <code>kvm_run</code> Ëøô‰∏™ÁªìÊûÑ‰Ωì‰øùÂ≠ò‰∫ÜCPUÁöÑËøêË°åÁä∂ÊÄÅ„ÄÇÂõ†Ê≠§CPUÁöÑËøÅÁßªÊØîËæÉÁÆÄÂçïÔºåÂè™ÈúÄ‰øùÂ≠òCPUStateËøô‰∏™ÁªìÊûÑ‰ΩìÁöÑÊâÄÊúâ‰ø°ÊÅØÔºå‰º†ÈÄíÁªôÁõÆÁöÑÂÆø‰∏ªÊú∫‰∏äÔºåÁÑ∂ÂêéÈáçÊñ∞ÊÅ¢Â§çÔºåÂç≥ÂèØÊÅ¢Â§çËôöÊãüÊú∫CPU‰∏ä‰∏ãÊñá„ÄÇ</p>
<h3 id="ÂÜÖÂ≠òÁÉ≠ËøÅÁßª">ÂÜÖÂ≠òÁÉ≠ËøÅÁßª
</h3><p>ÂÜÖÂ≠òÁöÑÁÉ≠ËøÅÁßªÊòØÁÉ≠ËøÅÁßª‰∏≠ÊúÄËÄóË¥πÊó∂Èó¥„ÄÅÊúÄÂÆπÊòìÂá∫ÈîôÁöÑÂú∞Êñπ„ÄÇÂÜÖÂ≠òÁöÑÁÉ≠ËøÅÁßªÂèØ‰ª•ÂàÜ‰∏∫ <code>push</code> „ÄÅ<code>stop-and-copy</code> „ÄÅ<code>pull</code> ‰∏™Èò∂ÊÆµÔºö</p>
<ol>
<li><code>push</code> Èò∂ÊÆµÔºöËØ•Èò∂ÊÆµÔºåËôöÊãüÊú∫‰æùÁÑ∂Âú®Ê∫êÂÆø‰∏ªÊú∫‰∏äËøêË°åÔºåÂØπÂ§ñÊ≠£Â∏∏Êèê‰æõÊúçÂä°„ÄÇÂêéÂè∞ÂàôÂÄüÂä©È´òÈÄüÁΩëÁªúÂ∞ÜÂÜÖÂ≠ò‰º†ËæìËá≥ÁõÆÁöÑÂÆø‰∏ªÊú∫„ÄÇÁî±‰∫éËôöÊãüÊú∫Âú®ËøêË°åËøáÁ®ã‰∏≠Ôºå‰ºö‰∏çÊñ≠‰∫ßÁîüËÑèÈ°µÔºå‰∏∫‰∫ÜÁ°Æ‰øùËôöÊãüÊú∫ËøÅÁßªÂâçÂêéÁä∂ÊÄÅ‰∏ÄËá¥ÔºåÈúÄË¶ÅÂ∞ÜÈáçÊñ∞‰º†ËæìËÑèÈ°µ„ÄÇ</li>
<li><code>stop-and-copy</code> Èò∂ÊÆµÔºöËØ•Èò∂ÊÆµÔºåÈ¶ñÂÖàÊåÇËµ∑ËôöÊãüÊú∫ÔºåÁÑ∂ÂêéÊã∑Ë¥ùÂâ©‰ΩôÁöÑÂÜÖÂ≠òËÑèÈ°µËá≥ÁõÆÁöÑÂÆø‰∏ªÊú∫‰∏äÔºåÊã∑Ë¥ùÂÆåÊàêÂêéÔºåÁõ¥Êé•Âú®ÁõÆÁöÑÂÆø‰∏ªÊú∫‰∏äÊÅ¢Â§çËôöÊãüÊú∫ÁöÑËøêË°å„ÄÇ</li>
<li><code>pull</code> Èò∂ÊÆµÔºöÂ∞ÜCPUÂíåËÆæÂ§áÁä∂ÊÄÅÊã∑Ë¥ùËá≥ÁõÆÁöÑÂÆø‰∏ªÊú∫‰∏äÂêéÔºåÁõ¥Êé•ÊÅ¢Â§çËôöÊãüÊú∫ÁöÑËøêË°åÔºåÁî±‰∫éÊú™Êã∑Ë¥ùÂÜÖÂ≠òÔºåÂõ†Ê≠§ËôöÊãüÊú∫ËøôÊó∂‰ºö‰∫ßÁîüÁº∫È°µÔºåÁº∫È°µÂ∞ÜÈÄöËøáÈ´òÈÄüÁΩëÁªú‰º†ËæìËá≥ÁõÆÁöÑÂÆø‰∏ªÊú∫„ÄÇ</li>
</ol>
<p>ÂÜÖÂ≠òÁöÑÁÉ≠ËøÅÁßªÁÆóÊ≥ïÂèØ‰ª•ÂêåÊó∂ÂåÖÊã¨‰∏äËø∞ÂÖ®ÈÉ®Èò∂ÊÆµÔºå‰ΩÜÂú®Áîü‰∫ßÁéØÂ¢É‰∏≠ÁöÑÁÉ≠ËøÅÁßªÁÆóÊ≥ïÂæÄÂæÄÂè™ÂåÖÂê´‰∏äËø∞‰∏Ä‰∏™Êàñ‰∏§‰∏™Èò∂ÊÆµ„ÄÇ‰æãÂ¶ÇÔºåÁ∫ØÁ≤πÁöÑ <code>stop-and-copy</code> ËøÅÁßªÁÆóÊ≥ïÈúÄË¶ÅÂÖàÊöÇÂÅúËôöÊãüÊú∫ÔºåÊã∑Ë¥ùÊâÄÊúâÂÜÖÂ≠òËá≥ÁõÆÁöÑÂÆø‰∏ªÊú∫‰∏äÂêéÔºåÂÜçÊÅ¢Â§çËôöÊãüÊú∫ËøêË°å„ÄÇËøôÁßçÁ≠ñÁï•ÁöÑÂ•ΩÂ§ÑÊòØËøÅÁßªÂæàÁÆÄÂçïÔºå‰ΩÜÂÅúÊú∫Êó∂Èó¥Â∞±Á≠â‰∫éËøÅÁßªÊó∂Èó¥ÔºåÂÜÖÂ≠òË∂äÂ§ßÔºåÂÅúÊú∫Êó∂Èó¥ÂæÄÂæÄÊàêÊ≠£ÊØî‰æãÂ¢ûÈïøÔºåÂØπ‰∫éÈÇ£‰∫õË¶ÅÊ±ÇÈ´òÂèØÁî®ÊÄßÁöÑÂ∫îÁî®Êù•ËØ¥ÔºåËøôÊòæÁÑ∂‰∏çÂèØÊé•Âèó„ÄÇ</p>
<p>ËÄå <code>post-copy</code> ÁÆóÊ≥ïÔºåÁªìÂêà <code>stop-and-copy</code> Âíå <code>pull</code> ‰∏§‰∏™Èò∂ÊÆµ„ÄÇËØ•ÁÆóÊ≥ïÈ¶ñÂÖàÁªèÂéÜ‰∏Ä‰∏™ <code>stop-and-copy</code> Èò∂ÊÆµÔºåÊåÇËµ∑ËôöÊãüÊú∫ÂêéÔºåÂ∞ÜCPUÂíåÂ§ñËÆæÁöÑÁä∂ÊÄÅ‰º†ÈÄÅËá≥ÁõÆÁöÑÂÆø‰∏ªÊú∫ÔºåÁÑ∂ÂêéÁõ¥Êé•Âú®ÁõÆÁöÑÂÆø‰∏ªÊú∫‰∏äÊÅ¢Â§çËôöÊãüÊú∫ÁöÑËøêË°åÔºåËôöÊãüÊú∫ËøôÊó∂‰ºö‰∫ßÁîüÁº∫È°µÂºÇÂ∏∏ÔºåÂºÄÂßãËøõÂÖ• <code>pull</code> Èò∂ÊÆµÔºåÈÄöËøáÁΩëÁªú‰º†ËæìÁº∫È°µ‰ª•ÂèäÊú™Êã∑Ë¥ùÁöÑÂÜÖÂ≠òÈ°µ„ÄÇËØ•ÁÆóÊ≥ïÁöÑÂ•ΩÂ§ÑÊòØÔºåÂèØ‰ª•ÂÅöÂà∞ÂæàÁü≠ÁöÑÂÅúÊú∫Êó∂Èó¥Ôºå‰ΩÜÁî±‰∫é‰ºö‰∫ßÁîüÂ§ßÈáèÁöÑÁº∫È°µÂºÇÂ∏∏ÔºàPAGE_FAULTÔºâÔºåËøô‰∫õÁº∫È°µÈÉΩÈÄöËøáÁΩëÁªú‰º†ËæìÔºåÂõ†Ê≠§ËôöÊãüÊú∫ÁöÑÊÄßËÉΩÂ∞ÜÂá∫Áé∞Â§ßÂπÖÂ∫¶‰∏ãÈôç„ÄÇ</p>
<hr>
<p>KVMÁöÑÂÜÖÂ≠òÁÉ≠ËøÅÁßªÁÆóÊ≥ïÂ±û‰∫éÈ¢ÑÊã∑Ë¥ùÁÆóÊ≥ïÔºàpre-copyÔºâÔºåËØ•ÁÆóÊ≥ïÁî± <code>pull</code> Âíå <code>stop-and-copy</code> ‰∏§‰∏™Èò∂ÊÆµÊûÑÊàêÔºö</p>
<ul>
<li>ËøÅÁßªÊó∂ÔºåÈ¶ñÂÖàËøõÂÖ• <code>pull</code> Èò∂ÊÆµÔºåËØ•Èò∂ÊÆµÈááÁî®Ëø≠‰ª£Êã∑Ë¥ùÁöÑÊñπÂºèÊã∑Ë¥ùÂÜÖÂ≠òËá≥ÁõÆÁöÑÂÆø‰∏ªÊú∫‰∏ä„ÄÇÈ¶ñËΩÆÈúÄË¶ÅÊã∑Ë¥ùÊâÄÊúâÁöÑÂÜÖÂ≠òÈ°µÔºåÁî±‰∫éËôöÊãüÊú∫‰ªçÁÑ∂Âú®ËøêË°åÔºå‰ºö‰∫ßÁîüËÑèÈ°µÔºåÂõ†Ê≠§Êé•‰∏ãÊù•ÊØè‰∏ÄËΩÆÈÉΩÂ∞ÜÊã∑Ë¥ùÂâç‰∏ÄËΩÆÊâÄ‰∫ßÁîüÁöÑËÑèÈ°µ„ÄÇÈöèÁùÄËø≠‰ª£ÁöÑÂ¢ûÂä†ÔºåËÑèÈ°µÂ∞ÜË∂äÊù•Ë∂äÂ∞ëÔºàÂâçÊèêÊòØËÑèÈ°µ‰∫ßÁîüÁöÑÈÄüÁéáË¶Å‰Ωé‰∫éËÑèÈ°µ‰º†ËæìÁöÑÈÄüÁéáÔºâÔºåÂΩìËÑèÈ°µÊï∞ÈáèÊî∂ÊïõÂà∞Êüê‰∏™ÈòÄÂÄºÊó∂ÔºåËøõÂÖ• <code>stop-and-copy</code> Èò∂ÊÆµ„ÄÇ</li>
<li>Âú® <code>stop-and-copy</code> Èò∂ÊÆµÔºåÈ¶ñÂÖàÊåÇËµ∑ËôöÊãüÊú∫ÔºåÁÑ∂ÂêéÂ∞ÜÂâ©‰ΩôÁöÑËÑèÈ°µÂèäCPUÁä∂ÊÄÅ„ÄÅIOËÆæÂ§áÁä∂ÊÄÅÊã∑Ë¥ùËá≥ÁõÆÁöÑÂÆø‰∏ªÊú∫„ÄÇÊã∑Ë¥ùÂÆåÊàêÂêéÔºåÂú®ÁõÆÁöÑÂÆø‰∏ªÊú∫‰∏äÊÅ¢Â§çËôöÊãüÊú∫ÁöÑËøêË°åÔºåÁÉ≠ËøÅÁßªÈ°∫Âà©ÁªìÊùü„ÄÇ</li>
</ul>
<h3 id="ioËÆæÂ§áÁöÑËøÅÁßª">IOËÆæÂ§áÁöÑËøÅÁßª
</h3><p>IOËÆæÂ§áÁöÑËøÅÁßªÂåÖÊã¨Á£ÅÁõò„ÄÅÁΩëÁªú„ÄÅÈº†Ê†á„ÄÅÈîÆÁõòÁ≠âÁöÑËøÅÁßªÔºåËøô‰∫õËÆæÂ§áÈÉΩÊòØÁî±QEMUËΩØ‰ª∂Ê®°ÊãüÁöÑ„ÄÇKVMÂú®ÁÉ≠ËøÅÁßªËôöÊãüÊú∫Êó∂ÔºåË¶ÅÊ±ÇÂú®ÁõÆÁöÑÂÆø‰∏ªÊú∫‰∏äÂàõÂª∫‰∏ÄÂè∞ÂíåÂéüËôöÊãüÊú∫ÈÖçÁΩÆÁõ∏ÂêåÁöÑËôöÊãüÊú∫ÔºåÂåÖÊã¨ÊâÄÊúâÁöÑIOËÆæÂ§áÔºåËøôÂ∞±‰øùËØÅ‰∫ÜIOËÆæÂ§áÂÆåÂÖ®Áõ∏ÂêåÔºåÂõ†Ê≠§IOËÆæÂ§áÁöÑËøÅÁßªÊòØÈúÄË¶ÅÊääIOËÆæÂ§áÁöÑËøêË°åÁä∂ÊÄÅÔºàÂ¶ÇÊüê‰∫õÊéßÂà∂ÂØÑÂ≠òÂô®ÁöÑÁä∂ÊÄÅÔºâÊã∑Ë¥ùËá≥ËôöÊãüÊú∫Âç≥ÂèØ„ÄÇÂÖ∂‰∏≠Á£ÅÁõò„ÄÅÁΩëÁªúËøô‰∏§Á±ªËµÑÊ∫êÈúÄË¶ÅÊ†ºÂ§ñÂÖ≥Ê≥®„ÄÇ</p>
<h4 id="Á£ÅÁõòÁöÑËøÅÁßª">Á£ÅÁõòÁöÑËøÅÁßª
</h4><p>Á£ÅÁõòÁöÑËøÅÁßªÂáÜÁ°ÆÊù•ËØ¥Â∫îËØ•ÂåÖÊã¨Á£ÅÁõòÊéßÂà∂Âô®ÂíåÁ£ÅÁõòÈïúÂÉèÁöÑËøÅÁßª„ÄÇ</p>
<ul>
<li>Á£ÅÁõòÊéßÂà∂Âô®ÁöÑËøÅÁßªÂè™ÂåÖÊã¨Â∞ëÈáèËøêË°åÁä∂ÊÄÅÔºõ</li>
<li>Á£ÅÁõòÈïúÂÉè‰∏ÄËà¨ÊØîËæÉÂ§ßÔºåËá≥Â∞ëÂçÅÂá†GBÔºåÁ£ÅÁõòÈïúÂÉèÁöÑËøÅÁßªÂæÄÂæÄÈúÄË¶ÅÂç†ÊçÆÂ§ßÈáèÁöÑÂ∏¶ÂÆΩÂíåÊó∂Èó¥Ôºõ</li>
</ul>
<p>KVMÁöÑÁÉ≠ËøÅÁßªÊú¨Ë∫´ÊòØÊîØÊåÅÁ£ÅÁõòÈïúÂÉèÁöÑÁÉ≠ËøÅÁßªÁöÑÔºå‰ΩÜÂÆûÈôÖÂú®ÊûÑÂª∫Êï∞ÊçÆ‰∏≠ÂøÉÊó∂ÔºåËôöÊãüÊú∫ÁöÑÁ£ÅÁõòÈïúÂÉèÂæÄÂæÄÊòØÂÖ±‰∫´ÁöÑÔºåÂç≥Â∞ÜÁ£ÅÁõòÈïúÂÉèÊîæÂú®ÂÖ±‰∫´ÁöÑÂ≠òÂÇ®ËÆæÂ§á‰∏ä„ÄÇÁ£ÅÁõòÈïúÂÉèÂèØ‰ª•Â≠òÊîæÂú®ÂïÜÁî®ÁöÑNASËÆæÂ§áÔºå‰πüÂèØ‰ª•ÊîæÂú®ÂºÄÊ∫êÁöÑÂàÜÂ∏ÉÂºèÂ≠òÂÇ®‰∏äÈù¢ÔºåÂ¶ÇCeph„ÄÅSheepdogÁ≠â„ÄÇ</p>
<h4 id="ÁΩëÁªúÁöÑËøÅÁßª">ÁΩëÁªúÁöÑËøÅÁßª
</h4><p>ÂØπ‰∫éÁΩëÁªúËµÑÊ∫êÔºåÊàë‰ª¨Ë¶ÅÊ±ÇÂú®ËøÅÁßªËøáÁ®ã‰∏≠ÔºåÊâÄÊúâÁöÑÁΩëÁªúÁä∂ÊÄÅÔºåÂ¶ÇÂ∑≤Âª∫Á´ãÁöÑTCPËøûÊé•‰ª•ÂèäIPÂú∞ÂùÄÁ≠âÈÉΩËÉΩÂ§üÁª¥ÊåÅ‰∏çÂèò„ÄÇÂõ†Ê≠§ÔºåÁõÆÁöÑÂÆø‰∏ªÊú∫ÂíåÊ∫êÂÆø‰∏ªÊú∫ÂøÖÈ°ª‰Ωç‰∫éÂêå‰∏ÄÂ±ÄÂüüÁΩë‰ª•ÂÜÖÔºåËøôÂ∞±‰øùËØÅ‰∫ÜËøÅÁßªÂêéIPÂú∞ÂùÄËÉΩ‰øùÊåÅ‰∏çÂèò„ÄÇËøÅÁßªÂêéÔºå‰∏éËØ•IPÁõ∏ÂÖ≥ÁöÑÊï∞ÊçÆÂåÖ‰πüÂøÖÈ°ªËΩ¨ÂèëËá≥ÁõÆÁöÑÂÆø‰∏ªÊú∫ÔºåÈúÄË¶ÅÂ∞ÜIPÂú∞ÂùÄÂíåÁõÆÁöÑÂÆø‰∏ªÊú∫ÁöÑMACÂú∞ÂùÄËøõË°åÁªëÂÆö„ÄÇÂõ†Ê≠§Âú®ËøÅÁßªÁªìÊùüÊó∂ÔºåÁõÆÁöÑÂÆø‰∏ªÊú∫Â∞ÜÂèëÈÄÅ‰∏Ä‰∏™ARPÂπøÊí≠ÔºåÈÄöÁü•Â±ÄÂüüÁΩëÂÜÖÁöÑÂÖ∂‰ªñËÆæÂ§áÔºåËØ•ËôöÊãüÊú∫Â∑±ÁªèËøÅÁßªËá≥Êñ∞ÁöÑ‰ΩçÁΩÆ„ÄÇ</p>
<h2 id="32-kvmÁÉ≠ËøÅÁßªÁöÑÂÖ∑‰ΩìÂÆûÁé∞">3.2 KVMÁÉ≠ËøÅÁßªÁöÑÂÖ∑‰ΩìÂÆûÁé∞
</h2><h3 id="kvmÁÉ≠ËøÅÁßªÊµÅÁ®ã">KVMÁÉ≠ËøÅÁßªÊµÅÁ®ã
</h3><p>KVMËôöÊãüÊú∫ÁÉ≠ËøÅÁßªÂ∑•‰ΩúÁî±Áî®Êà∑ÊÄÅÁöÑQEMUÂíåKVMÂÜÖÊ†∏Ê®°ÂùóÈÖçÂêàÂÆûÊñΩÁöÑ„ÄÇËøÅÁßªÂºÄÂßãÂâçÔºåÈúÄË¶ÅÂú®ÁõÆÁöÑÂÆø‰∏ªÊú∫ÂàõÂª∫‰∏ÄÂè∞ÂíåÂéüËôöÊãüÊú∫ÈÖçÁï≥Áõ∏ÂêåÁöÑËôöÊãüÊú∫ÔºåËØ•ËôöÊãüÊú∫Ë¥üË¥£Êé•Êî∂ÂæÖËøÅÁßªËôöÊãüÊú∫ÁöÑÊâÄÊúâÁä∂ÊÄÅ„ÄÇÁî®Êà∑ÂèëËµ∑ËØ∑Ê±ÇÂêéÔºåÂéüËôöÊãüÊú∫Â∞ÜÂàõÂª∫‰∏Ä‰∏™‰∏ìÈó®ÁöÑËøÅÁßªÁ∫øÁ®ãË¥üË¥£ËøÅÁßªÔºåËÄåÊñ∞ÁöÑËôöÊãüÊú∫Â∞ÜÂàõÂª∫‰∏Ä‰∏™ÂçèÁ®ãÔºàCoroutineÔºâÔºåË¥üË¥£Êé•Êî∂„ÄÅÊÅ¢Â§çËôöÊãüÊú∫ÔºåËøÅÁßªÂÖ∑‰ΩìÊ≠•È™§ÂèØ‰ª•ÂàÜ‰∏∫Âõõ‰∏™Èò∂ÊÆµÔºåÂç≥ËµÑÊ∫êÈ¢ÑÁïôÔºàReservationÔºâ„ÄÅËø≠‰ª£È¢ÑÊã∑Ë¥ùÔºàiterative pre-copyÔºâ„ÄÅÂÅúÊú∫Êã∑Ë¥ùÔºàstop-and-copyÔºâ„ÄÅÊøÄÊ¥ªÔºàActivationÔºâÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312281501221.png"
	
	
	
	loading="lazy"
	
		alt="image-20231228150140184"
	
	
></p>
<p>Êàë‰ª¨Â∞ÜÊ∫êÂÆø‰∏ªÊú∫Áß∞ÂÅö‰∏ªÊú∫Ôº°ÔºåÁõÆÁöÑÂÆø‰∏ªÊú∫Áß∞ÂÅö‰∏ªÊú∫Ôº¢„ÄÇ</p>
<ol>
<li>**ËµÑÊ∫êÈ¢ÑÁïôÔºö**ËØ•Èò∂ÊÆµÁöÑÂ∑•‰ΩúÈÄöÂ∏∏Áî±Á¨¨‰∏âÊñπËΩØ‰ª∂ÔºàÂ¶Ç <code>libvirt</code> ÔºâÊàñ‰∫∫Â∑•ÂÆåÊàêÔºåÂç≥Âú®ÁõÆÁöÑÂÆø‰∏ªÊú∫‰∏äÂàõÂª∫ÂíåÂæÖËøÅÁßªÁöÑËôöÊãüÊú∫ÈÖçÁΩÆÁõ∏ÂêåÁöÑËôöÊãüÊú∫ÔºåËØ•ËôöÊãüÊú∫‰∏ÄÂêØÂä®Â∞±Ë¢´ÊöÇÂÅúÔºåÊó†Ê≥ïÁªßÁª≠ËøêË°åÔºåÂêåÊó∂ÂºÄÂßãÁõëÂê¨Â§ñÁïåÁä∂ÊÄÅÔºõ</li>
<li>**Ëø≠‰ª£È¢ÑÊã∑Ë¥ùÔºö**ËØ•Èò∂ÊÆµËôöÊãüÊú∫‰æùÊóßÂú®‰∏ªÊú∫Ôº°‰∏äËøêË°åÔºåÂêåÊó∂ÂºÄÂêØ‰∫ÜKVMÁöÑËÑèÈ°µÊó•ÂøóÂäüËÉΩ„ÄÇ‰∏ìÈó®ÁöÑËøÅÁßªÁ∫øÁ®ãÔºàmigration threadÔºâË¥üË¥£Â∞ÜÂÜÖÂ≠òËø≠‰ª£Âú∞Êã∑Ë¥ùËá≥‰∏ªÊú∫Ôº¢‰∏äÔºåÁ¨¨‰∏ÄËΩÆÊã∑Ë¥ùÊâÄÊúâÂÜÖÂ≠òÈ°µÔºåÊé•‰∏ãÊù•ÁöÑÊØè‰∏ÄËΩÆÂ∞ÜÊã∑Ë¥ù‰∏ä‰∏ÄËΩÆÁöÑËÑèÈ°µËá≥‰∏ªÊú∫Ôº¢„ÄÇ</li>
<li>**ÂÅúÊú∫Êã∑Ë¥ùÔºö**ÊåÇËµ∑‰∏ªÊú∫Ôº°‰∏äÁöÑËôöÊãüÊú∫ÔºåÂ∞ÜÂâ©‰ΩôÁöÑËÑèÈ°µ„ÄÅCPUÁä∂ÊÄÅ‰ª•ÂèäÂêÑÁßçËÆæÂ§áÁä∂ÊÄÅÊã∑Ë¥ùÂà∞‰∏ªÊú∫Ôº¢‰∏ä„ÄÇ</li>
<li>**ÊøÄÊ¥ªÔºö**ÊøÄÊ¥ª‰∏ªÊú∫Ôº¢‰∏äÁöÑËôöÊãüÊú∫ÔºåÂêåÊó∂ÂπøÊí≠‰∏Ä‰∏™ARPÂåÖÔºåÈÄöÁü•Â±ÄÂüüÁΩëÂÜÖÁöÑ‰∫§Êç¢Êú∫ÂíåÂÖ∂‰ªñËÆ°ÁÆóÊú∫ÔºåËôöÊãüÊú∫Â∑≤ËøÅÁßªËá≥‰∏ªÊú∫Ôº¢‰∏ä„ÄÇ</li>
</ol>
<h3 id="ÈáçË¶ÅÊï∞ÊçÆÁªìÊûÑ">ÈáçË¶ÅÊï∞ÊçÆÁªìÊûÑ
</h3><p>‰∏ãÈù¢Â∞Ü‰ªãÁªçKVMËôöÊãüÊú∫ÁÉ≠ËøÅÁßªËøáÁ®ã‰∏≠Ê∂âÂèäÂà∞ÁöÑ‰∏ªË¶ÅÊï∞ÊçÆÁªìÊûÑ‰ª•ÂèäÂáΩÊï∞ÔºåÁî±ÂÆÉ‰ª¨Ë¥üË¥£ÂÆûÊñΩÁÉ≠ËøÅÁßªÔºö</p>
<ol>
<li><code>migration_thread</code>ÔºöËøÅÁßªÁ∫øÁ®ãÂáΩÊï∞ÔºåÂéüËôöÊãüÊú∫Êé•ÂèóËøÅÁßªËØ∑Ê±ÇÂêéÔºåÂ∞ÜÁî®Ëøô‰∏™ÂáΩÊï∞ÂàõÂª∫‰∏Ä‰∏™Á∫øÁ®ãÔºåÂÆåÊàêËøÅÁßªÂ∑•‰Ωú„ÄÇ</li>
<li><code>process_incoming_migration_co</code>ÔºöËøÅÁßªÊé•Êî∂ÂçèÁ®ãÔºàCoroutineÔºâÂáΩÊï∞ÔºåÁõÆÁöÑÂÆø‰∏ªÊú∫Â∞ÜÁî®Ëøô‰∏™ÂáΩÊï∞ÂàõÂª∫‰∏Ä‰∏™ÂçèÁ®ãÔºåË¥üË¥£Êé•Êî∂ËôöÊãüÊú∫ÁöÑÁä∂ÊÄÅÂπ∂ÊÅ¢Â§ç„ÄÇ</li>
<li><code>MigrationState</code>ÔºöËøôÊòØ‰∏Ä‰∏™ÂÖ®Â±ÄÂèòÈáèÁªìÊûÑÔºåË¥üË¥£‰øùÂ≠òËøÅÁßªÊó∂ÁöÑÂêÑÁßçÁä∂ÊÄÅÔºåÂ¶ÇÊÄªËøÅÁßªÊó∂Èó¥„ÄÅÂÅúÊú∫Êó∂Èó¥„ÄÅÊã∑Ë¥ùÊï∞ÊçÆÈáè„ÄÅËø≠‰ª£Ê¨°Êï∞„ÄÅËøÅÁßªÊâÄÂ§ÑÈò∂ÊÆµÔºàMIGRATION_STATUS_SETUP„ÄÅMIGRATION_STATUS_ACTIVEÁ≠âÔºâÔºåÂêåÊó∂ËøòÂåÖÂê´ <code>QEMUFile</code> Ëøô‰∏™ÊàêÂëò„ÄÇ</li>
<li><code>QEMUFile</code>ÔºöËØ•ÁªìÊûÑ‰ΩìË¥üË¥£ËôöÊãüÊú∫Áä∂ÊÄÅÊï∞ÊçÆÁöÑ‰º†ËæìÔºåÂÆÉÁªëÂÆö‰∫Ü‰∏Ä‰∏™Â•óÊé•Â≠óÔºàSocketÔºâÔºå‰∏ìÈó®Áî®‰∫éÊîØÊåÅÁΩëÁªú‰º†Ëæì„ÄÇQEMUFileÂåÖÂê´‰∏§‰∏™‰∏ªË¶ÅÊàêÂëò<code>buf[IO_BUF_SIZE]</code> Âíå <code>QEMUFileOps</code>ÔºåÂÖ∂‰∏≠Ôºö
<ul>
<li><code>buf</code> ÊòØ‰∏Ä‰∏™ÁºìÂÜ≤Âå∫ÔºåÂèØ‰ª•ÂæÄËØ•ÁºìÂÜ≤Âå∫ËØªÂèñÊàñÂÜôÂÖ•Ë¶Å‰º†ËæìÁöÑÊï∞ÊçÆÔºõ</li>
<li><code>QemuFileOps</code> ÂÆö‰πâ‰∫Ü‰∏ÄÁ≥ªÂàóÈíàÂØπQEMUFileÁöÑÊìç‰ΩúÔºåÂåÖÊã¨ËØªÂèñ„ÄÅÂÜôÂÖ•QEMUFileÁöÑbufÔºå‰ª•ÂèäÂèëÈÄÅbuf‰∏≠ÂÜÖÂÆπ„ÄÅÊé•Êî∂Êï∞ÊçÆÂà∞bufÁ≠âÔºõ</li>
</ul>
</li>
<li><code>migration_bitmap</code>ÔºöËÑèÈ°µ‰ΩçÂõæÔºåQEMUÊØè‰∏ÄËΩÆËø≠‰ª£ÈÉΩÂ∞Ü‰ªéKVMËé∑ÂèñÂÜÖÂ≠òËÑèÈ°µ‰ø°ÊÅØÂπ∂Â≠òÂÖ•migration_bitmapÔºå‰∏Ä‰∏™bit‰ª£Ë°®‰∏Ä‰∏™ÂÜÖÂ≠òÈ°µÔºå4GÂÜÖÂ≠òÂ§ßÊ¶ÇÈúÄË¶Å128kbÁöÑmigration_bitmap„ÄÇ</li>
<li><code>VMStateDescription</code>ÔºöKVMËôöÊãüÊú∫‰∏≠ÁöÑËôöÊãüËÆæÂ§áÔºàCPU„ÄÅÁΩëÂç°„ÄÅÁ£ÅÁõò„ÄÅBIOSÔºâÈÉΩÊúâ‰∏Ä‰∏™Áõ∏ÂÖ≥ÁöÑÁªìÊûÑ‰ΩìÔºåËøô‰∏™ÁªìÊûÑ‰ΩìÂÆö‰πâ‰∫Ü‰∏ÄÁ≥ªÂàóÁöÑVMStateFieldÔºåÂç≥ËÆæÂ§áÁöÑÁä∂ÊÄÅÔºåÂêåÊó∂ËøòÂÆö‰πâ‰∫ÜÁõ∏Â∫îÁöÑ‰øùÂ≠òÂíåÊÅ¢Â§çÂáΩÊï∞ÔºåÁî®‰∫éÊîØÊåÅËÆæÂ§áÁä∂ÊÄÅÁöÑ‰øùÂ≠òÂíåÊÅ¢Â§ç„ÄÇ</li>
<li><code>savevm_handlers</code>Ôºö‰∏Ä‰∏™SaveStateEntryÁ±ªÂûãÁöÑÈìæË°®ÔºåÊØè‰∏ÄÁßçËÆæÂ§áÔºàÂåÖÊã¨ÂÜÖÂ≠òÔºâÈÉΩÊúâ‰∏Ä‰∏™SaveStateEntryÔºåÂåÖÂê´ <code>name</code>„ÄÅ<code>instance_id</code>„ÄÅ<code>ops</code> Âíå <code>vmsd</code> Á≠âÊàêÂëòÔºåÂÖ∂‰∏≠Âè™ÊúâÂÜÖÂ≠òÂíåÁ£ÅÁõòÁöÑ <code>ops</code> ‰∏ç‰∏∫Á©∫Ôºå<code>ops</code> ÂÆö‰πâ‰∫ÜÂÜÖÂ≠ò„ÄÅÁ£ÅÁõòÁöÑÁÉ≠ËøÅÁßªÂêÑ‰∏™Èò∂ÊÆµÁöÑhandlersÔºàÂåÖÊã¨‰øùÂ≠òÂíåÊÅ¢Â§çÔºâ„ÄÇÂÖ∂‰ΩôËÆæÂ§áÁä∂ÊÄÅÁöÑ‰øùÂ≠òÂíåÊÅ¢Â§çÂÄüÂä© <code>vmsd</code> Ëøô‰∏™ÂèòÈáèÔºåÂÖ∂Á±ªÂûãÊ≠£ÊòØÂâçÈù¢ÊèêÂà∞ÁöÑ <code>VMStateDescription</code>„ÄÇ</li>
<li><code>loadvm_handlers</code>Ôºö‚Äî‰∏™LoadStateEntryÁ±ªÂûãÁöÑÈìæË°®ÔºåÂåÖÂê´‰∫ÜÊàêÂëòÂèòÈáè <code>se</code>ÔºåÊúâË∂£ÁöÑÊòØ <code>se</code> ‰πüÊòØ‰∏Ä‰∏™SaveStateEntryÁ±ªÂûãÁöÑÂèòÈáèÔºåÂÜÖÂ≠òÁöÑÊÅ¢Â§ç„ÄÅËÆæÂ§áÁä∂ÊÄÅÁöÑÊÅ¢Â§ç‰∏ªË¶ÅÊòØÂÄüÂä© <code>se</code> Êù•ÂÆåÊàêÁöÑÔºå‰πüÂ∞±ÊòØËØ¥ÂÖ∂ÂÆûsavevm_handlersÂÆåÊàêËÆæÂ§áÁä∂ÊÄÅÁöÑÊÅ¢Â§çÔºå‰º∞ËÆ°‰∏∫‰∫Ü‰ª£Á†ÅÁöÑÊòìËØªÊÄß„ÄÅÁªü‰∏ÄÊÄßÔºåÂ∞Ü <code>SaveStateEntry</code> ÂåÖË£ÖÊàê <code>LoadStateEntry</code>ÔºåÂπ∂ÂÆö‰πâÂá∫loadvm_handlers„ÄÇ</li>
</ol>
<h3 id="ËÑèÈ°µ‰ΩçÂõæ">ËÑèÈ°µ‰ΩçÂõæ
</h3><blockquote>
<p>ÂÜÖÂ≠òËøÅÁßªÁöÑÂÖ≥ÈîÆÊ≠•È™§Â∞±ÊòØËÆ∞ÂΩïËÑèÈ°µÔºåÂç≥ËÆ∞ÂΩï‰∏ä‰∏ÄËΩÆÈ¢ÑÊã∑Ë¥ù‰∏≠Ë¢´‰øÆÊîπËøáÁöÑÂÜÖÂ≠òÈ°µ„ÄÇ</p>
</blockquote>
<p>Ëøô‰∏™ÂäüËÉΩÁî± <code>migration_bitmap_sync</code> ÂáΩÊï∞ÂÆåÊàêÔºåÂ∞ÜËÑèÈ°µ‰ø°ÊÅØ‰øùÂ≠òÂà∞ <code>migration_bitmap</code> Ëøô‰∏™ÂèòÈáè‰∏≠Ôºå‰æõËøÅÁßª‰ΩøÁî®„ÄÇ<code>migration_bitmap_sync</code> ÂáΩÊï∞Â∫ïÂ±ÇÊòØÈÄöËøáKVM_GET_DIRTY_LOGËøô‰∏™ioctlË∞ÉÁî®ÔºåÂêëÂÜÖÊ†∏KVMÊ®°ÂùóËé∑ÂèñËÑèÈ°µ‰ø°ÊÅØ„ÄÇ</p>
<p>Áé∞Èò∂ÊÆµÔºåKVMÁöÑËÑèÈ°µÊó•ÂøóÊú∫Âà∂‰∏∫ÔºöÂØπÂΩ±Â≠êÈ°µË°®ËøõË°åÂÜô‰øùÊä§Ôºàwrite protectionÔºâÔºåÂΩìÂÆ¢Êà∑Êú∫Ë¶Å‰øÆÊîπÂÜÖÂ≠òÊó∂ÔºåÂ∞Ü‰ºö‰∫ßÁîüÂÜôÈîôËØØÔºàwrite faultÔºâÔºåËøôÊó∂ËôöÊãüÊú∫‰ºöÈÄÄÂá∫ÔºåÁî±KVMËøõË°åÂ§ÑÁêÜÔºåKVMÂ∞ÜÊ£ÄÊü•ÂΩ±Â≠êÈ°µË°®ÂØπÂ∫îÁöÑÂÆ¢Êà∑Êú∫PTEÁöÑËÆøÈóÆÊùÉÔºåÂÅáÂ¶ÇËØ•ÂÜÖÂ≠òÈ°µÂèØÂÜôÔºåÂàôKVMË¥üË¥£Â∞ÜÂØπÂ∫îÂΩ±Â≠êÈ°µË°®PTEÊîπ‰∏∫ÂèØÂÜôÊùÉÈôêÔºåÂêåÊó∂ËÆ∞ÂΩïËÑèÈ°µ‰ΩçÁΩÆ„ÄÇÁé∞Âú®Âú®ÊúÄÊñ∞ÁöÑEPTÊäÄÊúØÈáåÈù¢ÔºåÊúâÁ°¨‰ª∂ËÆ∞ÂΩïËÑèÈ°µÁöÑÂäüËÉΩÔºåÁß∞‰∏∫PMLÔºàPage Modification LoggingÔºâÔºåËØ•ÂäüËÉΩÁõ¥Êé•Áî±Á°¨‰ª∂ÂÆûÁé∞ÔºåÈÅøÂÖç‰∫ÜÂéüÊúâÊú∫Âà∂‰∏ãËôöÊãüÊú∫ÁöÑÈ¢ëÁπÅÈÄÄÂá∫ÔºåÊèêÈ´ò‰∫ÜËôöÊãüÊú∫ÁöÑËøêË°åÊÄßËÉΩ„ÄÇ</p>
<h3 id="Ëø≠‰ª£È¢ÑÊã∑Ë¥ùÈò∂ÊÆµ">Ëø≠‰ª£È¢ÑÊã∑Ë¥ùÈò∂ÊÆµ
</h3><p>KVMËôöÊãüÊú∫ÁÉ≠ËøÅÁßªÂäüËÉΩÁî± <code>migration_thread</code> ÂáΩÊï∞ÂÆåÊàêÔºåËØ•ÂáΩÊï∞‰Ωç‰∫éÊñá‰ª∂ <code>migration.c</code> ‰∏≠Ôºå‰ª£Á†ÅÊï¥‰ΩìÊµÅÁ®ãÂ¶ÇÂõæÊâÄÁ§∫„ÄÇ</p>
<p><img src="C:/Users/26896/AppData/Roaming/Typora/typora-user-images/image-20231228154403313.png"
	
	
	
	loading="lazy"
	
		alt="image-20231228154403313"
	
	
></p>
<ul>
<li>
<p>ÂÖ∂‰∏≠ <code>qemu_savevm_state_begin</code> ÂáΩÊï∞Ë¥üË¥£ËøÅÁßªÂâçÊúüÁöÑÂàùÂßãÂåñÂ∑•‰ΩúÔºåÂàùÂßãÂåñMigrationStateÁªìÊûÑ‰ΩìÔºåÂÖ∂Áä∂ÊÄÅÂèò‰∏∫MIG_STATE_SETUPÔºåÂºÄÂêØKVMÁöÑËÑèÈ°µËÆ∞ÂΩïÂäüËÉΩÔºåÂπ∂‰∏∫ <code>migration_bitmap</code> ÂàÜÈÖçÂÜÖÂ≠òÁ©∫Èó¥ÔºåÂàùÂßãÂåñ <code>migration_bitmap</code> ÁöÑÊâÄÊúâ‰ΩçÈÉΩ‰∏∫1ÔºåÂç≥‰ª£Ë°®Á¨¨‰∏ÄËΩÆÊâÄÊúâÂÜÖÂ≠òÂùá‰∏∫ËÑèÈ°µÔºåMigrationStateÁä∂ÊÄÅÂèò‰∏∫MIG_STATE_ACTIVEÔºåËøõÂÖ•Ëø≠‰ª£È¢ÑÊã∑Ë¥ùÈò∂ÊÆµ„ÄÇ</p>
</li>
<li>
<p>Ëø≠‰ª£È¢ÑÊã∑Ë¥ùÁî± <code>qemu_savevm_state_pending</code> Âíå <code>qemu_savevm_state_iterate</code> Ëøô‰∏§‰∏™ÂáΩÊï∞ÂÆåÊàêÔºö</p>
<ul>
<li>
<p>È¶ñÂÖàÁúã <code>qemu_savevm_state_pending</code>ÔºåËØ•ÂáΩÊï∞Â∞ÜÈÅçÂéÜsavevm_handlersÈìæË°®ÔºåË∞ÉÁî®ÊØè‰∏ÄÁßçËÆæÂ§áÁöÑ <code>save_live_pending</code> ÂáΩÊï∞ÔºåÂè™ÊúâÂÜÖÂ≠òÂíåÁ£ÅÁõòËÆæÂ§áÂÆö‰πâ‰∫ÜËØ•ÂáΩÊï∞ÔºåÂÖ∂‰ΩôËÆæÂ§áËøô‰∏™ÂáΩÊï∞‰∏∫Á©∫„ÄÇÂØπÂÜÖÂ≠òÊù•ËØ¥ÔºåÂ∞ÜË∞ÉÁî® <code>ram_save_pending</code> ÂáΩÊï∞ÔºåËØ•ÂáΩÊï∞È¶ñÂÖàÂ∞ÜË∞ÉÁî® <code>migration_bitmao_sync</code> ÂáΩÊï∞ÔºåÂéªÂêåÊ≠•ËÑèÈ°µ‰ΩçÂõæÔºåÂêåÊó∂Â∞ÜËøîÂõûËÑèÈ°µÁöÑÊï∞ÊçÆÈáèÔºåÂç≥ <code>pending_size</code>„ÄÇËøõÂÖ•ÂÜÖÂ≠òÊã∑Ë¥ù‰º†ËæìÁöÑÈò∂ÊÆµ‰πãÂâçÔºå‰ºöËøõË°å‰∏ÄÊ¨°Âà§Êñ≠ÔºåÂç≥ <code>pending_size</code> Âíå <code>max_size</code> ÁöÑÂ§ßÂ∞è„ÄÇ<code>max_size</code> ÊòØËøõÂÖ•ÂÅúÊú∫Êã∑Ë¥ùÈò∂ÊÆµÁöÑÊúÄÂ§ßËÑèÈ°µÊï∞ÊçÆÈáèÔºåÂÆÉÊòØÊ†πÊçÆÊúÄÂ§ßÂÖÅËÆ∏ÂÅúÊú∫Êó∂Èó¥Ôºàmax_downtimeÔºâÂíåÂ∏¶ÂÆΩÔºàbandwidthÔºâËÆ°ÁÆóÂá∫Êù•ÁöÑÔºåËã• <code>pending_size</code> Â∞è‰∫é <code>max_size</code>ÔºåÂàôËøõÂÖ•ÂÅúÊú∫Êã∑Ë¥ùÈò∂ÊÆµ„ÄÇ<code>max_size</code> ËÆ°ÁÆóÂÖ¨ÂºèÂ¶Ç‰∏ãÔºö</p>
<blockquote>
<p>max_size = max_downtime * bandwidth</p>
</blockquote>
</li>
<li>
<p>ÂÖ∑‰ΩìÁöÑËø≠‰ª£Êã∑Ë¥ùÂ∑•‰ΩúÁî± <code>qemu_savevm_state_iterate</code> ÂáΩÊï∞ÂÆåÊàêÔºåËøô‰∏™ÂáΩÊï∞Â∞ÜË∞ÉÁî®ÂÜÖÂ≠òÁöÑ <code>ram_save_iterate</code> ÂáΩÊï∞ÔºåËØ•ÂáΩÊï∞ÊòØ‰∏Ä‰∏™Âæ™ÁéØÂáΩÊï∞ÔºåË¥üË¥£ÂØπÂÜÖÂ≠òÁöÑËø≠‰ª£Êã∑Ë¥ùÔºåË∞ÉÁî® <code>migration_bitmap_find_and_reset_dirty</code> ÂáΩÊï∞Êü•Êâæmigration_bitmap‰∏≠‰∏ã‰∏Ä‰∏™ËÑèÈ°µÔºå<code>save_block_hdr</code> ÂáΩÊï∞Ë¥üË¥£‰º†ËæìËøô‰∏™ËÑèÈ°µÔºåÂ∞ÜÂÖ∂ÂÜôÂÖ•QEMUFileÁöÑÁºìÂÜ≤Âå∫ÔºåÁºìÂÜ≤Âå∫Êª°Êó∂ÔºåÊâπÈáè‰º†ËæìÂÜÖÂ≠òÈ°µÂà∞ÁõÆÁöÑÂÆø‰∏ªÊú∫‰∏äÂéª„ÄÇÂΩì <code>pending_size</code> Â∞è‰∫é <code>max_size</code> Êó∂ÔºåËøÅÁßªËøõÂÖ•ÂÅúÊú∫Êã∑Ë¥ùÈò∂ÊÆµ„ÄÇ</p>
</li>
</ul>
</li>
</ul>
<h3 id="ÂÅúÊú∫Êã∑Ë¥ùÈò∂ÊÆµ">ÂÅúÊú∫Êã∑Ë¥ùÈò∂ÊÆµ
</h3><p>ÂÅúÊú∫Êã∑Ë¥ùÂ∑•‰Ωú‰∏ªË¶ÅÁî± <code>vm_stop_force_state</code> Âíå <code>qemu_savevm_state_complete</code> ‰∏§‰∏™ÂáΩÊï∞ÂÆåÊàê„ÄÇ</p>
<ul>
<li>È¶ñÂÖàÁî± <code>vm_stop_force_state</code> ÂáΩÊï∞ÂÆåÊàêÂÅúÊú∫Êìç‰ΩúÔºåÊ≥®ÊÑèËøôÈáåÁöÑÂÅúÊú∫Êìç‰ΩúÂπ∂‰∏çÊòØÂÖ≥Êú∫ÔºåÂÅúÊú∫‰∏ªË¶ÅÊòØËÆ©CPU‰∏çÂÜçÂàáÊç¢Ëá≥ÈùûÊ†πÊìç‰ΩúÊ®°ÂºèËøêË°åÔºåÊ≠§Êó∂ÂÆ¢Êà∑Êú∫ÁöÑ‰∏ä‰∏ãÊñáÁéØÂ¢ÉÂ∑±Áªè‰øùÂ≠òÂú®VMCSËøô‰∏™ËôöÊãüÊú∫ÊéßÂà∂Âùó‰∏≠‰∫Ü„ÄÇÈÄöËøáËÆæÁΩÆQEMU‰∏≠ÁöÑCPUÁªìÊûÑ‰ΩìÁöÑ <code>stop</code> Ê†áÂøó‰∏∫TrueÔºåvcpuÁ∫øÁ®ãË∞ÉÁî®<code>ioctl(KVM_RUN)</code> ‰πãÂâç‰ºöÊ£ÄÊü•Ëøô‰∏™flagÔºåËã•‰∏∫TrueÔºåÂàô‰∏ç‰ºöË∞ÉÁî® <code>ioctl(KVM_RUN)</code> ‰∏ãÈô∑ÔºåËôöÊãüÊú∫Â∞Ü‰∏ç‰ºöËøêË°å„ÄÇ</li>
<li>Êé•‰∏ãÊù•ÁöÑÂ∑•‰Ωú‰æøÊòØÊã∑Ë¥ùÂâ©‰ΩôÁöÑËÑèÈ°µÊï∞ÊçÆÔºå‰ª•ÂèäCPU„ÄÅÂ§ñËÆæÁöÑËøêË°åÁä∂ÊÄÅËá≥ÁõÆÁöÑÂÆø‰∏ªÊú∫ÔºåËØ•Â∑•‰Ωú‰∏ªË¶ÅÁî± <code>qemu_savevm_state_complete</code> ÂéªÊâßË°å„ÄÇËøô‰∏™ÂáΩÊï∞Â∞ÜÈÅçÂéÜsavevm_handlers‰∏§Ê¨°„ÄÇ
<ul>
<li>Á¨¨‰∏ÄÊ¨°ÈÅçÂéÜ‰∏ªË¶ÅÊòØ‰∏∫‰∫ÜÂèëÈÄÅÂâ©‰ΩôÂÜÖÂ≠òËÑèÈ°µÔºåÈÄöËøáÊâßË°åÂÜÖÂ≠òÁöÑ <code>ram_save_complete</code> ÂáΩÊï∞ÔºåËØ•ÂáΩÊï∞È¶ñÂÖà‰ºöË∞ÉÁî® <code>migration_bitmap_sync</code> ÂêåÊ≠•ËÑèÈ°µ‰ΩçÂõæÔºåÁÑ∂ÂêéÂèëÈÄÅÂâ©‰ΩôÁöÑÂÜÖÂ≠òËÑèÈ°µÔºõ</li>
<li>Á¨¨‰∫åÊ¨°ÈÅçÂéÜ‰∏ªË¶ÅÊòØ‰∏∫‰∫ÜÂêåÊ≠•CPU„ÄÅÂ§ñËÆæËøêË°åÁä∂ÊÄÅÔºåÁî± <code>vmstate_save</code> ÂáΩÊï∞ÊâßË°åÔºåËØ•ÂáΩÊï∞Â∞ÜË∞ÉÁî®CPU‰ª•ÂèäÂÖ∂‰ªñÂ§ñËÆæÂú®ÂàùÂßãÂåñÊó∂Ê≥®ÂÜåÁöÑÁä∂ÊÄÅ‰øùÂ≠òÂáΩÊï∞ÔºåÂÆåÊàêËÆæÂ§áÁä∂ÊÄÅÁöÑËøÅÁßªÔºõ</li>
</ul>
</li>
</ul>

</section>


    <footer class="article-footer">
    

    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2024 zcxGGmu
    </section>
    
    <section class="powerby">
        ‰ΩøÁî® <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> ÊûÑÂª∫ <br />
        ‰∏ªÈ¢ò <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.27.0">Stack</a></b> Áî± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> ËÆæËÆ°
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>
<div id="particles-js"></div>

<script src=https://zcxggmu.github.io/background/particles.min.js></script>
<script>
  particlesJS.load('particles-js', "https://zcxggmu.github.io/background/particlesjs-config.json", function() {
    console.log('particles.js loaded - callback');
  });
</script>

<style>
  #particles-js {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: -1;
  }
</style>


    </body>
</html>
