<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="Before RISC-V AIA &hellip;\n1 RISC-V ÂºÇÂ∏∏‰∏é‰∏≠Êñ≠ 1.1 Âü∫Êú¨Ê¶ÇÂøµ‰∏éÂàÜÁ±ª Âú®RISC-VÊ†áÂáÜ‰∏≠ÔºåÂ∞Ü**ÂºÇÂ∏∏(exception)ÂÆö‰πâ‰∏∫ÂΩìÂâçCPUËøêË°åÊó∂ÈÅáÂà∞ÁöÑ‰∏éÊåá‰ª§ÊúâÂÖ≥ÁöÑ‰∏çÂØªÂ∏∏ÊÉÖÂÜµÔºåËÄå‰ΩøÁî®‰∏≠Êñ≠(interrupt)ÂÆö‰πâ‰∏∫Âõ†‰∏∫Â§ñÈÉ®ÂºÇÊ≠•‰ø°Âè∑ËÄåÂºïËµ∑ÁöÑËÆ©ÊéßÂà∂ÊµÅËÑ±Á¶ªÂΩìÂâçCPUÁöÑ‰∫ã‰ª∂„ÄÇËÄåÈô∑Èò±(trap)**Ë°®Á§∫ÁöÑÂàôÊòØÔºåÁî±ÂºÇÂ∏∏ÊàñËÄÖ‰∏≠Êñ≠ÂºïËµ∑ÁöÑÊéßÂà∂ÊùÉËΩ¨ÁßªÂà∞Èô∑Èò±Â§ÑÁêÜÁ®ãÂ∫èÁöÑËøáÁ®ã„ÄÇ\n">
<title>Riscv Trap Handle</title>

<link rel='canonical' href='https://zcxggmu.github.io/p/riscv-trap-handle/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="Riscv Trap Handle">
<meta property='og:description' content="Before RISC-V AIA &hellip;\n1 RISC-V ÂºÇÂ∏∏‰∏é‰∏≠Êñ≠ 1.1 Âü∫Êú¨Ê¶ÇÂøµ‰∏éÂàÜÁ±ª Âú®RISC-VÊ†áÂáÜ‰∏≠ÔºåÂ∞Ü**ÂºÇÂ∏∏(exception)ÂÆö‰πâ‰∏∫ÂΩìÂâçCPUËøêË°åÊó∂ÈÅáÂà∞ÁöÑ‰∏éÊåá‰ª§ÊúâÂÖ≥ÁöÑ‰∏çÂØªÂ∏∏ÊÉÖÂÜµÔºåËÄå‰ΩøÁî®‰∏≠Êñ≠(interrupt)ÂÆö‰πâ‰∏∫Âõ†‰∏∫Â§ñÈÉ®ÂºÇÊ≠•‰ø°Âè∑ËÄåÂºïËµ∑ÁöÑËÆ©ÊéßÂà∂ÊµÅËÑ±Á¶ªÂΩìÂâçCPUÁöÑ‰∫ã‰ª∂„ÄÇËÄåÈô∑Èò±(trap)**Ë°®Á§∫ÁöÑÂàôÊòØÔºåÁî±ÂºÇÂ∏∏ÊàñËÄÖ‰∏≠Êñ≠ÂºïËµ∑ÁöÑÊéßÂà∂ÊùÉËΩ¨ÁßªÂà∞Èô∑Èò±Â§ÑÁêÜÁ®ãÂ∫èÁöÑËøáÁ®ã„ÄÇ\n">
<meta property='og:url' content='https://zcxggmu.github.io/p/riscv-trap-handle/'>
<meta property='og:site_name' content='zcxGGmu'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2024-10-17T10:03:29&#43;08:00'/><meta property='article:modified_time' content='2024-10-17T10:03:29&#43;08:00'/>
<meta name="twitter:title" content="Riscv Trap Handle">
<meta name="twitter:description" content="Before RISC-V AIA &hellip;\n1 RISC-V ÂºÇÂ∏∏‰∏é‰∏≠Êñ≠ 1.1 Âü∫Êú¨Ê¶ÇÂøµ‰∏éÂàÜÁ±ª Âú®RISC-VÊ†áÂáÜ‰∏≠ÔºåÂ∞Ü**ÂºÇÂ∏∏(exception)ÂÆö‰πâ‰∏∫ÂΩìÂâçCPUËøêË°åÊó∂ÈÅáÂà∞ÁöÑ‰∏éÊåá‰ª§ÊúâÂÖ≥ÁöÑ‰∏çÂØªÂ∏∏ÊÉÖÂÜµÔºåËÄå‰ΩøÁî®‰∏≠Êñ≠(interrupt)ÂÆö‰πâ‰∏∫Âõ†‰∏∫Â§ñÈÉ®ÂºÇÊ≠•‰ø°Âè∑ËÄåÂºïËµ∑ÁöÑËÆ©ÊéßÂà∂ÊµÅËÑ±Á¶ªÂΩìÂâçCPUÁöÑ‰∫ã‰ª∂„ÄÇËÄåÈô∑Èò±(trap)**Ë°®Á§∫ÁöÑÂàôÊòØÔºåÁî±ÂºÇÂ∏∏ÊàñËÄÖ‰∏≠Êñ≠ÂºïËµ∑ÁöÑÊéßÂà∂ÊùÉËΩ¨ÁßªÂà∞Èô∑Èò±Â§ÑÁêÜÁ®ãÂ∫èÁöÑËøáÁ®ã„ÄÇ\n">
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="ÂàáÊç¢ËèúÂçï">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu16968365064894999835.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">zcxGGmu</a></h1>
            <h2 class="site-description">riscv, linux-kernel/kvm, llm-app/infer</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/zcxGGmu'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>‰∏ªÈ°µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>ÂÖ≥‰∫é</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>ÊöóËâ≤Ê®°Âºè</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ÁõÆÂΩï</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#11-Âü∫Êú¨Ê¶ÇÂøµ‰∏éÂàÜÁ±ª">1.1 Âü∫Êú¨Ê¶ÇÂøµ‰∏éÂàÜÁ±ª</a></li>
    <li><a href="#12-Èô∑Èò±ÁöÑÂßîÊ¥æ">1.2 Èô∑Èò±ÁöÑÂßîÊ¥æ</a></li>
    <li><a href="#13-csrs">1.3 CSRs</a>
      <ol>
        <li><a href="#sstatus">sstatus</a></li>
        <li><a href="#stvec">stvec</a></li>
        <li><a href="#sipsie">sip/sie</a>
          <ol>
            <li><a href="#‰∏≠Êñ≠Ë¢´ÂëàÈÄíÂà∞‰ΩïÁßçÁâπÊùÉÁ∫ß‰∏ãÂ§ÑÁêÜ">‰∏≠Êñ≠Ë¢´ÂëàÈÄíÂà∞‰ΩïÁßçÁâπÊùÉÁ∫ß‰∏ãÂ§ÑÁêÜÔºü</a></li>
            <li><a href="#ÂìçÂ∫î‰∏≠Êñ≠ÁöÑÊó∂Êú∫">ÂìçÂ∫î‰∏≠Êñ≠ÁöÑÊó∂Êú∫</a></li>
            <li><a href="#Â§ñÈÉ®‰∏≠Êñ≠claimcompleteÊú∫Âà∂">Â§ñÈÉ®‰∏≠Êñ≠„ÄÅclaim/completeÊú∫Âà∂</a></li>
            <li><a href="#ËΩØ‰∏≠Êñ≠ÂíåÂÆöÊó∂Âô®‰∏≠Êñ≠">ËΩØ‰∏≠Êñ≠ÂíåÂÆöÊó∂Âô®‰∏≠Êñ≠</a></li>
          </ol>
        </li>
        <li><a href="#sscratch">sscratch</a></li>
        <li><a href="#sepc">sepc</a></li>
        <li><a href="#scause">scause</a></li>
        <li><a href="#stval">stval</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/riscv-trap-handle/">Riscv Trap Handle</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2024-10-17</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    ÈòÖËØªÊó∂Èïø: 19 ÂàÜÈíü
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>Before RISC-V AIA &hellip;</p>
<h1 id="1-risc-v-ÂºÇÂ∏∏‰∏é‰∏≠Êñ≠">1 RISC-V ÂºÇÂ∏∏‰∏é‰∏≠Êñ≠
</h1><h2 id="11-Âü∫Êú¨Ê¶ÇÂøµ‰∏éÂàÜÁ±ª">1.1 Âü∫Êú¨Ê¶ÇÂøµ‰∏éÂàÜÁ±ª
</h2><p>Âú®RISC-VÊ†áÂáÜ‰∏≠ÔºåÂ∞Ü**ÂºÇÂ∏∏(exception)<strong>ÂÆö‰πâ‰∏∫ÂΩìÂâçCPUËøêË°åÊó∂ÈÅáÂà∞ÁöÑ‰∏éÊåá‰ª§ÊúâÂÖ≥ÁöÑ‰∏çÂØªÂ∏∏ÊÉÖÂÜµÔºåËÄå‰ΩøÁî®</strong>‰∏≠Êñ≠(interrupt)<strong>ÂÆö‰πâ‰∏∫Âõ†‰∏∫Â§ñÈÉ®ÂºÇÊ≠•‰ø°Âè∑ËÄåÂºïËµ∑ÁöÑËÆ©ÊéßÂà∂ÊµÅËÑ±Á¶ªÂΩìÂâçCPUÁöÑ‰∫ã‰ª∂„ÄÇËÄå</strong>Èô∑Èò±(trap)**Ë°®Á§∫ÁöÑÂàôÊòØÔºåÁî±ÂºÇÂ∏∏ÊàñËÄÖ‰∏≠Êñ≠ÂºïËµ∑ÁöÑÊéßÂà∂ÊùÉËΩ¨ÁßªÂà∞Èô∑Èò±Â§ÑÁêÜÁ®ãÂ∫èÁöÑËøáÁ®ã„ÄÇ</p>
<p>‰∏≠Êñ≠‰πüÂèØ‰ª•Ëøõ‰∏ÄÊ≠•ÁªÜÂàÜ‰∏∫‰∏§ÁßçÊÉÖÂÜµÔºå‰∏ÄÁßçÊòØÊú¨Âú∞‰∏≠Êñ≠Ôºå‰∏ÄÁßçÊòØÂÖ®Â±Ä‰∏≠Êñ≠„ÄÇÊú¨Âú∞‰∏≠Êñ≠ÂåÖÊã¨ËΩØ‰ª∂‰∏≠Êñ≠ÂíåÂÆöÊó∂Âô®‰∏≠Êñ≠ÔºåÂÆÉ‰ª¨Áî±CLINT (Core-Local Interruptor, Ê†∏ÂøÉÊú¨Âú∞‰∏≠Êñ≠Âô®) Êù•ÊéßÂà∂ÔºõÂè¶‰∏ÄÁßçÊòØÂ§ñÈÉ®ËÆæÂ§áÂºïËµ∑ÁöÑ‰∏≠Êñ≠Ôºå‰πüË¢´Áß∞‰∏∫ÂÖ®Â±Ä‰∏≠Êñ≠ÔºåÂÆÉ‰ª¨Áî±PLIC (Platform-Level Interrupt Controller,Âπ≥Âè∞Á∫ß‰∏≠Êñ≠ÊéßÂà∂Âô®) Êù•ÊéßÂà∂„ÄÇPLIC„ÄÅCLINTÂíåRISC-V CoreÁöÑËøûÊé•ÈÄªËæëÁ§∫ÊÑèÂõæÂ¶Ç‰∏ãÔºö</p>
<p><img src="/p/riscv-trap-handle/index.assets/core_clint_plic.png"
	width="852"
	height="721"
	srcset="/p/riscv-trap-handle/index.assets/core_clint_plic_hu12785955072320980460.png 480w, /p/riscv-trap-handle/index.assets/core_clint_plic_hu7278144653543285376.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="118"
		data-flex-basis="283px"
	
></p>
<p>ËÄåÊó†ËÆ∫ÊòØÂºÇÂ∏∏ËøòÊòØ‰∏≠Êñ≠ÔºåÂÆÉ‰ª¨ÊâÄÂØºËá¥ÁöÑ<strong>Á°¨‰ª∂Èô∑Èò±ÊµÅÁ®ã</strong>ÈÉΩÊòØ‰∏ÄÊ†∑ÁöÑÔºåÂÖ∑‰ΩìÊù•ËØ¥Êúâ‰∏§‰∏™Â§ßÂä®‰ΩúÔºö</p>
<blockquote>
<ol>
<li>ÊîπÂèòÊéßÂà∂ÊµÅ</li>
</ol>
<p>Â∞ÜPCÁöÑÂÄº‰øùÂ≠òÂú®sepc‰∏≠ÔºåÁÑ∂ÂêéÂ∞Üstvec‰∏≠‰øùÂ≠òÁöÑÈô∑Èò±Â§ÑÁêÜÂáΩÊï∞Âú∞ÂùÄÊîæÂÖ•PC„ÄÇ</p>
<ol start="2">
<li>Êõ¥Êñ∞CSRsÁöÑÂÄº</li>
</ol>
<p>ÂåÖÊã¨Ôºö<code>sstatus/stval/scause</code></p>
</blockquote>
<p>ÂΩìÊàë‰ª¨ËØ¥‰∏Ä‰∏™ <strong>X-Mode ÁöÑÂºÇÂ∏∏</strong>Êó∂ (XÂèØ‰ª•ÊòØU/S/M‰ªª‰Ωï‰∏ÄÁßçÊ®°Âºè)ÔºåÊàë‰ª¨ÊåáÁöÑÊú¨Ë¥®‰∏äÊòØÂΩìÂºÇÂ∏∏ÂèëÁîüÊó∂ CPU Ê≠£Â∑•‰ΩúÂú® X-Mode„ÄÇËÄå <strong>X-Mode ÁöÑ‰∏≠Êñ≠</strong>Êàë‰ª¨ÊåáÁöÑÊòØÔºåPLICËß¶Âèë‰∫Ü‰∏Ä‰∏™ÂøÖÈ°ªÁî± X-Mode ÂìçÂ∫îÁöÑ‰∏≠Êñ≠ÔºåCPUÂπ∂‰∏ç‰∏ÄÂÆöÈúÄË¶ÅÊ≠£Âú®Â∑•‰ΩúÂú®Ê≠§Ê®°Âºè‰∏ã„ÄÇ</p>
<p>Êó∂Èíü‰∏≠Êñ≠‰Ωú‰∏∫‰∏ÄÁßçÁâπ‰æãÔºåÂú®RISC-VÂ§ÑÁêÜÂô®‰∏≠Ë¢´Á°¨ËøûÁ∫ø‰∏∫‰∏Ä‰∏™M-ModeÁöÑ‰∏≠Êñ≠ÔºåËøô‰πüÂ∞±ÊòØËØ¥ÂÆÉÂøÖÈ°ªÁî±MÊ®°Âºè‰∏ãÁöÑ interrupt handler ÂìçÂ∫îÔºåÂΩìÁÑ∂ËøôÊòØÂêéËØùÔºåÊàë‰ª¨‰ºöÂú®ÂêéÈù¢ÈáçÊèê„ÄÇ</p>
<h2 id="12-Èô∑Èò±ÁöÑÂßîÊ¥æ">1.2 Èô∑Èò±ÁöÑÂßîÊ¥æ
</h2><p>‰∫ãÂÆû‰∏äÔºåÂú®RISC-VÁöÑÊ†áÂáÜÂÆö‰πâ‰∏≠ÔºåÊâÄÊúâÈô∑Èò±ÈªòËÆ§ÈÉΩÊòØÁî±Êú∫Âô®Ê®°Âºè(M-mode)Êù•Â§ÑÁêÜÁöÑ„ÄÇÁÑ∂ËÄåÔºåÂú®ÊîØÊåÅÊìç‰ΩúÁ≥ªÁªüÁöÑËÆæÂ§á‰∏äÂæÄÂæÄÈÉΩÂÆûÁé∞‰∫ÜÁõëÁÆ°ËÄÖÊ®°Âºè (S-Mode)ÔºåÂ¶ÇÊûúÊåâÁÖßÈªòËÆ§Ê®°ÂºèÂèëÁîü‰∏≠Êñ≠ÂàôÂ∫îËØ•È¶ñÂÖàÈô∑ÂÖ• M-Mode ‰∏ãÁöÑ‰∏≠Êñ≠Â§ÑÁêÜÁ®ãÂ∫èÔºåÁÑ∂ÂêéËß¶Âèë‰∏Ä‰∏™S-Mode ‰∏ãÁöÑ‰∏≠Êñ≠ÂÜç mret Âõû S-Mode ‰∏ãÂ§ÑÁêÜÔºåËøô‰∏™ËøáÁ®ãËøá‰∫éÁπÅÁêê‰∏îÈúÄË¶ÅÁ®ãÂ∫èÂëòËá™Â∑±ÂÆûÁé∞ÔºåÊâÄ‰ª•Ôºö</p>
<p>RISC-VÊ†áÂáÜ‰∏∫‰∫ÜÂ∫îÂØπËøôÁßçÊÉÖÂÜµÊèêÂá∫‰∫ÜÈô∑Èò±ÂßîÊ¥æÊú∫Âà∂„ÄÇ‰πüÂ∞±ÊòØËØ¥Âú®M-Mode‰∏ãÂèØ‰ª•ÈÖçÁΩÆÂØÑÂ≠òÂô®Ôºå‰ªéËÄå‰ΩøÂæóS-Mode‰∏ãÁöÑÊâÄÊúâÈô∑Èò±ÈÉΩË¢´S-Mode‰∏ãÁöÑÈô∑Èò±Â§ÑÁêÜÂáΩÊï∞Ëá™Âä®Êé•ÁÆ°„ÄÇÊúâ‰∏§‰∏™ÂØÑÂ≠òÂô®Ôºå<code>medeleg/mideleg</code>ÔºåÂàÜÂà´Áî®Êù•<strong>ÁÆ°ÁêÜÂºÇÂ∏∏Âíå‰∏≠Êñ≠ÁöÑÂßîÊ¥æ„ÄÇ</strong></p>
<p>È¶ñÂÖàÊòØ <code>medeleg</code> ÂØÑÂ≠òÂô®ÔºåÂÆÉÁöÑÁ§∫ÊÑèÂõæÂ¶Ç‰∏ãÊâÄÁ§∫ÔºåÂΩìË¶ÅÊääÁâπÂÆöÁöÑÂºÇÂ∏∏ÂßîÊâòÁªôS-ModeÊó∂ÔºåÂè™ÈúÄË¶ÅÂ∞Ü <code>mcause</code> ÂØÑÂ≠òÂô®‰∏≠ÂØπÂ∫îÊï∞ÂÄº‰ΩçÁΩÆÁöÑÊØîÁâπ‰ΩçÁΩÆ 1 Âç≥ÂèØÔºåÂèÇËÄÉ‰∏ãÈù¢ÁöÑË°®Ê†º„ÄÇÊØîÂ¶ÇÂΩìÊääÁ≥ªÁªüË∞ÉÁî®ÂßîÊâòÁªôS-ModeÊó∂ÔºåÂõ†‰∏∫ÂÆÉÂØπÂ∫îÁöÑException CodeÊòØ 8ÔºåÈÇ£‰πàÂè™ÈúÄË¶ÅÂ∞ÜÊ≠§ÂØÑÂ≠òÂô®‰∏≠Á¨¨ 8 ‰ΩçÁΩÆ‰∏∫ 1 Âç≥ÂèØ„ÄÇ</p>
<p><img src="/p/riscv-trap-handle/index.assets/riscv_ecode.png"
	width="429"
	height="667"
	srcset="/p/riscv-trap-handle/index.assets/riscv_ecode_hu2276639625215783387.png 480w, /p/riscv-trap-handle/index.assets/riscv_ecode_hu11360498154303842485.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="64"
		data-flex-basis="154px"
	
></p>
<p>Ê≥®ÊÑèÔºåM-Mode‰∏ãÂèëÁîüÂºÇÂ∏∏ÔºåÂç≥‰ΩøÂÆÉË¢´ÊâòÁÆ°Âà∞S-ModeÔºåËøô‰∏™ÂºÇÂ∏∏‰πü‰∏ç‰ºöË¢´Áßª‰∫§ÁªôS-ModeÂéªÂ§ÑÁêÜÔºåËÄåÊòØÂú®M-ModeÂÆåÊàêÂ§ÑÁêÜ„ÄÇËøô‰πüÂ∞±ÊòØRISC-VËßÑËåÉ‰∏≠ÊâÄËØ¥ÁöÑÔºöTraps never transition from a more-privileged mode to a less-privileged mode(Èô∑Èò±‰ªé‰∏ç‰ºö‰ªéÈ´ò‰ºòÂÖàÁ∫ßÁßª‰∫§Âà∞‰Ωé‰ºòÂÖàÁ∫ß)‰ΩÜÊòØÂ¶ÇÊûúÊòØÂèëÁîüÂú®S-Mode‰∏ãÁöÑÂºÇÂ∏∏ÔºåÂ∞±‰ºöË¢´S-ModeÁõ¥Êé•Êé•ÁÆ°Ôºå‰∏ç‰ºöÂÜç‰∏ä‰∫§Âà∞M-Mode‰∫ÜÔºåËøôË¢´Áß∞‰∏∫Ôºötraps may be taken horizontally(‰∏≠Êñ≠ÂèØ‰ª•Ë¢´Ê∞¥Âπ≥Êé•ÁÆ°)„ÄÇ</p>
<p>‰ΩÜÊòØÔºåÂ¶ÇÊûú‰∏Ä‰∏™Â±û‰∫éS-ModeÁöÑ‰∏≠Êñ≠‰ªéM-ModeÂßîÊâòÁªôS-ModeÔºàÊØîÊñπÊàë‰ª¨ÂêéÈù¢Ë¶ÅÁúãÂà∞ÁöÑÂ§ñÈÉ®‰∏≠Êñ≠ÔºâÔºåËøô‰∏™‰∏≠Êñ≠Âú®M-Mode‰∏ãÂ∞±‰ºöË¢´Â±èËîΩÊéâÔºå‰∏ÄÂÆöË¶ÅÁ≠âÂà∞ËøõÂÖ•S-ModeÊó∂Êâç‰ºöË¢´Â§ÑÁêÜ„ÄÇË¥üË¥£ÁÆ°ÁêÜ‰∏≠Êñ≠ÂßîÊ¥æÁöÑÊòØ <code>mideleg</code> ÂØÑÂ≠òÂô®„ÄÇ</p>
<blockquote>
<p>ËøôÈáåÊúâ‰∏Ä‰∫õÁÇπÂÄºÂæóÊæÑÊ∏ÖÔºöÂú®ÂÆûÁé∞Êó∂ÔºåÊó†ËÆ∫ÊòØÂú® qemu ËøòÊòØÂú®ÁúüÊ≠£ÁöÑ Verilog ÂÆûÁé∞‰∏≠ÔºåÊâÄË∞ì <code>mideleg</code> ÂØÑÂ≠òÂô®‰∏≠MÊÄÅ‰∏ãÁöÑÊú¨Âú∞‰∏≠Êñ≠ÔºàÂåÖÊã¨Êó∂Èíü‰∏≠Êñ≠ÂíåËΩØ‰∏≠Êñ≠ÔºâÈÉΩÊòØË¢´Á°¨ËøûÁ∫øÁõ¥Êé•ËøûÊé•Âà∞0ÁöÑÔºåÊâÄ‰ª•ÂßîÊ¥æÊó∂ËµãÂÄºÂÖ®ËµãÂÄº‰∏∫1Âè™ÊòØÂá∫‰∫éÊñπ‰æøÔºåÂπ∂‰∏çËÉΩÁúüÁöÑÊääM-Mode‰∏ãÁöÑÊú¨Âú∞‰∏≠Êñ≠‰∫§ÁªôS-ModeÂ§ÑÁêÜ„ÄÇ**ÂîØ‰∏ÄÂèØ‰ª•Ë¢´ÂßîÊ¥æÂà∞ S-Mode ÁöÑ‰∏≠Êñ≠ÊòØÂ§ñÈÉ®‰∏≠Êñ≠ MEIÔºå**Â§ñÈÉ®‰∏≠Êñ≠‰∏ÄÊó¶Ë¢´ÂßîÊ¥æÂà∞ S-ModeÔºåPLIC Â∞±Âè™‰ºöËß¶Âèë S-Mode ‰∏ãÁöÑ‰∏≠Êñ≠ÊåÇËµ∑‰Ωç sip.SEIP‰∫ÜÔºåÊàë‰ª¨Âú®ÂêéÈù¢‰ºöÁúãÂà∞Êõ¥Â§öÁªÜËäÇ„ÄÇÔºàÊ≥®ÊÑèÔºåËøôÈáå M-Mode ‰∏ãÁöÑÊú¨Âú∞‰∏≠Êñ≠Âú®ÂÆûÁé∞Êó∂‰∏çËÉΩÂÆûÁé∞ÂßîÊ¥æÊòØ SiFive_Unleashed ËøôÂùóRISC-VÂπ≥Âè∞ÁöÑÂÆûÁé∞Áâπ‰æãÔºåÂÖ∑‰ΩìÊÉÖÂÜµË¶ÅÂÖ∑‰ΩìÂàÜÊûêÔºå‰πüËÆ∏‰ª•ÂêéÁîµË∑ØËÆæËÆ°‰∏çÂêå‰∫ÜÔºåÁªìËÆ∫Â∞±‰ºöÊúâÊâÄÊîπÂèòÔºå‰ΩÜÂú®ËøôÈáåÊòØÊàêÁ´ãÁöÑÔºâ„ÄÇ</p>
</blockquote>
<p>ÊâÄ‰ª•ÂÖ∂ÂÆûÊó∂Èíü‰∏≠Êñ≠ÂíåËΩØ‰∏≠Êñ≠ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÈÉΩÊòØM-Mode‰∏≠Êñ≠ÔºåËøôÊòØÁî±Á°¨‰ª∂ÂÆûÁé∞ÂÜ≥ÂÆöÁöÑÔºåÂèØËÉΩ‰Ω†‰ºöÈóÆÈÇ£‰πà <code>STI/SSI</code> ËøòÊúâ‰ªÄ‰πàÊÑè‰πâÂë¢ÔºåÂèçÊ≠£ÂÆÉ‰ª¨‰πü‰∏ç‰ºöË¢´Ëß¶Âèë„ÄÇ‰∫ãÂÆû‰∏äÔºå<strong>ÂÆÉ‰ª¨Ë¢´Ëß¶ÂèëÁöÑÂîØ‰∏ÄÂèØËÉΩÂú∫ÊôØÂ∞±ÊòØÂú®M-Mode‰∏ãÁöÑ‰∏≠Êñ≠Â§ÑÁêÜÁ®ãÂ∫è‰∏≠Ë¢´ÁΩÆ‰ΩçÔºåÁÑ∂ÂêéÈÄöËøámretÂõûÂà∞S-Mode‰∏ãÂÜçÂ§ÑÁêÜ</strong>„ÄÇ</p>
<h2 id="13-csrs">1.3 CSRs
</h2><h3 id="sstatus">sstatus
</h3><p><code>sstatus</code> ÂØÑÂ≠òÂô®ÁöÑÂÖ®Áß∞ÊòØ supervisor status registerÔºåÈ°æÂêçÊÄù‰πâÔºåÂÆÉÊòØÁî®Êù•ÂèçÊò†S-Mode‰∏ãÂ§ÑÁêÜÂô®ÁöÑÂ∑•‰ΩúÁä∂ÊÄÅÁöÑ„ÄÇÂΩìÊâßË°åRV64Êó∂Ôºå<code>sstatus</code> ÂØÑÂ≠òÂô®ÁöÑÁ§∫ÊÑèÂõæÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö</p>
<p><img src="/p/riscv-trap-handle/index.assets/sstatus.png"
	width="1193"
	height="297"
	srcset="/p/riscv-trap-handle/index.assets/sstatus_hu5471243338596524964.png 480w, /p/riscv-trap-handle/index.assets/sstatus_hu18084149043102850572.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="401"
		data-flex-basis="964px"
	
></p>
<p>Âú® <code>sstatus</code> ‰∏≠‰∏éÂºÇÂ∏∏Âíå‰∏≠Êñ≠ÊúâÂÖ≥ÁöÑ‰ΩçÊúâ <code>SPP/SIE/SPIE</code>Ôºå‰∏ãÈù¢‰∏Ä‰∏™‰∏Ä‰∏™Êù•Áúã„ÄÇ</p>
<ul>
<li>
<p><em><strong>SPP</strong></em></p>
<p>SPPËÆ∞ÂΩïÁöÑÊòØÂú®ËøõÂÖ•S-Mode‰πãÂâçÂ§ÑÁêÜÂô®ÁöÑÁâπÊùÉÁ∫ßÂà´Ôºå‰∏∫0Ë°®Á§∫Èô∑Èò±Ê∫êËá™Áî®Êà∑Ê®°Âºè(U-Mode)Ôºå‰∏∫1Ë°®Á§∫ÂÖ∂‰ªñÊ®°Âºè„ÄÇÂΩìÊâßË°å‰∏Ä‰∏™Èô∑Èò±Êó∂ÔºåSPP‰ºöÁî±Á°¨‰ª∂Ëá™Âä®Ê†πÊçÆÂΩìÂâçÂ§ÑÁêÜÂô®ÊâÄÂ§ÑÁöÑÁä∂ÊÄÅËá™Âä®ËÆæÁΩÆ‰∏∫0ÊàñËÄÖ1„ÄÇÂΩìÊâßË°åSRETÊåá‰ª§‰ªéÈô∑Èò±‰∏≠ËøîÂõûÊó∂ÔºåÂ¶ÇÊûúSPP‰Ωç‰∏∫0ÔºåÈÇ£‰πàÂ§ÑÁêÜÂô®Â∞Ü‰ºöËøîÂõûU-ModeÔºå‰∏∫1Âàô‰ºöËøîÂõûS-ModeÔºåÊúÄÂêéÊó†ËÆ∫Â¶Ç‰ΩïÔºåSPPÈÉΩË¢´ËÆæÁΩÆ‰∏∫0„ÄÇ</p>
</li>
<li>
<p><em><strong>SIE</strong></em></p>
<p>SIE‰ΩçÊòØS-Mode‰∏ã‰∏≠Êñ≠ÁöÑÊÄªÂºÄÂÖ≥ÔºåÂ∞±ÂÉèÊòØ‰∏Ä‰∏™ÊÄªÁîµÈó∏„ÄÇÂ¶ÇÊûúSIE‰ΩçÁΩÆ‰∏∫0ÔºåÈÇ£‰πàÊó†ËÆ∫Âú®S-Mode‰∏ãÂèëÁîü‰ªÄ‰πà‰∏≠Êñ≠ÔºåÂ§ÑÁêÜÂô®ÈÉΩ‰∏ç‰ºöÂìçÂ∫î„ÄÇ‰ΩÜÊòØÂ¶ÇÊûúÂΩìÂâçÂ§ÑÁêÜÂô®ËøêË°åÂú®U-ModeÔºåÈÇ£‰πàËøô‰∏Ä‰Ωç‰∏çËÆ∫ÊòØ0ËøòÊòØ1ÔºåS-Mode‰∏ãÁöÑ‰∏≠Êñ≠ÈÉΩÊòØÈªòËÆ§ÊâìÂºÄÁöÑ„ÄÇ‰πüÂ∞±ÊòØËØ¥Âú®‰ªª‰ΩïÊó∂ÂÄôS-ModeÈÉΩÊúâÊùÉÂõ†‰∏∫Ëá™Â∑±ÁöÑ‰∏≠Êñ≠ËÄåÊä¢Âç†‰Ωç‰∫éU-Mode‰∏ãÁöÑÂ§ÑÁêÜÂô®ÔºåËøô‰∏ÄÁÇπË¶ÅÊ†ºÂ§ñÊ≥®ÊÑè„ÄÇÊÉ≥ÊÉ≥ÂÆöÊó∂Âô®‰∏≠Êñ≠ËÄåÂØºËá¥ÁöÑCPUË∞ÉÂ∫¶Ôºå‰∫ãÂÆû‰∏äËøôÁßçËÆæËÆ°ÊòØÈùûÂ∏∏ÂêàÁêÜÁöÑ„ÄÇ</p>
<blockquote>
<p><strong>ÊâÄ‰ª•SIE‰ΩçÊòØS-Mode‰∏ãÁöÑÊÄªÂºÄÂÖ≥ÔºåËÄå‰∏çÊòØ‰ªª‰ΩïÊÉÖÂÜµ‰∏ãÁöÑÊÄªÂºÄÂÖ≥ÔºåÁúüÊ≠£ÂÆåÂÖ®Ë¥üË¥£Á¶ÅÁî®ÊàñËÄÖÂêØÁî®ÁâπÂÆö‰∏≠Êñ≠ÁöÑ‰ΩçÔºåÈÉΩÂú® sie ÂØÑÂ≠òÂô®‰∏≠</strong>Ôºå‰∏ãÈù¢ÂÜçËØ¶ÁªÜËß£Èáä„ÄÇ</p>
</blockquote>
</li>
<li>
<p><em><strong>SPIE</strong></em></p>
<p>SPIE‰ΩçËÆ∞ÂΩïÁöÑÊòØÂú®ËøõÂÖ•S-Mode‰πãÂâçS-Mode‰∏≠Êñ≠ÊòØÂê¶ÂºÄÂêØ„ÄÇÂΩìËøõÂÖ•Èô∑Èò±Êó∂ÔºåÁ°¨‰ª∂‰ºöËá™Âä®Â∞ÜSIE‰ΩçÊîæÁΩÆÂà∞SPIE‰Ωç‰∏äÔºåÁõ∏ÂΩì‰∫éËµ∑Âà∞‰∫ÜËÆ∞ÂΩïÂéüÂÖàSIEÂÄºÁöÑ‰ΩúÁî®ÔºåÂπ∂ÊúÄÂêéÂ∞ÜSIEÁΩÆ‰∏∫0ÔºåË°®ÊòéÁ°¨‰ª∂‰∏çÂ∏åÊúõÂú®Â§ÑÁêÜ‰∏Ä‰∏™Èô∑Èò±ÁöÑÂêåÊó∂Ë¢´ÂÖ∂‰ªñ‰∏≠Êñ≠ÊâÄÊâìÊâ∞Ôºå‰πüÂ∞±ÊòØ‰ªéÁ°¨‰ª∂ÁöÑÂÆûÁé∞ÈÄªËæë‰∏äÊù•ËØ¥‰∏çÊîØÊåÅÂµåÂ•ó‰∏≠Êñ≠(Âç≥‰æøÂ¶ÇÊ≠§ÔºåÊàë‰ª¨ËøòÊòØÂèØ‰ª•ÊâãÂä®ÊâìÂºÄSIE‰Ωç‰ª•ÊîØÊåÅÂµåÂ•ó‰∏≠Êñ≠)„ÄÇÂΩì‰ΩøÁî®SRETÊåá‰ª§‰ªéS-ModeËøîÂõûÊó∂ÔºåSPIEÁöÑÂÄº‰ºöÈáçÊñ∞ÊîæÁΩÆÂà∞SIE‰Ωç‰∏äÊù•ÊÅ¢Â§çÂéüÂÖàÁöÑÂÄºÔºåÂπ∂‰∏îÂ∞ÜSPIEÁöÑÂÄºÁΩÆ‰∏∫1„ÄÇ</p>
</li>
</ul>
<p>ÂÖ≥‰∫éRISC-V‰∏≠‰Ωç‰∫é‰∏çÂêåÁâπÊùÉÊ®°Âºè‰∏ãÁöÑÂìçÂ∫îÈóÆÈ¢òÔºåÊ†áÂáÜ‰∏≠ÊúâËøõ‰∏ÄÊ≠•ÁöÑËØ¥ÊòéÔºö</p>
<p>ÂΩì‰∏Ä‰∏™Â§ÑÁêÜÂô®Âú®ÁâπÊùÉÊ®°Âºè <code>x(x = U/S/M)</code> ËøêË°åÊó∂ÔºåxIE ÊéßÂà∂ÁùÄÂØπÂ∫îÊ®°Âºè‰∏ãÁöÑ‰∏≠Êñ≠ÊÄªÂºÄÂÖ≥„ÄÇ**ÂØπ‰∫éÊõ¥‰Ωé‰ºòÂÖàÁ∫ßÁöÑ‰∏≠Êñ≠Êù•ËØ¥ÔºåÊòØÈªòËÆ§ÂÖ®ÈÉ®Á¶ÅÁî®ÁöÑÔºåËÄåÂØπ‰∫éÊõ¥È´ò‰ºòÂÖàÁ∫ßÁöÑ‰∏≠Êñ≠Êù•ËØ¥ÊòØÈªòËÆ§ÂÖ®ÈÉ®ÊâìÂºÄÁöÑ„ÄÇ**ËøôÊÑèÂë≥ÁùÄÂú®‰ªª‰ΩïÊó∂ÂÄôÈ´ò‰ºòÂÖàÁ∫ßÈÉΩÊã•ÊúâÁùÄÂØπÂ§ÑÁêÜÂô®ÁöÑÊä¢Âç†ÊùÉÔºåËÄå‰Ωé‰ºòÂÖàÁ∫ßÂàôË¢´Âº∫Ë°åÂâ•Â§∫ÊâìÊñ≠È´ò‰ºòÂÖàÁ∫ßÁöÑÊùÉÂäõ„ÄÇ</p>
<p>ÈÇ£‰πàÁî®Êà∑ÈöæÈÅìÂØπËøôÁßçÊú∫Âà∂Êó†ËÉΩ‰∏∫ÂäõÔºåÂè™ËÉΩ‰ªªÂá≠È´ò‰ºòÂÖàÁ∫ßÈöèÊÑèÊâìÊñ≠‰Ωé‰ºòÂÖàÁ∫ßÊ®°ÂºèÂêóÔºüÂÖ∂ÂÆû‰πü‰∏çÊòØÔºåÊ†áÂáÜ‰∏äËØ¥ÂèØ‰ª•ÈÄöËøáÁ¶ÅÁî®ÊüêÁßçÁâπÂÆöÁöÑ‰∏≠Êñ≠Ôºå‰ΩøÂæóÂØπÂ∫îÁöÑ‰∏≠Êñ≠ÂèëÁîüÊó∂Ôºå‰Ωé‰ºòÂÖàÁ∫ßÁöÑËøêË°å‰∏çÂèóÂΩ±ÂìçÔºåËøôÊòØÈÄöËøáËÆæÁΩÆ <code>mie/sie</code> ÂØÑÂ≠òÂô®ÂÆûÁé∞ÁöÑ„ÄÇ(Higher-privilege-level code can use separate per-interrupt enable bits to disable selected higher-privilege-mode interrupts before ceding control to a lower-privilege mode.)</p>
<p>Âè¶Â§ñÔºåRISC-VÂú®Á°¨‰ª∂Â±ÇÈù¢‰∏äÊù•ËØ¥‰∏çÊîØÊåÅÈô∑Èò±ÁöÑÂµåÂ•óÔºåÁ°¨‰ª∂Âè™ÂÅáËÆæÊúÄÁêÜÊÉ≥ÁöÑÊÉÖÂÜµÔºåÂç≥Ôºö<strong>ÂèëÁîüÈô∑Èò±-&gt;Â§ÑÁêÜÂÆÉ(Âú®Ê≠§ÊúüÈó¥ÂÆåÂÖ®‰∏çÂèëÁîüÂÖ∂‰ªñÈô∑Èò±)-&gt;ÊÅ¢Â§çÂà∞ÂéüÂÖàÁä∂ÊÄÅ„ÄÇ</strong></p>
<h3 id="stvec">stvec
</h3><p><code>stvec</code> ÂØÑÂ≠òÂô®ÁöÑÂÖ®Áß∞ÊòØ supervisor trap vector base address register(SÊÄÅÈô∑Èò±ÂêëÈáèÂü∫ÂùÄÂØÑÂ≠òÂô®Ôºåstvec)ÔºåÂÆÉÁöÑÁ§∫ÊÑèÂõæÂ¶Ç‰∏ãÔºö</p>
<p><img src="/p/riscv-trap-handle/index.assets/stvec.png"
	width="1425"
	height="129"
	srcset="/p/riscv-trap-handle/index.assets/stvec_hu1535761407666972822.png 480w, /p/riscv-trap-handle/index.assets/stvec_hu7631526643785473951.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="1104"
		data-flex-basis="2651px"
	
></p>
<p>ÂèØ‰ª•ÁúãÂà∞stvecÂØÑÂ≠òÂô®ÂàÜ‰∏∫‰∏§‰∏™ÂüüÔºåÂàÜÂà´ÊòØBASEÂüüÂíåMODEÂüüÔºö</p>
<ul>
<li>
<p><em><strong>MODE Âüü</strong></em></p>
<p>Âú®RISC-VÊ†áÂáÜÁöÑÂÆö‰πâ‰∏≠ÔºåMODEÂüüÂèØËÉΩÁöÑÂèñÂÄºÊúâÂ¶Ç‰∏ã‰∏âÁßçÔºö„ÄÅ</p>
<p><img src="/p/riscv-trap-handle/index.assets/stvec_MODE.png"
	width="930"
	height="261"
	srcset="/p/riscv-trap-handle/index.assets/stvec_MODE_hu267191434450890305.png 480w, /p/riscv-trap-handle/index.assets/stvec_MODE_hu15890301224537916771.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="356"
		data-flex-basis="855px"
	
></p>
<p>ÂèØ‰ª•ÁúãÂà∞ÔºåMODE ÂüüÁöÑÂèñÂÄºÂΩ±Âìç‰∫ÜÂèëÁîüÈô∑Èò±Êó∂Ë¶ÅË∑≥ËΩ¨Âà∞ÁöÑÂú∞ÂùÄ„ÄÇ‰πãÂâçÊàë‰ª¨‰∏∫‰∫ÜÊèèËø∞ÁöÑÊñπ‰æøÔºå‰∏ÄËà¨ÁÆÄÂçïÂú∞ËØ¥ <code>stvec</code> ‰∏≠Â≠òÊîæÁùÄ‰∏≠Êñ≠Â§ÑÁêÜÁ®ãÂ∫èÁöÑÂú∞ÂùÄÔºåÂèëÁîüÈô∑Èò±Êó∂‰ºöÁõ¥Êé•Ë∑≥ËΩ¨Âà∞„ÄÇ‰ΩÜÂÖ∂ÂÆû <code>stvec</code> ÂØÑÂ≠òÂô®‰∏≠‰∏ç‰ªÖ‰ªÖÊòØ‰∏≠Êñ≠Â§ÑÁêÜÁ®ãÂ∫èÁöÑÂú∞ÂùÄÔºåËøòÂ≠òÊîæÁùÄ MODE ÂüüÁöÑÂÄº„ÄÇ</p>
<blockquote>
<ul>
<li>ÂΩìBASEÂüü‰∏∫0Êó∂ÔºåÊâÄÊúâÁöÑÈô∑Èò±ÂÖ®ÈÉ®Ë∑≥ËΩ¨Âà∞BASEÂú∞ÂùÄÊåáÂêëÁöÑÁ®ãÂ∫èÂÖ•Âè£Ôºõ</li>
<li>ÂΩìBASEÂüü‰∏∫1Êó∂ÔºåÂêåÊ≠•Èô∑Èò± (ÊåáÂõ†‰∏∫Êåá‰ª§ËÄåÂºïËµ∑ÁöÑÂºÇÂ∏∏) ËøòÊòØ‰ºöË∑≥ËΩ¨Âà∞BASEÂú∞ÂùÄÂ§ÑÔºåËÄåÈùûÂêåÊ≠•Èô∑Èò± (ÊåáÁî±Â§ñÈÉ®‰ø°Âè∑ÂºïËµ∑ÁöÑ‰∏≠Êñ≠) Âàô‰ºöË∑≥ËΩ¨Âà∞ <code>BASE + 4*cause</code> ÁöÑÂú∞ÊñπÔºåËøôÈáåÊâãÂÜå‰∏ä‰∏æ‰∫Ü‰∏Ä‰∏™‰æãÂ≠êÔºöÂ¶ÇÊûúÊàë‰ª¨Â∞ÜMODEËÆæÁΩÆ‰∏∫Vectored Áä∂ÊÄÅÔºåÂêåÊó∂Ëß¶Âèë‰∫Ü‰∏Ä‰∏™ S-Mode ÂÆöÊó∂Âô®‰∏≠Êñ≠ (‰∏≠Êñ≠Âè∑‰∏∫5)ÔºåÂàôÁ®ãÂ∫è‰ºöË∑≥ËΩ¨Âà∞ <code>BASE + 4*5 = BASE + 0x14</code> ÁöÑ‰ΩçÁΩÆ„ÄÇ</li>
</ul>
</blockquote>
</li>
<li>
<p><em><strong>BASE Âüü</strong></em></p>
<p>BASEÂüüÂ≠òÊîæÁùÄ‰∏Ä‰∏™Âü∫Âú∞ÂùÄÔºåÂú® Direct/Vectored Ê®°Âºè‰∏ãÁöÑÂêåÊ≠•Èô∑Èò±ÊÉÖÂÜµ‰∏ãÔºåÂÆÉÈÉΩÊåáÂêë‰∏≠Êñ≠Â§ÑÁêÜÁ®ãÂ∫èÁöÑÂú∞ÂùÄ (ËøôÈáåÁöÑÂú∞ÂùÄÂèØ‰ª•ÊòØËôöÊãüÂú∞ÂùÄÔºå‰πüÂèØ‰ª•ÊòØÁâ©ÁêÜÂú∞ÂùÄ)„ÄÇ</p>
<p>Âú®VectoredÊ®°ÂºèÁöÑÈùûÂêåÊ≠•Èô∑Èò±ÁöÑÊÉÖÂÜµ‰∏ãÔºåÊØîÂ¶ÇÁî±Â§ñÈÉ®‰∏≠Êñ≠ÂºïËµ∑ÁöÑÈô∑Èò±Êó∂ÔºåÂÆÉÊòØ‰∏≠Êñ≠ÊúçÂä°Á®ãÂ∫èÁöÑÂü∫ÂùÄÔºåÂä†‰∏ä‰∏Ä‰∏™ÁâπÂÆöÂÅèÁßªÈáè‰πãÂêéÊâçÂèØ‰ª•ÂØπÂ∫îÂà∞ÂØπÂ∫îÁöÑ‰∏≠Êñ≠Â§ÑÁêÜÁ®ãÂ∫è„ÄÇ</p>
<p>Âè¶Â§ñÔºåBASEÂüüÊúâÈ¢ùÂ§ñÁöÑÈôêÂà∂Âõ†Á¥†ÔºåÂÆÉÂøÖÈ°ªÊòØ 4 Â≠óËäÇÂØπÈΩêÁöÑ (4-byte aligned)„ÄÇÂÜÖÊ†∏ÂÆûÁé∞Êó∂Ôºå‰ª£Á†Å‰∏≠ÈúÄË¶ÅÊ∑ªÂä†Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="p">.</span><span class="n">align</span> <span class="mi">4</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøôÊòØ‰∏∫‰∫ÜËÆ©‰ª£Á†ÅÊñá‰ª∂ÊåâÁÖß4Â≠óËäÇÂØπÈΩêÔºå‰ªéËÄåÊª°Ë∂≥‰∫Ü <code>stvec</code> ÂØÑÂ≠òÂô®ÁöÑÂÜôÂÖ•ÈúÄÊ±Ç„ÄÇ</p>
</li>
</ul>
<h3 id="sipsie">sip/sie
</h3><p><code>sip/sie</code> Ëøô‰∏§‰∏™ÂØÑÂ≠òÂô®‰∏é‰∏≠Êñ≠ÁöÑÂ§ÑÁêÜÂØÜÂàáÁõ∏ÂÖ≥ÔºåÂú®ÊâãÂÜåÂØπÂ∫îÁöÑÈÉ®ÂàÜ‰∏ç‰ªÖÊúâÂÖ≥‰∫éËøô‰∏§‰∏™ÂØÑÂ≠òÂô®ÁöÑËØ¥Êòé„ÄÇËÄå‰∏îËøòÊúâÂ§ßÈáèÊúâÂÖ≥‰∏≠Êñ≠Êú∫Âà∂ÁöÑÁªÜËäÇÊèèËø∞ÔºåÊé•‰∏ãÊù•ÁöÑÂêÑ‰∏™Â∞èÊÆµÈÉΩÊòØ‰ªéRISC-VÊ†áÂáÜ‰∏≠ÈòÖËØªÂæóÂà∞ÁöÑÊÄªÁªìÔºåÂú®Ê≠§ÂÅö‰∏Ä‰∏™ËØ¶ÁªÜËÆ∞ÂΩï„ÄÇ</p>
<p><code>sip/sie</code> ÈÉΩÊòØÂ§ÑÁêÜÂô®‰∏é‰∏≠Êñ≠ÊúâÂÖ≥ÁöÑÂØÑÂ≠òÂô®ÔºåÂÆÉ‰ª¨ÂêàÁß∞ (Supervisor Interrupt RegistersÔºåS-Mode ‰∏≠Êñ≠ÂØÑÂ≠òÂô®)Ôºå<code>sip</code> ‰∏ìÈó®Áî®Êù•ËÆ∞ËΩΩÊåÇËµ∑ÁöÑ‰∏≠Êñ≠‰ΩçÔºå<code>sie</code> ‰∏ìÈó®Áî®Êù•ËÆ∞ËΩΩ‰ΩøËÉΩÁöÑ‰∏≠Êñ≠‰ΩçÔºåÂÆÉ‰ª¨ÁöÑÁ§∫ÊÑèÂõæÂ¶Ç‰∏ãÔºö</p>
<p><img src="/p/riscv-trap-handle/index.assets/sip_sie_rv64.png"
	width="1157"
	height="466"
	srcset="/p/riscv-trap-handle/index.assets/sip_sie_rv64_hu6525830594911747185.png 480w, /p/riscv-trap-handle/index.assets/sip_sie_rv64_hu13894340745190693765.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="248"
		data-flex-basis="595px"
	
></p>
<p>Âú®RV-64Ê†áÂáÜ‰∏≠ÔºåËøô‰∏§‰∏™ÂØÑÂ≠òÂô®ÈÉΩÊòØ64‰ΩçÂ§ßÂ∞èÁöÑ„ÄÇ Ê†áÂáÜ‰∏≠Êñ≠Âè™Âç†ÊçÆ‰∫ÜËøô‰∏§‰∏™ÂØÑÂ≠òÂô®ÁöÑ‰Ωé16‰Ωç(15:0)ÔºåÊõ¥È´òÁöÑ‰ΩçÈÉΩË¢´‰øùÂ≠ò‰∏ãÊù•‰ª•‰Ωú‰∏∫Êâ©Â±ïÁî®ÈÄî„ÄÇÂíå <code>medeleg/mideleg</code> ÂØÑÂ≠òÂô®ÁöÑÁî®Ê≥ïÂ∑Æ‰∏çÂ§öÔºå<strong>Â∞Ü‰∏≠Êñ≠Âè∑ÂØπÂ∫îÁöÑ‰ΩçÂú®Ëøô‰∏§‰∏™ÂØÑÂ≠òÂô®‰∏≠ÁΩÆ‰Ωç</strong>Âç≥ÂèØÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="/p/riscv-trap-handle/index.assets/sip_sie_15_0.png"
	width="627"
	height="299"
	srcset="/p/riscv-trap-handle/index.assets/sip_sie_15_0_hu17214122920619431732.png 480w, /p/riscv-trap-handle/index.assets/sip_sie_15_0_hu1846709259102548870.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="209"
		data-flex-basis="503px"
	
></p>
<p>Â¶ÇÊûúÊàë‰ª¨ÊÉ≥<strong>Ëß¶Âèë‰∏Ä‰∏™ S-Mode ‰∏ãÁöÑËΩØ‰ª∂‰∏≠Êñ≠ÔºåÂõ†‰∏∫ÂÆÉÁöÑÂºÇÂ∏∏ÁºñÂè∑ÊòØ1ÔºåÂàôÂè™ÈúÄË¶ÅÂú®sip‰∏≠Â∞ÜÁ¨¨ 1 ‰ΩçËÆæÁΩÆ‰∏∫ 1 Âç≥ÂèØÔºå</strong><code>sie</code> ÂØÑÂ≠òÂô®ÁöÑ‰ΩøÁî®ÊñπÊ≥ï‰πüÊòØ‰∏ÄÊ†∑ÁöÑÔºåÂÆÉË°®Á§∫ÁöÑÊòØÂØπÂ∫îÁºñÂè∑ÁöÑ‰∏≠Êñ≠ÊòØÂê¶‰ΩøËÉΩ„ÄÇ</p>
<h4 id="‰∏≠Êñ≠Ë¢´ÂëàÈÄíÂà∞‰ΩïÁßçÁâπÊùÉÁ∫ß‰∏ãÂ§ÑÁêÜ">‰∏≠Êñ≠Ë¢´ÂëàÈÄíÂà∞‰ΩïÁßçÁâπÊùÉÁ∫ß‰∏ãÂ§ÑÁêÜÔºü
</h4><p>ËøôÊòØ‰∏Ä‰∏™ÈùûÂ∏∏ÈáçË¶ÅÁöÑËØùÈ¢òÔºåÂú®RISC-VÂ§ÑÁêÜÂô®‰∏≠ÁöÑ‰∏âÁßçÁâπÊùÉÊ®°ÂºèÊù•ÂõûÂàáÊç¢ËÆ©‰∫∫ÁúºËä±Áº≠‰π±ÔºåËÄåÂÆÉ‰ª¨Âèà‰∏éÂØπÂ∫îÊ®°Âºè‰∏ãÁöÑ‰∏≠Êñ≠Á¥ßÂØÜËÅîÁ≥ªÂú®‰∏ÄËµ∑ÔºåÂÜçÂä†‰∏äÊàë‰ª¨‰∏äÈù¢ËØ¥ÁöÑÈô∑Èò±ÂßîÊâòÊú∫Âà∂ÔºåËÆ©Êï¥‰∏™RISC-VÊû∂ÊûÑÁöÑÈô∑Èò±‰∏éÁâπÊùÉÊ®°ÂºèÂØπÂ∫îÂÖ≥Á≥ªÈùûÂ∏∏Ê∑∑‰π±„ÄÇÂπ∏Â•ΩÔºåRISC-VÊ†áÂáÜ‰∏≠ÊòéÁ°ÆËØ¥Êòé‰∫Ü‰∏≠Êñ≠Â∫îËØ•Ë¢´ÊîæÂú®Âì™ÁßçÁâπÊùÉÊ®°Âºè‰∏ãÂ§ÑÁêÜÁöÑÂØπÂ∫îÂéüÂàôÔºö</p>
<ul>
<li><strong>ÂΩì‰∏ãËø∞Êù°‰ª∂ÂÖ®ÈÉ®Êª°Ë∂≥Êó∂Ôºå‰∏≠Êñ≠‰∏ÄÂÆöË¶ÅÂú®M-Mode‰∏ãÂ§ÑÁêÜÔºö</strong>
<ul>
<li>ÂΩìÂâçÁâπÊùÉÁ∫ßÂà´a‰∏∫ M-Mode ‰∏î mstatus‰∏≠ÁöÑ MIE ÊâìÂºÄÔºåÊàñÂΩìÂâçÁâπÊùÉÁ∫ßÂà´‰Ωé‰∫é M-Mode<font color='red'>Ôºà‰∏≠Êñ≠ÊÄªÂºÄÂÖ≥ÊâìÂºÄÔºâ</font></li>
<li><code>mip/mie</code> ‰∏≠ÁöÑÁ¨¨ i ‰ΩçÈÉΩË¢´ËÆæÁΩÆ‰∏∫ 1 <font color='red'>(Ë°®Êòé‰∏≠Êñ≠ÂæÖÂ§ÑÁêÜ‰∏î‰ΩøËÉΩ‰ΩçÊâìÂºÄ) </font></li>
<li><code>mideleg</code> ÂØÑÂ≠òÂô®Â≠òÂú®Ôºå‰∏îÁ¨¨ i ‰ΩçÊ≤°ÊúâË¢´ËÆæÁΩÆ <font color='red'>Ôºà‰∏≠Êñ≠Ê≤°ÊúâÂßîÊâòÁªôS ModeÔºâ</font></li>
</ul>
</li>
</ul>
<p>ÊâÄ‰ª•ÔºåÂ¶ÇÊûúÂÜÖÊ†∏‰ΩøÁî®‰∫ÜÈô∑Èò±ÂßîÊâòÊú∫Âà∂ÔºåËøôÈáåÂΩªÂ∫ïÂ∞ÜÂ§ñÈÉ®‰∏≠Êñ≠ÁöÑÁ¨¨‰∏â‰∏™Êù°‰ª∂Á†¥Âùè‰∫Ü„ÄÇ</p>
<ul>
<li><strong>ÂΩì‰∏ãËø∞Êù°‰ª∂ÂêåÊó∂Êª°Ë∂≥Êó∂Ôºå‰∏≠Êñ≠‰∏ÄÂÆöË¶ÅÂú®S-Mode‰∏ãÂ§ÑÁêÜÔºö</strong>
<ul>
<li>ÂΩìÂâçÁâπÊùÉÁ∫ßÂà´‰∏∫S-Mode‰∏îsstatus‰∏≠ÁöÑSIEÊâìÂºÄÔºåÊàñÂΩìÂâçÁâπÊùÉÁ∫ßÂà´‰Ωé‰∫éS-Mode <font color='red'>(‰∏≠Êñ≠ÊÄªÂºÄÂÖ≥ÊâìÂºÄ)</font></li>
<li><code>sip/sie</code> ‰∏≠ÁöÑÁ¨¨ i ‰ΩçÈÉΩË¢´ËÆæÁΩÆ‰∏∫ 1 <font color='red'>(Ë°®Êòé‰∏≠Êñ≠ÂæÖÂ§ÑÁêÜ‰∏î‰ΩøËÉΩ‰ΩçÊâìÂºÄ)</font></li>
</ul>
</li>
</ul>
<h4 id="ÂìçÂ∫î‰∏≠Êñ≠ÁöÑÊó∂Êú∫">ÂìçÂ∫î‰∏≠Êñ≠ÁöÑÊó∂Êú∫
</h4><p>Âú®RISC-VÊ†áÂáÜ‰∏≠ÊúâÂÖ≥sipÂíåsieÂØÑÂ≠òÂô®ÁöÑ‰ªãÁªç‰∏≠ÔºåÊâãÂÜå‰∏≠ÊúâËøôÊ†∑‰∏ÄÊÆµËØùÔºö</p>
<blockquote>
<p>These conditions for an interrupt trap to occur must be evaluated in a bounded amount of time
from when an interrupt becomes, or ceases to be, pending in sip, and must also be evaluated
immediately following the execution of an SRET instruction or an explicit write to a CSR on which
these interrupt trap conditions expressly depend (including sip, sie and sstatus).</p>
</blockquote>
<p>ËØëÔºöËøô‰∫õ‰∏≠Êñ≠Èô∑Èò±ÂèëÁîüÁöÑÊù°‰ª∂(Êåá‰∏äËø∞5.1ËäÇ‰∏≠ÁöÑÊù°‰ª∂)ÔºåÂøÖÈ°ªÂú®‰∏Ä‰∏™‰∏≠Êñ≠Âú®sip‰∏≠Ë¢´ÁΩÆ‰ΩçÊàñÊ∏ÖÈô§ÂêéÁöÑ‰∏ÄÊÆµÊó∂Èó¥ÂÜÖÂæóÂà∞Ê£ÄÊµã„ÄÇ Âπ∂‰∏îÂú®Á¥ßË∑üÁùÄSRETÊåá‰ª§‰πãÂêéÔºåÊàñÂØπCSRÂØÑÂ≠òÂô®‰∏≠‰∏é‰∏≠Êñ≠Èô∑Èò±Êù°‰ª∂ÊúâÂÖ≥ÁöÑÂØÑÂ≠òÂô®(ÂåÖÊã¨sie„ÄÅsip„ÄÅsstatus)ËøõË°å<strong>ÊòæÂºèÂÜôÂÖ•‰πãÂêéÁ´ãÂç≥Ê£ÄÊµã„ÄÇ</strong></p>
<p>ËøôÂ∞±ÊòØÊ†áÂáÜ‰∏≠ÊúâÂÖ≥<strong>‰∏≠Êñ≠Ê£ÄÊµãÊó∂Êú∫</strong>ÁöÑÊèèËø∞ÔºåÂÖ∑‰ΩìÁöÑÂÆûÁé∞ÂèØËÉΩÂíåËäØÁâáÁöÑÂæÆ‰ΩìÁ≥ªÁªìÊûÑÊúâÂÖ≥Ôºå‰ΩÜÁé∞Âú®Êàë‰ª¨ÂèØ‰ª•ÂÅáÂÆöÂú®‰∏äËø∞Âä®‰ΩúÂÆåÊàê‰πãÂêéÔºåÂ∞±‰ºöËøõÂÖ•‰∏≠Êñ≠ÁöÑÊù°‰ª∂Ê£ÄÊµãÔºåËÄå‰∏ÄÊó¶Êù°‰ª∂Êª°Ë∂≥Â∞±ÂºÄÂßãÂìçÂ∫î‰∏≠Êñ≠„ÄÇ</p>
<h4 id="Â§ñÈÉ®‰∏≠Êñ≠claimcompleteÊú∫Âà∂">Â§ñÈÉ®‰∏≠Êñ≠„ÄÅclaim/completeÊú∫Âà∂
</h4><p><code>sip</code> ÂØÑÂ≠òÂô®‰∏≠ÁöÑÊØè‰∏Ä‰ΩçÂú®ÂÆûÁé∞Êó∂ÔºåÂèØ‰ª•ÊòØÂèØËØªÂèØÂÜôÁöÑÔºå‰πüÂèØ‰ª•ÊòØÂè™ËØªÁöÑÔºå‰πüÂ∞±ÊòØËØ¥ËøôÈáåRISC-VÊ†áÂáÜÂπ∂Ê≤°ÊúâÂØπ <code>sip</code> ÂØÑÂ≠òÂô®ÁöÑËØªÂÜôÊÄßÂä†‰ª•‰∏•Ê†ºÁöÑÁ∫¶Êùü„ÄÇ‰ΩÜÊòØÂêéÈù¢Ê†áÂáÜ‰∏≠ÊèêÂà∞ÔºåÂ¶ÇÊûú <code>sip</code> ÂØÑÂ≠òÂô®‰∏≠ÁöÑ‰ΩçÂèØÂÜôÔºåÈÇ£‰πàÊ∏ÖÈô§Êüê‰∏™ÁâπÂÆö‰∏≠Êñ≠ÁöÑÊìç‰ΩúÂ∞±ÊòØÂêëÂÆÉÁöÑÂØπÂ∫î‰ΩçÂÜôÂÖ• 0 Âç≥ÂèØ„ÄÇ‰ΩÜÂ¶ÇÊûú <code>sip</code> ÂØÑÂ≠òÂô®ÊòØÂè™ËØªÁöÑÔºåÈÇ£‰πàÂøÖÈ°ªÊèê‰æõÂÖ∂‰ªñÊú∫Âà∂Êù•ÂÆûÁé∞ÂØπ <code>sip</code> ÂØπÂ∫î‰ΩçÁöÑÊ∏ÖÈõ∂ÔºåÂÖ∑‰ΩìÊÄé‰πàÂÆûÁé∞ÂàôË¶ÅÁúãÂæÆÂ§ÑÁêÜÂô®ÁöÑÂÖ∑‰ΩìÊûÑÊàêÂíåÂÆûÁé∞„ÄÇ**Ê≥®ÊÑèÔºåËøôÈáåÊâÄËØ¥ÁöÑÂè™ËØª (read-only) Âè™ÊòØËØ¥ÔºåÊàë‰ª¨‰∏çËÉΩÁî®Êåá‰ª§ÁöÑÂΩ¢ÂºèÂéªÊúâÊïàÂú∞Ê∏ÖÈô§ÂØπÂ∫îÁöÑpending bitÔºå‰ΩÜÁªùÈùûÊ≤°ÊúâÁ°¨‰ª∂ÁîµË∑ØËÉΩÂéªÊîπÂèòÂÆÉÔºå**Êàë‰ª¨‰∏ãÈù¢Â∞±‰ºöÁúãÂà∞ÊòØÊÄé‰πàÂÅöÁöÑ‰∫Ü„ÄÇ</p>
<p>ÂØπÂ∫îÁöÑÔºå<code>sie</code> ‰Ωú‰∏∫ <code>sip</code> ÂØπÂ∫îÁöÑ‰ΩøËÉΩ‰ΩçÔºåÂ¶ÇÊûú‰∏Ä‰∏™‰∏≠Êñ≠ÂèØ‰ª•Ë¢´ÊåÇËµ∑ÔºåÈÇ£‰πàÂÆÉÂØπÂ∫îÁöÑ <code>sie</code> ‰Ωç‰∏ÄÂÆöÊòØÂèØÂÜôÁöÑ„ÄÇ‰ΩÜÂ¶ÇÊûúÂØπÂ∫îÁöÑ‰ΩçÂú® <code>sip</code> ‰∏≠Ê≤°ÊúâÂØπÂ∫îÔºåÈÇ£‰πà <code>sie</code> ÂØπÂ∫îÁöÑ‰ΩçÂ∞±‰∏çËÉΩÂÜôÂÖ•ÔºåËÄåÊòØÂè™ËØªÁöÑ 0 (read-only zero)„ÄÇ</p>
<p>‰∏äËø∞ÂØÑÂ≠òÂô®‰∏≠Ë¥üË¥£ÊéßÂà∂Â§ñÈÉ®‰∏≠Êñ≠ÁöÑ‰ΩçÊúâ <code>sip.SEIP/sie.SEIE</code> Ëøô‰∏§‰∏™‰ΩçÔºåÂú®‰∏ÄËà¨ÁöÑÂ§ÑÁêÜÂô®‰∏≠ <code>sip.SEIP</code> Â∞±‰ºöË¢´ÂÆûÁé∞‰∏∫Âè™ËØªÁöÑ (read-only)ÔºåÂÆÉÁöÑÊ∏ÖÈô§‰∏éÁΩÆ‰ΩçÊìç‰Ωú‰∏ÄËà¨‰ºöÁõ¥Êé•‰∫§ÁªôÁâπÂÆöÂπ≥Âè∞ÁöÑ‰∏≠Êñ≠ÊéßÂà∂Âô®Êù•ÂÅö„ÄÇÂú® SiFive Unleashed ÂºÄÂèëÊùø‰∏äÔºåÂ§ÑÁêÜÂ§ñÈÉ®‰∏≠Êñ≠ÁöÑÂ∞±ÊòØ PLIC Ëøô‰∏™Ë¥üË¥£ÁÆ°ÁêÜÂÖ®Â±ÄÂ§ñÈÉ®‰∏≠Êñ≠ÁöÑ IP Ê†∏„ÄÇCPUÊ†∏ÂøÉÂè™ÈúÄË¶ÅÂØπ <code>sip.SEIP</code> ËøõË°åËØªÂèñÂç≥ÂèØÁü•ÈÅìÊòØÂê¶ÊúâÂ§ñÈÉ®‰∏≠Êñ≠ÊåÇËµ∑„ÄÇ</p>
<p>ËøôÈáåÊàë‰ª¨Áõ¥Êé•È°∫ÂäøÂØπ PLIC Âíå‰∏≠Êñ≠Â§ÑÁêÜÊµÅÁ®ãÂÅöÂá∫Âª∂‰º∏ÔºåÊâìÂºÄ SiFive ÁöÑÂºÄÂèëÊùøÊâãÂÜåÔºåÊâæÂà∞ÂÖ≥‰∫é Interrupts ‰∏ÄÁ´†ÁöÑÊ¶ÇËø∞„ÄÇÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞Ëøô‰∏ÄÁ´†ÁöÑÂºÄÂ§¥Â∞±ÂØπÂºÄÂèëÊùøÁöÑ PLIC ÂÅöÂá∫‰∫ÜÊèèËø∞Ôºö</p>
<blockquote>
<p>Global interrupts, by contrast, are routed through a Platform-Level Interrupt Controller (PLIC),
which can direct interrupts to any hart in the system via the external interrupt. Decoupling global
interrupts from the hart(s) allows the design of the PLIC to be tailored to the platform, permitting
a broad range of attributes like the number of interrupts and the prioritization and routing
schemes.</p>
</blockquote>
<p>(ËØëÔºöÁõ∏ÊØî‰πã‰∏ãÔºåÂÖ®Â±Ä‰∏≠Êñ≠ÈÄöËøáÂπ≥Âè∞Á∫ß‰∏≠Êñ≠ÊéßÂà∂Âô®(PLIC)ËøõË°åË∑ØÁî±ÔºåPLICÂèØ‰ª•ÈÄöËøáÂ§ñÈÉ®‰∏≠Êñ≠Â∞Ü‰∏≠Êñ≠ÂºïÂØºÂà∞Á≥ªÁªü‰∏≠ÁöÑ‰ªª‰Ωïhart„ÄÇÂ∞ÜÂÖ®Â±Ä‰∏≠Êñ≠‰∏éhartËß£ËÄ¶ÔºåÂèØ‰ª•Ê†πÊçÆÂπ≥Âè∞ÂÆöÂà∂PLICÁöÑËÆæËÆ°ÔºåÂÖÅËÆ∏ÂπøÊ≥õÁöÑÂ±ûÊÄßÔºåÂ¶Ç‰∏≠Êñ≠Êï∞Èáè„ÄÅ‰ºòÂÖàÁ∫ßÂíåË∑ØÁî±ÊñπÊ°à)„ÄÇ</p>
<p>ÊâÄ‰ª•ÂÖ∂ÂÆû PLIC ËøôÊ†∑ÁöÑ‰∏≠Êñ≠ÊéßÂà∂Âô®ÁöÑÂºïÂÖ•ÊòØ‰∏∫‰∫ÜÊõ¥Âä†ÁÅµÊ¥ªÂú∞ÂØπÂ§ñÈÉ®‰∏≠Êñ≠ËøõË°åÁÆ°ÁêÜÔºå‰ΩøÂæóÂºÄÂèëÊùøÊúâÊõ¥Â•ΩÁöÑÈÄÇÂ∫îÊÄß‰∏éÂèØË£ÅÂâ™ÊÄß„ÄÇÂ∞±ÂÉèÊú¨ÁßëÊó∂Êàë‰ª¨Â≠¶ËøáÁöÑÂæÆÊú∫ÂéüÁêÜÔºå8059A‰πüÂ∞±ÊòØ8086ÁöÑ‰∏≠Êñ≠ÊéßÂà∂Âô®‰∏ÄÊ†∑ÔºåÂèØ‰ª•ÂØπÂ§ñÈÉ®‰∏≠Êñ≠ËøõË°åÊõ¥Â•ΩÁöÑÁÆ°ÁêÜÔºåÂú®Êàë‰ª¨ÁöÑSiFive ÂºÄÂèëÊùø‰∏ä‰∏ÄÂÖ±ÊîØÊåÅ53‰∏™13Â§ßÁ±ªÂ§ñÈÉ®ËÆæÂ§á‰∏≠Êñ≠ÔºåÂÆÉ‰ª¨È¢ÑÁïôÁöÑIDËåÉÂõ¥Â¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇËøô‰πàÂ§öÁöÑ‰∏≠Êñ≠ÂÖ∂ÂÆûÈÉΩÂ±û‰∫éÂ§ñÈÉ®‰∏≠Êñ≠Ôºå‰ΩÜÊòØÂÆÉ‰ª¨Âú®RISC-VÁöÑCPU‰∏≠ÂÖ∂ÂÆûÂè™Êúâ‰∏Ä‰∏™ <code>sip.SEIP/sie.SEIE</code> ‰∏§‰∏™‰ΩçÂØπÂ∫î„ÄÇÊâÄ‰ª•ÔºåÊàë‰ª¨‰πü‰∏çÂæó‰∏çÁî®‰∏Ä‰∏™Âº∫Â§ßÁöÑPLICÊ†∏ÂøÉÂéªÁªÜÂåñÂíå‰∏∞ÂØåÂØπÂ§ñÈÉ®ËÆæÂ§á‰∏≠Êñ≠ÁöÑÁÆ°ÁêÜËøáÁ®ã„ÄÇ</p>
<p><img src="/p/riscv-trap-handle/index.assets/SiFive_PLIC_ID.png"
	width="329"
	height="438"
	srcset="/p/riscv-trap-handle/index.assets/SiFive_PLIC_ID_hu18280465315752992734.png 480w, /p/riscv-trap-handle/index.assets/SiFive_PLIC_ID_hu12919317365251778579.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="75"
		data-flex-basis="180px"
	
></p>
<p>Âú®Êõ¥Âä†Ê∑±ÂÖ•Âú∞ÂØπ‰∏≠Êñ≠ËøõË°å‰ªãÁªç‰πãÂâçÔºåÊàë‰ª¨ËøòË¶ÅÂØπPLICÁöÑ <strong>claim/completion Êú∫Âà∂</strong>ËøõË°åËß£Èáä„ÄÇËÆ©Êàë‰ª¨ÂõûÈ°æ‰∏Ä‰∏ãPLIC‰∏éRISC-VÊ†∏ÂøÉ‰πãÈó¥ÁöÑËøûÊé•ÂÖ≥Á≥ªÔºå‰∏Ä‰∏™PLICÊú¨Ë¥®‰∏äËøûÊé•‰∫ÜÂ§ö‰∏™RISC-VÊ†∏ÂøÉ„ÄÇÂΩì‰∏Ä‰∏™Â§ñÈÉ®ËÆæÂ§áÂèëÂá∫‰∏≠Êñ≠ËØ∑Ê±ÇÊó∂ÔºåÁªèËøáPLIC‰∏≠ÁöÑInterrupt GatewaysÁöÑ‰ø°Âè∑ËΩ¨Êç¢Á≠âÊìç‰ΩúÔºåÂÖ∂ÂÆûPLIC‰ºöÂ∞ÜËøô‰∏™‰∏≠Êñ≠ËΩ¨ÂèëÁªôÂ§ö‰∏™Ê†∏ÂøÉ(ÂâçÊèêÊòØÂØπÂ∫îÊ†∏ÂøÉ‰∏≠ <code>sie</code> ÂØÑÂ≠òÂô®‰∏≠ÂØπÂ∫î‰ΩçÊòØÊâìÂºÄÁöÑ)ÔºåËøô‰∏™Êìç‰ΩúÂè´ÂÅö interrupt notificationÔºåÊú¨Ë¥®ÊòØPLICÂ∞ÜÂØπÂ∫îÊ†∏ÂøÉ <code>sip</code> ÂØÑÂ≠òÂô®‰∏≠ÁöÑÂØπÂ∫î‰ΩçÁΩÆ‰Ωç„ÄÇ</p>
<p>Ëøô‰∏™ notification Êìç‰ΩúÂú®ÁÆÄÂçïÁ≥ªÁªüÁöÑÁ°¨‰ª∂ÂÆûÁé∞‰∏≠ÔºåÊòØÈÄöËøáÂ∞ÜPLICÊ†∏ÂøÉ‰∏≠ÁöÑ PIE ‰ΩçÁ°¨ËøûÁ∫øÂà∞ÂØπÂ∫îÁöÑ <code>sip.SEIP</code> ÂØÑÂ≠òÂô®‰ΩçÊù•ÂÆûÁé∞ÁöÑÔºåËÄåÂú®Â§çÊùÇÁöÑÁ≥ªÁªü‰∏≠ÊòØÈÄöËøáÂ§çÊùÇÁöÑÁâá‰∏äË∑ØÁî±ÁΩëÁªúÂÆûÁé∞ÁöÑ„ÄÇÂú®Â§ñÈÉ®‰∏≠Êñ≠ÂÖ®ÈÉ®Ë¢´ÂßîÊ¥æÂà∞S-ModeÁöÑÊù°‰ª∂‰∏ãÔºåÂÆÉÂè™‰ºöÂØºËá¥Â§ö‰∏™Ê†∏ÂøÉ‰∏≠ÁöÑ <code>sip.SEIP</code> ‰ΩçÁΩÆ‰Ωç (The notification only appear in lower-privilege xip registers if external interrupts have been delegated to the lower-privilege modes, quoted from PLIC doc)„ÄÇÊ†πÊçÆÊàë‰ª¨‰πãÂâçÊÄªÁªìÁöÑËß¶Âèë‰∏≠Êñ≠ÁöÑÊù°‰ª∂ÔºåÂ§ö‰∏™Ê†∏ÂøÉÊàñÊó©ÊàñÊôö‰ºöËøô‰∏™ÂØπÊåÇËµ∑ÁöÑ‰∏≠Êñ≠ËøõË°åÂìçÂ∫î„ÄÇÈÇ£‰πàÔºåÂ§ö‰∏™Ê†∏ÂøÉ‰πãÈó¥ÂÖ∂ÂÆûÂ∞±Â∑≤ÁªèÊúâ‰∫ÜÂØπ‰∏≠Êñ≠ÂìçÂ∫îÁöÑÁ´û‰∫â„ÄÇ</p>
<p><img src="/p/riscv-trap-handle/index.assets/PLIC.png"
	width="981"
	height="668"
	srcset="/p/riscv-trap-handle/index.assets/PLIC_hu6425746541214660632.png 480w, /p/riscv-trap-handle/index.assets/PLIC_hu9543283552623087350.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="146"
		data-flex-basis="352px"
	
></p>
<p>‰∏Ä‰∏™Ê†∏ÂøÉÂ¶Ç‰ΩïÂØπ interrupt notification ËøõË°åÂìçÂ∫îÂë¢ÔºüËøô‰∏™Êìç‰ΩúÊàë‰ª¨Âè´ÂÅö claim Êìç‰ΩúÔºåÊú¨Ë¥®Â∞±ÊòØ‰∏Ä‰∏™ÁÆÄÂçïÁöÑÂØπclaim/complete ÂØÑÂ≠òÂô®ÁöÑËØªÊìç‰ΩúÔºåclaim/complete ÂØÑÂ≠òÂô®‰ºö‰øùÂ≠ò‰∏Ä‰∏™ÂΩìÂâçÊú™Ë¢´Â§ÑÁêÜ‰∏îÂÖ∑ÊúâÊúÄÈ´ò‰ºòÂÖàÁ∫ßÁöÑ‰∏≠Êñ≠ÁöÑ ID Âè∑„ÄÇCPUËØªÂèñ claim/complete ÂØÑÂ≠òÂô®Â∞±ÂèØ‰ª•Ëé∑ÂæóËøô‰∏™ ID Âè∑ÔºåÂêåÊó∂‰πüÂ∞±ÂÆåÊàê‰∫ÜÂØπÊ≠§‰∏≠Êñ≠ÁöÑ claim Êìç‰ΩúÔºåÂõûÂà∞ÂÜÖÊ†∏‰∏≠Â∞±ÂèØ‰ª•ÂåπÈÖçÂØπÂ∫îÁöÑ‰∏≠Êñ≠Â§ÑÁêÜÁ®ãÂ∫è (interrupt handler) ËøõË°åÂØπÂ∫îÁöÑÂ§ÑÁêÜ„ÄÇÂú® <code>drivers/irqchip/irq-sifive-plic.c</code> ‰∏≠Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Handling an interrupt is a two-step process: first you claim the interrupt
</span></span></span><span class="line"><span class="cl"><span class="cm"> * by reading the claim register, then you complete the interrupt by writing
</span></span></span><span class="line"><span class="cl"><span class="cm"> * that source ID back to the same claim register.  This automatically enables
</span></span></span><span class="line"><span class="cl"><span class="cm"> * and disables the interrupt, so there&#39;s nothing else to do.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">void</span> <span class="nf">plic_handle_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">irq_desc</span> <span class="o">*</span><span class="n">desc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">while</span> <span class="p">((</span><span class="n">hwirq</span> <span class="o">=</span> <span class="nf">readl</span><span class="p">(</span><span class="n">claim</span><span class="p">)))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="nf">generic_handle_domain_irq</span><span class="p">(</span><span class="n">handler</span><span class="o">-&gt;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">irqdomain</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">						    <span class="n">hwirq</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nf">unlikely</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			<span class="nf">pr_warn_ratelimited</span><span class="p">(</span><span class="s">&#34;can&#39;t find mapping for hwirq %lu</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">					<span class="n">hwirq</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂΩì‰∏Ä‰∏™‰∏≠Êñ≠ÁöÑ notification Ë¢´ claim Âêé (‰πüÂ∞±ÊòØ <code>claim/complete</code> ÂØÑÂ≠òÂô®Ë¢´ËØªÂèñÂêé)ÔºåPLIC Ê†∏ÂøÉ‰ºöËá™Âä®Ê∏ÖÈô§ÊéâÂØπÂ∫î‰∏≠Êñ≠Ê∫êÂú®PLIC ‰∏≠ÁöÑÊåÇËµ∑‰Ωç (clear down the corresponding source‚Äôs IP bit)ÔºåË°®Á§∫Ëøô‰∏™‰∏≠Êñ≠Â∑≤ÁªèË¢´Â§ÑÁêÜ‰∫Ü„ÄÇ</p>
<p>ÂΩì‰∏Ä‰∏™È´ò‰ºòÂÖàÁ∫ßÁöÑ‰∏≠Êñ≠Ë¢´Â§ÑÁêÜ‰πãÂêéÔºå‰Ωé‰ºòÂÖàÁ∫ß‰∏≠Êñ≠ÂèØËÉΩÂèà‰ºöË°•‰∏äÔºåÊâÄ‰ª•PLIC‰∏≠ÁöÑPIE‰ΩçÂèØËÉΩËøòÊòØ‰∏ç‰ºöË¢´Ê∏ÖÈõ∂ÔºåËøô‰πüÂ∞±ÂØºËá¥‰∫ÜÂ§ö‰∏™Ê†∏ÂøÉ‰∏≠ÁöÑ <code>sip.SEIP</code> ‰ΩçÂÖ∂ÂÆûËøòÊòØÊ≤°ÊúâË¢´Ê∏Ö 0 „ÄÇ‰πüÂ∞±ÊòØËØ¥ÔºåÂú®‰∏Ä‰∏™Â§öÊ†∏Âπ≥Âè∞‰∏äÔºåÂèØËÉΩÂêåÊó∂ÂèëÁîüÁöÑÔºåÈúÄË¶ÅË¢´Â§ÑÁêÜÁöÑ‰∏≠Êñ≠‰∏çÊ≠¢‰∏Ä‰∏™„ÄÇËøôÊó∂ÔºåÂÆÉ‰ª¨ÂèØËÉΩ‰ºöË¢´ÂÖ∂‰ªñÊ†∏ÂøÉÂìçÂ∫î„ÄÇÂç≥‰ΩøÊòØÂú®‰∏Ä‰∏™Ê†∏ÂøÉÂÜÖÈÉ®ÔºåPLICÊ†áÂáÜ‰∏ä‰πüÂª∫ËÆÆÔºåÂú® interrupt handler ËøîÂõûÂâçÂèØ‰ª•Êü•Áúã‰∏Ä‰∏ãÊ†∏ÂøÉËá™Â∑±ÁöÑ <code>sip.SEIP</code> ‰ΩçÊòØÂê¶Ëøò‰∏∫1ÔºåÂ¶ÇÊûúËøòÊòØ1ÔºåÂ∞±ÂèØ‰ª•Ë∑≥ËøáÊÅ¢Â§çÁé∞Âú∫ÁöÑÊ≠•È™§ÔºåÁõ¥Êé• claim ‰∏ã‰∏Ä‰∏™‰∏≠Êñ≠Âπ∂ÊúçÂä°ÂêßÔºåËäÇÁúÅÊó∂Èó¥ ÔºÅ</p>
<p>ÊúÄÂêéÔºåÂ¶ÇÊûú‰∏Ä‰∏™Ê†∏ÂøÉ claim Êó∂Â∑≤ÁªèÊ≤°Êúâ‰∏≠Êñ≠Ë¶ÅÂ§ÑÁêÜ‰∫Ü (ÊúâÂèØËÉΩÊòØÊ≤°ÊúâÁ´û‰∫âËøáÂÖ∂‰ªñÊ†∏ÂøÉÔºå‰πüÊúâÂèØËÉΩÊòØÁ°ÆÂÆûÊ≤°Êúâ‰∏≠Êñ≠Ë¶ÅÂ§ÑÁêÜ)ÔºåËØªÂèñPLIC‰∏≠ÁöÑ <code>claim/complete</code> ÂØÑÂ≠òÂô®Â∞±‰ºöËøîÂõû0ÔºåËøõËÄåÂõûÂà∞ OS ÂÜÖÊ†∏Âêé‰ªÄ‰πà‰πü‰∏çÂÅöÔºåËøôÂú®‰∏äÈù¢ÁöÑ‰ª£Á†Å‰∏≠‰πüÊúâÂØπÂ∫î„ÄÇÂÆûÈôÖ‰∏äÔºå‰∏≠Êñ≠ID‰∏∫ 0 Âú®Ê†áÂáÜ‰∏≠ÂØπÂ∫îÁöÑÂê´‰πâÂ∞±ÊòØÔºö‚ÄúÊó†ÈúÄÂìçÂ∫îÁöÑ‰∏≠Êñ≠‚Äù„ÄÇ</p>
<p>Áé∞Âú®‰∏Ä‰∏™Ê†∏ÂøÉ claim ‰∫Ü‰∏Ä‰∏™‰∏≠Êñ≠Âπ∂Â∞ÜÂÖ∂ÊúçÂä°ÂÆåÊØïÔºåÂÆÉÂ∞±‰ºöËøõË°å‰∏Ä‰∏™ complete Êìç‰ΩúÔºåËøô‰∏™Êìç‰ΩúÂíå claim Êìç‰ΩúÂæàÂÉèÔºåÂè™ÊòØÂÆåÂÖ®Áõ∏Âèç‚Äî‚ÄîÂÆÉÊòØÂêë <code>claim/complete</code> ÂØÑÂ≠òÂô®ÂÜôÂÖ•ÂÆÉÂàöÂàöÂÆåÊàêÊúçÂä°ÁöÑ‰∏≠Êñ≠IDÂè∑ÔºåËøô‰∏™IDÂè∑‰ºöË¢´ËΩ¨ÂèëÁªô GatewaysÔºåËøõËÄåGateways ‰ºöÂÜçÊ¨°ÂºÄÂßãÂØπÂØπÂ∫îIDÂè∑ÁöÑ‰∏≠Êñ≠ËøõË°åËΩ¨Âèë„ÄÇÂú®Ê≤°ÊúâÂÆåÊàê complete Êìç‰Ωú‰πãÂâçÔºåGateways ÊòØ‰∏ç‰ºöËΩ¨ÂèëÂêåÊ†∑IDÂè∑ÁöÑ‰∏≠Êñ≠ÁªôPLICÊ†∏ÂøÉÁöÑÔºåÊâÄ‰ª•Âú®ÂÆåÊàêcompleteÊìç‰Ωú‰πãÂâçËøôÁßç‰∏≠Êñ≠‰πüÂ∞±‰∏ç‰ºöË¢´Â§ÑÁêÜ„ÄÇ</p>
<blockquote>
<p><font color='red'><strong>ÊúÄÂêéÊ¢≥ÁêÜ‰∏Ä‰∏ãËøô‰∏™ËøáÁ®ãÔºö</strong></font></p>
<ol>
<li>Â§ñÈÉ®ËÆæÂ§áÂèëËµ∑‰∏Ä‰∏™‰∏≠Êñ≠ÁªôPLIC‰∏≠ÁöÑGatewaysÔºåGatewaysË¥üË¥£Â∞Ü‰∏≠Êñ≠‰ø°Âè∑ËøõË°åËΩ¨Êç¢Âπ∂ËΩ¨ÂèëÁªôPLICÊ†∏ÂøÉÔºåËøô‰∏™ËøáÁ®ã‰∏≠‰ºöÊ∂âÂèäPriority„ÄÅThresholdÁ≠âÁ≠â‰∏ÄÁ≥ªÂàóÁöÑÂà§Êñ≠ (ËØ¶ËßÅ‰∏äÈù¢ÁöÑÁîµË∑Ø)ÔºåÊúÄÁªà‰ºö‰ΩìÁé∞Âú®PLICÊ†∏ÂøÉÁöÑ EIP ‰Ωç‰∏äÔºõ</li>
<li>EIP ‰Ωç‰∏ÄÊó¶Ë¢´ÁΩÆ 1Ôºå‰ºöÁõ¥Êé•ÂØºËá¥Â§ö‰∏™Ê†∏ÂøÉ‰∏äÁöÑ <code>sip.SEIP</code> ‰ΩçË¢´ÁΩÆ 1„ÄÇËøõËÄåÂØºËá¥Â§ö‰∏™ÊâìÂºÄÊ≠§‰∏≠Êñ≠ÁöÑCPUÊ†∏ÂøÉÂºÄÂßãÁ´û‰∫âclaim Ëøô‰∏™‰∏≠Êñ≠ÔºåÊ≤°ÊúâÁ´û‰∫âËøáÂÖ∂‰ªñÊ†∏ÂøÉÊó∂‰ºöÂæóÂà∞‰∏≠Êñ≠ID‰∏∫ 0ÔºåËøõËÄå‰∏çÂìçÂ∫îÔºåËøô‰∏™ËøáÁ®ãÂè´ÂÅö claim Êìç‰ΩúÔºõ</li>
<li>ÂìçÂ∫îÊúÄÊó©ÁöÑÊ†∏ÂøÉÊàêÂäüÂºÄÂßãÊúçÂä°Ëøô‰∏™‰∏≠Êñ≠ÔºåÂπ∂Âú®ÊúçÂä°ÂÆåÊàê‰πãÂêéÂ∞Ü‰∏≠Êñ≠IDÂè∑ÂÜçÊ¨°ÂÜôÂÖ• <code>claim/completion</code> ÂØÑÂ≠òÂô®ÔºåËøô‰∏™ËøáÁ®ãÂè´ÂÅö complete Êìç‰ΩúÔºõ</li>
<li>Ëøô‰∏™ complete Êìç‰Ωú‰ºöË¢´ËΩ¨ÂèëÂà∞ GatewaysÔºåËøõËÄåÂÜçÊ¨°ÂºÄÂêØÂØπËøôÁßç‰∏≠Êñ≠ÁöÑËΩ¨Âèë„ÄÇ</li>
</ol>
</blockquote>
<h4 id="ËΩØ‰∏≠Êñ≠ÂíåÂÆöÊó∂Âô®‰∏≠Êñ≠">ËΩØ‰∏≠Êñ≠ÂíåÂÆöÊó∂Âô®‰∏≠Êñ≠
</h4><p>Ê≥®ÊÑèÂäõÂÜçÊ¨°ÂõûÂà∞ <code>sip/sie</code> ÂØÑÂ≠òÂô®‰∏≠ÔºåÈô§‰∫Ü <code>sip.SEIP</code> Âè™ËØª‰ΩçÁî®Êù•ÂèçÊò†Â§ñÈÉ®‰∏≠Êñ≠‰ª•Â§ñÔºåËøòÊúâ <code>sip.SSIP/sip.STIP</code> ‰ΩçÊù•ÂàÜÂà´ÂèçÊò†ËΩØ‰∏≠Êñ≠ÂíåÊó∂Èíü‰∏≠Êñ≠„ÄÇÂú®ÂºÄÂèëÊùøÁöÑÊâãÂÜå‰∏≠ÔºåËøô‰∏§ËÄÖÈÉΩÂ±û‰∫éÊú¨Âú∞‰∏≠Êñ≠ÔºåÈÉΩ‰∫§Áî± <strong>CLINT(Ê†∏ÂøÉÊú¨Âú∞‰∏≠Êñ≠Âô®)</strong> Êù•ÁÆ°ÁêÜ„ÄÇ</p>
<p><img src="/p/riscv-trap-handle/index.assets/sip_sie_15_0-1698908502906-10.png"
	width="627"
	height="299"
	srcset="/p/riscv-trap-handle/index.assets/sip_sie_15_0-1698908502906-10_hu17214122920619431732.png 480w, /p/riscv-trap-handle/index.assets/sip_sie_15_0-1698908502906-10_hu1846709259102548870.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="209"
		data-flex-basis="503px"
	
></p>
<blockquote>
<p><em><strong>Êó∂Èíü‰∏≠Êñ≠</strong></em></p>
</blockquote>
<p><code>sip.STIP/sie.STIE</code> ‰ΩçÂàÜÂà´Áî®Êù•ÁÆ°ÁêÜÊó∂Èíü‰∏≠Êñ≠ÁöÑÊåÇËµ∑Âíå‰ΩøËÉΩÔºåÊó∂Èíü‰∏≠Êñ≠Âú®ÂÜÖÊ†∏‰∏≠‰∏ªË¶ÅÊòØÁî®Êù•ÂÅöCPUË∞ÉÂ∫¶ÁöÑ„ÄÇ‰πüÂ∞±ÊòØÊàë‰ª¨Â∏∏ËØ¥ÁöÑÊó∂Èó¥ÁâáËΩÆËΩ¨Ë∞ÉÂ∫¶ÁÆóÊ≥ï (Round-Robin, RR)Ôºå‰∏Ä‰∏™ËøõÁ®ãÁªèËøá‰∏ÄÊÆµÊó∂Èó¥‰πãÂêé‰ºöËá™Âä®ËÆ©Âá∫CPUÁöÑ‰ΩøÁî®ÊùÉÔºåËÆ©ÂÖ∂‰ªñËøõÁ®ãËøõË°åÊâßË°å„ÄÇ</p>
<p><code>sip.STIP</code> ‰Ωç‰πüÈùûÂ∏∏ÁâπÊÆäÔºåÂíå <code>sip.SEIP</code> ‰∏ÄÊ†∑Ôºå‰∏ÄÊó¶Ë¢´ÂÆûÁé∞Â∞±Âè™ËÉΩÊòØÂè™ËØªÁöÑ (read-only)ÔºåÂè™ËÉΩË¢´ÊâßË°åÁéØÂ¢É (execution environment) ÊâÄËÆæÁΩÆÂíåÊ∏ÖÈô§„ÄÇËøôÈáåÊâÄË∞ìÁöÑÊâßË°åÁéØÂ¢ÉÊåáÁöÑÂ∞±ÊòØÊìç‰ΩúÁ≥ªÁªüÈáåÁöÑ‰∏≠Êñ≠ÊúçÂä°Á®ãÂ∫è„ÄÇ</p>
<p>‰πãÂâçÔºåÊàë‰ª¨Â∞±ÁÆÄÂçïÊèêËøá**Êó∂Èíü‰∏≠Êñ≠ÊòØË¢´ CLINT Á°¨ËøûÁ∫ø‰∏∫‰∏Ä‰∏™ M-Mode ‰∏≠Êñ≠ÁöÑÔºå**Âπ∂‰∏îËøô‰∏™‰∏≠Êñ≠‰∏çËÉΩË¢´ÂßîÊ¥æÂà∞ S-ModeÔºåÊâÄ‰ª•Êó∂Èíü‰∏≠Êñ≠ÊÄé‰πà‰πüËΩÆ‰∏çÂà∞ÂÜÖÊ†∏ÂéªÂ§ÑÁêÜÔºåÂÆÉÁúüÁöÑÂæóÁî±Á°¨‰ª∂Êú∫Âà∂ÂéªËß¶Âèë„ÄÇËøôÈáåÂ∞±ÈùûÂ∏∏Â∑ßÂ¶ô‰∫ÜÔºåÁõÆÂâçÁÆÄÂçïÁªôÂá∫‰∏Ä‰∏™ÁªìËÆ∫Ôºö**ÂÜÖÊ†∏‰∏≠ M-Mode ‰∏ãÁöÑÊó∂Èíü‰∏≠Êñ≠ÁöÑ interrupt handler ‰ºö‰ΩøÁî®Ê±áÁºñ‰ª£Á†Å‰∏ªÂä®Ëß¶Âèë‰∏Ä‰∏™ S-Mode ‰∏ãÁöÑËΩØ‰∏≠Êñ≠Ôºå‰ªéËÄåÂ∞ÜÊó∂Èíü‰∏≠Êñ≠ÁöÑÂ§ÑÁêÜÊùÉÁßª‰∫§Áªô‰Ωç‰∫é S-Mode ‰∏ãÁöÑÊìç‰ΩúÁ≥ªÁªüÔºåÊìç‰ΩúÁ≥ªÁªüÂ§ÑÁêÜÂÆåÊó∂Èíü‰∏≠Êñ≠‰πãÂêé‰ºöÂ∞ÜËøô‰∏™ËΩØ‰∏≠Êñ≠Ê∏ÖÈô§‰ª•Ë°®ÊòéÂÆåÊàê‰∫ÜÂØπÊó∂Èíü‰∏≠Êñ≠ÁöÑÂ§ÑÁêÜ„ÄÇ**ÊâÄ‰ª•ÔºåÂÖ∂ÂÆûÂÜÖÊ†∏ÂÄüÁî®‰∫Ü S-Mode ‰∏ãÁöÑËΩØ‰∏≠Êñ≠ÂéªÂÆåÊàêÂØπÊó∂Èíü‰∏≠Êñ≠ÁöÑÂìçÂ∫îÔºåËøôÊòØÂõ†‰∏∫Êìç‰ΩúÁ≥ªÁªüÂæÄÂæÄË¶ÅÂÄüÂä©Êó∂Èíü‰∏≠Êñ≠Êù•ÂÆåÊàê‰∏Ä‰∫õÂäüËÉΩÔºåËÄåËøô‰∫õÂäüËÉΩÂ±û‰∫é S-Mode ‰∏ãÁöÑÊìç‰ΩúÁ≥ªÁªüÁöÑ‰∏Ä‰∫õÊ¶ÇÂøµ (ÊØîÂ¶ÇCPUË∞ÉÂ∫¶„ÄÅsigalarmÁ≠â)ÔºåÊâÄ‰ª•ÂÖ∂ÂÆûÂ∞ÜÂéüÊú¨‰Ωç‰∫é M-Mode ‰∏ãÁöÑÊó∂Èíü‰∏≠Êñ≠Áßª‰∫§Áªô S-Mode ÈùûÂ∏∏Ëá™ÁÑ∂„ÄÇ</p>
<blockquote>
<p><em><strong>ËΩØ‰∏≠Êñ≠</strong></em></p>
</blockquote>
<p>ËΩØ‰∏≠Êñ≠Âàô‰∏é <code>sip.SSIP/sie.SSIE</code> ÊúâÂÖ≥Ôºå‰∏éÂâç‰∏§ËÄÖ‰∏çÂêåÔºåÂÆÉÊó¢ÂèØ‰ª•Áî±Êåá‰ª§ËØªÂÜôÔºå‰πüÂèØ‰ª•Áî± CLINT Êù•ÊéßÂà∂„ÄÇ**ËΩØ‰ª∂‰∏≠Êñ≠ÊòØÈÄöËøáÊåá‰ª§Êù•Ëß¶ÂèëÁöÑÔºåÂÖ∑‰ΩìÊòØÂÜôÂÖ• CLINT ‰∏≠ÁöÑ msip ÂØÑÂ≠òÂô®„ÄÇ**Ëøô‰∏™ÂØÑÂ≠òÂô®Êúâ 32 ‰ΩçÔºåÈ´ò 31 ‰ΩçÂÖ®ÈÉ®Ë¢´Á°¨ËøûÁ∫øÂà∞ 0ÔºåÊúÄ‰Ωé‰ΩçÂàôÁõ¥Êé•Êò†Â∞ÑÂà∞ <code>mip.MSIP</code> ‰Ωç„ÄÇËΩØ‰ª∂‰∏≠Êñ≠Âú®Á°¨‰ª∂ÂÆûÁé∞‰∏≠ÔºåÊ†πÊçÆÁ§∫ÊÑèÂõæÂàÜÊûêÔºåÂ∫îËØ•‰πüÊòØÂÉèÊó∂Èíü‰∏≠Êñ≠‰∏ÄÊ†∑ÔºåË¢´Âº∫Âà∂Á°¨ËøûÁ∫øÂà∞M-Mode‰∏ã„ÄÇËΩØ‰∏≠Êñ≠‰∏ÄËà¨Áî®‰∫éÂ§ö‰∏™Â§ÑÁêÜÂô®Ê†∏ÂøÉ‰πãÈó¥ÁöÑÈÄö‰ø°ÔºåÂêÑ‰∏™Ê†∏ÂøÉÈÉΩÂèØ‰ª•ÈÄöËøáÊåá‰ª§Ëß¶ÂèëÂè¶Â§ñÊ†∏ÂøÉÁöÑËΩØ‰ª∂‰∏≠Êñ≠„ÄÇ</p>
<p>Ëá≥Ê≠§ÔºåÊàë‰ª¨Â∞Ü <code>sip/sie</code> ÂØÑÂ≠òÂô®ËÆ≤Ëß£ÁöÑÂ∑Æ‰∏çÂ§ö‰∫ÜÔºåÂπ∂È°∫Â∏¶‰ªãÁªç‰∫ÜÂ§ßÈáèÊúâÂÖ≥Â§ñÈÉ®‰∏≠Êñ≠„ÄÅÊó∂Èíü‰∏≠Êñ≠ÂíåËΩØ‰ª∂‰∏≠Êñ≠ÁöÑÂ§ÑÁêÜÊµÅÁ®ãÂíåÁªÜËäÇ„ÄÇÂú®ÂÆûÈôÖÂÆûÁé∞RISC-VÊ†∏ÂøÉÊó∂ÔºåÂπ∂‰∏ç‰∏ÄÂÆöË¶ÅÂÆûÁé∞‰∏äËø∞ÁöÑÊâÄÊúâ‰∏≠Êñ≠Á±ªÂûãÔºåÂΩìÊüêÁßç‰∏≠Êñ≠Á±ªÂûãÊ≤°ÊúâË¢´ÂÆûÁé∞Êó∂ÔºåÂÆÉÂØπÂ∫îÁöÑ <code>sip/sie</code> ÂØÑÂ≠òÂô®ÁöÑÂØπÂ∫îÂüü‰ºöË¢´Á°¨ËøûÁ∫øÂà∞ 0 „ÄÇ</p>
<p>ÊúÄÂêéÔºåÂΩìËøô‰∏âÁßç‰∏≠Êñ≠ÂêåÊó∂ÂèëÁîüÊó∂ÔºåÂÆÉ‰ª¨ÁöÑÁõ∏ÂØπ‰ºòÂÖàÁ∫ßÊòØ <code>SEI &gt; STI &gt; SSI</code>„ÄÇ</p>
<h3 id="sscratch">sscratch
</h3><p><code>sscratch</code> ÂØÑÂ≠òÂô®ÁöÑËÆæËÆ°ÊòØRISC-V‰∏≠‰∏Ä‰∏™ÈùûÂ∏∏Â∑ßÂ¶ôÁöÑÊú∫Âà∂ÔºåËøô‰∏™ÂØÑÂ≠òÂô®‰∏≠Â≠òÊîæÁùÄ‰∏Ä‰∏™ (ËôöÊãü) Âú∞ÂùÄ„ÄÇÂΩìÂú®ÊâßË°åÁî®Êà∑‰ª£Á†ÅÊó∂ÔºåËøô‰∏™Âú∞ÂùÄÊåáÂêëÁöÑÊòØ‰∏ÄÂùó‰øùÂ≠òÂΩìÂâçÁ®ãÂ∫è‰∏ä‰∏ãÊñá (ÂÖ∂ÂÆûÂ∞±ÊòØÂØÑÂ≠òÂô®ÁªÑÂÜÖÂÆπÔºåcontext) ÁöÑ‰∏ÄÂùóÂÜÖÂ≠òÂå∫ÂüüÔºåÂèØ‰ª•Â∞ÜÂÖ∂Áß∞ÂÅöÈô∑Èò±Â∏ß<code>trapframe</code>„ÄÇ</p>
<p>ÂΩìCPUÂ§ÑÁêÜÈô∑Èò±ÁöÑÊó∂ÂÄôÔºåPC‰ºöË¢´ËÆæÁΩÆ‰∏∫ <code>stvec</code> ÂØÑÂ≠òÂô®ÁöÑÂÄºÔºåËøõËÄåÈô∑ÂÖ•‰∏ÄÊÆµËøáÊ∏°Á®ãÂ∫èÔºåÂú®ËøôÊÆµÁ®ãÂ∫èÁöÑÂºÄÂ§¥Â∞±‰ºöÂ∞Ü <code>sscratch</code>ÂØÑÂ≠òÂô®Âíå <code>a0</code> ÂØÑÂ≠òÂô®ËøõË°å‰∫§Êç¢ÔºåËøô‰∏ÄÊñπÈù¢Â∞Ü <code>a0</code> ÁöÑÂÄº‰øùÂ≠òÂú®‰∫Ü <code>sscratch</code> ÂØÑÂ≠òÂô®‰∏≠ÔºåÂêåÊó∂ <code>a0</code> ÊåáÂêë‰∫Ü <code>trapframe</code> ÁöÑÂºÄÂßãÂú∞ÂùÄÔºåËøôÊ†∑ËøõËÄåÂ∞±ÂèØ‰ª•ÈÄöËøá <code>a0</code> ÂØÑÂ≠òÂô®ÂØªÂùÄÂ∞ÜÊâÄÊúâÂØÑÂ≠òÂô®ÁöÑÂÄº‰øùÂ≠òÂú® <code>trapframe</code> ÈáåÔºåÂ¶ôÁªùÔºÅ</p>
<h3 id="sepc">sepc
</h3><p><code>sepc</code> ÂØÑÂ≠òÂô®Ôºå‰∏ÄË®Ä‰ª•ËîΩ‰πãÂ∞±ÊòØËÆ∞ÂΩïÈô∑Èò±Èô∑ÂÖ•Âà∞ S-Mode Êó∂ÂèëÁîüÈô∑Èò±ÁöÑÊåá‰ª§ÁöÑËôöÊãüÂú∞ÂùÄÔºåÂÆÉÂú®ÊâßË°åÈô∑Èò±Êó∂‰ºöËÆ∞ÂΩï‰∏ãË¢´‰∏≠Êñ≠ÁöÑÊåá‰ª§ÁöÑËôöÊãüÂú∞ÂùÄÔºåÈô§‰∫ÜÂàöÊâçËØ¥ÁöÑÈô∑Èò±Âú∫ÊôØ‰πãÂ§ñÔºåÁ°¨‰ª∂‰∏ç‰ºö‰∏ªÂä®ÊîπÂèò sepc ÁöÑÂÄº„ÄÇ‰ΩÜÊòØ spec ÂØÑÂ≠òÂô®ÂèØ‰ª•Ë¢´Êåá‰ª§ÂÜôÂÖ•ÔºåÂ¶ÇÊûúÊâßË°åÁ≥ªÁªüË∞ÉÁî®ÁöÑËØùÔºåÂÜÖÊ†∏‰ºöÂ∞ÜËøîÂõûÂú∞ÂùÄ +4 Âπ∂ËµãÁªô <code>sepc</code>ÔºåËøôË°®ÊòéÁ≥ªÁªüË∞ÉÁî®‰ºöËøîÂõû ecall ÁöÑ‰∏ã‰∏ÄÊù°Êåá‰ª§ÁªßÁª≠ÊâßË°å„ÄÇ</p>
<h3 id="scause">scause
</h3><p><img src="/p/riscv-trap-handle/index.assets/scause.png"
	width="1122"
	height="132"
	srcset="/p/riscv-trap-handle/index.assets/scause_hu15317989320834712412.png 480w, /p/riscv-trap-handle/index.assets/scause_hu16429487224502960722.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="850"
		data-flex-basis="2040px"
	
></p>
<p><code>scause</code> ÂØÑÂ≠òÂô®Âú®ÊâßË°åÈô∑Èò±Êó∂Áî±Á°¨‰ª∂Ëá™Âä®ËÆ∞ÂΩï‰∏ãÂØºËá¥Êú¨Ê¨°Èô∑Èò±ÁöÑÂéüÂõ†ÔºåÂÖ∂‰∏≠ interrupt ‰ΩçË°®Á§∫Êú¨Ê¨°Èô∑Èò±ÁöÑÂéüÂõ†ÊòØÂê¶‰∏∫‰∏≠Êñ≠(Êàë‰ª¨‰∏äÈù¢ËØ¥ËøáÔºåÈô∑Èò±ÊòØÂä®‰ΩúÔºåËÄå‰∏≠Êñ≠ÂíåÂºÇÂ∏∏ÊòØÂØºËá¥Èô∑Èò±ÁöÑÂéüÂõ†)„ÄÇËÄå Exception Code ÂàôË°®Á§∫ÁªÜÂàÜÁöÑÂéüÂõ†ÔºåÂØπÂ∫îÂÖ≥Á≥ªÂ¶Ç‰∏ãË°®ÔºåÂèØ‰ª•ÁúãÂà∞scauseËøòÊòØÊúâÂæàÂ§öÂèØÊâ©Â±ïÁöÑÂºÇÂ∏∏Âè∑Ê≤°ÊúâË¢´‰ΩøÁî®ÁöÑÔºö</p>
<p><img src="/p/riscv-trap-handle/index.assets/riscv_ecode-1698909631064-13.png"
	width="429"
	height="667"
	srcset="/p/riscv-trap-handle/index.assets/riscv_ecode-1698909631064-13_hu2276639625215783387.png 480w, /p/riscv-trap-handle/index.assets/riscv_ecode-1698909631064-13_hu11360498154303842485.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="64"
		data-flex-basis="154px"
	
></p>
<p>Âú®ÂÜÖÊ†∏ÁöÑÂÖ∑‰ΩìÂÆûÁé∞‰∏≠ÔºåÊàë‰ª¨‰ºöÊ†πÊçÆ <code>scause</code> ‰∏≠ËÆ∞ÂΩïÁöÑÂºÇÂ∏∏Âè∑ÂÆûÁé∞ÂØπÈô∑Èò±‚ÄúÂàÜÈó®Âà´Á±ª‚ÄùÁöÑÂ§ÑÁêÜ„ÄÇÂíå <code>sepc</code> ‰∏ÄÊ†∑Ôºå<code>scause</code> ‰πüÊîØÊåÅ‰ΩøÁî®Êåá‰ª§ÂÜôÂÖ•Ôºå‰ΩÜÊòØ‰∏ÄËà¨‰∏çËøô‰πàÂÅö„ÄÇ</p>
<h3 id="stval">stval
</h3><p><code>stval</code> ÂØÑÂ≠òÂô®ÁöÑÂÖ®Áß∞ÊòØ Supervisor Trap Value RegisterÔºåËøô‰∏™ÂØÑÂ≠òÂô®‰∏ìÈó®Áî®Êù•Â≠òÊîæ‰∏éÈô∑Èò±ÊúâÂÖ≥ÁöÑÂÖ∂‰ªñ‰ø°ÊÅØÔºåÁõÆÁöÑÊòØÂ∏ÆÂä©Êìç‰ΩúÁ≥ªÁªüÊàñÂÖ∂‰ªñËΩØ‰ª∂Êõ¥Âø´Á°ÆÂÆöÂíåÂÆåÊàêÈô∑Èò±ÁöÑÂ§ÑÁêÜ„ÄÇÊâãÂÜå‰∏äÁõ∏ÂÖ≥ÁöÑÂèôËø∞ÊòæÂæóÊúâ‰∫õÊô¶Ê∂©ÔºåËøôÈáåÁÆÄÂçïÂú∞ÂÅö‰∏Ä‰∏™ÊÄªÁªìÔºö</p>
<p>È¶ñÂÖàÔºå<code>stval</code> ÂØÑÂ≠òÂô®‰∏≠Â≠òÂÇ®ÁöÑÂÄºÂèØ‰ª•ÊòØÈõ∂ÂÄºÊàñËÄÖÊòØÈùûÈõ∂ÂÄºÔºåÂØπ‰∫éÂ§ßÈÉ®ÂàÜÊú™ÁªèÁ°¨‰ª∂Âπ≥Âè∞ÂÆö‰πâÁöÑÈô∑Èò±ÊÉÖÂÜµËÄåË®ÄÔºå<code>stval</code> Âπ∂‰∏ç‰ºöÂ≠òÂÇ®‰∏éËøô‰∫õÈô∑Èò±ÊúâÂÖ≥ÁöÑ‰ø°ÊÅØÔºåËøôÊó∂ÂÄô <code>stval</code> Â∞±‰ºöÂ≠òÂÇ®Èõ∂ÔºåÊú¨Ë¥®‰∏ä <code>stval</code> Ê≤°ÊúâÂ≠òÂÇ®‰ªÄ‰πàÊúâÊïà‰ø°ÊÅØ„ÄÇ**Â≠òÂÇ®ÈùûÈõ∂ÂÄºÁöÑÊÉÖÂÜµÂèàÂàÜ‰∏∫‰∏§ÁßçÔºå‰∏ÄÁßçÊòØÂõ†‰∏∫ÂÜÖÂ≠òËÆøÈóÆÈùûÊ≥ïÔºå‰∏ÄÁßçÂàôÊòØÂõ†‰∏∫Êåá‰ª§Êú¨Ë∫´ÈùûÊ≥ïÔºå**‰∏ãÈù¢ËØ¶ÁªÜËØ¥ËØ¥Ôºö</p>
<blockquote>
<ul>
<li>
<p>ÂÜÖÂ≠òËÆøÈóÆÈùûÊ≥ï</p>
<p>ËøôÁßçÊÉÖÂÜµÂåÖÊã¨Á°¨‰ª∂Êñ≠ÁÇπ (Hardware Breakpoints)„ÄÅÂú∞ÂùÄÊú™ÂØπÈΩê (address misaligned)„ÄÅËÆøÈóÆÊïÖÈöú (access-faultÔºåÂèØËÉΩÊòØÊ≤°ÊúâÊùÉÈôêÁ≠â)„ÄÅÁº∫È°µÊïÖÈöú (page-fault) Á≠âÊÉÖÂÜµ„ÄÇÂΩìËøôÁßçÊÉÖÂÜµÂèëÁîüÊó∂Ôºå<code>stval</code> ‰ºöÂ≠òÂÇ®Âá∫Èîô‰ΩçÁΩÆÁöÑËôöÊãüÂú∞ÂùÄ„ÄÇÊØîÂ¶ÇÁº∫È°µÊïÖÈöúÂèëÁîüÊó∂Ôºå<code>stval</code> Â∞±‰ºöËÆ∞ÂΩïÂà∞Â∫ïÊòØÂØπÂì™‰∏™ËôöÊãüÂú∞ÂùÄÁöÑËÆøÈóÆÂØºËá¥‰∫ÜÊú¨Ê¨°Áº∫È°µÊïÖÈöúÔºåÂÜÖÊ†∏Â∞±ÂèØ‰ª•Ê†πÊçÆÊ≠§‰ø°ÊÅØÂéªÂä†ËΩΩÈ°µÈù¢ËøõÂÖ•ÂÜÖÂ≠ò„ÄÇ</p>
</li>
<li>
<p>Êåá‰ª§ÊâßË°åÈùûÊ≥ï</p>
<p>ÂΩìÊâßË°åÁöÑÊåá‰ª§ÈùûÊ≥ïÊó∂Ôºå<code>stval</code> ‰ºöÂ∞ÜËøôÊù°Êåá‰ª§ÁöÑ‰∏ÄÈÉ®ÂàÜ‰ΩçËÆ∞ÂΩï‰∏ãÊù•„ÄÇillegal instruction, ÂºÇÂ∏∏Âè∑‰∏∫ 2„ÄÇ</p>
</li>
</ul>
</blockquote>
<h1 id="2-clintplic">2 CLINT/PLIC
</h1><p><a class="link" href="https://github.com/riscv/riscv-plic-spec"  target="_blank" rel="noopener"
    >riscv/riscv-plic-spec: PLIC Specification (github.com)</a></p>

</section>


    <footer class="article-footer">
    

    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2024 zcxGGmu
    </section>
    
    <section class="powerby">
        ‰ΩøÁî® <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> ÊûÑÂª∫ <br />
        ‰∏ªÈ¢ò <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.27.0">Stack</a></b> Áî± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> ËÆæËÆ°
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>
<div id="particles-js"></div>

<script src=https://zcxggmu.github.io/background/particles.min.js></script>
<script>
  particlesJS.load('particles-js', "https://zcxggmu.github.io/background/particlesjs-config.json", function() {
    console.log('particles.js loaded - callback');
  });
</script>

<style>
  #particles-js {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: -1;
  }
</style>


    </body>
</html>
