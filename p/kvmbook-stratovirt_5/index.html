<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="0 ÂèÇËÄÉ Âçé‰∏∫ | Âü∫‰∫éRustÁöÑ‰∏ã‰∏Ä‰ª£ËôöÊãüÂåñÂπ≥Âè∞-StratoVirt - RustÁ≤æÈÄâ (rustmagazine.github.io)\nStratoVirt‰∏≠MicroVMÂêØÂä®ËøáÁ®ã-CSDNÂçöÂÆ¢\n">
<title>Kvmbook Stratovirt_5</title>

<link rel='canonical' href='https://zcxggmu.github.io/p/kvmbook-stratovirt_5/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="Kvmbook Stratovirt_5">
<meta property='og:description' content="0 ÂèÇËÄÉ Âçé‰∏∫ | Âü∫‰∫éRustÁöÑ‰∏ã‰∏Ä‰ª£ËôöÊãüÂåñÂπ≥Âè∞-StratoVirt - RustÁ≤æÈÄâ (rustmagazine.github.io)\nStratoVirt‰∏≠MicroVMÂêØÂä®ËøáÁ®ã-CSDNÂçöÂÆ¢\n">
<meta property='og:url' content='https://zcxggmu.github.io/p/kvmbook-stratovirt_5/'>
<meta property='og:site_name' content='zcxGGmu'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2024-10-17T10:07:36&#43;08:00'/><meta property='article:modified_time' content='2024-10-17T10:07:36&#43;08:00'/>
<meta name="twitter:title" content="Kvmbook Stratovirt_5">
<meta name="twitter:description" content="0 ÂèÇËÄÉ Âçé‰∏∫ | Âü∫‰∫éRustÁöÑ‰∏ã‰∏Ä‰ª£ËôöÊãüÂåñÂπ≥Âè∞-StratoVirt - RustÁ≤æÈÄâ (rustmagazine.github.io)\nStratoVirt‰∏≠MicroVMÂêØÂä®ËøáÁ®ã-CSDNÂçöÂÆ¢\n">
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="ÂàáÊç¢ËèúÂçï">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu16968365064894999835.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">zcxGGmu</a></h1>
            <h2 class="site-description">riscv, linux-kernel/kvm, llm-app/infer</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/zcxGGmu'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>‰∏ªÈ°µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>ÂÖ≥‰∫é</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>ÊöóËâ≤Ê®°Âºè</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ÁõÆÂΩï</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#0-ÂèÇËÄÉ">0 ÂèÇËÄÉ</a></li>
    <li><a href="#1-stratovirtÊ¶ÇËø∞">1 StratoVirtÊ¶ÇËø∞</a></li>
    <li><a href="#2-ÂèëÂ±ïËÉåÊôØ">2 ÂèëÂ±ïËÉåÊôØ</a></li>
    <li><a href="#3-stratovirtÊû∂ÊûÑËÆæËÆ°">3 StratoVirtÊû∂ÊûÑËÆæËÆ°</a>
      <ol>
        <li><a href="#31-cpuÂ≠êÁ≥ªÁªü">3.1 CPUÂ≠êÁ≥ªÁªü</a></li>
        <li><a href="#32-ÂÜÖÂ≠òÂ≠êÁ≥ªÁªü">3.2 ÂÜÖÂ≠òÂ≠êÁ≥ªÁªü</a>
          <ol>
            <li><a href="#Áõ∏ÂÖ≥Ê¶ÇÂøµ">Áõ∏ÂÖ≥Ê¶ÇÂøµ</a></li>
            <li><a href="#ËôöÊãüÊú∫Áâ©ÁêÜÂÜÖÂ≠òÂàùÂßãÂåñ">ËôöÊãüÊú∫Áâ©ÁêÜÂÜÖÂ≠òÂàùÂßãÂåñ</a></li>
          </ol>
        </li>
        <li><a href="#33-ioÂ≠êÁ≥ªÁªü">3.3 I/OÂ≠êÁ≥ªÁªü</a>
          <ol>
            <li><a href="#ÂÆåÂÖ®ËÆæÂ§áÊ®°Êãü-‰∏≤Âè£">ÂÆåÂÖ®ËÆæÂ§áÊ®°Êãü: ‰∏≤Âè£</a></li>
            <li><a href="#ÂçäËôöÊãüÂåñÊ®°Êãü-Á£ÅÁõò">ÂçäËôöÊãüÂåñÊ®°Êãü: Á£ÅÁõò</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#4-‰ªéÈõ∂ÂºÄÂßãÊûÑÂª∫stratovirt">4 ‰ªéÈõ∂ÂºÄÂßãÊûÑÂª∫StratoVirt</a>
      <ol>
        <li><a href="#41-ÊÄª‰Ωì‰ªãÁªç">4.1 ÊÄª‰Ωì‰ªãÁªç</a></li>
        <li><a href="#42-kvmÊ®°Âûã">4.2 KVMÊ®°Âûã</a>
          <ol>
            <li><a href="#step1-ÂÆö‰πâÊ±áÁºñÊåá‰ª§">step1: ÂÆö‰πâÊ±áÁºñÊåá‰ª§</a></li>
            <li><a href="#step2-ÊâìÂºÄkvmÊ®°ÂùóÂπ∂ÂàõÂª∫ËôöÊãüÊú∫">step2: ÊâìÂºÄKVMÊ®°ÂùóÂπ∂ÂàõÂª∫ËôöÊãüÊú∫</a></li>
            <li><a href="#step3-ÂàùÂßãÂåñËôöÊãüÊú∫ÂÜÖÂ≠ò">step3: ÂàùÂßãÂåñËôöÊãüÊú∫ÂÜÖÂ≠ò</a></li>
            <li><a href="#step4-ÂàõÂª∫Âπ∂ÂàùÂßãÂåñËôöÊãüÊú∫Âíåvcpu">step4: ÂàõÂª∫Âπ∂ÂàùÂßãÂåñËôöÊãüÊú∫ÂíåvCPU</a></li>
            <li><a href="#step5-Â§ÑÁêÜvcpuÈÄÄÂá∫‰∫ã‰ª∂">step5: Â§ÑÁêÜvCPUÈÄÄÂá∫‰∫ã‰ª∂</a></li>
          </ol>
        </li>
        <li><a href="#43-ÂÜÖÂ≠òÊ®°Âûã">4.3 ÂÜÖÂ≠òÊ®°Âûã</a>
          <ol>
            <li><a href="#Âú∞ÂùÄÁ©∫Èó¥Â∏ÉÂ±Ä">Âú∞ÂùÄÁ©∫Èó¥Â∏ÉÂ±Ä</a></li>
            <li><a href="#ÂÜÖÂ≠òÂú∞ÂùÄÊò†Â∞ÑÁÆ°ÁêÜ">ÂÜÖÂ≠òÂú∞ÂùÄÊò†Â∞ÑÁÆ°ÁêÜ</a></li>
            <li><a href="#ÂÜÖÂ≠òËÆøÈóÆÁÆ°ÁêÜ">ÂÜÖÂ≠òËÆøÈóÆÁÆ°ÁêÜ</a></li>
            <li><a href="#ÈîôËØØÂ§ÑÁêÜ">ÈîôËØØÂ§ÑÁêÜ</a></li>
          </ol>
        </li>
        <li><a href="#44-cpuÊ®°Âûã">4.4 CPUÊ®°Âûã</a>
          <ol>
            <li><a href="#cpuÂü∫Êú¨ÁªìÊûÑÁöÑÊäΩË±°">CPUÂü∫Êú¨ÁªìÊûÑÁöÑÊäΩË±°</a>
              <ol>
                <li><a href="#vcpuÂàùÂßãÂåñ">vCPUÂàùÂßãÂåñ</a></li>
                <li><a href="#vcpuÂêåÊ≠•">vCPUÂêåÊ≠•</a></li>
                <li><a href="#vcpuËøêË°å">vCPUËøêË°å</a></li>
              </ol>
            </li>
            <li><a href="#cpuÂπ∂ÂèëËøêË°åÂ§ö‰∏™‰ªªÂä°">CPUÂπ∂ÂèëËøêË°åÂ§ö‰∏™‰ªªÂä°</a></li>
          </ol>
        </li>
        <li><a href="#45-bootloaderÂÆûÁé∞">4.5 BootLoaderÂÆûÁé∞</a>
          <ol>
            <li><a href="#ÂÜÖÊ†∏Êñá‰ª∂ËØªÂÖ•ÂÜÖÂ≠ò">ÂÜÖÊ†∏Êñá‰ª∂ËØªÂÖ•ÂÜÖÂ≠ò</a></li>
            <li><a href="#linuxÂÜÖÊ†∏ÂºïÂØºÊµÅÁ®ã">LinuxÂÜÖÊ†∏ÂºïÂØºÊµÅÁ®ã</a></li>
            <li><a href="#ÈÖçÁΩÆzero-page">ÈÖçÁΩÆZero Page</a></li>
            <li><a href="#ÈÖçÁΩÆmptable">ÈÖçÁΩÆMPtable</a></li>
            <li><a href="#ÈÖçÁΩÆinitrdkernelÂíåÂÜÖÊ†∏ÂëΩ‰ª§Ë°å">ÈÖçÁΩÆInitrd„ÄÅKernelÂíåÂÜÖÊ†∏ÂëΩ‰ª§Ë°å</a></li>
            <li><a href="#ËøõÂÖ•‰øùÊä§Ê®°Âºè">ËøõÂÖ•‰øùÊä§Ê®°Âºè</a></li>
          </ol>
        </li>
        <li><a href="#46-‰∏≤Âè£ÂÆûÁé∞">4.6 ‰∏≤Âè£ÂÆûÁé∞</a></li>
        <li><a href="#47-epollÂÆûÁé∞">4.7 EpollÂÆûÁé∞</a>
          <ol>
            <li>
              <ol>
                <li><a href="#epollÊ°ÜÊû∂ÁÆÄÂçïÂ∞ÅË£Ö">EpollÊ°ÜÊû∂ÁÆÄÂçïÂ∞ÅË£Ö</a></li>
                <li><a href="#‰∏≤Ë°åËÆæÂ§áÂ§ÑÁêÜÈõÜÊàêepollÊú∫Âà∂">‰∏≤Ë°åËÆæÂ§áÂ§ÑÁêÜÈõÜÊàêEpollÊú∫Âà∂</a></li>
              </ol>
            </li>
          </ol>
        </li>
        <li><a href="#todo-48-È≤≤ÈπèÂπ≥Âè∞ÊîØÊåÅ-aarch64">//TODO: 4.8 È≤≤ÈπèÂπ≥Âè∞ÊîØÊåÅ: AArch64</a>
          <ol>
            <li><a href="#‰∏≠Êñ≠ÊéßÂà∂Âô®">‰∏≠Êñ≠ÊéßÂà∂Âô®</a></li>
            <li><a href="#bootloader">BootLoader</a></li>
            <li><a href="#cpuÊ®°Âûã">CPUÊ®°Âûã</a></li>
            <li><a href="#ÊûÑÂª∫ËÆæÂ§áÊ†ë">ÊûÑÂª∫ËÆæÂ§áÊ†ë</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#5-mini_stratovirt_eduÁÆÄ‰ªã">5 mini_stratovirt_eduÁÆÄ‰ªã</a>
      <ol>
        <li><a href="#51-Êû∂ÊûÑËÆæËÆ°">5.1 Êû∂ÊûÑËÆæËÆ°</a>
          <ol>
            <li><a href="#kvmÊ®°Âùó">KVMÊ®°Âùó</a></li>
            <li><a href="#ÂÜÖÂ≠òÊ®°Âùó">ÂÜÖÂ≠òÊ®°Âùó</a></li>
            <li><a href="#cpuÊ®°Âùó">CPUÊ®°Âùó</a></li>
            <li><a href="#bootloaderÊ®°Âùó">BootLoaderÊ®°Âùó</a></li>
            <li><a href="#ËÆæÂ§áÊ®°Âùó">ËÆæÂ§áÊ®°Âùó</a></li>
            <li><a href="#todo-aarch64Êû∂ÊûÑÈ¢ùÂ§ñÊîØÊåÅ">//TODO: AArch64Êû∂ÊûÑÈ¢ùÂ§ñÊîØÊåÅ</a></li>
            <li><a href="#ÊÄªÁªì">ÊÄªÁªì</a></li>
          </ol>
        </li>
        <li><a href="#52-‰ΩøÁî®ÊåáÂçó">5.2 ‰ΩøÁî®ÊåáÂçó</a>
          <ol>
            <li><a href="#ËΩØÁ°¨‰ª∂Ë¶ÅÊ±Ç">ËΩØÁ°¨‰ª∂Ë¶ÅÊ±Ç</a></li>
            <li><a href="#ÂÖ∑‰ΩìÂÆâË£ÖËøáÁ®ã">ÂÖ∑‰ΩìÂÆâË£ÖËøáÁ®ã</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#6-ÊÄªÁªì">6 ÊÄªÁªì</a></li>
    <li><a href="#7-todoÂºÄÂèëÊµÅÁ®ã">7 //TODOÔºöÂºÄÂèëÊµÅÁ®ã</a>
      <ol>
        <li><a href="#71-Âú®qemu-armÁ≥ªÁªü‰∏äËøêË°å">7.1 Âú®QEMU ARMÁ≥ªÁªü‰∏äËøêË°å</a></li>
        <li><a href="#72-‰æùÊ¨°ÊµãËØï‰∏ãÂêÑcommit">7.2 ‰æùÊ¨°ÊµãËØï‰∏ãÂêÑcommit</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/kvmbook-stratovirt_5/">Kvmbook Stratovirt_5</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2024-10-17</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    ÈòÖËØªÊó∂Èïø: 60 ÂàÜÈíü
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="0-ÂèÇËÄÉ">0 ÂèÇËÄÉ
</h1><p><a class="link" href="https://rustmagazine.github.io/rust_magazine_2021/chapter_3/hw_rust_stratovirt.html"  target="_blank" rel="noopener"
    >Âçé‰∏∫ | Âü∫‰∫éRustÁöÑ‰∏ã‰∏Ä‰ª£ËôöÊãüÂåñÂπ≥Âè∞-StratoVirt - RustÁ≤æÈÄâ (rustmagazine.github.io)</a></p>
<p><a class="link" href="https://blog.csdn.net/u012520854/article/details/125158629"  target="_blank" rel="noopener"
    >StratoVirt‰∏≠MicroVMÂêØÂä®ËøáÁ®ã-CSDNÂçöÂÆ¢</a></p>
<h1 id="1-stratovirtÊ¶ÇËø∞">1 StratoVirtÊ¶ÇËø∞
</h1><p>StratoVirtÊòØËÆ°ÁÆó‰∫ß‰∏ö‰∏≠Èù¢Âêë‰∫ëÊï∞ÊçÆ‰∏≠ÂøÉÁöÑ‰ºÅ‰∏öÁ∫ßËôöÊãüÂåñÂπ≥Âè∞ÔºåÂÆûÁé∞‰∫Ü‰∏ÄÂ•óÁªü‰∏ÄÊû∂ÊûÑÔºåÊîØÊåÅËôöÊãüÊú∫„ÄÅÂÆπÂô®ÂíåServerless‰∏âÁßçÂú∫ÊôØÔºåÂú®ËΩªÈáè‰ΩéÂô™„ÄÅËΩØÁ°¨ÂçèÂêå„ÄÅÂÆâÂÖ®Á≠âÊñπÈù¢ÂÖ∑Â§áÂÖ≥ÈîÆÊäÄÊúØÁ´û‰∫â‰ºòÂäø„ÄÇStratoVirtÂú®Êû∂ÊûÑËÆæËÆ°ÂíåÊé•Âè£‰∏äÈ¢ÑÁïô‰∫ÜÁªÑ‰ª∂ÂåñÊãºË£ÖÁöÑËÉΩÂäõÂíåÊé•Âè£ÔºåÂõ†Ê≠§StratoVirtÂèØ‰ª•ÊåâÈúÄÁÅµÊ¥ªÁªÑË£ÖÈ´òÁ∫ßÁâπÊÄßÔºåÁõ¥Ëá≥ÊºîÂåñÂà∞ÊîØÊåÅÊ†áÂáÜËôöÊãüÂåñÔºåÂú®ÁâπÊÄßÈúÄÊ±Ç„ÄÅÂ∫îÁî®Âú∫ÊôØÂíåËΩªÂø´ÁÅµÂ∑ß‰πãÈó¥ÊâæÂà∞ÊúÄ‰Ω≥ÁöÑÂπ≥Ë°°ÁÇπ„ÄÇ</p>
<p>Êú¨Êñá‰∏ªË¶ÅËÆ≤Ëø∞‰∫ÜÔºö</p>
<ul>
<li>‰ªãÁªçStratoVirtÁöÑÂü∫Êú¨ËÉΩÂäõ‰∏éÁâπÊÄßÔºå‰ΩøËØªËÄÖ‰∫ÜËß£StratoVirtÁöÑ‰ΩøÁî®Âú∫ÊôØ‰ª•ÂèäÊäÄÊúØÁâπÁÇπÔºõ</li>
<li>‰ªãÁªçËôöÊãüÊú∫ÊäÄÊúØÁöÑÊºîËøõÔºõ</li>
<li>‰ªãÁªçStratoVirtËôöÊãüÂåñÊäÄÊúØÂéüÁêÜÔºå‰∏∫ÂêéÁª≠ÂÆûÁé∞ÂÅöÁêÜËÆ∫Èì∫Âû´Ôºõ</li>
<li>ÁªìÂêà‰ª£Á†ÅËÆ≤Ëß£StratoVirtÁöÑÂü∫Êú¨ÂÆûÁé∞Ôºå‰ªéÈõ∂ÂºÄÂßãÊâìÈÄ†‰∏Ä‰∏™ÂÖ∑Â§áÂü∫Êú¨ÂäüËÉΩÁöÑËΩªÈáèÁ∫ßËôöÊãüÂåñÂπ≥Âè∞„ÄÇ</li>
</ul>
<hr>
<p>StratoÂèñËá™Âú∞ÁêÉÂ§ßÊ∞îÂ±Ç‰∏≠ÁöÑÂπ≥ÊµÅÂ±Ç (stratosphere)„ÄÇÂ§ßÊ∞îÂ±ÇÂèØ‰ª•‰øùÊä§Âú∞ÁêÉ‰∏çÂèóÂ§ñÁïåÁéØÂ¢É‰æµÂÆ≥ÔºåÂπ≥ÊµÅÂ±ÇÂàôÊòØÂ§ßÊ∞îÂ±Ç‰∏≠ÊúÄÁ®≥ÂÆöÁöÑ‰∏ÄÂ±ÇÔºõÁ±ª‰ººÁöÑÔºåËôöÊãüÂåñÂ±ÇÊòØÊØîÊìç‰ΩúÁ≥ªÁªüÊõ¥‰∏∫Â∫ïÂ±ÇÁöÑÈöîÁ¶ªÂ±ÇÔºåÊó¢ËÉΩ‰øùÊä§Êìç‰ΩúÁ≥ªÁªüÂπ≥Âè∞‰∏çÂèó‰∏äÂ±ÇÊÅ∂ÊÑèÂ∫îÁî®ÁöÑÁ†¥ÂùèÔºåÂèàËÉΩ‰∏∫Ê≠£Â∏∏Â∫îÁî®Êèê‰æõÁ®≥ÂÆöÂèØÈù†ÁöÑËøêË°åÁéØÂ¢É„ÄÇStratoVirt‰∏≠ÁöÑStratoÂØìÊÑèÂÖ∂‰∏∫‰øùÊä§openEulerÂπ≥Âè∞‰∏ä‰∏öÂä°Âπ≥Á®≥ËøêË°åÁöÑËΩªËñÑ‰øùÊä§Â±ÇÔºõÂêåÊó∂ÔºåÂÆÉ‰πüÊâøËΩΩ‰∫ÜÈ°πÁõÆÁöÑÊÑøÊôØ‰∏éÊú™Êù•ÔºöËΩªÈáè„ÄÅÁÅµÊ¥ª„ÄÅÂÆâÂÖ®ÂíåÂÆåÊï¥ÁöÑ‰øùÊä§ËÉΩÂäõ„ÄÇ</p>
<p>StratoVirtÊòØopenEulerÂπ≥Âè∞‰æùÊâò‰∫éËôöÊãüÂåñÊäÄÊúØÊâìÈÄ†ÁöÑÁ®≥ÂÆöÂíåÂùöÂõ∫ÁöÑ‰øùÊä§Â±ÇÔºåÂÆÉÈáçÊûÑ‰∫ÜopenEulerËôöÊãüÂåñÂ∫ïÂ∫ßÔºåÂÖ∑Êúâ‰ª•‰∏ã<strong>ÂÖ≠Â§ßÊäÄÊúØÁâπÁÇπ„ÄÇ</strong></p>
<ol>
<li>**Âº∫ÂÆâÂÖ®ÊÄß‰∏éÈöîÁ¶ªÊÄß„ÄÇ**ÈááÁî®ÂÜÖÂ≠òÂÆâÂÖ®ËØ≠Ë®ÄRustÁºñÂÜôÔºå‰øùËØÅËØ≠Ë®ÄÁ∫ßÂÆâÂÖ®ÊÄßÔºõÂü∫‰∫éÁ°¨‰ª∂ËæÖÂä©ËôöÊãüÂåñÂÆûÁé∞ÂÆâÂÖ®Â§öÁßüÊà∑ÈöîÁ¶ªÔºåÂπ∂ÈÄöËøá <code>seccomp</code> Ëøõ‰∏ÄÊ≠•Á∫¶ÊùüÈùûÂøÖË¶ÅÁöÑÁ≥ªÁªüË∞ÉÁî®ÔºåÂáèÂ∞èÁ≥ªÁªüÊîªÂáªÈù¢„ÄÇ</li>
<li>**ËΩªÈáè‰ΩéÂô™„ÄÇ**ËΩªÈáèÂåñÂú∫ÊôØ‰∏ãÂÜ∑ÂêØÂä®Êó∂Èó¥ &lt; 50msÔºåÂÜÖÂ≠òÂºÄÈîÄ &lt; 4MB„ÄÇ</li>
<li>**È´òÈÄüÁ®≥ÂÆöÁöÑI/OËÉΩÂäõ„ÄÇ**ÂÖ∑ÊúâÁ≤æÁÆÄÁöÑËÆæÂ§áÊ®°ÂûãÔºåÂπ∂Êèê‰æõ‰∫ÜÁ®≥ÂÆöÈ´òÈÄüÁöÑI/OËÉΩÂäõ„ÄÇ</li>
<li>**ËµÑÊ∫ê‰º∏Áº©„ÄÇ**ÂÖ∑ÊúâÊØ´ÁßíÁ∫ßÂà´ÁöÑËÆæÂ§á‰º∏Áº©Êó∂Âª∂Ôºå‰∏∫ËΩªÈáèÂåñË¥üËΩΩÊèê‰æõÁÅµÊ¥ªÁöÑËµÑÊ∫ê‰º∏Áº©ËÉΩÂäõ„ÄÇ</li>
<li>**ÂÖ®Âú∫ÊôØÊîØÊåÅ„ÄÇ**ÁõÆÂâçÊîØÊåÅx86ÂíåARMÂπ≥Âè∞„ÄÇx86ÊîØÊåÅVT„ÄÅÈ≤≤ÈπèÊîØÊåÅKunpeng-VÔºåÂÆûÁé∞Â§ö‰ΩìÁ≥ªÁ°¨‰ª∂Âä†ÈÄüÔºõÂèØ‰∏éÂÆπÂô®KubernetesÁîüÊÄÅÊó†ÁºùÈõÜÊàêÔºåÂú®ËôöÊãüÊú∫„ÄÅÂÆπÂô®ÂíåServerlessÂú∫ÊôØÊúâÂπøÈòîÁöÑÂ∫îÁî®Á©∫Èó¥„ÄÇ</li>
<li>**Êâ©Â±ïÊÄß„ÄÇ**Êû∂ÊûÑËÆæËÆ°ÂÆåÂ§áÔºåÂêÑ‰∏™ÁªÑ‰ª∂ÂèØÁÅµÊ¥ªÂú∞ÈÖçÁΩÆÂíåÊãÜÂàÜÔºõËÆæÂ§áÊ®°ÂûãÂèØÊâ©Â±ïÔºåÂèØ‰ª•Êâ©Â±ïPCIeÁ≠âÂ§çÊùÇËÆæÂ§áËßÑËåÉÔºåÂêëÈÄöÁî®Ê†áÂáÜËôöÊãüÊú∫ÊºîËøõ„ÄÇ</li>
</ol>
<h1 id="2-ÂèëÂ±ïËÉåÊôØ">2 ÂèëÂ±ïËÉåÊôØ
</h1><p>Âú®ÂºÄÊ∫êËôöÊãüÂåñÊäÄÊúØÁöÑÂèëÂ±ïÂéÜÁ®ã‰∏≠ÔºåQEMU/KVM ‰∏ÄÁõ¥ÊòØÊï¥‰∏™ËôöÊãüÂåñ‰∫ß‰∏öÂèëÂ±ïÁöÑÂü∫Áü≥Âíå‰∏ªÁ∫ø„ÄÇÈöèÁùÄÂ§öÂπ¥ÁöÑÂèëÂ±ïÂíåËø≠‰ª£ÔºåQEMU‰πüÊ≤âÁßØ‰∫ÜÂ∫ûÂ§ßÁöÑ‰ª£Á†ÅÂü∫Á∫øÂíåÁπÅÂ§öÁöÑÂéÜÂè≤ËÆæÂ§á„ÄÇÊçÆÁªüËÆ° QEMU Â∑≤Êúâ <code>157</code> ‰∏áË°å‰ª£Á†ÅÔºåËÄå‰∏îÂÖ∂‰∏≠ÂæàÂ§ß‰∏ÄÈÉ®ÂàÜ‰ª£Á†ÅÊòØÁî®‰∫éÂéÜÂè≤ÈÅóÁïô (legacy) ÂäüËÉΩÊàñËÄÖËÆæÂ§áÁöÑÔºåÂäüËÉΩÂíåËÆæÂ§á‰∏•ÈáçËÄ¶ÂêàÂú®‰∏ÄËµ∑ÔºåÂØºËá¥Âú®ËΩªÈáèÂåñÂú∫ÊôØ‰∏≠Êó†Ê≥ïËΩªË£Ö‰∏äÈòµ„ÄÇ</p>
<blockquote>
<p><strong>StratoVirtÈááÁî®Á≤æÁÆÄÁöÑËÆæÂ§áÊ®°ÂûãÔºåÊèê‰æõÈ´òÈÄüÁ®≥ÂÆöÁöÑI/OËÉΩÂäõÔºåÂÅöÂà∞ËΩªÈáè‰ΩéÂô™ÔºåËææÂà∞ÊØ´ÁßíÁ∫ßÁöÑËµÑÊ∫ê‰º∏Áº©ËÉΩÂäõÔºåÂêåÊó∂Êû∂ÊûÑËÆæËÆ°È¢ÑÁïô‰∫ÜÁªÑ‰ª∂ÂåñËÉΩÂäõÔºåÊîØÊíëÂêëÊ†áÂáÜËôöÊãüÂåñÊñπÂêëÊºîËøõ„ÄÇ</strong></p>
</blockquote>
<p>Âè¶‰∏ÄÊñπÈù¢ÔºåÂú®ËøáÂéªÂçÅÂá†Âπ¥QEMUÁöÑCVEÔºàCommon Vulnerabilities &amp; ExposuresÔºåÈÄöÁî®ÊºèÊ¥ûÊä´Èú≤ÔºâÂÆâÂÖ®ÈóÆÈ¢ò‰∏≠ÔºåÂèëÁé∞ÂÖ∂‰∏≠ÊúâÂ∞ÜËøë‰∏ÄÂçäÊòØÂõ†‰∏∫ÂÜÖÂ≠òÈóÆÈ¢òÂØºËá¥ÁöÑÔºå‰æãÂ¶ÇÁºìÂÜ≤Âå∫Ê∫¢Âá∫„ÄÅÂÜÖÂ≠òÈùûÊ≥ïËÆøÈóÆÁ≠â„ÄÇÂ¶Ç‰ΩïÊúâÊïàÈÅøÂÖç‰∫ßÁîüÂÜÖÂ≠òÈóÆÈ¢òÔºåÊàê‰∏∫ÁºñÁ®ãËØ≠Ë®ÄÈÄâÂûãÊñπÈù¢ÁöÑÈáçË¶ÅËÄÉËôë„ÄÇÂõ†Ê≠§Ôºå‰∏ìÊ≥®‰∫éÂÆâÂÖ®ÁöÑRustËØ≠Ë®ÄËÑ±È¢ñËÄåÂá∫„ÄÇRustËØ≠Ë®ÄÊã•ÊúâÂº∫Â§ßÁöÑÁ±ªÂûãÁ≥ªÁªü„ÄÅÊâÄÊúâÊùÉÁ≥ªÁªü„ÄÅÂÄüÁî®ÂíåÁîüÂëΩÂë®ÊúüÁ≠âÊú∫Âà∂Ôºå‰∏ç‰ªÖ‰øùËØÅÂÜÖÂ≠òÂÆâÂÖ®ÔºåËøò‰øùËØÅÂπ∂ÂèëÂÆâÂÖ®ÔºåÊûÅÂ§ßÂú∞ÊèêÂçáËΩØ‰ª∂ÁöÑË¥®Èáè„ÄÇÂú®ÊîØÊåÅÂÆâÂÖ®ÊÄßÁöÑÂêåÊó∂ÔºåÂÖ∑ÊúâÈõ∂ÊàêÊú¨ÊäΩË±°ÁöÑÁâπÁÇπÔºåÊó¢ÊèêÂçá‰ª£Á†ÅÁöÑÂèØËØªÊÄßÔºåÂèà‰∏çÂΩ±Âìç‰ª£Á†ÅÁöÑËøêË°åÊó∂ÊÄßËÉΩ„ÄÇÂêåÊó∂ÔºåRustËØ≠Ë®ÄÊã•ÊúâÂº∫Â§ßÁöÑËΩØ‰ª∂ÂåÖÁÆ°ÁêÜÂô®ÂíåÈ°πÁõÆÁÆ°ÁêÜÂ∑•ÂÖ∑‚Äî‚Äî <code>Cargo</code>Ôºå‰∏ç‰ªÖËÉΩÂ§üÊñπ‰æø„ÄÅÁªü‰∏ÄÂíåÁÅµÊ¥ªÂú∞ÁÆ°ÁêÜÈ°πÁõÆÔºåËøòÊèê‰æõ‰∫ÜÂ§ßÈáèÁöÑ‰ª£Á†ÅÊâ´ÊèèÂ∑•ÂÖ∑ÔºåËÉΩËøõ‰∏ÄÊ≠•ÊèêÂçáÂºÄÂèëËÄÖÁöÑÁºñÁ†ÅÈ£éÊ†ºÂíå‰ª£Á†ÅË¥®Èáè„ÄÇ</p>
<p>‰∏öÁïåÊúâÂæàÂ§öÂéÇÂïÜ‰πüÂú®Â∞ùËØï‰ΩøÁî®RustËØ≠Ë®ÄÂèëÂ±ïËôöÊãüÂåñÊäÄÊúØ„ÄÇË∞∑Ê≠åÂÖ¨Âè∏ÊòØÊúÄÊó©Â∞ùËØï‰ΩøÁî®RustËØ≠Ë®ÄËøõË°åËôöÊãüÂåñÂºÄÂèëÁöÑÂéÇÂïÜ‰πã‰∏ÄÔºåÊé®Âá∫‰∫ÜCrosVMÈ°πÁõÆÔºåÂÆÉÊòØChromeÊìç‰ΩúÁ≥ªÁªü‰∏≠Áî®‰∫éÂàõÂª∫ËôöÊãüÊú∫ÁöÑÂ∫îÁî®„ÄÇÂêéÊù•‰∫öÈ©¨ÈÄäÂÖ¨Âè∏Âü∫‰∫éË∞∑Ê≠åÂÖ¨Âè∏ÂºÄÊ∫êÁöÑCrosVMÈ°πÁõÆÁöÑÈÉ®ÂàÜÂäüËÉΩÔºå‰πüÊé®Âá∫‰∫ÜÂü∫‰∫éRustËØ≠Ë®ÄÁöÑËΩªÈáèÁ∫ßËôöÊãüÂåñÈ°πÁõÆFirecracker„ÄÇ‰∏§‰∏™ÂéÇÂïÜÂú®ÂºÄÂèëÁöÑËøáÁ®ã‰∏≠ÔºåÂ∞ÜËôöÊãüÂåñËΩØ‰ª∂Ê†àÊâÄÈúÄÁöÑÂü∫Á°ÄÁªÑ‰ª∂ËøõË°åËß£ËÄ¶ÂåñËÆæËÆ°ÔºåÂç¥ÂèëÁé∞‰∫ÜÂæàÂ§öÈáçÂ§çÁöÑÈÄöÁî®ÁªÑ‰ª∂Ôºå‰∏∫‰∫Ü‰∏çÈáçÂ§çÈÄ†ËΩÆÂ≠êÔºåÊàêÁ´ã‰∫ÜRust-VMMÂºÄÊ∫êÁ§æÂå∫ÔºåÁî®‰∫éÁÆ°ÁêÜÊâÄÊúâÈÄöÁî®ÁöÑÂü∫Á°ÄÁªÑ‰ª∂Ôºå‰æø‰∫éÊûÑÂª∫Ëá™ÂÆö‰πâÁöÑHypervisor„ÄÇËã±ÁâπÂ∞îÂÖ¨Âè∏‰∏ªÂØºÁöÑCloud HypervisorÈ°πÁõÆ‰πüÊòØÂü∫‰∫éRust-VMMÊù•ÂÆûÁé∞ÂØπÊ†áÂáÜËôöÊãüÂåñÁöÑÊîØÊåÅ„ÄÇ</p>
<blockquote>
<p><strong>StratoVirtÈ°πÁõÆÂêåÊ†∑‰πüÊòØÂü∫‰∫éRust-VMMÂºÄÂèëÁöÑÔºåÊó®Âú®ÂÆûÁé∞‰∏ÄÂ•óÊû∂ÊûÑÊó¢ËÉΩÊª°Ë∂≥ËΩªÈáèÁ∫ßËôöÊãüÂåñÂú∫ÊôØÔºåÂèàËÉΩÊª°Ë∂≥Ê†áÂáÜËôöÊãüÂåñÂú∫ÊôØÁöÑ‰ΩøÁî®„ÄÇ</strong></p>
</blockquote>
<h1 id="3-stratovirtÊû∂ÊûÑËÆæËÆ°">3 StratoVirtÊû∂ÊûÑËÆæËÆ°
</h1><p>Â¶ÇÂõæ6-1ÊâÄÁ§∫ÔºåStratoVirtÊ†∏ÂøÉÊû∂ÊûÑËá™È°∂Âêë‰∏ãÂàÜ‰∏∫‰ª•‰∏ã‰∏âÂ±Ç„ÄÇ</p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/ÂæÆ‰ø°Êà™Âõæ_20231202121525.png" style="zoom: 33%;" />
<ol>
<li>**OCIÔºàOpen Container InitiativeÔºåÂºÄÊîæÂÆπÂô®ÔºâÂÖºÂÆπÊé•Âè£„ÄÇ**ÂÖºÂÆπQMPÔºàQEMU Monitor ProtocolÔºåQEMUÁõëÊéßÂçèËÆÆÔºâÔºåÂÖ∑ÊúâÂÆåÂ§áÁöÑOCIÂÖºÂÆπËÉΩÂäõ„ÄÇ</li>
<li>**ÂºïÂØºÂä†ËΩΩÁ®ãÂ∫è (BootLoader)„ÄÇ**ÊäõÂºÉ‰º†ÁªüÁöÑ BIOS+GRUBÔºàGRand Unified BootloaderÔºåÂ§öÈáçÊìç‰ΩúÁ≥ªÁªüÂêØÂä®ÁÆ°ÁêÜÂô®ÔºâÂêØÂä®Ê®°ÂºèÔºåÂÆûÁé∞‰∫ÜÊõ¥ËΩªÊõ¥Âø´ÁöÑBootLoaderÔºåÂπ∂ËææÂà∞ÊûÅÈôêÂêØÂä®Êó∂Âª∂„ÄÇ</li>
<li>**ËΩªÈáèÁ∫ßËôöÊãüÊú∫ (MicroVM)„ÄÇ**ÂÖÖÂàÜÂà©Áî®ËΩØÁ°¨‰ª∂ÂçèÂêåËÉΩÂäõÔºåÁ≤æÁÆÄÂåñËÆæÂ§áÊ®°ÂûãÔºå‰ΩéÊó∂Âª∂ËµÑÊ∫ê‰º∏Áº©ËÉΩÂäõ„ÄÇÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</li>
</ol>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/ÂæÆ‰ø°Êà™Âõæ_20231202121717.png" style="zoom: 50%;" />
<hr>
<p>StratoVirtÊ∫êÁ†Å‰∏ªË¶ÅÂàÜ‰∏∫Âõõ‰∏™ÈÉ®ÂàÜÔºåÂèØÂèÇËÄÉStratoVirtÁΩëÁ´ô‰∏ªÈ°µÔºàhttps://gitee.com/openeuler/stratovirt‰∏≠ÁöÑÊ†áÁ≠æv0.2.0‰πãÂâç‰ª£Á†ÅÔºâÂÖ∑‰ΩìÂ¶Ç‰∏ã„ÄÇ</p>
<ul>
<li><code>address_space</code>ÔºöÂú∞ÂùÄÁ©∫Èó¥Ê®°ÊãüÔºåÂÆûÁé∞Âú∞ÂùÄÂ†ÜÂè†Á≠âÂ§çÊùÇÂú∞ÂùÄÁÆ°ÁêÜÊ®°Âºè„ÄÇ</li>
<li><code>boot_loader</code>ÔºöÂÜÖÊ†∏ÂºïÂØºÁ®ãÂ∫èÔºåÂÆûÁé∞Âø´ÈÄüÂä†ËΩΩÂíåÂêØÂä®ÂäüËÉΩ„ÄÇ</li>
<li><code>device_model</code>Ôºö‰ªøÁúüÂêÑÁ±ªËÆæÂ§áÔºåÂèØÊâ©Â±ï„ÄÅÂèØÁªÑÂêà„ÄÇ</li>
<li><code>machine_manager</code>ÔºöÊèê‰æõËôöÊãüÊú∫ÁÆ°ÁêÜÊé•Âè£ÔºåÂÖºÂÆπQMPÁ≠âÂ∏∏Áî®ÂçèËÆÆÔºåÂèØÊâ©Â±ï„ÄÇ</li>
</ul>
<p>ÂΩìÂâç StratoVirt ÂºÄÊ∫ê‰ª£Á†Å‰∏≠ÂÆûÁé∞ÁöÑÊòØËΩªÈáèÂåñËôöÊãüÊú∫Ê®°ÂûãÔºåÊòØËÉΩÂÆûÁé∞ËøêË°å‰∏öÂä°Ë¥üËΩΩÁöÑÊúÄÂ∞èËÆæÂ§áÈõÜÂêàÔºå‰ΩÜÂ∑≤ÁªèÂåÖÊã¨ËôöÊãüÂåñ‰∏âÂ§ßÂ≠êÁ≥ªÁªüÔºöCPUÂ≠êÁ≥ªÁªü„ÄÅÂÜÖÂ≠òÂ≠êÁ≥ªÁªü„ÄÅI/OËÆæÂ§áÂ≠êÁ≥ªÁªüÔºàÂåÖÊã¨‰∏≠Êñ≠ÊéßÂà∂Âô®ÂíåÂêÑÁ±ª‰ªøÁúüËÆæÂ§á„ÄÅ‰æãÂ¶ÇvirtioËÆæÂ§á„ÄÅ‰∏≤Ë°åËÆæÂ§áÁ≠âÔºâ„ÄÇ‰∏ãÈù¢ÂàÜÂà´‰ªãÁªçÂÖ∂Âü∫Êú¨ÂäüËÉΩÂíåÁâπÊÄß„ÄÇ</p>
<h2 id="31-cpuÂ≠êÁ≥ªÁªü">3.1 CPUÂ≠êÁ≥ªÁªü
</h2><p>StratoVirtÊòØ‰∏ÄÂ•óËΩØÁ°¨‰ª∂ÁªìÂêàÁöÑËôöÊãüÂåñËß£ÂÜ≥ÊñπÊ°àÔºåÂÖ∂Ëøê‰Ωú‰æùËµñ‰∫éÁ°¨‰ª∂ËæÖÂä©ËôöÊãüÂåñÁöÑËÉΩÂäõÔºàÂ¶ÇVT-xÊàñKunpeng-VÔºâ„ÄÇCPUÂ≠êÁ≥ªÁªüÁöÑÂÆûÁé∞‰πüÊòØÁ¥ßÂØÜ‰æùËµñ‰∫éÁ°¨‰ª∂ËæÖÂä©ËôöÊãüÂåñÊäÄÊúØÔºàÂÜÖÊ†∏KVMÊ®°ÂùóÔºâÔºå‰æãÂ¶ÇÂØπ‰∫éx86Êû∂ÊûÑÁöÑCPUËÄåË®ÄÔºåÁ°¨‰ª∂ËæÖÂä©ËôöÊãüÂåñ‰∏∫CPUÂ¢ûÂä†‰∫Ü‰∏ÄÁßçÊñ∞ÁöÑÊ®°ÂºèÔºåÂç≥ÈùûÊ†πÊ®°ÂºèÔºåÂú®ËØ•Ê®°Âºè‰∏ãÔºåCPUÊâßË°åÁöÑÂπ∂‰∏çÊòØÁâ©ÁêÜÊú∫ÁöÑÊåá‰ª§ÔºåËÄåÊòØËôöÊãüÊú∫ÁöÑÊåá‰ª§„ÄÇËøôÁßçÊåá‰ª§ÊâßË°åÊñπÂºèÊ∂àÈô§‰∫ÜÂ§ßÈÉ®ÂàÜÊÄßËÉΩÂºÄÈîÄÔºåÈùûÂ∏∏È´òÊïà„ÄÇ‰ΩÜÊòØÊïèÊÑüÊåá‰ª§ÔºàÂ¶ÇI/OÊåá‰ª§Ôºâ‰∏çËÉΩÈÄöËøáËøôÁßçÊñπÂºèÊâßË°åÔºåËÄå‰∏îËøòÊòØÂº∫Âà∂Â∞ÜCPUÈÄÄÂá∫Âà∞Ê†πÊ®°Âºè‰∏ã‰∫§ÁªôHypervisorÁ®ãÂ∫èÔºàÂÜÖÊ†∏ÊÄÅKVMÊ®°Âùó/Áî®Êà∑ÊÄÅStratoVirtÔºâÂéªÂ§ÑÁêÜÔºåÂ§ÑÁêÜÂÆåÂÜçÈáçÊñ∞ËøîÂõûÂà∞ÈùûÊ†πÊ®°ÂºèÔºåÊâßË°å‰∏ã‰∏ÄÊù°ËôöÊãüÊú∫ÁöÑÊåá‰ª§„ÄÇ</p>
<p>ËÄåStratoVirt‰∏≠ÁöÑCPUÂ≠êÁ≥ªÁªü‰∏ªË¶ÅÂõ¥ÁªïÁùÄKVMÊ®°Âùó‰∏≠ÂØπCPUÁöÑÊ®°ÊãüÊù•ÂÆûÁé∞Ôºå‰∏∫‰∫ÜÊîØÊåÅKVMÊ®°Âùó‰∏≠ÂØπCPUÁöÑÊ®°ÊãüÔºåCPUÂ≠êÁ≥ªÁªü‰∏ªË¶ÅË¥üË¥£Â§ÑÁêÜÈÄÄÂá∫Âà∞Ê†πÊ®°ÂºèÁöÑ‰∫ã‰ª∂Ôºå‰ª•ÂèäÂú®ÂÆ¢Êà∑Êú∫Êìç‰ΩúÁ≥ªÁªüÂÜÖÊ†∏ÂºÄÂßãËøêË°åÂâçÂØπvCPUÁöÑÂØÑÂ≠òÂô®Á≠âËôöÊãüÁ°¨‰ª∂ÁöÑÁä∂ÊÄÅËøõË°åÂàùÂßãÂåñ„ÄÇÊï¥‰∏™CPUÂ≠êÁ≥ªÁªüÁöÑËÆæËÆ°Ê®°ÂûãÂ¶ÇÂõæ6-3ÊâÄÁ§∫„ÄÇ</p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231202121917.png" style="zoom: 33%;" />
<p>StratoVirt‰∏∫ÊØè‰∏™vCPUÂàõÂª∫‰∫Ü‰∏Ä‰∏™Áã¨Á´ãÁöÑÁ∫øÁ®ãÔºåÁî®Êù•Â§ÑÁêÜÈÄÄÂá∫Âà∞Ê†πÊ®°ÂºèÁöÑ‰∫ã‰ª∂ÔºåÂåÖÊã¨I/OÁöÑ‰∏ãÂèë„ÄÅÁ≥ªÁªüÂÖ≥Êú∫‰∫ã‰ª∂„ÄÅÁ≥ªÁªüÂºÇÂ∏∏‰∫ã‰ª∂Á≠âÔºåËøô‰∫õ‰∫ã‰ª∂ÁöÑÂ§ÑÁêÜ‰ª•ÂèäKVMÂØπvCPUÊé•Âè£ÁöÑrunÂáΩÊï∞Áã¨Âç†‰∏Ä‰∏™ÂçïÁã¨Á∫øÁ®ãÔºåÁî®Êà∑ÂèØ‰ª•Ëá™Â∑±ÈÄöËøáÂØπvCPUÁ∫øÁ®ãËøõË°åÁªëÊ†∏Á≠âÊñπÂºèËÆ©ËôöÊãüÊú∫ÁöÑvCPUËé∑ÂèñÁâ©ÁêÜÊú∫CPUËøë‰ººÁôæÂàÜ‰πãÁôæÁöÑÊÄßËÉΩ„ÄÇ</p>
<p>Âú®ÂÆ¢Êà∑Êú∫Êìç‰ΩúÁ≥ªÁªüÁöÑÂÜÖÊ†∏ËøêË°åÂâçÔºåÂØπvCPUÂØÑÂ≠òÂô®ËôöÊãüÁ°¨‰ª∂Áä∂ÊÄÅ‰ø°ÊÅØÁöÑÂàùÂßãÂåñÂàôÊòØ‰∏éStratoVirtÁöÑÂè¶‰∏Ä‰∏™Ê®°ÂùóBootLoaderÁõ∏‰∫íÁªìÂêàÔºåÂú®BootLoader‰∏≠ÂÆûÁé∞‰∫Ü‰∏ÄÁßçÂø´ÈÄüÂºïÂØºÂêØÂä®LinuxÂÜÖÊ†∏ÈïúÂÉèÁöÑÊñπÊ≥ï„ÄÇÂú®ËøôÂ•óÂêØÂä®ÊµÅÁ®ã‰∏≠ÔºåBootLoaderÂ∞Ü‰∏ªÂä®ÂÆåÊàê‰º†ÁªüBIOSÂØπ‰∏Ä‰∫õÁ°¨‰ª∂‰ø°ÊÅØÁöÑËé∑ÂèñÔºåÂ∞ÜÂØπÂ∫îÁöÑÁ°¨‰ª∂Ë°®‰øùÂ≠òÂú®ËôöÊãüÊú∫ÂÜÖÂ≠ò‰∏≠ÔºåÂêåÊó∂Â∞ÜÊèê‰æõ‰∏ÄÂÆöÁöÑÂØÑÂ≠òÂô®ËÆæÁΩÆ‰ø°ÊÅØÔºåËøô‰∫õÂØÑÂ≠òÂô®ËÆæÁΩÆ‰ø°ÊÅØÂ∞Ü‰º†ËæìÁªôCPUÊ®°ÂùóÔºåÈÄöËøáËÆæÁΩÆCPUÁªìÊûÑ‰∏≠ÁöÑÂØÑÂ≠òÂô®ÂÄºÔºåËÆ©ËôöÊãüÊú∫CPUË∑≥ËøáÂÆûÊ®°ÂºèÁõ¥Êé•ËøõÂÖ•‰øùÊä§Ê®°ÂºèËøêË°åÔºåËøôÊ†∑ÂÜÖÊ†∏Â∞±ËÉΩÁõ¥Êé•‰ªé‰øùÊä§Ê®°ÂºèÁöÑÂÖ•Âè£ÂºÄÂßãËøêË°åÔºå‰ªéËÄåËÆ©StratoVirtÁöÑÂêØÂä®ÊµÅÁ®ãÊõ¥ËΩªÈáèÂø´ÈÄü„ÄÇ</p>
<p>CPUÂ≠êÁ≥ªÁªüÂè¶‰∏ÄÂ§ßËÅåË¥£Â∞±ÊòØÁÆ°ÁêÜvCPUÁöÑÁîüÂëΩÂë®ÊúüÔºåÂåÖÊã¨ÂàõÂª∫(new)„ÄÅ‰ΩøËÉΩ(realize)„ÄÅËøêË°å(run)„ÄÅÊöÇÂÅú(pause)„ÄÅÊÅ¢Â§ç(resume)ÂíåÈîÄÊØÅ(destroy)„ÄÇÂàõÂª∫Âíå‰ΩøËÉΩËøáÁ®ãÂ∞±ÊòØÁªìÊûÑ‰ΩìÂàõÂª∫ÂíåÂØÑÂ≠òÂô®ÂàùÂßãÂåñÁöÑÊµÅÁ®ãÔºåËøêË°åËøáÁ®ãÂç≥ÂÆûÁé∞KVM‰∏≠vCPUËøê‰ΩúÂíåvCPUÈÄÄÂá∫‰∫ã‰ª∂Â§ÑÁêÜÁöÑÊµÅÁ®ã„ÄÇÂêåÊó∂ÔºåÂæóÁõä‰∫éRustËØ≠Ë®ÄÂØπÁ∫øÁ®ãÂπ∂ÂèëÂíåÂêåÊ≠•ÁöÑÁ≤æÂØÜÊéßÂà∂ÔºåCPUÂ≠êÁ≥ªÁªüÁî®‰∏ÄÁßçÁÆÄÂçïÁöÑÊñπÂºèÂÆûÁé∞‰∫ÜÊöÇÂÅú‰∏éÊÅ¢Â§çÁöÑÂäüËÉΩ„ÄÇ‰ªªÊÑèvCPUÁ∫øÁ®ãÊî∂Âà∞ÊöÇÂÅúÊàñÊÅ¢Â§çÁöÑÂëΩ‰ª§ÂêéÔºåÂ∞±‰ºöÈÄöËøáÊîπÂèò‰ø°Âè∑ÈáèÁöÑÊñπÂºèÔºåÂ∞ÜËØ•Á∫øÁ®ãvCPUÁöÑÁä∂ÊÄÅÂèòÂåñ‰º†ÈÄíÂà∞ÊâÄÊúâÁöÑvCPUÁ∫øÁ®ãÔºåÂÆûÁé∞Êï¥Âè∞ËôöÊãüÊú∫ÁöÑÊöÇÂÅúÊàñÊÅ¢Â§çÔºåÊµÅÁ®ãÂ¶ÇÂõæ6-4ÂíåÂõæ6-5ÊâÄÁ§∫„ÄÇ</p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/ÂæÆ‰ø°Êà™Âõæ_20231202122047.png" style="zoom:33%;" />
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/ÂæÆ‰ø°Êà™Âõæ_20231202122108.png" style="zoom:33%;" />
<p>ÂΩìËôöÊãüÊú∫ÁöÑÁîüÂëΩÂë®ÊúüÁªìÊùüÊó∂ÔºåÂêåÊ†∑Ë¶Å‰ªéÂØπvCPUÁöÑÈîÄÊØÅÂºÄÂßãÂÆûÁé∞ÔºåÂú®StratoVirt‰∏≠ÔºåvCPUÈîÄÊØÅÂàÜ‰∏∫‰∏§ÁßçÊÉÖÂÜµ„ÄÇ</p>
<p>(1)ÂÆ¢Êà∑Êú∫ÂÜÖÈÉ®Ê≠£Â∏∏ÂÖ≥Êú∫ÔºöÂ∞ÜÈÄöËøáÂØπVM-Exit‰∫ã‰ª∂‰∏≠ÁöÑÂÆ¢Êà∑Êú∫ÂÖ≥Êú∫(GUEST_SHUTDOWN)‰∫ã‰ª∂ËøõË°åÊçïËé∑ÔºåÊâßË°åÈîÄÊØÅÂπ∂‰º†ÈÄíÂà∞ÊâÄÊúâÁöÑvCPU„ÄÇ(2)ÈÄöËøáÂ§ñÈÉ®ÁöÑQMPÊé•Âè£ÊâßË°åÈîÄÊØÅÔºöÊé•Êî∂Âà∞QMP‰∏ãÂèëÁöÑÂëΩ‰ª§ÂêéÔºåÂ∞ÜÈÅçÂéÜÊØè‰∏Ä‰∏™vCPUÔºå‰æùÊ¨°ÊâßË°åÈîÄÊØÅÂáΩÊï∞„ÄÇ</p>
<p>‰∏§ÁßçÊñπÂºèÊúÄÁªàÈÉΩ‰ºöË∞ÉÁî®ÊØè‰∏™vCPUÂÆû‰æãÁöÑdestroyÂáΩÊï∞ÔºåËÆ©vCPUÂèëÁîü‰ªéRunningÂà∞StoppingÁöÑÁä∂ÊÄÅËΩ¨Êç¢ÔºåÂêåÊ≠•ÊâÄÊúâÁöÑvCPUÁä∂ÊÄÅÂêéÔºåÂÜçËøõÂÖ•StoppedÁä∂ÊÄÅÔºåÂÆåÊàêÂÖ≥Êú∫ÊµÅÁ®ã„ÄÇÊ≠£Â∏∏ÂÖ≥Êú∫ÂêéÔºåÊâÄÊúâÁöÑvCPUÈÉΩ‰ºöÂ§Ñ‰∫éStoppedÁä∂ÊÄÅÔºåÈùûÊ≠§Áä∂ÊÄÅÁöÑÁîüÂëΩÂë®ÊúüÁªìÊùüÂàôÊòØÂºÇÂ∏∏ÂÖ≥Êú∫ÔºåÂ∞ÜËøõÂÖ•ÈîôËØØÂ§ÑÁêÜÊµÅÁ®ã„ÄÇ</p>
<p>StratoVirtÁöÑCPUÊ®°ÂûãËæÉ‰∏∫Á≤æÁÆÄÔºåËÆ∏Â§öCPUÁâπÊÄß‰ª•ÂèäÁ°¨‰ª∂‰ø°ÊÅØÈÉΩÂ∞ÜÁõ¥Êé•ÈÄè‰º†Âà∞ËôöÊãüÊú∫‰∏≠Ôºå‰πãÂêéÂ∞ÜÂú®Áé∞ÊúâÊû∂ÊûÑÁöÑÂü∫Á°Ä‰∏äÂÆûÁé∞Êõ¥Â§öÁöÑÈ´òÁ∫ßCPUÁâπÊÄß„ÄÇ</p>
<h2 id="32-ÂÜÖÂ≠òÂ≠êÁ≥ªÁªü">3.2 ÂÜÖÂ≠òÂ≠êÁ≥ªÁªü
</h2><p>StratoVirtËøõÁ®ãËøêË°åÂú®Áî®Êà∑ÊÄÅÔºåStratoVirt‰ºöÂÆåÊàêËôöÊãüÊú∫ÂêØÂä®‰πãÂâçÁöÑÂáÜÂ§áÂ∑•‰ΩúÔºåÂåÖÊã¨ËôöÊãüÊú∫ÂÜÖÂ≠òÂàùÂßãÂåñ„ÄÅCPUÂØÑÂ≠òÂô®ÂàùÂßãÂåñ„ÄÅËÆæÂ§áÂàùÂßãÂåñÁ≠â„ÄÇÂÖ∂‰∏≠ÔºåÂÜÖÂ≠òÂàùÂßãÂåñÂ∑•‰ΩúÂíåËôöÊãüÊú∫ÁöÑÂú∞ÂùÄÁ©∫Èó¥ÁÆ°ÁêÜÈÉΩÊòØÁî±StratoVirtÁöÑÂÜÖÂ≠òÂ≠êÁ≥ªÁªüÂÆåÊàêÁöÑ„ÄÇ</p>
<h3 id="Áõ∏ÂÖ≥Ê¶ÇÂøµ">Áõ∏ÂÖ≥Ê¶ÇÂøµ
</h3><p>(1)Âú∞ÂùÄÁ©∫Èó¥(AddressSpace)ÔºöÊòØÂú∞ÂùÄÁ©∫Èó¥Ê®°ÂùóÁöÑÁÆ°ÁêÜÁªìÊûÑÔºåË¥üË¥£Êï¥‰∏™ËôöÊãüÊú∫ÁöÑÁâ©ÁêÜÂú∞ÂùÄÁ©∫Èó¥ÁÆ°ÁêÜ„ÄÇ</p>
<p>(2)ÂÜÖÂ≠òÂå∫Âüü(Region)Ôºö‰ª£Ë°®‰∏ÄÊÆµÂú∞ÂùÄÂå∫Èó¥ÔºåÊ†πÊçÆËøôÊÆµÂú∞ÂùÄÂå∫Èó¥ÁöÑ‰ΩøÁî®ËÄÖÔºåÂèØ‰ª•ÂàÜ‰∏∫Ë°®6-1‰∏≠ÁöÑÁ±ªÂûã„ÄÇ</p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051754378.png" style="zoom: 50%;" />
<p>(3)Âπ≥Âù¶Âú∞ÂùÄÁ©∫Èó¥(FlatRange)ÔºöÂ¶ÇÂõæ6-6ÊâÄÁ§∫ÔºåÊòØÊ†πÊçÆÊ†ëÁä∂ÊãìÊâëÁªìÊûÑ‰∏≠ÂÜÖÂ≠òÂå∫ÂüüÁöÑÂú∞ÂùÄËåÉÂõ¥Âíå‰ºòÂÖàÁ∫ß(priority)Â±ûÊÄßÂΩ¢ÊàêÁöÑÁ∫øÊÄßËßÜÂõæ„ÄÇ</p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051755472.png" alt="image-20231205175530081" style="zoom: 50%;" />
<p>Âú®Ê†ëÁä∂ÊãìÊâëÁªìÊûÑ‰∏≠ÔºåÊØè‰∏™ÂÜÖÂ≠òÂå∫ÂüüÈÉΩ‰ºöÂØπÂ∫î‰∏Ä‰∏™‰ºòÂÖàÁ∫ßÂ±ûÊÄßÔºåÂ¶ÇÊûú‰Ωé‰ºòÂÖàÁ∫ßÂíåÈ´ò‰ºòÂÖàÁ∫ßÁöÑÂÜÖÂ≠òÂå∫ÂüüÂç†Áî®ÁöÑÂú∞ÂùÄÂå∫Èó¥ÈáçÂè†ÔºåÂàô‰Ωé‰ºòÂÖàÁ∫ßÁöÑÂÜÖÂ≠òÂå∫ÂüüÁöÑÈáçÂè†ÈÉ®ÂàÜÂ∞Ü‰ºöË¢´Ë¶ÜÁõñÔºåÂç≥Âú®Âπ≥Âù¶ËßÜÂõæ‰∏≠‰∏çÂèØËßÅÔºåÂÖ∑‰Ωì‰ΩìÁé∞‰∏∫Âú®Âπ≥Âù¶ËßÜÂõæ‰∏≠Ê≤°ÊúâÂØπÂ∫îÁöÑÂπ≥Âù¶Âú∞ÂùÄÁ©∫Èó¥„ÄÇ</p>
<p>(4)Âπ≥Âù¶ËßÜÂõæ(FlatView)ÔºöÂÖ∂‰∏≠ÂåÖÂê´Â§ö‰∏™Âπ≥Âù¶Âú∞ÂùÄÁ©∫Èó¥„ÄÇÂú®ÈÄöËøáÂú∞ÂùÄÁ©∫Èó¥ÁÆ°ÁêÜÁªìÊûÑÂú∞ÂùÄÁ©∫Èó¥ËÆøÈóÆËÆæÂ§áÊàñËÄÖÂÜÖÂ≠òÊó∂Ôºå‰ΩøÁî®Âπ≥Âù¶ËßÜÂõæÂèØ‰ª•ÊâæÂà∞ÂØπÂ∫îÁöÑÂπ≥Âù¶Âú∞ÂùÄÁ©∫Èó¥ÔºåÂπ≥Âù¶Âú∞ÂùÄÁ©∫Èó¥‰∏≠ÊúâÊåáÂêëÂÖ∂ÊâÄÂ±ûÂÜÖÂ≠òÂå∫ÂüüÁöÑÊåáÈíà„ÄÇ</p>
<p>StratoVirtÂú∞ÂùÄÁ©∫Èó¥Ê®°ÂùóÁöÑËÆæËÆ°ÈááÁî®Ê†ëÁä∂ÁªìÊûÑÂíåÂπ≥Âù¶ËßÜÂõæÁªìÂêàÁöÑÊñπÊ°à„ÄÇÈÄöËøáÊ†ëÁä∂ÁªìÊûÑÂèØ‰ª•Âø´ÈÄü‰∫ÜËß£Âà∞ÂêÑ‰∏™ÂÜÖÂ≠òÂå∫Âüü‰πãÈó¥ÁöÑÊãìÊâëÁªìÊûÑÂÖ≥Á≥ªÔºåËøôÁßçÂàÜÂ±Ç„ÄÅÂàÜÁ±ªÁöÑËÆæËÆ°ÔºåÂèØ‰ª•ÁÆ°ÁêÜÂπ∂Âå∫ÂàÜÂ≠òÂÇ®Âô®Âüü‰∏éPCIÊÄªÁ∫øÂüüÁöÑÂú∞ÂùÄÁÆ°ÁêÜÔºåÂπ∂ÂΩ¢Êàê‰∏éPCIËÆæÂ§áÊ†ëÁõ∏ÂëºÂ∫îÁöÑÊ†ëÁä∂ÁÆ°ÁêÜÁªìÊûÑ„ÄÇÂπ≥Âù¶ËßÜÂõæÂàôÊòØÊ†πÊçÆËøô‰∫õÂÜÖÂ≠òÂå∫ÂüüÁöÑÂú∞ÂùÄËåÉÂõ¥Âíå‰ºòÂÖàÁ∫ßÂ±ûÊÄßÂΩ¢ÊàêÁöÑÁ∫øÊÄßËßÜÂõæÔºåÂú®ÈÄöËøáÂú∞ÂùÄÁ©∫Èó¥ÁÆ°ÁêÜÁªìÊûÑÂÜÖÂ≠òÂú∞ÂùÄÁ©∫Èó¥ËÆøÈóÆËÆæÂ§áÊàñËÄÖÂÜÖÂ≠òÊó∂Ôºå‰ΩøÁî®Âπ≥Âù¶ËßÜÂõæÂèØ‰ª•Êõ¥Âä†Êñπ‰æøÂø´Êç∑Âú∞ÊâæÂà∞ÂØπÂ∫îÁöÑÂÜÖÂ≠òÂå∫Âüü„ÄÇ</p>
<p>Ê†ëÁä∂ÊãìÊâëÁªìÊûÑÁöÑÊõ¥Êñ∞ÂæàÂ§ßÂèØËÉΩ‰ºöÂ∏¶Êù•Âπ≥Âù¶ËßÜÂõæÁöÑÊõ¥Êñ∞Ôºå‰∏Ä‰∫õËÆæÂ§áÊàñËÄÖÊ®°ÂùóÈúÄË¶ÅËé∑ÂèñÊúÄÊñ∞ÁöÑÂπ≥Âù¶ËßÜÂõæÂπ∂ÊâßË°å‰∏Ä‰∫õÁõ∏Â∫îÁöÑÊìç‰Ωú„ÄÇ‰æãÂ¶ÇvhostËÆæÂ§áÔºåÈúÄË¶ÅÂ∞ÜÂπ≥Âù¶ËßÜÂõæ‰∏≠ÁöÑÂÖ®ÈÉ®ÂÜÖÂ≠ò‰ø°ÊÅØÂêåÊ≠•Âà∞ÂÜÖÊ†∏vhostÊ®°ÂùóÔºå‰ª•‰æøÈÄöËøáÂÖ±‰∫´ÂÜÖÂ≠òÁöÑÊñπÂºèÂÆåÊàêÊ∂àÊÅØÈÄöÁü•ÁöÑÊµÅÁ®ã„ÄÇÂè¶Â§ñÔºå‰πüÈúÄË¶ÅÂ∞ÜÂ∑≤ÁªèÂàÜÈÖçÂπ∂Êò†Â∞ÑÂ•ΩÁöÑGPAÂíåHVA‰ø°ÊÅØÊ≥®ÂÜåÂà∞KVMÊ®°ÂùóÔºåËøôÊ†∑ÂèØ‰ª•ÂÄüÂä©Á°¨‰ª∂ËæÖÂä©ËôöÊãüÂåñÂä†ÈÄüÂÜÖÂ≠òËÆøÈóÆÁöÑÊÄßËÉΩ„ÄÇÂü∫‰∫é‰ª•‰∏äÈúÄÊ±ÇÔºåÂºïÂÖ•‰∫ÜÂú∞ÂùÄÁ©∫Èó¥ÁõëÂê¨ÂáΩÊï∞ÈìæË°®ÔºåËØ•ÈìæË°®ÂÖÅËÆ∏ÂÖ∂‰ªñÊ®°ÂùóÊ∑ªÂä†‰∏Ä‰∏™Ëá™ÂÆö‰πâÁöÑÂõûË∞ÉÂáΩÊï∞ÔºåË¢´Ê≥®ÂÜåÂà∞ËØ•ÈìæË°®‰∏≠ÁöÑÂáΩÊï∞Â∞ÜÂú®Âπ≥Âù¶ËßÜÂõæÊõ¥Êñ∞ÂêéË¢´‰æùÊ¨°Ë∞ÉÁî®ÔºåËøôÊ†∑Âç≥ÂèØÊñπ‰æøÂú∞ÂÆåÊàê‰ø°ÊÅØÂêåÊ≠•„ÄÇ</p>
<h3 id="ËôöÊãüÊú∫Áâ©ÁêÜÂÜÖÂ≠òÂàùÂßãÂåñ">ËôöÊãüÊú∫Áâ©ÁêÜÂÜÖÂ≠òÂàùÂßãÂåñ
</h3><p>StratoVirt‰Ωú‰∏∫Áî®Êà∑ÊÄÅËôöÊãüÊú∫ÁõëÊéßÂô®ÔºåÂÆûÈôÖÊòØËøêË°åÂú®ÂÆø‰∏ªÊú∫‰∏äÁöÑÁî®Êà∑ÊÄÅËøõÁ®ã„ÄÇÂú®StratoVirtËøõÁ®ãÁöÑËôöÊãüÂú∞ÂùÄÁ©∫Èó¥‰∏≠ÔºåÂ≠òÂú®Â§öÊÆµStratoVirtËøõÁ®ãÊú¨Ë∫´‰ΩøÁî®ÁöÑÂú∞ÂùÄÂå∫Èó¥ÔºåËØ•Âú∞ÂùÄÂå∫Èó¥ÊòØÂÆø‰∏ªÊú∫‰∏äÁöÑVMAÔºàVirtual Memory AreaÔºåËôöÊãüÂÜÖÂ≠òÂå∫Èó¥Ôºâ„ÄÇ</p>
<p>Âú®ËôöÊãüÊú∫ÂêØÂä®ÂâçÔºåStratoVirt‰ºöÂàùÂßãÂåñ‰∏ÄÊÆµÂÜÖÂ≠òÁªôËôöÊãüÊú∫‰ΩøÁî®ÔºåËøôÊÆµËôöÊãüÂÜÖÂ≠òÂå∫Èó¥‰πüÊòØStratoVirtËøõÁ®ãÁöÑËôöÊãüÂú∞ÂùÄÁ©∫Èó¥‰∏≠ÁöÑ‰∏ÄÊÆµVMA„ÄÇStratoVirt‰ΩøÁî®mmapÁ≥ªÁªüË∞ÉÁî®Êù•ÂÆûÁé∞ËôöÊãüÊú∫ÂÜÖÂ≠òËµÑÊ∫êÁöÑÂàÜÈÖçÔºåÂæóÂà∞ÁöÑÂÜÖÂ≠òÊò†Â∞ÑÂÖ≥Á≥ªÂ¶ÇÂõæ6-7ÊâÄÁ§∫„ÄÇ</p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051756519.png" style="zoom:50%;" />
<p>mmapÊò†Â∞ÑÊúâ‰∏§ÁßçÊñπÂºèÔºöÂåøÂêçÊò†Â∞ÑÂíåÊñá‰ª∂Êò†Â∞Ñ„ÄÇÊñá‰ª∂Êò†Â∞ÑÊòØÂ∞Ü‰∏Ä‰∏™Êñá‰ª∂Êò†Â∞ÑÂà∞ÁúüÂÆûÁöÑÂÜÖÂ≠ò‰∏≠ÔºåÈÄöËøáËØªÂÜôÂÜÖÂ≠òÁöÑÊñπÂºèÁõ¥Êé•ËØªÂÜôÊñá‰ª∂„ÄÇÊñá‰ª∂Êò†Â∞ÑÈúÄË¶ÅÂª∫Á´ãFileBackendÁªìÊûÑ‰ΩìÔºåÂåÖÊã¨Êñá‰ª∂stdÔºöÔºöfsÔºöÔºöFileÂíåÊñá‰ª∂ÂÜÖÂÅèÁßªÈáè‰∏§‰∏™ÊàêÂëò„ÄÇÂåøÂêçÊò†Â∞ÑÂàô‰∏çÈúÄË¶ÅÊñá‰ª∂ÔºåÁõ¥Êé•ÂàÜÈÖçÂÆø‰∏ªÊú∫‰∏äÁöÑ‰∏ÄÊÆµËôöÊãüÂÜÖÂ≠òÁªôËôöÊãüÊú∫‰ΩøÁî®„ÄÇStratoVirtÁé∞Âú®ÊîØÊåÅÂåøÂêçÊò†Â∞ÑÂíåÊñá‰ª∂Êò†Â∞Ñ‰∏§ÁßçÊñπÂºèÔºåÂπ∂Âà©Áî®Êñá‰ª∂Êò†Â∞ÑÁöÑÊú∫Âà∂ÂÆûÁé∞‰∫ÜÂ§ßÈ°µÁâπÊÄß„ÄÇ</p>
<p>ÂâçÈù¢ÊèêÂà∞ÂÜÖÂ≠òÊò†Â∞ÑÁöÑ‰ø°ÊÅØÈúÄË¶ÅÂêåÊ≠•Âà∞KVMÔºåÂú®StratoVirtÂÜÖÂ≠òÂ≠êÁ≥ªÁªü‰∏≠ÂêåÊ≠•ÁöÑÊñπÂºè‰∏∫ÔºöÂú®ÂÜÖÂ≠òÂú∞ÂùÄÁ©∫Èó¥ÂàùÂßãÂåñÊó∂ÔºåÊ∑ªÂä†ÈªòËÆ§ÁöÑÁõëÂê¨ÂõûË∞ÉÂáΩÊï∞KvmMemoryListener„ÄÇKvmMemoryListenerÁöÑÂäüËÉΩ‰∏∫ÔºöÂΩìÂõæ6-6‰∏≠ÁöÑÊ†ëÁä∂ÊãìÊâëÂèëÁîüÂèòÂåñ‰ªéËÄåÂºïËµ∑Âπ≥Âù¶ËßÜÂõæÂèòÂåñÊó∂ÔºåKvmMemoryListener‰∏≠ÁöÑÂõûË∞ÉÂáΩÊï∞Ë¢´Ë∞ÉÁî®ÔºåÂ∞ÜÊñ∞Â¢ûÊàñËÄÖÂà†Èô§ÁöÑÂÜÖÂ≠òÊò†Â∞Ñ‰ø°ÊÅØÂêåÊ≠•Âà∞KVM„ÄÇ</p>
<h2 id="33-ioÂ≠êÁ≥ªÁªü">3.3 I/OÂ≠êÁ≥ªÁªü
</h2><p>I/OÂ≠êÁ≥ªÁªüË¥üË¥£ÂâçÁ´ØËôöÊãüÊú∫ÂÜÖÈÉ®ÂíåÂêéÁ´Ø‰∏ªÊú∫‰∫§‰∫íÔºåÂ¶ÇÊûúÊääËôöÊãüÊú∫ÂΩì‰Ωú‰∏Ä‰∏™ÈªëÁõíÔºåÈÇ£‰πàI/OÂ≠êÁ≥ªÁªüÂ∞±ÊòØËøô‰∏™ÈªëÁõíÂíåÂ§ñÁïåËøûÈÄöÁöÑÁÆ°ÈÅì„ÄÇ‰∏ÄÂè∞Áâ©ÁêÜ‰∏ªÊú∫ÈÄöÂ∏∏‰ºöÂåÖÂê´Âü∫Êú¨ÁöÑI/OËÆæÂ§áÔºåÂ¶Ç‰øùÂ≠òÊï∞ÊçÆÁöÑÁ£ÅÁõò„ÄÅ‰∏éÂ§ñÈÉ®ËøõË°åÈÄö‰ø°ÁöÑÁΩëÂç°„ÄÅËøõË°åÁôªÂΩïÊìç‰ΩúÁöÑ‰∏≤Âè£ËÆæÂ§áÁ≠âÔºåËøô‰∫õÈÉΩÊòØ‰∏ªÊú∫‰∏éÂ§ñÈÉ®ËøõË°å‰∫§‰∫íÁöÑÂøÖË¶ÅËÆæÂ§á„ÄÇ‰∏éÁâ©ÁêÜÊú∫Á±ª‰ººÔºåËôöÊãüÊú∫Ë¶ÅÂÆûÁé∞Âü∫Êú¨ÁöÑ‰∫§‰∫íÂäüËÉΩÔºå‰πüÈúÄË¶ÅÂÆûÁé∞ÂùóËÆæÂ§á„ÄÅÁΩëÁªúËÆæÂ§á„ÄÅ‰∏≤Âè£ËÆæÂ§áÁ≠â„ÄÇËôöÊãüËøô‰∫õËÆæÂ§áÊòØËôöÊãüÂåñÊäÄÊúØI/OÂ≠êÁ≥ªÁªüÁöÑËÅåË¥£ÔºåÁß∞‰∏∫I/OËôöÊãüÂåñ„ÄÇ</p>
<p>StratoVirt‰Ωú‰∏∫‰∏ÄÊ¨æËΩªÈáèÁ∫ßÁöÑËôöÊãüÂåñËΩØ‰ª∂Ôºå‰πüÂÆûÁé∞‰∫ÜÂü∫Êú¨ÁöÑËÆæÂ§á‰∫§‰∫íÂäüËÉΩ„ÄÇËøô‰∫õËÆæÂ§áÈô§‰∫ÜÁ£ÅÁõò(virtio-block)„ÄÅÁΩëÂç°(virtio-net)„ÄÅ‰∏≤Âè£(serial)‰πãÂ§ñÔºåËøòÊúâÁî®‰ΩúÁâπÂÆöÁî®ÈÄîÁöÑvirtio-vsock„ÄÅvirtio-consoleÁ≠âËÆæÂ§á„ÄÇÊåâÁÖß‰πãÂâçÊâÄËø∞ÁöÑI/OËôöÊãüÂåñÊñπÂºèÔºåÂàÜ‰∏∫ÂÆåÂÖ®ËÆæÂ§áÊ®°Êãü„ÄÅÂçäËôöÊãüÂåñÊ®°Êãü„ÄÅËÆæÂ§áÁõ¥ÈÄöÂíåÂçïÊ†πI/OËôöÊãüÂåñÔºåStratoVirtÈááÁî®ÁöÑÊòØÂÆåÂÖ®ËÆæÂ§áÊ®°ÊãüÂíåÂçäËôöÊãüÂåñÊ®°ÊãüÁöÑÊñπÂºèËôöÊãüÂá∫ÂêÑ‰∏™I/OËÆæÂ§á„ÄÇÂÆåÂÖ®ËÆæÂ§áÊ®°Êãü‰∏ªË¶ÅÁî®Âú®‰∏≤Ë°åËÆæÂ§áÁöÑÊ®°Êãü‰∏äÔºåÂçäËôöÊãüÂåñÊ®°ÊãüÁî®Âú®Á£ÅÁõò„ÄÅÁΩëÂç°Á≠âËÆæÂ§áÁöÑÊ®°Êãü‰∏äÔºå‰∏ãÊñáÂ∞±‰ª•‰∏≤Âè£ÂíåÁ£ÅÁõò‰∏∫‰æãÂàÜÂà´‰ªãÁªçËøô‰∏§ÁßçÊñπÂºè„ÄÇ</p>
<h3 id="ÂÆåÂÖ®ËÆæÂ§áÊ®°Êãü-‰∏≤Âè£">ÂÆåÂÖ®ËÆæÂ§áÊ®°Êãü: ‰∏≤Âè£
</h3><p>‰∏≤Âè£ËÆæÂ§á‰∏ªË¶ÅÊòØÁÆ°ÁêÜÂëòÊàñÊìç‰Ωú‰∫∫Âëò‰∏éËôöÊãüÊú∫ËøõË°å‰∫§‰∫íÁöÑÊâãÊÆµÔºåÂ¶ÇÁôªÂΩïÂà∞ËôöÊãüÊú∫ÂÜÖÈÉ®ÊâßË°åÂëΩ‰ª§Á≠â„ÄÇStratoVirtÂÆûÁé∞‰∫ÜÂØπUARTÔºàUniversal Asynchronous Receiver TransmitterÔºåÈÄöÁî®ÂºÇÊ≠•Êî∂Âèë‰º†ËæìÂô®Ôºâ16550A‰∏≤Âè£ËÆæÂ§áÁöÑÊ®°ÊãüÔºåËØ•ËÆæÂ§áÂú®ËÆ°ÁÆóÊú∫ÂèëÂ±ïÂéÜÂè≤‰∏äÂá∫Áé∞ËæÉÊó©ÔºåËÆæÂ§áÂäüËÉΩÊØîËæÉÁÆÄÂçï„ÄÇÂú®Áâ©ÁêÜ‰∏ªÊú∫Âú∫ÊôØÔºåÁî±CPUËÆøÈóÆ16550AÁöÑÂØÑÂ≠òÂô®ÂÆûÁé∞OSÂíåÂ§ñÁïåÁöÑ‰∏≤Âè£ÈÄö‰ø°ÔºåËøô‰∫õÂØÑÂ≠òÂô®Ë¢´Êò†Â∞ÑÂà∞ÁâπÂÆöÁöÑCPUÂú∞ÂùÄÁ©∫Èó¥ÔºåÂ¶Çx86Êû∂ÊûÑ‰∏ãÔºå‰∏≤Âè£ËÆæÂ§áË¢´Êò†Â∞ÑÂà∞0x3f8Ëµ∑ÂßãÁöÑ8Â≠óËäÇÁöÑPIOÂú∞ÂùÄÁ©∫Èó¥„ÄÇ16550AËÆæÂ§áÁöÑÂØÑÂ≠òÂô®Â¶ÇË°®6-2ÊâÄÁ§∫„ÄÇ</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231202123120.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>Âú®ËôöÊãüÂåñÂú∫ÊôØ‰∏≠ÔºåI/OËôöÊãüÂåñÊäÄÊúØË¥üË¥£ÂÆåÂÖ®Ê®°ÊãüÁõ∏Â∫îPIOÁ´ØÂè£ÁöÑÂØÑÂ≠òÂô®ËÆøÈóÆÔºåËøôÁßçÊ®°ÊãüÊñπÊ≥ï‰∏çÈúÄË¶Å‰øÆÊîπ‰ªª‰ΩïÂâçÁ´ØÂÆ¢Êà∑Êú∫Êìç‰ΩúÁ≥ªÁªü‰ª£Á†ÅÔºåËôöÊãüÊú∫Êó†ÊÑüÁü•ÔºåÊâÄ‰ª•Áß∞‰∏∫ÂÆåÂÖ®ËÆæÂ§áÊ®°ÊãüÊñπÂºè„ÄÇÂú®6.4.6ËäÇÁöÑÂÆûÈ™å‰∏≠‰ºöËØ¶ÁªÜ‰ªãÁªç16550AÂêÑÂØÑÂ≠òÂô®ÁöÑ‰ΩúÁî®Ôºå‰ª•ÂèäStratoVirtÂ¶Ç‰ΩïÈÄöËøáËΩØ‰ª∂Ê®°ÊãüËØ•ËÆæÂ§á„ÄÇ</p>
<h3 id="ÂçäËôöÊãüÂåñÊ®°Êãü-Á£ÅÁõò">ÂçäËôöÊãüÂåñÊ®°Êãü: Á£ÅÁõò
</h3><p>Á£ÅÁõòËÆæÂ§áÁöÑ‰ΩúÁî®ÊòØÂ≠òÊîæÊï∞ÊçÆÔºåËøô‰∏™Êï∞ÊçÆÂèØ‰ª•ÊòØOSÂøÖÈúÄÁöÑÈïúÂÉèÊñá‰ª∂Ôºå‰πüÂèØ‰ª•ÊòØÁî®Êà∑Êï∞ÊçÆÔºåÂ¶ÇÁâ©ÁêÜ‰∏ªÊú∫‰∏äÁöÑSATAÁõò„ÄÇStratoVirtÊ®°ÊãüÁöÑÊòØvirtio-blockËÆæÂ§áÔºåÂÆÉÊòØ‰∏ÄÁßçÂü∫‰∫évirtioÂâçÂêéÁ´ØÂçèËÆÆÁöÑÂùóËÆæÂ§áÔºåÂú®ËôöÊãüÊú∫ÂÜÖÈÉ®ÂëàÁé∞ÁöÑÊòØvda„ÄÅvdbÁ≠âÁõòÁ¨¶ÔºåËôöÊãüÊú∫ÂÜÖÈÉ®ÂèØ‰ª•Ê†ºÂºèÂåñ„ÄÅËØªÂÜôËøô‰∫õËÆæÂ§áÔºåÂ∞±ÂÉèÂú®Áâ©ÁêÜ‰∏ªÊú∫‰∏äÊìç‰Ωú‰∏ÄÊ†∑„ÄÇ‰∏éÁâ©ÁêÜ‰∏ªÊú∫‰ΩøÁî®ÁöÑËÆæÂ§áÈ©±Âä®‰∏çÂêåÔºàÂ¶ÇSATAÁõòÈ©±Âä®ÔºâÔºåStratoVirtÊ®°ÊãüÁöÑÁ£ÅÁõòËÆæÂ§áÂü∫‰∫évirtioÈ©±Âä®ÔºåËøôÁßçÈ©±Âä®ÊòØ‰∏ìÈó®ÈíàÂØπI/OËôöÊãüÂåñËÆæËÆ°ÁöÑÔºåÊâÄ‰ª•Ë¶ÅÊ±ÇËôöÊãüÊú∫ÂÜÖÈÉ®ÂÆâË£ÖvirtioÈ©±Âä®ÔºåËøôÁßçË°å‰∏∫‰ºöÈÄ†ÊàêËôöÊãüÊú∫ÊÑüÁü•Âà∞Ëá™Â∑±Â§Ñ‰∫éËôöÊãüÂåñÁéØÂ¢ÉÔºåÊâÄ‰ª•ÊòØÁßçÂçäËôöÊãüÂåñÁöÑËÆæÂ§áÊ®°ÊãüÊñπÂºè„ÄÇvirtioÈ©±Âä®ÊòØÂØπvirtioÂçèËÆÆÁöÑÂÆûÁé∞ÔºåËØ•ÂçèËÆÆÁöÑ‰ΩúÁî®ÊòØÂ∞ÜÂâçÁ´ØÁöÑI/OËØ∑Ê±ÇÂèëÈÄÅÂà∞ÂêéÁ´ØÁî®Êà∑ÊÄÅHypervisorÔºåÂç≥StratoVirtÔºåÁÑ∂ÂêéÁî±StratoVirt‰ª£ÊõøÂâçÁ´ØÂÅöÁúüÊ≠£ÁöÑI/OÊâßË°åÔºåËøôÊ†∑Â∞±ÂèØ‰ª•ÊéßÂà∂ÂâçÁ´ØÁöÑI/OË°å‰∏∫ÔºåÈÅøÂÖçÈÄ†ÊàêÈÄÉÈÄ∏Á≠âÂÆâÂÖ®ÈóÆÈ¢ò„ÄÇ</p>
<p>virtioÂçèËÆÆÊòØI/OËôöÊãüÂåñÊäÄÊúØ‰∏≠Â∏∏Áî®ÁöÑ‰∏ÄÁßçÂçèËÆÆÔºåÊú¨Ë¥®‰∏äÊòØÁßçÊó†ÈîÅÁöÑÂâçÂêéÁ´ØÊï∞ÊçÆÂÖ±‰∫´ÊñπÊ°àÔºåÂÆÉÂÆûÁé∞‰∫ÜÈùûÂ∏∏È´òÊïàÁöÑÂâçÂêéÁ´ØÊï∞ÊçÆ‰º†ÈÄíÔºåÂΩìÂâç‰∏ªÊµÅÁöÑÂá†ÁßçËôöÊãüÂåñËΩØ‰ª∂ÔºàÂ¶ÇQEMUÔºâÈÉΩÊîØÊåÅviritoÂçèËÆÆÔºåÂ∏∏ËßÅÁöÑËÆæÂ§áÂåÖÂê´virito-block„ÄÅvirito-net„ÄÅvirtio-gpuÁ≠â„ÄÇ‰∏é‰∏äÈù¢‰ªãÁªçÁöÑÂü∫‰∫éPCIÂçèËÆÆÁöÑvirito‰∏çÂêåÔºåStratoVirtÂü∫‰∫éMMIOÂçèËÆÆÔºåMMIOÂçèËÆÆÂÆö‰πâ‰∫ÜËÆæÂ§áÂØÑÂ≠òÂô®ÁöÑMMIOÂú∞ÂùÄ„ÄÇvirtio-mmioÈÉ®ÂàÜÂØÑÂ≠òÂô®Â¶ÇË°®6-3ÊâÄÁ§∫„ÄÇ</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231202123220.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>StratoVirtÂÆûÁé∞‰∫ÜÊúÄÂü∫Êú¨ÁöÑÂü∫‰∫éMMIOÂçèËÆÆÁöÑvirtio-blockËÆæÂ§áÔºåÁõ∏ÂØπ‰∫éÊ†áÂáÜÁöÑPCIÂçèËÆÆÔºåMMIOÂçèËÆÆÂÖ∑ÊúâÂêØÂä®ÈÄüÂ∫¶Âø´ÁöÑÁâπÁÇπÔºåÁ¨¶ÂêàËΩªÈáèÂåñÁöÑ‰ΩøÁî®Âú∫ÊôØ„ÄÇÂú®ÂÆûÁé∞‰∏≠ÔºåËôöÊãüÂá∫‰∏Ä‰∏™MMIOÊÄªÁ∫øÔºåÊâÄÊúâËÆæÂ§áÈÉΩÊåÇÂú®MMIOÊÄªÁ∫ø‰∏ã„ÄÇÂΩìÂâçÁ´ØCPUÁ∫øÁ®ãËÆøÈóÆËÆæÂ§áÊó∂ÔºåÁªèËøáMMIOÊÄªÁ∫øÁöÑËØªÂÜôÂáΩÊï∞ÔºåÂÜçÂà∞ÂÖ∑‰ΩìËÆæÂ§á(virtio-block)ÁöÑËØªÂÜôÂáΩÊï∞ÔºåÁÑ∂ÂêéÂú®virtio-block‰∏≠Ê®°ÊãüÂêÑ‰∏™ÂØÑÂ≠òÂô®ÁöÑËÆøÈóÆ„ÄÇviritoÂçèËÆÆËßÑÂÆöÔºåÂâçÁ´ØÈ©±Âä®ÂáÜÂ§áÂ∞±Áª™ÂêéÔºå‰ºöÂæÄ0x70ÂØÑÂ≠òÂô®ÂÜôÂÖ•DRIVER_OKÊ†áËÆ∞ÔºåÂΩìStratoVirtÊî∂Âà∞ËØ•Ê†áËÆ∞Êó∂‰ºöÂÅöÁ£ÅÁõòÁöÑÂàùÂßãÂåñÂä®‰ΩúÔºåÊØîÂ¶ÇÁõëÂê¨ÂâçÁ´Ø‰∫ã‰ª∂„ÄÅÂºÇÊ≠•I/OÂÆåÊàê‰∫ã‰ª∂Á≠â„ÄÇÂΩìÂâçÁ´ØÊúâÁ£ÅÁõòI/OÈúÄË¶Å‰∏ãÂèëÊó∂Ôºå‰ºöÈÄöÁü•Âà∞ÂêéÁ´ØÔºåÂêéÁ´ØÂ∞ÜËøô‰∫õI/OËØ∑Ê±Ç‰∏ãÂèëÂà∞ÂºÇÊ≠•I/OÊ®°Âùó(aio)ÔºåaioÂ∞ÅË£ÖËØ∑Ê±ÇÂÜçÈÄöËøáÁ≥ªÁªüË∞ÉÁî®Êé•Âè£(io_submit)‰∏ãÂèëÂà∞‰∏ªÊú∫ÂÜÖÊ†∏„ÄÇÂΩìÂºÇÊ≠•I/OÂÆåÊàêÂêéÔºå‰∏ªÊú∫ÂÜÖÊ†∏‰ºöÈÄöÁü•StratoVirtÁªôËôöÊãüÊú∫ÂÜÖÈÉ®ÂèëÈÄÅ‰∏≠Êñ≠Ôºå‰∏ÄÊ¨°ÂÆåÊï¥ÁöÑI/OÊµÅÁ®ãÂ∞±ÂÆåÊàê‰∫Ü„ÄÇËøôÊ†∑Â∞±ÂÆåÊàê‰∫ÜÁ£ÅÁõòËÆæÂ§áÁöÑÊ®°Êãü„ÄÇ</p>
<h1 id="4-‰ªéÈõ∂ÂºÄÂßãÊûÑÂª∫stratovirt">4 ‰ªéÈõ∂ÂºÄÂßãÊûÑÂª∫StratoVirt
</h1><h2 id="41-ÊÄª‰Ωì‰ªãÁªç">4.1 ÊÄª‰Ωì‰ªãÁªç
</h2><p>‰ªéÁé∞Âú®ÂºÄÂßãÔºåÂ∞ÜÈÄöËøá‰∏ÄÁ≥ªÂàóÁöÑÂä®ÊâãÂÆûË∑µÊûÑÂª∫‰∏Ä‰∏™Á≤æÁÆÄÁâàStratoVirtÔºåÂÖ∂Êû∂ÊûÑÂ¶ÇÂõæ6-8ÊâÄÁ§∫„ÄÇ</p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051447793.png" style="zoom:50%;" />
<p>Á≤æÁÆÄËôöÊãüÂåñÂÆûË∑µÊó®Âú®‰ΩøÁî® Rust ËØ≠Ë®ÄÊåáÂØºÈõ∂Âü∫Á°ÄÂºÄÂèë‰∏Ä‰∏™Âü∫Êú¨ÂäüËÉΩÂÆåÂ§áÁöÑ<strong>Áî®Êà∑ÊÄÅËôöÊãüÊú∫ÁõëÊéßËΩØ‰ª∂Ôºå<strong>Âü∫‰∫é Linux Êèê‰æõÁöÑÁ°¨‰ª∂ËæÖÂä©ËôöÊãüÂåñËÉΩÂäõÔºåÂÆûÁé∞Âú®Â§öÂπ≥Âè∞Ôºàx86ÂíåÈ≤≤ÈπèÂπ≥Âè∞ÔºâÁöÑËøêË°å„ÄÇÈ¢ÑÊúüÁöÑÂÆûÁé∞ÁªìÊûú‰∏∫</strong>Áî®Êà∑ÂèØ‰ª•ÈÄöËøá‰∏≤Âè£ÁôªÂÖ•ËôöÊãüÊú∫ÂÜÖÈÉ®Âπ∂ÊâßË°åÂü∫Êú¨ÁöÑLinuxÂëΩ‰ª§„ÄÇ</strong></p>
<p>Á≤æÁÆÄËôöÊãüÊú∫ÂÆûË∑µ‰∏ªË¶ÅÂåÖÊã¨KVMÊ®°ÂûãÂÆûÁé∞„ÄÅÂÜÖÂ≠òÊ®°ÂûãÂÆûÁé∞„ÄÅCPUÊ®°ÂûãÂÆûÁé∞„ÄÅBootLoaderÂÆûÁé∞‰ª•Âèä‰∏≤Âè£ËÆæÂ§áÂÆûÁé∞„ÄÇ‰∏ãÈù¢Ê∂âÂèäÁöÑ‰ª£Á†ÅÂ≠òÊîæÂú®openEulerÁ§æÂå∫ StratoVirt ‰ªìÂ∫ì‰∏≠ÔºåÂØπÂ∫îÁöÑÂàÜÊîØ‰∏∫ <code>mini_stratovirt_edu</code>ÔºåËØ•ÂàÜÊîØÁöÑÂêÑ‰∏™Êèê‰∫§ÂàÜÂà´ÂØπÂ∫î <code>4.2~4.8</code> Â∞èËäÇ‰∏≠ÁöÑÂÜÖÂÆπ„ÄÇ</p>
<h2 id="42-kvmÊ®°Âûã">4.2 KVMÊ®°Âûã
</h2><p>Linux Êèê‰æõÁöÑ KVM Ê®°ÂùóÂèØ‰ª•ÂÖÖÂàÜÂà©Áî®Á°¨‰ª∂ËæÖÂä©ËôöÊãüÂåñÁöÑÁâπÊÄßÔºåÂπ∂Êèê‰æõ‰∫ÜCPU„ÄÅÂÜÖÂ≠òÂíå‰∏≠Êñ≠ÁöÑËôöÊãüÂåñÊîØÊåÅ„ÄÇÊûÑÂª∫‰∏Ä‰∏™ÂÆåÊï¥ÁöÑËôöÊãüÊú∫ÈúÄË¶Å CPU Ê®°ÂûãÊûÑÂª∫„ÄÅËÆæÂ§áÊ®°ÊãüÁ≠â„ÄÇ‰∏∫ÁÆÄÂçïËµ∑ËßÅÔºåÊú¨ËäÇÂ∞ÜÂÄüÂä©KVM APIÔºåÊûÑÂª∫‰∏Ä‰∏™ÊúÄÂ∞èÂåñ‰∏îÂèØËøêË°åÁöÑËôöÊãüÊú∫ÔºåËøêË°å‰∏ÄÊÆµÊ±áÁºñ‰ª£Á†Å„ÄÇÂÖ∑‰ΩìÊµÅÁ®ã‰∏∫Ôºö<strong>ÂàõÂª∫ËôöÊãüÊú∫ÂíåvCPUÁ∫øÁ®ãÔºåÊèê‰æõ‰∏ÄÊÆµÊ±áÁºñÊåá‰ª§ËÆ©vCPUÁ∫øÁ®ãÊâßË°åÔºåÂπ∂ÊçïËé∑ÂíåÂ§ÑÁêÜËôöÊãüÊú∫ÈÄÄÂá∫‰∫ã‰ª∂„ÄÇ</strong></p>
<p>Âú®ÂºÄÂßãÂâçÔºåÂÖàÁî® Rust ÁöÑÊûÑÂª∫Á≥ªÁªüÂíåÂåÖÁÆ°ÁêÜÂô® Cargo Êù•ÂàõÂª∫‰∏Ä‰∏™Êñ∞È°πÁõÆ ‚Äî StratoVirt-miniÔºö<code>cargo new StratoVirt-mini</code>ÔºåËøôË°å‰ª£Á†ÅÊñ∞Âª∫‰∫Ü‰∏Ä‰∏™Âêç‰∏∫ <code>StratoVirt-mini</code> ÁöÑÁõÆÂΩïÔºåËØ•ÁõÆÂΩïÂêç‰πü‰Ωú‰∏∫È°πÁõÆÁöÑÂêçÂ≠ó„ÄÇËøõÂÖ•ÁõÆÂΩïÔºåÂèØ‰ª•ÁúãËßÅ Cargo ÁîüÊàê‰∫Ü‰∏§‰∏™Êñá‰ª∂Âíå‰∏Ä‰∏™ÁõÆÂΩïÔºö‰∏Ä‰∏™ Cargo.toml Êñá‰ª∂Ôºå‰∏Ä‰∏™ src ÁõÆÂΩïÁî®Êù•Â≠òÊîæ‰ª£Á†ÅÔºåÂΩìÂâç‰ªÖÊúâ‰∏Ä‰∏™ main.rs Êñá‰ª∂ÔºåÂÆÉËøòÂú®È°πÁõÆÁõÆÂΩï‰∏ãÂàùÂßãÂåñ‰∫Ü‰∏Ä‰∏™ git ‰ªìÂ∫ìÔºå‰æø‰∫éÁÆ°ÁêÜ‰ª£Á†Å„ÄÇ</p>
<h3 id="step1-ÂÆö‰πâÊ±áÁºñÊåá‰ª§">step1: ÂÆö‰πâÊ±áÁºñÊåá‰ª§
</h3><p>ÊúÄÂ∞èÂåñÊ®°ÂûãÊöÇÊó∂Âπ∂‰∏çËøêË°å‰∏Ä‰∏™Êìç‰ΩúÁ≥ªÁªüÂÜÖÊ†∏ÔºåËÄåÊòØÊèê‰æõ‰∏ÄÊÆµÊåá‰ª§ÁªôvCPUÊâßË°åÔºåÊâßË°åÂÆåÊØïÂêéÔºåvCPUÈÄÄÂá∫„ÄÇÊèê‰æõÁªôvCPUÊâßË°åÁöÑÊ±áÁºñÊåá‰ª§ÂÆö‰πâÂú®Â¶Ç‰∏ã<code>src/main.rs</code> ‰∏≠„ÄÇ</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/main.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231202131951.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>ËøôÊÆµ‰ª£Á†ÅÁöÑÈÄªËæë‰∏∫Ôºö</p>
<ol>
<li>Â∞Ü 0x3f8 Â≠òÂú®ÂØÑÂ≠òÂô® <code>DX</code> ‰∏≠Ôºõ</li>
<li>Â∞Ü <code>AL</code> ÂØÑÂ≠òÂô®Âíå <code>BL</code> ÂØÑÂ≠òÂô®‰∏≠ÁöÑÂÄºÁõ∏Âä†ÔºåËæìÂá∫Âà∞ 0x3f8 Á´ØÂè£Ôºõ</li>
<li>Âπ∂Â∞ÜÊç¢Ë°åÁ¨¶ <code>\n</code> ËæìÂá∫Âà∞ 0x3f8 Á´ØÂè£ÔºåÊúÄÂêéÊâßË°å HLT Êåá‰ª§ÂÅúÊ≠¢ËôöÊãüÊú∫ÁöÑËøêË°å„ÄÇ</li>
</ol>
<h3 id="step2-ÊâìÂºÄkvmÊ®°ÂùóÂπ∂ÂàõÂª∫ËôöÊãüÊú∫">step2: ÊâìÂºÄKVMÊ®°ÂùóÂπ∂ÂàõÂª∫ËôöÊãüÊú∫
</h3><p>Âú®ÊâìÂºÄ KVM Ê®°Âùó‰πãÂâçÔºåÈúÄË¶ÅÂºïÂÖ• Rust ÁöÑÁ¨¨‰∏âÊñπÂ∫ì <code>kvm-bindings</code> Âíå <code>kvm-ioctls</code>Ôºö</p>
<ul>
<li>ÂÖ∂‰∏≠ <code>kvm-bindings</code> ‰ΩøÁî® Rust ËØ≠Ë®ÄÂØπ KVM Ê®°Âùó‰ΩøÁî®ÁöÑÁªìÊûÑ‰ΩìËøõË°åÂ∞ÅË£ÖÔºõ</li>
<li><code>kvm-ioctls</code> Â∫ìÂØπKVM APIËøõË°åÂ∞ÅË£Ö„ÄÇ</li>
</ul>
<p>ÂºïÂÖ•ÁöÑÊñπÊ≥ï‰∏∫Ôºö‚ë†Âú®È°πÁõÆ Cargo.toml ÁöÑ <code>[dependencies]</code> ‰∏≠ÊèèËø∞Á¨¨‰∏âÊñπÂ∫ìÁöÑÁâàÊú¨‰ø°ÊÅØÔºõ‚ë°Âú®ÈúÄË¶Å‰ΩøÁî®Â∫ìÁöÑÊñá‰ª∂Â§¥ÈÉ®Â§ÑÔºåÈÄöËøá <code>use</code> Êù•ÂºïÂÖ•ÈúÄË¶Å‰ΩøÁî®ÁöÑÁ¨¨‰∏âÊñπÂ∫ì‰∏≠ÂØπÂ∫îÁöÑÁªìÊûÑ‰ΩìÊàñÂáΩÊï∞„ÄÇ‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/Cargo.toml</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202131750297.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202131750297"
	
	
></p>
<p><code>StratoVirt-mini_stratovirt_edu/src/main.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202131824100.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202131824100"
	
	
></p>
<hr>
<p>ÂºïÂÖ•Á¨¨‰∏âÊñπÂ∫ì <code>kvm-bindings</code> Âíå <code>kvm-ioctls</code> ‰πãÂêéÔºåË∞ÉÁî® <code>kvm_ioctls</code>ÔºöKVMÁöÑÊûÑÈÄ†ÂáΩÊï∞ÊâìÂºÄ <code>/dev/kvm</code> Ê®°ÂùóÔºåËØ•ÂáΩÊï∞‰ºöËøîÂõû‰∏Ä‰∏™kvmÂØπË±°„ÄÇÈÄöËøáË∞ÉÁî®ËØ•ÂØπË±°ÁöÑ <code>create_vm</code> ÊàêÂëòÂáΩÊï∞ÔºåÂèØ‰ª•ÂæóÂà∞ÊâÄÂàõÂª∫ËôöÊãüÊú∫ÁöÑÂè•ÊüÑ <code>vm_fd</code>„ÄÇ‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/main.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202131858194.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202131858194"
	
	
></p>
<h3 id="step3-ÂàùÂßãÂåñËôöÊãüÊú∫ÂÜÖÂ≠ò">step3: ÂàùÂßãÂåñËôöÊãüÊú∫ÂÜÖÂ≠ò
</h3><blockquote>
<p><strong>ÈÇ£‰πàÂú®ÂêØÂä®ËôöÊãüÊú∫‰πãÂâçÔºåÂ¶Ç‰ΩïÈÖçÁΩÆËôöÊãüÊú∫ÁöÑÂÜÖÂ≠òÂ§ßÂ∞èÂë¢Ôºü</strong></p>
</blockquote>
<p>ËøôÈáåÂõ∫ÂÆöÂàÜÈÖç 64 KBÁöÑÂÜÖÂ≠òÁªôËôöÊãüÊú∫‰ΩøÁî®„ÄÇ‰∏ãÈù¢ÁöÑ‰ªãÁªç‰∏≠ÔºåÁî® <code>GPA</code> ‰ª£Ë°®ÂÆ¢Êà∑Êú∫Áâ©ÁêÜÂú∞ÂùÄÔºåÁî® <code>HVA</code> ‰ª£Ë°®ÂÆø‰∏ªÊú∫ËôöÊãüÂú∞ÂùÄ„ÄÇ</p>
<p>È¶ñÂÖàÂú® StratoVirt-mini ËøõÁ®ã‰∏≠‰ΩøÁî® <code>mmap</code> Á≥ªÁªüË∞ÉÁî®ÂàÜÈÖç‰∏ÄÊÆµÂÆø‰∏ªÊú∫‰∏äÁöÑËôöÊãüÂú∞ÂùÄËµÑÊ∫êÔºåÂπ∂ÂæóÂà∞ÂØπÂ∫îÁöÑ <code>HVA</code>„ÄÇÂÄºÂæóÊ≥®ÊÑèÁöÑÊòØÔºåRust ËØ≠Ë®Ä‰∏≠ÂØπ <code>mmap</code> ÁöÑÁ≥ªÁªüË∞ÉÁî®ÈúÄË¶Å‰ΩøÁî®Á¨¨‰∏âÊñπÂ∫ì <code>libc</code>Ôºå‰∏∫Ê≠§Âú® Cargo.toml ‰∏≠ÁöÑ <code>[dependencies]</code> ÂêéÈù¢Ê∑ªÂä† <code>libc</code> Á¨¨‰∏âÊñπÂ∫ì‰ª•ÂèäÂÆÉÁöÑÁâàÊú¨‰ø°ÊÅØlibc=&quot;&gt;=0.2.39&quot;„ÄÇ</p>
<hr>
<p>Â¶Ç‰∏ãÂõæÊâÄÁ§∫ÔºåÂæóÂà∞ <code>HVA</code> ‰πãÂêéÔºåÈúÄË¶ÅÂ∞Ü <code>HVA</code> ‰∏é <code>GPA</code> ÁöÑÊò†Â∞ÑÂÖ≥Á≥ªÔºå‰ª•ÂèäÈÖçÁΩÆÁöÑÂÆ¢Êà∑Êú∫ÂÜÖÂ≠òÂ§ßÂ∞èÈÄöÁü•ÁªôKVM„ÄÇÂÖ∂‰∏≠Êò†Â∞ÑÂÖ≥Á≥ªÂíåÂÜÖÂ≠òÂ§ßÂ∞èÁöÑ‰ø°ÊÅØ‰øùÂ≠òÂú®<code>kvm-binding</code> Êèê‰æõÁöÑ <code>kvm_userspace_memory_region</code> ÁªìÊûÑ‰Ωì‰∏≠ÔºåÁÑ∂ÂêéÈÄöËøá <code>step2</code> ‰∏≠ÂæóÂà∞ÁöÑËôöÊãüÊú∫Âè•ÊüÑ <code>vm_fd</code> ÁöÑ <code>set_user_memory_region</code>ÊàêÂëòÊñπÊ≥ïÔºåÂ∞ÜÂÜÖÂ≠òÊò†Â∞Ñ‰ø°ÊÅØÈÄöÁü•KVM„ÄÇ</p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051510610.png" alt="image-20231202132100623" style="zoom: 33%;" />
<p>ÊúÄÂêéÂ∞ÜÂ∑≤ÂÆö‰πâÁöÑÊ±áÁºñÊú∫Âô®Á†ÅÂÜôÂÖ• <code>HVA</code> Ëµ∑ÂßãÂú∞ÂùÄÔºåvCPUÂú®ËøêË°åÊó∂Ôºå‰ºöÈÄÄÂá∫Âà∞KVMÔºåKVMÂÄüÂä©Á°¨‰ª∂ËæÖÂä©ËôöÊãüÂåñÊäÄÊúØÂª∫Á´ãÈ°µË°®Ôºå‰ªéËÄå vCPU ÂèØ‰ª•ÊâßË°åËøôÊÆµÂÜÖÂ≠ò‰∏≠‰øùÂ≠òÁöÑÊ±áÁºñÊåá‰ª§„ÄÇ‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/main.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202132244788.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202132244788"
	
	
></p>
<h3 id="step4-ÂàõÂª∫Âπ∂ÂàùÂßãÂåñËôöÊãüÊú∫Âíåvcpu">step4: ÂàõÂª∫Âπ∂ÂàùÂßãÂåñËôöÊãüÊú∫ÂíåvCPU
</h3><p>Êé•‰∏ãÊù•‰ΩøÁî®ËôöÊãüÊú∫Âè•ÊüÑ <code>vm_fd</code> ÁöÑ <code>create_vcpu</code> ÊàêÂëòÂáΩÊï∞Êù•ÂàõÂª∫vCPU„ÄÇÈÄöËøáÂæóÂà∞ÁöÑ vCPU Âè•ÊüÑËÆæÁΩÆÈÄöÁî®ÂØÑÂ≠òÂô®ÂíåÊÆµÂØÑÂ≠òÂô®„ÄÇÂÖ∂‰∏≠ <code>CS</code>ÔºàCode SegmentÔºå‰ª£Á†ÅÊÆµÔºâÂØÑÂ≠òÂô®ËÆæÁΩÆ‰∏∫0Ôºå<code>IP</code>ÔºàInstruction PointÔºåÊåá‰ª§ÊåáÈíàÔºâÂØÑÂ≠òÂô®‰∏∫ËôöÊãüÊú∫ÂÜÖÂ≠òËµ∑ÂßãÂú∞ÂùÄÔºå<code>RAX</code> ÂØÑÂ≠òÂô®ËÆæÁΩÆ‰∏∫ 2Ôºå<code>RBX</code> ÂØÑÂ≠òÂô®ËÆæÁΩÆ‰∏∫ 3ÔºåËøô‰∫õÂØÑÂ≠òÂô®ÁöÑÂÖ∑‰ΩìÂäüËÉΩÂ∞ÜÂú® 4.4 ËäÇ‰∏≠‰ªãÁªç„ÄÇ‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/main.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202132401822.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202132401822"
	
	
></p>
<h3 id="step5-Â§ÑÁêÜvcpuÈÄÄÂá∫‰∫ã‰ª∂">step5: Â§ÑÁêÜvCPUÈÄÄÂá∫‰∫ã‰ª∂
</h3><p>Âú® vCPU ÊâßË°å <code>step1</code>ÔºàÂÆö‰πâÊ±áÁºñÊåá‰ª§Ôºâ‰∏≠ÂÆö‰πâÁöÑÊ±áÁºñÊåá‰ª§Êó∂Ôºå‰ºöËÆøÈóÆ I/O Á´ØÂè£ <code>0x3f8</code>ÔºåËØ•Á´ØÂè£ËµÑÊ∫êÊ≤°ÊúâË¢´Êò†Â∞ÑÔºåÂõ†Ê≠§ËôöÊãüÊú∫ÈÄÄÂá∫ÔºåËøõÂÖ•KVM„ÄÇKVM ÂêåÊ†∑Êó†Ê≥ïÂ§ÑÁêÜËØ•ËÆøÈóÆËØ∑Ê±ÇÔºåËøõ‰∏ÄÊ≠•ÈÄÄÂá∫Âà∞Áî®Êà∑ÊÄÅ <code>Hypervisor</code> Á®ãÂ∫è‰∏≠„ÄÇÂú®Êî∂Âà∞ <code>VcpuExit::IoOut</code> ÁöÑ vCPU ÈÄÄÂá∫‰∫ã‰ª∂Êó∂ÔºåÂ∞ÜËÆøÈóÆËØ∑Ê±ÇÁöÑ‰ø°ÊÅØ‰ª•‰∏ÄÂÆöÊ†ºÂºèÊâìÂç∞Âá∫Êù•„ÄÇ‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/main.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202132452664.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202132452664"
	
	
></p>
<p>ÁºñÂÜôÂÆåÊúÄÂ∞èÂåñËôöÊãüÊú∫Ê®°ÂûãÂêéÔºåÊâßË°å <code>cargo run</code> ÂèØ‰ª•ÁºñËØëÂπ∂ËøêË°åÂ∑•Á®ãÔºåÂèØ‰ª•ÂæóÂà∞‰ª•‰∏ãËøêË°åÁªìÊûú„ÄÇ</p>
<p><code>Terminal</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202132526371.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202132526371"
	
	
></p>
<p>Ê†πÊçÆËøêË°åÁªìÊûúÂèØÁü•ÔºåÂÖ±ÂèëÁîü‰∫Ü<strong>‰∏âÊ¨°</strong>ËôöÊãüÊú∫ VM_Exit ‰∫ã‰ª∂Ôºö</p>
<ul>
<li>Ââç‰∏§Ê¨°ËôöÊãüÊú∫ÈÄÄÂá∫Âùá‰∏∫ËÆøÈóÆ I/O Á´ØÂè£ <code>0x3f8</code>„ÄÇÂÖ∂‰∏≠ÔºåÊï∞ÊçÆ <code>53</code> ‰∏∫ <code>step5</code> ‰∏≠ËÆæÁΩÆÁöÑRAXÂØÑÂ≠òÂô®„ÄÅRBXÂØÑÂ≠òÂô®‰ª•ÂèäÊï∞Â≠ó0ÁöÑASCIIÁ†ÅÁõ∏Âä†ÂæóÂà∞ÁöÑÁªìÊûúÔºõÊï∞ÊçÆ10‰∏∫Êç¢Ë°åÁ¨¶ÂØπÂ∫îÁöÑASCIIÁ†Å„ÄÇ</li>
<li>ÊúÄÂêé‰∏ÄÊ¨°ËôöÊãüÊú∫ÈÄÄÂá∫‰∏∫ HLT Êåá‰ª§ÔºåËôöÊãüÊú∫ÁªìÊùüËøêË°åÔºåHypervisor ËøõÁ®ãÈÄÄÂá∫„ÄÇ</li>
</ul>
<h2 id="43-ÂÜÖÂ≠òÊ®°Âûã">4.3 ÂÜÖÂ≠òÊ®°Âûã
</h2><p>4.2 ËäÇ‰ªãÁªç‰∫ÜÂàõÂª∫ÁÆÄÂçïËôöÊãüÊú∫ÁöÑÊñπÊ≥ïÔºåÂπ∂ÊâßË°å‰∫Ü‰∏ÄÊÆµÁÆÄÂçïÁöÑÊ±áÁºñÊåá‰ª§„ÄÇ‰∏∫Â∞ÜËøôÊÆµÊ±áÁºñÊåá‰ª§‰øùÂ≠òÂà∞ËôöÊãüÊú∫ÂÜÖÂ≠ò‰∏≠ÔºåÂàÜÈÖç‰∫Ü 64 KBÁöÑÂú∞ÂùÄËµÑÊ∫êÊù•Â≠òÊîæËøôÊÆµÊ±áÁºñÊåá‰ª§‰ª£Á†Å„ÄÇ‰ΩÜÊòØÔºåËã•Ë¶ÅÊîØÊåÅ StratoVirt È°πÁõÆÁöÑËøõ‰∏ÄÊ≠•Êâ©Â±ïÔºå<code>src/main.rs</code> Êñá‰ª∂‰∏≠ÁöÑÂÜÖÂ≠òÂÆûÁé∞Â≠òÂú®Â¶Ç‰∏ãÂæàÂ§ö‰∏çË∂≥Ôºö</p>
<ul>
<li>4.5 ËäÇ‰∏≠ÔºåÂ∞ÜÂà†ÂéªÊµãËØï‰ΩøÁî®ÁöÑËøôÊÆµÊ±áÁºñ‰ª£Á†ÅÔºåËÄåÂêØÂä®‰∏ÄÂè∞Ê†áÂáÜÁöÑËôöÊãüÊú∫„ÄÇÂ¶ÇÊûúËøêË°åÂÆ¢Êà∑Êú∫ÂÜÖÊ†∏ÔºåÈÇ£‰πà 64 KBÁöÑ<strong>ËôöÊãüÊú∫ÂÜÖÂ≠òËµÑÊ∫êËøúËøú‰∏çÂ§ü„ÄÇ<strong>Â¶ÇÊûúÊñ∞Â¢ûÂÜÖÂ≠òÁÉ≠ÊèíÊãîÁâπÊÄßÔºåÂàôÈúÄË¶Å</strong>Êñ∞Â¢ûÂ§öÊÆµÂÜÖÂ≠òÊò†Â∞ÑÂÖ≥Á≥ª„ÄÇ</strong></li>
<li>Âú® Intel Q35 ËäØÁâáÁªÑÁöÑÂú∞ÂùÄÁ©∫Èó¥Â∏ÉÂ±Ä‰∏≠Ôºå4 GB‰ª•‰∏ãÁöÑ‰∏ÄÈÉ®ÂàÜÂú∞ÂùÄËµÑÊ∫êË¢´Âõ∫ÂÆöÂàÜÈÖçÁªôFlash„ÄÅ‰∏≠Êñ≠ÊéßÂà∂Âô®„ÄÅPCIËÆæÂ§áÁ≠âÔºåÂõ†Ê≠§ÂÜÖÂ≠òÂèØÂç†Áî®ÁöÑÂú∞ÂùÄËµÑÊ∫êË¢´<strong>ÂàÜÂâ≤ÊàêÂ§ö‰∏™Âå∫Èó¥„ÄÇ</strong></li>
</ul>
<p>ËÄÉËôëÂà∞‰ª•‰∏äÈôêÂà∂Ôºå‰ª•ÂèäÂ¢ûÂº∫Âú∞ÂùÄËµÑÊ∫êÁÆ°ÁêÜÁÅµÊ¥ªÊÄßÁöÑÈúÄÊ±ÇÔºåÊú¨ËäÇÊñ∞Â¢û‰∫Ü <code>memory</code> Â≠êÊ®°ÂùóÔºåÂπ∂Âú® <code>src/main.rs</code> Â§¥ÈÉ®‰∏≠Â£∞ÊòéÔºömod memory„ÄÇ</p>
<p><code>memory</code> Â≠êÊ®°Âùó‰∏≠‰∏ªË¶ÅÂåÖÂê´<strong>Âú∞ÂùÄËµÑÊ∫êÁÆ°ÁêÜ„ÄÅËôöÊãüÊú∫ÂÜÖÂ≠òÁÆ°ÁêÜ„ÄÅÂÜÖÂ≠òËØªÂÜô</strong>Á≠âÂäüËÉΩ„ÄÇ</p>
<h3 id="Âú∞ÂùÄÁ©∫Èó¥Â∏ÉÂ±Ä">Âú∞ÂùÄÁ©∫Èó¥Â∏ÉÂ±Ä
</h3><p>StratoVirt ËÆæÁΩÆÁöÑÂÆ¢Êà∑Êú∫Áâ©ÁêÜÂú∞ÂùÄÁ©∫Èó¥Â∏ÉÂ±ÄÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051555905.png" alt="image-20231202132847182" style="zoom: 80%;" />
<p>StratoVirt ËÆæÁΩÆÁöÑÂÆ¢Êà∑Êú∫Áâ©ÁêÜÂú∞ÂùÄÁ©∫Èó¥Â∏ÉÂ±ÄÂ¶Ç‰∏äÂõæÊâÄÁ§∫ÔºåÂÖ∂‰∏≠Ôºö</p>
<ul>
<li>ÂÜÖÂ≠òÂç†Áî® <code>0~3GB</code>„ÄÅ<code>4GB</code> ‰ª•‰∏äÁöÑÂú∞ÂùÄËµÑÊ∫êÔºõ</li>
<li><code>3~4GB</code> ÁöÑÂú∞ÂùÄËµÑÊ∫êÊèê‰æõÁªôËÆæÂ§á„ÄÅ‰∏≠Êñ≠ÊéßÂà∂Âô®‰ΩøÁî®Ôºõ</li>
<li>ÂÜÖÂ≠òÁöÑ <code>0~1MB</code> Á©∫Èó¥ÂÜÖÔºåÂõ∫ÂÆöÂ≠òÊîæÂêØÂä®ÂÆ¢Êà∑Êú∫ÂÜÖÊ†∏ÁöÑÁõ∏ÂÖ≥ÈÖçÁΩÆÂÜÖÂÆπÔºåËøôÈÉ®ÂàÜÂÜÖÂÆπÂ∞ÜÂú® 4.5 ËäÇËØ¶ÁªÜ‰ªãÁªç„ÄÇ</li>
</ul>
<p>‰∏∫ÊîØÊåÅÊõ¥Â§ßÁöÑËôöÊãüÊú∫ÂÜÖÂ≠òËßÑÊ†º„ÄÅÊ®°ÊãüÊõ¥Â§öÁöÑËÆæÂ§áÁ±ªÂûãÔºåÂ∞Ü StratoVirt È°πÁõÆ‰∏≠ÂêÑ‰∏™ÁªÑ‰ª∂Áî®Âà∞ÁöÑÂú∞ÂùÄËµÑÊ∫êËåÉÂõ¥ÂÆö‰πâÂú®Â∏∏Èáè‰∏≠ÔºåÂΩìÊñ∞Â¢ûÂÖ∂‰ªñÁ±ªÂûãÁöÑËÆæÂ§áÊó∂ÔºåÂèØ‰ª•Âú®ÂÖ®Â±ÄÂèòÈáè‰∏≠Âä®ÊÄÅÊ∑ªÂä†ËÆæÂ§á‰ΩøÁî®ÁöÑÂú∞ÂùÄËµÑÊ∫ê„ÄÇ‰∏äÂõæ‰∏≠ÂÆö‰πâÁöÑÂÆ¢Êà∑Êú∫Áâ©ÁêÜÂú∞ÂùÄÁ©∫Èó¥Â∏ÉÂ±ÄÂÆö‰πâÂú® <code>src/memory/mod.rs</code> ‰∏≠ÔºåÂÖ∂‰∏≠ËµÑÊ∫êÁ±ªÂûãÂÆö‰πâÂú® <code>LayoutEntryType</code> Êûö‰∏æÁªìÊûÑ‰Ωì‰∏≠ÔºåÊØè‰∏™ËµÑÊ∫êÁöÑËåÉÂõ¥ÂÆö‰πâÂú®Â∏∏Èáè <code>MEM_LAYOUT</code> ‰∏≠„ÄÇ‰ª£Á†ÅÂ¶Ç‰∏ã„ÄÇ</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/memory/mod.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202132936906.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202132936906"
	
	
></p>
<h3 id="ÂÜÖÂ≠òÂú∞ÂùÄÊò†Â∞ÑÁÆ°ÁêÜ">ÂÜÖÂ≠òÂú∞ÂùÄÊò†Â∞ÑÁÆ°ÁêÜ
</h3><p>4.2 ËäÇÊûÑÈÄ†ÊúÄÂ∞èÂåñKVMÊ®°ÂûãÊó∂ÔºåÂàùÂßãÂåñ‰∫Ü‰∏ÄÊÆµÂÆø‰∏ªÊú∫ËôöÊãüÂÜÖÂ≠òÊèê‰æõÁªôËôöÊãüÊú∫‰ΩøÁî®ÔºåÂπ∂Â∞ÜÂÜÖÂ≠ò‰ø°ÊÅØÊ≥®ÂÜåÂà∞KVM„ÄÇ‰ΩÜÊòØÔºå<code>src/main.rs</code> ‰∏≠ÁöÑÂÆûÁé∞ÊñπÂºè‰∏çËÉΩÂ§üÊª°Ë∂≥È°πÁõÆÁöÑÂèØÊâ©Â±ïÈúÄÊ±ÇÔºå‰æãÂ¶ÇÊ∑ªÂä†‰∏Ä‰∏™ virtio` ËÆæÂ§á„ÄÇvirtioËÆæÂ§áÂú®ÂíåÂâçÁ´ØÈ©±Âä®‰∫§‰∫íËøáÁ®ã‰∏≠ÈÅµÂæ™virtioÂçèËÆÆÔºåÈÄöËøáÂâçÂêéÁ´ØÂÖ±‰∫´ÂÜÖÂ≠òÁöÑÊñπÂºèÈÄö‰ø°ÔºåÂêéÁ´ØvirtioËÆæÂ§áÈúÄË¶Å‰ªévirtqueueÂèñÂá∫ÂâçÁ´ØÈ©±Âä®‰∏ãÂèëÁöÑ‰∫ã‰ª∂Â§ÑÁêÜËØ∑Ê±ÇÔºåÂÖ∂‰∏≠virtqueueÂ∞±Â≠òÊîæÂú®ÂÜÖÂ≠ò‰∏≠„ÄÇÂõ†Ê≠§ÔºåÂÜÖÂ≠òÁÆ°ÁêÜÊ®°Âùó‰∏ç‰ªÖÈúÄË¶Å‰∏∫ HVA Âíå GPAÊò†Â∞ÑÂÖ≥Á≥ªÂª∫Á´ãÁÆ°ÁêÜÁªìÊûÑÔºåËÄå‰∏îÈúÄË¶ÅÊèê‰æõËÆøÈóÆÊé•Âè£‰æõÂÖ∂‰ªñÊ®°Âùó‰ΩøÁî®„ÄÇ</p>
<p>Â¶Ç‰∏ãÂõæÊâÄÁ§∫ÔºåÁÆ°ÁêÜ‰∏ÄÊÆµÂÜÖÂ≠òÊò†Â∞ÑÁöÑÁªìÊûÑ‰ΩìÂÆö‰πâ‰∏∫ <code>HostMemMapping</code>ÔºåËØ•ÁªìÊûÑ‰ΩìÈÄöËøá <code>mmap</code> Á≥ªÁªüË∞ÉÁî®ÂàÜÈÖçÂÆø‰∏ªÊú∫ËôöÊãüÂÜÖÂ≠òÔºåÂπ∂‰∏éÂÆ¢Êà∑Êú∫Áâ©ÁêÜÂú∞ÂùÄÁ©∫Èó¥Âª∫Á´ãÊò†Â∞Ñ„ÄÇÊò†Â∞ÑÂÖ≥Á≥ª‰ºö‰øùÂ≠òÂú® <code>HostMemMapping</code> ÁªìÊûÑ‰Ωì‰∏≠„ÄÇÂú® <code>HostMemMapping</code> ÁªìÊûÑ‰ΩìÁöÑÊûêÊûÑÂáΩÊï∞‰∏≠Ôºå‰ºöÈÄöËøá <code>unmap</code> Á≥ªÁªüË∞ÉÁî®ÈáäÊîæËøôÊÆµÂÆø‰∏ªÊú∫ËôöÊãüÂÜÖÂ≠òËµÑÊ∫ê„ÄÇ</p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051603633.png" alt="image-20231202133326724" style="zoom:50%;" />
<p>‰Ωú‰∏∫ÂÜÖÂ≠òÂ≠êÊ®°ÂùóÂØπÂ§ñÁöÑÊé•Âè£Ôºå<code>GuestMemory</code> ÁªìÊûÑ‰Ωì‰øùÂ≠òÊâÄÊúâÁöÑÂÜÖÂ≠òÊò†Â∞ÑÂÖ≥Á≥ª„ÄÇ‰æãÂ¶ÇÔºåÂΩìËÆæÁΩÆËôöÊãüÊú∫ÂÜÖÂ≠òËßÑÊ†ºÈ´ò‰∫é 3 GBÊó∂ÔºåÂÜÖÂ≠òÂ∞ÜË¢´ÂàÜÂâ≤‰∏∫‰∏§ÈÉ®ÂàÜÔºö0~3GBÂíåÈ´ò‰∫é4GBÁöÑÈÉ®ÂàÜ„ÄÇËøô‰∏§ÈÉ®ÂàÜÁöÑÊò†Â∞ÑÂÖ≥Á≥ªÂ∞ÜÂàÜÂà´‰øùÂ≠òÂú®‰∏§‰∏™ <code>HostMemMapping</code> ÂØπË±°‰∏≠ÔºåËøô‰∏§‰∏™ <code>HostMemMapping</code> ÂØπË±°Â∞Ü‰øùÂ≠òÂú®<code>GuestMemory</code> ÁªìÊûÑ‰ΩìÁöÑÊàêÂëò‰∏≠„ÄÇ</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/memory/guest_memory.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202133402571.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202133402571"
	
	
></p>
<p><code>GuestMemory</code> Êèê‰æõÁöÑÊûÑÈÄ†ÂáΩÊï∞ÈúÄË¶Å‰º†ÂÖ•ÁöÑÂèÇÊï∞‰∏∫ÂàõÂª∫ÁöÑÂÆ¢Êà∑Êú∫Âè•ÊüÑ„ÄÅÂÆ¢Êà∑Êú∫ÂÜÖÂ≠òËßÑÊ†ºÔºåËØ•ÊûÑÈÄ†ÂáΩÊï∞‰ºöÊ†πÊçÆÂú∞ÂùÄÁ©∫Èó¥Â∏ÉÂ±ÄÂíåÂÜÖÂ≠òÂ§ßÂ∞èÊù•Âª∫Á´ã HVA ÂíåGPA Êò†Â∞ÑÂÖ≥Á≥ªÔºåÂπ∂Ê≥®ÂÜåÂà∞KVM„ÄÇ</p>
<h3 id="ÂÜÖÂ≠òËÆøÈóÆÁÆ°ÁêÜ">ÂÜÖÂ≠òËÆøÈóÆÁÆ°ÁêÜ
</h3><p>ÂÜÖÂ≠òËÆøÈóÆÊé•Âè£ÊòØÂÖ∂‰ªñÊ®°ÂùóËÆøÈóÆÂÜÖÂ≠òÁöÑÊñπÂºèÔºåÈúÄË¶ÅËææÂà∞ÁÆÄÂçïÊòìÁî®ÁöÑÁõÆÁöÑ„ÄÇÈ¶ñÂÖàÔºåÂÖàÂÆûÁé∞ÊúÄÂü∫Êú¨ÁöÑÊé•Âè£Ôºö</p>
<ul>
<li>**ÂÜôÊé•Âè£Ôºö**Â∞ÜÈïøÂ∫¶Â∑≤Áü•ÁöÑÂ≠óËäÇÊµÅÂÜôÂÖ•ÂÆ¢Êà∑Êú∫Áâ©ÁêÜÂÜÖÂ≠ò‰∏≠ÁöÑÊåáÂÆöÂú∞ÂùÄÂ§ÑÔºåÂú∞ÂùÄÂú®ÂáΩÊï∞ÂèÇÊï∞‰∏≠ÊåáÂÆö„ÄÇ</li>
<li>**ËØªÊé•Âè£Ôºö**‰ªéÂÆ¢Êà∑Êú∫Áâ©ÁêÜÂÜÖÂ≠òÁöÑÊåáÂÆöÂú∞ÂùÄÂ§ÑËØªÂá∫‰∏ÄÊÆµÂ≠óËäÇÊµÅÔºåÂπ∂‰øùÂ≠òÂú®ËæìÂÖ•ÂèÇÊï∞‰∏≠„ÄÇ</li>
</ul>
<p><code>StratoVirt-mini_stratovirt_edu/src/memory/guest_memory.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202133519313.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202133519313"
	
	
></p>
<hr>
<p>Âú® 4.5 ËäÇ‰∏≠ÔºåBootLoaderÊ®°ÂùóÂ∞Ü‰ΩøÁî® <code>read/write</code> Êé•Âè£ËÆøÈóÆÂÆ¢Êà∑Êú∫ÂÜÖÂ≠òÔºåÂπ∂Â∞ÜÂÆ¢Êà∑Êú∫ÂÜÖÊ†∏Êñá‰ª∂‰øùÂ≠òÂú®ÂÜÖÂ≠ò‰∏≠„ÄÇ‰ΩøÁî®‰∏äÈù¢‰ª£Á†Å‰∏≠ÁöÑÊé•Âè£ÔºåÁ§∫‰æã‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu BootLoader</code> ÂØπÂÜÖÂ≠òÊ®°ÂùóÁöÑË∞ÉÁî®Ôºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202133619225.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202133619225"
	
	
></p>
<p>ËøôÊÆµ‰ª£Á†Å‰ºöÂ∞ÜÂÜÖÊ†∏ÁöÑÊï∞ÊçÆ‰øùÂ≠òÂú®‰∏Ä‰∏™ <code>Vec</code>ÔºàRustËØ≠Ë®ÄÂÆö‰πâÁöÑÊï∞ÊçÆÁªìÊûÑÔºåË°®Á§∫Êï∞ÁªÑÔºâ‰∏≠ÔºåÁÑ∂ÂêéÂ∞Ü <code>Vec</code> ‰∏≠ÁöÑÊï∞ÊçÆÂÜôÂÖ•ÂÜÖÂ≠ò„ÄÇËøôÈáåÂÖ±Â≠òÂú®‰∏§Ê¨°Â§çÂà∂ÔºåÂ¶ÇÊûúÊñá‰ª∂ËøáÂ§ßÔºåÂ§çÂà∂ÁöÑÊó∂Èó¥ÂíåÁ©∫Èó¥ÂºÄÈîÄÈÉΩ‰∏çÂÆπÂøΩËßÜ„ÄÇ</p>
<blockquote>
<p><em><strong>Rust ‰ºòÂåñËÆæËÆ°Ôºö</strong></em></p>
<p>ÈÇ£‰πàÔºåÂÜÖÂ≠òÊ®°ÂùóÁöÑËÆøÈóÆÊé•Âè£ÂèÇÊï∞ËÉΩÂê¶Êõ¥Âä†ÁÅµÊ¥ªÔºå‰ªéËÄåÊîØÊåÅÊõ¥Â§öÁöÑÂèÇÊï∞Á±ªÂûãÔºü‰∏Ä‰∏™ÂèØË°åÁöÑÊñπÊ≥ïÊòØ‰ΩøÁî® <code>trait</code>ÔºàRustËØ≠Ë®Ä‰∏≠ÁöÑÁ±ªÂûãÔºå‰∏∫‰∏ÄÁªÑÊñπÊ≥ïÁöÑÈõÜÂêàÔºâÂíå <code>trait</code> ÂØπË±°Ôºàtrait objectÔºåRustËØ≠Ë®Ä‰∏≠ÂÆûÁé∞‰∫Ü‰∏ÄÁªÑtraitsÁöÑÊï∞ÊçÆÂØπË±°ÔºâÊé•Âè£‰ºòÂåñÁöÑÂÆûÁé∞ÔºåÂèØ‰ª•ÂèÇËÄÉ StratoVirt È°πÁõÆ mini_stratovirt_edu ÂàÜÊîØ‰∏≠ <code>GuestMemory</code> ÁöÑ <code>read/write</code> ÊàêÂëòÂáΩÊï∞„ÄÇ</p>
<p>ÂÜÖÂ≠òËÆøÈóÆ <code>read/write</code> Êé•Âè£‰ºòÂåñÂêéÔºå‰ªçÂ≠òÂú®‰∏Ä‰∏™ÈóÆÈ¢òÔºåÂØπ‰∫éÂ¶Ç‰∏ã‰ª£Á†Å‰∏≠ÁöÑ <code>SplitVringDesc</code> Êï∞ÊçÆÁªìÊûÑÔºåÂ¶ÇÊûúÊÉ≥Â∞ÜÁ±ªÂûã‰∏∫ <code>SplitVringDesc</code> ÁöÑÊï∞ÊçÆÂØπË±°ÂÜôÂÖ•ÂÜÖÂ≠òÔºå‰ªçÈúÄË¶ÅÂÖàËΩ¨Êç¢‰∏∫ <code>Vec</code>ÔºåÂÜçÂ∞ÜÂÖ∂ÂÜôÂÖ•ÂÜÖÂ≠ò„ÄÇËØªËÄÖÂèØ‰ª•ÊÄùËÄÉÂ¶Ç‰Ωï‰ºòÂåñ <code>GuestMemory</code> ÁöÑËÆøÈóÆÊé•Âè£ÔºåÂ¢ûÂº∫ÊòìÁî®ÊÄß„ÄÇÈíàÂØπËøô‰∏™ÈóÆÈ¢òÁöÑÊé•Âè£‰ºòÂåñÔºåÂèØ‰ª•ÂèÇËÄÉ StratoVirt È°πÁõÆ <code>mini_stratovirt_edu</code> ÂàÜÊîØ‰∏≠ <code>GuestMemory</code> ÁöÑ <code>read_object/write_object</code> ÊàêÂëòÂáΩÊï∞Ôºå‰ª•Âèä<code>src/helper/byte_code.rs</code> Â≠êÊ®°ÂùóÁöÑÂÆûÁé∞„ÄÇ</p>
<p><code>StratoVirt-mini_stratovirt_edu VirtQueue</code> ‰∏≠ Vring ÁöÑ <code>Descriptor</code> ÁªìÊûÑ‰ΩìÔºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202133719118.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202133719118"
	
	
></p>
<p>ByteCode trait ÂÆö‰πâÂú® <code>src/helper/byte_code</code> Â≠êÊ®°Âùó‰∏≠ÔºåËØ•trait‰∏ªË¶ÅÂÆûÁé∞Êï∞ÊçÆÁªìÊûÑÂíåsliceÔºàRustËØ≠Ë®Ä‰∏≠ÁöÑÊï∞ÊçÆÁ±ªÂûãÔºåÊï∞ÁªÑÔºâÁöÑÁõ∏‰∫íËΩ¨Êç¢„ÄÇ</p>
</blockquote>
<h3 id="ÈîôËØØÂ§ÑÁêÜ">ÈîôËØØÂ§ÑÁêÜ
</h3><p>RustËØ≠Ë®Ä‰ΩøÁî® ResultÔºàRustËØ≠Ë®Ä‰∏≠ÁöÑÊï∞ÊçÆÁ±ªÂûãÔºåË°®Á§∫ÂáΩÊï∞ÊâßË°åÁªìÊûúÔºâËøõË°åÈîôËØØÂ§ÑÁêÜÂíå‰º†ÈÄíÔºåÈîôËØØÁ±ªÂûãÂèØ‰ª•Ëá™ÂÆö‰πâ„ÄÇÂú® <code>src/memory/lib.rs</code> Êñá‰ª∂‰∏≠ÂÆö‰πâ‰∫Ü <code>memory</code> Â≠êÊ®°ÂùóÁõ∏ÂÖ≥ÁöÑÈîôËØØÁ±ªÂûã„ÄÇÈÄöËøá‰∏∫ Error Êûö‰∏æÁ±ªÂûãÂÆûÁé∞ <code>std::fmt::Display</code> traitÔºåÂèØ‰ª•Ëá™ÂÆö‰πâÊØèÁßçÈîôËØØÂèëÁîüÊó∂ÁöÑËæìÂá∫‰ø°ÊÅØ„ÄÇÈÄöËøáÂÆö‰πâ <code>Result&lt;T&gt;</code> ÁöÑÂà´ÂêçÔºåÂú®Êú¨Ê®°ÂùóÊàñËÄÖÂÖ∂‰ªñÊ®°Âùó‰∏≠ÂèØ‰ª•Áõ¥Êé•ÈÄöËøá <code>use crate::memory::Result</code> ÂºïÂÖ•Âπ∂‰ΩøÁî®ËØ• Result Á±ªÂûã„ÄÇ‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/memory/mod.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202133819251.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202133819251"
	
	
></p>
<h2 id="44-cpuÊ®°Âûã">4.4 CPUÊ®°Âûã
</h2><p>Âú®‰πãÂâçÁöÑÁ´†ËäÇ‰∏≠Â≠¶‰π†‰∫ÜÂ¶Ç‰Ωï‰ΩøÁî® <code>kvm_ioctls</code> Êù•Ë∞ÉÁî®Á≥ªÁªüÁöÑKVMÊé•Âè£Ôºå‰ª•ÂÆåÊàêÁ°¨‰ª∂ËæÖÂä©ËôöÊãüÂåñÁöÑÂü∫Êú¨ÂäüËÉΩÔºåÂÆûË∑µ‰∫ÜÂ¶Ç‰Ωï‰ΩøÁî® Rust ËØ≠Ë®ÄÂØπËôöÊãüÊú∫ÂÜÖÂ≠òÂ≠êÁ≥ªÁªüËøõË°åËÆæËÆ°ÂíåÊäΩË±°„ÄÇÂú®Ëøô‰∏ÄËäÇÁöÑÂÆûÈ™å‰∏≠ÔºåÂ∞ÜÁªßÁª≠ÊûÑÂª∫ StratoVirt-mini ËôöÊãüÂåñÁ®ãÂ∫èÔºåÂØπËôöÊãüÊú∫ÁöÑ CPU ËøõË°åËøõ‰∏ÄÊ≠•ÁöÑËÆæËÆ°ÂíåÊäΩË±°„ÄÇ</p>
<p>Âú®Ê≠£ÂºèÂºÄÂßã‰πãÂâçÔºåÂÖàÂú®È°πÁõÆÁöÑ <code>src</code> ÁõÆÂΩï‰∏ãÂàõÂª∫‰∏Ä‰∏™Âêç‰∏∫ <code>cpu</code> ÁöÑÊñá‰ª∂Â§πÔºåÊñá‰ª∂Â§π‰∏ãÂàõÂª∫‰∏Ä‰∏™Âêç‰∏∫ <code>mod.rs</code> ÁöÑÊñá‰ª∂ÔºåÊú¨ËäÇÁöÑ‰∏ªË¶ÅÁºñÁ®ãÂ∞ÜÂú® <code>mod.rs</code>Êñá‰ª∂‰∏≠ËøõË°å„ÄÇ</p>
<h3 id="cpuÂü∫Êú¨ÁªìÊûÑÁöÑÊäΩË±°">CPUÂü∫Êú¨ÁªìÊûÑÁöÑÊäΩË±°
</h3><p>È¶ñÂÖàË¶ÅÂÖàÁ°ÆÂÆö CPU Â≠êÊ®°ÂùóÁöÑÂäüËÉΩÁïåÈôê„ÄÇÂØπ‰∫éÁâ©ÁêÜÊú∫Êù•ËØ¥ÔºåCPUÁöÑÂäüËÉΩ‰∏ªË¶ÅÊòØËß£ÈáäËÆ°ÁÆóÊú∫Êåá‰ª§‰ª•ÂèäÂ§ÑÁêÜËÆ°ÁÆóÊú∫ËΩØ‰ª∂‰∏≠ÁöÑÊï∞ÊçÆÔºõËÄåÂú®ËôöÊãüÂåñÁ®ãÂ∫è‰∏≠ÔºåCPUÂ∫îËØ•Ë¢´ÊäΩË±°‰∏∫‰∏§‰∏™Âü∫Êú¨ÂäüËÉΩÔºö</p>
<ul>
<li><strong>ÂÆåÊàêÂØπËÆ°ÁÆóÊú∫Êåá‰ª§ÁöÑÊ®°Êãü</strong></li>
<li><strong>Â§ÑÁêÜ‰∏ÄÂÆöÁöÑÂØÑÂ≠òÂô®Êï∞ÊçÆ</strong></li>
</ul>
<p>ËÆ°ÁÆóÊú∫Êåá‰ª§Ê®°ÊãüÁöÑÈÉ®ÂàÜ‰∏ªË¶ÅÂú®ÂÜÖÊ†∏ KVM Ê®°Âùó‰∏≠ËøõË°åÂ§ÑÁêÜÔºåÂú®ËôöÊãüÂåñÁ®ãÂ∫èÁöÑ CPU Ê®°Âùó‰∏≠Ôºå‰∏ªË¶ÅË¥üË¥£ÂØπ VM-Exit ÈÄÄÂá∫‰∫ã‰ª∂ÁöÑÂ§ÑÁêÜÔºå‰πüÂ∞±ÊòØ‰∏ä‰∏ÄËäÇ‰∏≠ÂØπ<code>vcpu_fd.run(...)</code> ‰∫ã‰ª∂ÁöÑÂ§ÑÁêÜÔºåËøôÈÉ®ÂàÜ‰ª£Á†ÅÂ∞Ü‰ºöÂÖ®ÈÉ®Â∞ÅË£ÖÂú®CPUÊ®°Âùó‰∏≠„ÄÇ</p>
<p>ÂêåÊó∂Âú®ËôöÊãüÂåñÁ®ãÂ∫èÁöÑCPUÂ≠êÊ®°Âùó‰∏≠ÔºåËøòÈúÄË¶ÅËøõË°å‰∏ÄÂÆöÂØÑÂ≠òÂô®Êï∞ÊçÆÁöÑÂ§ÑÁêÜ„ÄÇ‰∏∫‰∫Ü‰æø‰∫éÊìç‰ΩúÔºåËøô‰∫õÂØÑÂ≠òÂô®Áõ∏ÂÖ≥ÁöÑÊï∞ÊçÆÔºåÂ∞ÜË¢´Áõ¥Êé•‰øùÂ≠òÂú®ÊäΩË±°Âá∫ÁöÑCPUÊï∞ÊçÆÁªìÊûÑ‰∏≠ÔºåÂèØ‰ª•ÈÄöËøáKVMÊèê‰æõÁöÑÁõ∏ÂÖ≥Êé•Âè£ÔºåÂÆåÊàêÂÜÖÊ†∏KVMÊ®°Âùó‰∏≠Ê®°ÊãüÁöÑvCPUÂíåHypervisor‰∏≠CPUÁªìÊûÑÂØÑÂ≠òÂô®‰ø°ÊÅØÁöÑÂêåÊ≠•„ÄÇ</p>
<hr>
<p>Ê≤øÁùÄ‰∏äÈù¢ÁöÑÊÄùË∑ØÔºåÂèØ‰ª•ÁÆÄÂçïÊäΩË±°Âá∫ CPU ÁöÑÂü∫Êú¨Êï∞ÊçÆÁªìÊûÑÔºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/cpu/mod.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202134219134.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202134219134"
	
	
></p>
<p>ËôΩÁÑ∂ÁõÆÂâçCPU‰∏≠ÁöÑÊàêÂëòËøòÊØîËæÉÂ∞ëÔºå‰ΩÜÂ∑≤ÁªèÂü∫Êú¨ÂèØ‰ª•ÊääCPUÊï∞ÊçÆÁªìÊûÑ‰∏≠ÁöÑÊàêÂëòÂàÜ‰∏∫‰∏âÁ±ªÔºå‰πãÂêé<strong>ÂØπCPUÁªìÊûÑÁöÑ‰∏ÄÂàáÊâ©Â±ïÈÉΩÊòØÂõ¥ÁªïÁùÄËøô‰∏âÁ±ªËøõË°åÁöÑÔºö</strong></p>
<ul>
<li>**ËØ•vCPUÊú¨Ë∫´ÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØÔºö**Â¶ÇËØ•vCPUÁöÑ ID Âè∑Á≠âÔºõ</li>
<li>**‰∏éÂÜÖÊ†∏KVMÊ®°ÂùóËøõË°å‰∫§‰∫íÁöÑÊé•Âè£Ôºö**Â¶ÇËØ•vCPUÁöÑ <code>VcpuFd</code>ÔºåÈÄöËøáËøô‰∏™ÊäΩË±°Âá∫ÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶ÔºåÂèØ‰ª•Áõ¥Êé•Ë∞ÉÁî®Âà∞ÂÜÖÊ†∏KVMÊ®°ÂùóÊâÄÊèê‰æõÁöÑ vCPU Áõ∏ÂÖ≥Êé•Âè£Ôºõ</li>
<li>**ÂØÑÂ≠òÂô®ÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØÔºö**Â¶ÇÁõÆÂâç‰øùÂ≠òÁöÑÈÄöÁî®ÂØÑÂ≠òÂô®ÂíåÊÆµÂØÑÂ≠òÂô®ÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØÔºåÂèØ‰ª•Ê†πÊçÆËøêË°åÁ®ãÂ∫èÁöÑÈúÄË¶ÅÔºåÂØπËøô‰∫õÂØÑÂ≠òÂô®ÁöÑ‰ø°ÊÅØËá™Áî±ËøõË°å‰øÆÊîπ„ÄÇ</li>
</ul>
<hr>
<h4 id="vcpuÂàùÂßãÂåñ">vCPUÂàùÂßãÂåñ
</h4><p>Êé•‰∏ãÊù•‰∏∫ÊäΩË±°Âá∫ÁöÑ CPU ÁªìÊûÑÊ∑ªÂä†ÊàêÂëòÂáΩÊï∞„ÄÇÈ¶ñÂÖàÈúÄË¶ÅÊ∑ªÂä†‰∏Ä‰∏™ÊûÑÈÄ†ÂáΩÊï∞ <code>new</code> ÂØπCPUÁªìÊûÑËøõË°åÂàùÂßãÂåñÔºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/cpu/mod.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202134353967.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202134353967"
	
	
></p>
<p>Âú®RustËØ≠Ë®ÄÁöÑ‰π†ÊÉØ‰∏≠Ôºå<code>new</code> ‰∏ÄËà¨ÊÑèÂë≥ÁùÄÂØπÊï∞ÊçÆÁªìÊûÑÁöÑÁõ¥Êé•ÂàõÂª∫Ôºå‰Ωú‰∏∫ÂçïÁ∫ØÁöÑÊûÑÈÄ†ÂáΩÊï∞ËÄå‰∏çÂåÖÂê´Âà´ÁöÑÈÄªËæëÔºåÊâÄ‰ª•Áõ¥Êé•‰º†ÂÖ•Â∑≤ÁªèÂàùÂßãÂåñÂÆåÊàêÁöÑ <code>VcpuFd</code> Âíå <code>vcpu_id</code>„ÄÇ<code>new</code> ÂáΩÊï∞ËøêË°åÂêéÔºåÂèØ‰ª•Áõ¥Êé•Ëé∑Âæó‰∏Ä‰∏™ÂàùÂßãÂåñÂÆåÊàêÁöÑ CPU Êï∞ÊçÆÁªìÊûÑ„ÄÇ</p>
<p>Ê≠§Êó∂ÂØπ‰∫éËØ• CPU Êï∞ÊçÆÁªìÊûÑËÄåË®ÄÔºåÂ∑≤ÁªèÊúâ‰∫Ü vCPU ÁöÑÂîØ‰∏ÄÊ†áËØÜÁ¨¶ ‚Äî <code>vcpu_id</code>ÔºåÂíåÂÜÖÊ†∏‰∏≠KVMÊ®°ÂùóÁöÑÊé•Âè£ <code>VcpuFd</code>Ôºå‰ΩÜÊòØÂØÑÂ≠òÂô®Áä∂ÊÄÅËøòÈÉΩÊòØÂàùÂßãÂÄºÔºåÊâÄ‰ª•ËøòÈúÄË¶ÅÂè¶‰∏Ä‰∏™ÂáΩÊï∞Êù•ÂÆåÊàê‰∏éKVMÊ®°Âùó‰∏≠ÂØÑÂ≠òÂô®Êï∞ÂÄºÁöÑÂêåÊ≠•Ôºå‰ª£Á†ÅÂ¶Ç‰∏ã„ÄÇ</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/cpu/mod.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202134433953.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202134433953"
	
	
></p>
<hr>
<h4 id="vcpuÂêåÊ≠•">vCPUÂêåÊ≠•
</h4><p>ÁÆÄÂçïÂ∞ÜËÆæÂ§áÁöÑÁîüÂëΩÂë®Êúü‰∏≠<strong>ËÆæÂ§áÊ≠£ÂºèÂêØÂä®ÂâçÁöÑÊµÅÁ®ã</strong>ÂàÜ‰∏∫‰∏§‰∏™Èò∂ÊÆµÔºö</p>
<ul>
<li>Á¨¨‰∏Ä‰∏™Èò∂ÊÆµÊòØÂàùÂßãÂåñÈò∂ÊÆµ(new)ÔºåÂåÖÂê´ÊúÄÂü∫Êú¨ÁöÑÊï∞ÊçÆÁªìÊûÑÁöÑÂàõÂª∫Ôºõ</li>
<li>Á¨¨‰∫å‰∏™Èò∂ÊÆµÊòØ‰ΩøËÉΩÈò∂ÊÆµ(realize)ÔºåÂåÖÂê´ÂØπËÆæÂ§áÁä∂ÊÄÅÁöÑ‰ΩøËÉΩÔºõ</li>
</ul>
<p>Âú®CPUÁªìÊûÑ‰∏≠ÔºåËÆæÂ§áÁä∂ÊÄÅÁöÑ‰ΩøËÉΩ‰∏ªË¶ÅÂåÖÂê´CPU‰∏≠ÂØÑÂ≠òÂô®‰ø°ÊÅØÁöÑËÆæÁΩÆ„ÄÇÂú® <code>realize</code> ÂáΩÊï∞‰∏≠ÔºåÂ∞ÜËé∑ÂèñÂÜÖÊ†∏KVMÊ®°Âùó‰∏≠ÁöÑÂØÑÂ≠òÂô®Êï∞ÂÄºÔºåÂπ∂ÂêåÊ≠•Âà∞CPUÁªìÊûÑÁöÑÂØÑÂ≠òÂô®‰∏≠„ÄÇÂêåÊ≠•ÂÆåÊàêÂêéÔºåÂú®Ê≠§Âü∫Á°Ä‰∏äÂØπCPUÂØÑÂ≠òÂô®ËøõË°åÂ∫îÁî®Á®ãÂ∫èËøêË°åÊâÄÈúÄË¶ÅÁöÑ‰øÆÊîπÔºå‰ª•ÂâçÊñáÈÇ£ÊÆµÊ±áÁºñÁ®ãÂ∫è‰∏∫‰æãÔºåÈúÄË¶ÅÂØπÈÄöÁî®ÂØÑÂ≠òÂô®ÂíåÊÆµÂØÑÂ≠òÂô®‰∏≠ÁöÑ‰∏Ä‰∫õÂÄºËøõË°åÁõ∏ÂÖ≥ËÆæÁΩÆÔºå‰ª£Á†ÅÂ¶Ç‰∏ã„ÄÇ</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/main.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202134517604.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202134517604"
	
	
></p>
<p>‰∏∫‰∫ÜÊàêÂäüËøêË°åÂÜôÂÖ•ÂÜÖÂ≠òÁöÑÊ±áÁºñ‰ª£Á†ÅÔºåÂØπÂØÑÂ≠òÂô®ËøõË°åÂ¶Ç‰∏ãËÆæÁΩÆÔºö</p>
<ul>
<li>ÂØπ‰∫éÈÄöÁî®ÂØÑÂ≠òÂô® <code>regs</code> ËÄåË®ÄÔºö
<ul>
<li>‰ºöÂ∞ÜÂú∞ÂùÄÂØÑÂ≠òÂô® <code>RIP</code> ËÆæÁΩÆ‰∏∫ËØ•Ê±áÁºñ‰ª£Á†ÅÂú®ÂÜÖÂ≠ò‰∏≠ÁöÑÂÆ¢Êà∑Êú∫Áâ©ÁêÜÂú∞ÂùÄÔºåËøôÊ†∑ÔºåCPUÂ∞±‰ºöÊ≤øÁùÄÂú∞ÂùÄÂØÑÂ≠òÂô®ËÆæÁΩÆÁöÑÂú∞ÂùÄÂºÄÂßãÊâßË°åÊåá‰ª§Ôºõ</li>
<li>Ê†áÂøóÂØÑÂ≠òÂô® <code>RFLAGS</code> Áî®‰∫éÊåáÁ§∫Â§ÑÁêÜÂô®Áä∂ÊÄÅÂπ∂ÊéßÂà∂ÂÖ∂Êìç‰ΩúÔºåÊ†áÂøóÂØÑÂ≠òÂô®‰∏ÄÂÖ± 32 ‰ΩçÔºåÂÖ∂‰∏≠Á¨¨ 2 ‰ΩçÂøÖÈ°ª‰∏∫ 1ÔºåÂÖ∂‰ªñ‰ΩçÂùá‰∏çÈúÄË¶ÅËÆæÁΩÆÔºåÊâÄ‰ª•Â∞ÜÊ†áÂøóÂØÑÂ≠òÂô®ËÆæÁΩÆ‰∏∫ 2Ôºõ</li>
<li><code>RAX</code> Âíå <code>RBX</code> ÊòØ‰∏§‰∏™Êï∞ÊçÆÂØÑÂ≠òÂô®ÔºåÂú®Ê±áÁºñ‰ª£Á†Å‰∏≠Â∞Ü‰ºöÊää <code>RAX</code> ÁöÑÂÄºÂíå <code>RBX</code> ÁöÑÂÄºËøõË°åÂä†Ê≥ïËÆ°ÁÆóÔºåËøô‰∏§‰∏™ÂØÑÂ≠òÂô®ËÆæÁΩÆÁöÑÂÄºÂ∞Ü‰ºöÂíåÁ®ãÂ∫èÊúÄÂêéÁöÑËæìÂá∫ÁªìÊûúÁõ¥Êé•Áõ∏ÂÖ≥ÔºåËøôÈáåËÆæÁΩÆÊàê 2 Âíå 3ÔºåËæìÂá∫ÁªìÊûúÂ∞±Â∞ÜÊòØ 5Ôºõ</li>
</ul>
</li>
<li>ÂØπ‰∫éÊÆµÂØÑÂ≠òÂô® <code>sregs</code> ËÄåË®ÄÔºåÈúÄË¶ÅËÆæÁΩÆÂÆÉÁöÑ‰ª£Á†ÅÊÆµÂØÑÂ≠òÂô®ÔºåËØ•ÂØÑÂ≠òÂô®ÂíåËøêË°å‰ª£Á†ÅÁöÑÂØªÂùÄÁõ∏ÂÖ≥ÔºåÊ≠§Â§ÑÁî®ÊúÄÁÆÄÂçïÁöÑÂØªÂùÄÊñπÂºèÂç≥ÂèØÔºå<code>base</code> Âíå <code>selector</code> ÂùáËÆæÁΩÆ‰∏∫0„ÄÇ</li>
</ul>
<p>Âú®ËÆæÁΩÆÂÆå CPU ÂÆû‰æã‰∏≠ÂØÑÂ≠òÂô®ÁöÑÊï∞ÂÄº‰πãÂêéÔºåËøòÈúÄË¶ÅÂ∞ÜËÆæÁΩÆÂÆåÊàêÁöÑÂØÑÂ≠òÂô®Êï∞ÂÄºÂêåÊ≠•ÂõûÂÜÖÊ†∏ÁöÑ KVM Ê®°ÂùóÔºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/cpu/mod.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202134606758.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202134606758"
	
	
></p>
<p>ËØ•ÂáΩÊï∞Â∞Ü CPU Ê®°Âùó‰∏≠‰øÆÊîπÁöÑÂØÑÂ≠òÂô®ÂÄºÈáçÊñ∞ËÆæÁΩÆÂà∞‰∫ÜÂÜÖÊ†∏KVMÊ®°Âùó‰∏≠ÔºåËøôÊ†∑Âú®ËôöÊãüÊú∫vCPUÊ≠£ÂºèËøêË°å‰πãÂâçÔºåÊâÄÊúâÁöÑÂáÜÂ§áÈÉΩÂÆåÊàê‰∫Ü„ÄÇÔºà‰∏•Ê†ºÊù•ËØ¥ÔºåCPUÁöÑ‰ΩøËÉΩÊ≠•È™§Â∫îËØ•ÂåÖÊã¨ÔºöËé∑Âèñkvm_vcpu‰∏≠ÁöÑÂØÑÂ≠òÂô®ÂÄº„ÄÅ‰øÆÊîπkvm_vcpu‰∏≠ÁöÑÂØÑÂ≠òÂô®ÂÄºÂíåËÆæÁΩÆkvm_vcpu‰∏≠ÁöÑÂØÑÂ≠òÂô®ÂÄº‰∏â‰∏™ËøáÁ®ãÔºå‰∏∫‰∫Ü‰æø‰∫éËØ¥ÊòéÔºåÊ≠§Â§ÑÂàÜ‰∏∫‰∏â‰∏™Ê≠•È™§Êù•ÂÆåÊàêÔºâ„ÄÇ</p>
<hr>
<h4 id="vcpuËøêË°å">vCPUËøêË°å
</h4><p>‰∏ã‰∏ÄÊ≠•Â∞±ËÉΩÊ≠£ÂºèËøêË°åÊäΩË±°Âá∫ÁöÑCPU‰∫ÜÔºåËøêË°å‰∏≠ÊúÄ‰∏ªË¶ÅÁöÑÈÉ®ÂàÜËøòÊòØÂÜÖÊ†∏KVMÊ®°Âùó‰∏≠vCPUÁöÑÊåá‰ª§Ê®°ÊãüÂíåÂØπÈô∑Âá∫‰∫ã‰ª∂ÁöÑÂ§ÑÁêÜÔºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/cpu/mod.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202134654575.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202134654575"
	
	
></p>
<hr>
<p>Â∞ÜCPUÊ®°ÂùóÊäΩË±°ÂÆåÊàêÂêéÔºåÂ∞Ü <code>kvm_vcpu_exec</code> ÂáΩÊï∞Êï¥ÂêàËøõ <code>main.rs</code> ‰∏≠ËøêË°åÔºåÂèØ‰ª•ÂæóÂà∞Â¶Ç‰∏ãÂíå 4.2 Â∞èËäÇÊú´Â∞æÁõ∏ÂêåÁöÑÁªìÊûúÔºö</p>
<p><code>Terminal</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202135242255.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202135242255"
	
	
></p>
<p>Ëá≥Ê≠§ÔºåÊàêÂäüÊääCPUÊúÄÂü∫Êú¨ÁöÑÂäüËÉΩÂ∞ÅË£ÖÂà∞‰∫ÜCPUÂ≠êÊ®°Âùó‰∏≠„ÄÇ</p>
<h3 id="cpuÂπ∂ÂèëËøêË°åÂ§ö‰∏™‰ªªÂä°">CPUÂπ∂ÂèëËøêË°åÂ§ö‰∏™‰ªªÂä°
</h3><p>Âú®ÂÆåÊàêCPUÂü∫Êú¨ÂäüËÉΩÁöÑÊäΩË±°ÂêéÔºåÁªßÁª≠ÂØπÊØîËôöÊãüÊú∫CPUÂíåÁâ©ÁêÜÊú∫CPU‰ºöÂèëÁé∞ÔºåÂú®ÂÆûÈôÖÁöÑÁâ©ÁêÜÊú∫‰∏≠Ôºå‰∏ÄËà¨‰∏çÂè™Êúâ‰∏Ä‰∏™CPUÔºåÂ∏∏Â∏∏‰ºöÊúâ‰∏Ä‰∏™‰ª•‰∏äCPUÁöÑÂú∫ÊôØÔºåËøô‰∫õCPUÂèØ‰ª•Áã¨Á´ãÂú∞ËøêË°åÁ®ãÂ∫èÊåá‰ª§ÔºåÂÆÉ‰ª¨ÂèØ‰ª•ËøêË°å‰∏çÂêåÁöÑÁ®ãÂ∫èÔºå‰πüÂèØ‰ª•ËøêË°åÂêå‰∏Ä‰∏™Á®ãÂ∫èÔºåÂà©Áî®Âπ∂Ë°åËÆ°ÁÆóËÉΩÂäõÂä†Âø´Á®ãÂ∫èËøêË°åÁöÑÈÄüÂ∫¶„ÄÇ</p>
<p>‰∏∫‰∫ÜÂÖÖÂàÜÂèëÊå•Á°¨‰ª∂Êú¨Ë∫´ÁöÑËÆ°ÁÆóËÉΩÂäõÔºåÈúÄË¶Å<strong>Ê∑ªÂä†ÂØπÂ§öCPUÂπ∂Ë°å‰ªªÂä°ÁöÑÊîØÊåÅ„ÄÇ<strong>Âú®Êñ∞ÁöÑCPUËøêË°åÊ®°Âûã‰∏≠ÔºåCPUÁöÑÊåá‰ª§Ê®°ÊãüÂíåÂØπÈô∑Âá∫‰∫ã‰ª∂ÁöÑÂ§ÑÁêÜÂ∞Ü‰∏çÂú®‰∏ªÁ∫øÁ®ã‰∏≠ËøõË°åÔºåÊØè‰∏™vCPUÈÉΩ‰ºöÂØπÂ∫î‰∏Ä‰∏™ÂçïÁã¨ÁöÑÁ∫øÁ®ãÔºåÈÄöËøá</strong>ÂàÜÊó∂Â§çÁî®</strong>ÁöÑÊñπÂºèÂÖ±‰∫´Áâ©ÁêÜCPU„ÄÇ</p>
<p>Rust‰∏≠ÂêåÊ†∑‰πüÂØπÂ§öÁ∫øÁ®ãÂπ∂ÂèëÁºñÁ®ãÊèê‰æõ‰∫ÜÂæàÂ•ΩÁöÑÊîØÊåÅÔºå‰∏ªË¶ÅÂåÖÊã¨ <code>std::thread</code> Âíå <code>std::sync</code> ‰∏§‰∏™Âü∫Êú¨Ê®°ÂùóÔºö</p>
<ul>
<li><code>thread</code> Ê®°Âùó‰∏≠ÂÆö‰πâ‰∫Ü<strong>ÁÆ°ÁêÜÁ∫øÁ®ãÁöÑÂêÑÁßçÂáΩÊï∞Ôºõ</strong></li>
<li><code>sync</code> Ê®°Âùó‰∏≠ÂàôÂÆö‰πâ‰∫ÜÂπ∂ÂèëÁºñÁ®ã‰∏≠<strong>Â∏∏Áî®ÁöÑÈîÅ„ÄÅÊù°‰ª∂ÂèòÈáèÂíåÂ±èÈöú„ÄÇ</strong></li>
</ul>
<hr>
<p>Â∞Ü CPU ÂàõÂª∫Á∫øÁ®ãÂπ∂ËøêË°åÊåá‰ª§Ê®°ÊãüÂíåÂ§ÑÁêÜÈô∑ÂÖ•Èô∑Âá∫‰∫ã‰ª∂ÁöÑÊìç‰ΩúÂ∞ÅË£ÖËµ∑Êù•Ôºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/cpu/mod.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202135348832.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202135348832"
	
	
></p>
<p><code>StratoVirt-mini_stratovirt_edu/src/main.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202135415857.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202135415857"
	
	
></p>
<p>‰øÆÊîπÂÆåÊàêÂêéÂ∞ùËØïÈÄöËøá <code>cargo run</code> ËøêË°åÂç¥Â§±Ë¥•‰∫ÜÔºåÂèëÁé∞Â¶Ç‰∏ãÊä•Èîô‰ø°ÊÅØ„ÄÇ</p>
<p><code>Terminal</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202135459764.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202135459764"
	
	
></p>
<p>ËøôÊòØRustÁºñÁ®ã‰∏≠‰∏Ä‰∏™Â∏∏ËßÅÁöÑÈùôÊÄÅÁîüÂëΩÂë®ÊúüÊ£ÄÊü•Â§±Ë¥•ÁöÑÈîôËØØÔºåÂéüÂõ†ÊòØÂú®ÂàõÂª∫ËøõÁ®ãÊó∂‰ΩøÁî®‰∫Ü‰∏Ä‰∏™Èó≠ÂåÖ„ÄÇÈó≠ÂåÖÂú®‰∏ÄËà¨ÊÉÖÂÜµ‰∏ã‰ºöÊåâÂºïÁî®Êù•ÊçïËé∑ÂèòÈáèÔºåÂõ†‰∏∫Ê∑ªÂä†‰∫Ü <code>move</code> ÂÖ≥ÈîÆÂ≠óÔºå‰ºöÂ∞Ü <code>&amp;self</code> ÁöÑÊâÄÊúâÊùÉËΩ¨ÁßªÂà∞Èó≠ÂåÖ‰∏≠ÔºåËÄå <code>&amp;self</code> Âè™ÊòØ‰∏Ä‰∏™‰∏¥Êó∂ÂÄüÁî®ÔºåÊó†Ê≥ïÈÄöËøáÁîüÂëΩÂë®ÊúüÊ£ÄÊü•ÔºåÊâÄ‰ª•Ë¶ÅÂ∞Ü‰º†ÂÖ•ÂáΩÊï∞ÁöÑÂèÇÊï∞ <code>&amp;self</code> Êîπ‰∏∫ <code>self</code> ÊâçËÉΩÈÄöËøáÊ£ÄÊü•„ÄÇÁ°ÆÂÆö‰∫ÜÈóÆÈ¢òÂêéÔºåÂØπËØ•ÂáΩÊï∞ËøõË°åÂ¶Ç‰∏ã‰øÆÊîπ„ÄÇ</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/cpu/mod.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202135522139.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202135522139"
	
	
></p>
<p>ÁºñËØëÈÄöËøáÔºåÁ®ãÂ∫èÊàêÂäüÊâßË°å„ÄÇ‰ΩÜÊòØËøôÊ†∑ÊîπÂä®‰πü‰ºöÂ∏¶Êù•‰∏Ä‰∏™ÈóÆÈ¢òÔºöCPUÂÆû‰æãÁöÑÊâÄÊúâÊùÉÂ∞ÜÂÆåÂÖ®ËΩ¨ÁßªÂà∞Ëá™Â∑±ÁöÑCPUÁ∫øÁ®ã‰∏≠ÔºåÂú®‰∏ªÁ∫øÁ®ãÂ∞ÜÂÜç‰πüÊó†Ê≥ïËé∑ÂèñÂà∞CPUÂÆû‰æãÁöÑÊâÄÊúâÊùÉÔºåÊó†Ê≥ïÂØπÂÆÉËøõË°å‰ªª‰ΩïÊü•ËØ¢ÂíåËÆøÈóÆ„ÄÇËøôÂØπ‰πãÂêéÊü•ËØ¢ÂíåÁÆ°ÁêÜCPU‰ø°ÊÅØÊòØÊûÅ‰∏∫‰∏çÂà©ÁöÑÔºå</p>
<p>‰æãÂ¶ÇÊÉ≥Âú®CPUÂºÄÂßãÊåá‰ª§Ê®°ÊãüÂêéÂæóÂà∞CPUÂØπÂ∫îÁöÑID‰ø°ÊÅØÔºåÁõ¥Êé•Ëé∑ÂèñCPUÂÆû‰æãÁöÑ <code>id</code> Âè∑ÂêéÔºåÂ∞Ü‰ºöÂæóÂà∞Â¶Ç‰∏ãÊä•ÈîôÔºö<code>value borrowed here after move</code>„ÄÇËØ•Êä•ÈîôÊÑèÊÄùÊòØËØ•CPUÂÆû‰æãÁöÑÊâÄÊúâÊùÉÂ∑≤ÁªèË¢´ËΩ¨ÁßªÂà∞‰∫ÜCPUÁ∫øÁ®ã‰∏≠ÔºåÂú®‰∏ªÁ∫øÁ®ã‰∏≠Âõ†‰∏∫Ê≤°ÊúâËé∑ÂèñÂà∞ËØ•CPUÁöÑÊâÄÊúâÊùÉÔºåÂ∞ÜÂÜçÊó†Ê≥ïËé∑ÂèñÂÆû‰æãÁöÑ‰ªª‰Ωï‰ø°ÊÅØ„ÄÇÈÇ£‰πàÊúâÊ≤°Êúâ‰∏ÄÁßçÊñπÊ≥ïÂèØ‰ª•ÂÆâÂÖ®Âú∞Âú®‰∏ªÁ∫øÁ®ãÂíåCPUÁ∫øÁ®ã‰∏≠ÂÖ±‰∫´CPUÂÆû‰æãÂë¢ÔºüRustÊèê‰æõ‰∫Ü‰∏ÄÁßçÂæàÂº∫Â§ßÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÂêåÊ≠•Êú∫Âà∂Ôºö<code>Arc &lt;T&gt;</code>„ÄÇ</p>
<hr>
<p><code>Arc &lt;T&gt;</code> ÊÑèÊÄùÊòØÂ§öÁ∫øÁ®ãÂºïÁî®ËÆ°Êï∞ÊåáÈíàÔºåÊòØ‰∏Ä‰∏™Á∫øÁ®ãÂÆâÂÖ®ÁöÑÁ±ªÂûãÔºåÂÖÅËÆ∏ÂÆÉË¢´‰º†ÈÄíÂíåÂÖ±‰∫´ÁªôÂà´ÁöÑÁ∫øÁ®ãÔºåÂèØ‰ª•Áõ¥Êé•ÈÄöËøá <code>clone</code> ÊñπÊ≥ïÊù•ÂÖ±‰∫´ÊâÄÊúâÊùÉÔºåÊ≠§Êó∂ÁöÑ <code>clone</code> ÊñπÊ≥ïÂπ∂‰∏çÊòØÊ∑±Â§çÂà∂ÔºåÂè™ÊòØÁÆÄÂçïÂú∞ÂÖ±‰∫´ÊâÄÊúâÊùÉÁöÑËÆ°Êï∞„ÄÇ‰∏ãÈù¢ÂÜçÊ¨°ÂØπÂàÜÁ¶ªCPUÁ∫øÁ®ãÁöÑ‰ª£Á†ÅËøõË°åÂ¶Ç‰∏ã‰øÆÊîπÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/cpu/mod.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202135613094.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202135613094"
	
	
></p>
<p><code>StratoVirt-mini_stratovirt_edu/src/main.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202135648962.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202135648962"
	
	
></p>
<p>ÂêåÊó∂Â∞ÜÂâçÈù¢ÁöÑ <code>reset</code> Ê≠•È™§‰πüÂä†ÂÖ•CPUÁ∫øÁ®ã‰∏≠Êù•Âπ∂ÂèëËøõË°åÔºå‰ª•ÂáèÂ∞ë‰∏ªÁ∫øÁ®ã‰∏≠ÁöÑÊó∂Èó¥ÊçüËÄóÔºåÊèêÂçáÁ®ãÂ∫èËøêË°åÁöÑÊïàÁéá„ÄÇ</p>
<hr>
<p>ÂΩìÂÆûÁé∞‰∫ÜÂ§ö‰∏™CPUÁ∫øÁ®ãÂêåÊó∂ËøêË°åÁöÑÊñπÂºèÂêéÔºåÂèØ‰ª•ÊîØÊåÅÁî®Â§ö‰∏™CPUÊù•ÊâßË°å‰∏çÂêåÁöÑ‰ªªÂä°„ÄÇÊàë‰ª¨ÂèØ‰ª•Â∞ùËØïÂêåÊó∂ËøêË°å‰∏§ÊÆµ‰ª£Á†ÅÔºåÊØèÊÆµ‰ª£Á†ÅÁî±ÂêÑËá™ÁöÑCPUÁ∫øÁ®ãÂπ∂ÂèëËøêË°å„ÄÇÂú®‰∏ä‰∏ÄËäÇÊ±áÁºñ‰ª£Á†ÅÁöÑÂü∫Á°Ä‰∏äÊ∑ªÂä†Á¨¨‰∫åÊÆµÊ±áÁºñ‰ª£Á†ÅÔºåÁÆÄÂçïÂú∞ÂØπ <code>0x8000</code> Âú∞ÂùÄËøõË°åmmioËØªÂÜôÂêéÔºåËØ•vCPUÊâßË°å <code>HLT</code> Êåá‰ª§„ÄÇ‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/main.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202135734292.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202135734292"
	
	
></p>
<p>‰øÆÊîπÁ®ãÂ∫èËÆ©‰∏§‰∏™vCPUËøêË°åÂêÑËá™ÁöÑÊ±áÁºñ‰ª£Á†ÅÔºåÊàêÂäüËøêË°åÂêéÂ∞ÜÂæóÂà∞‰ª•‰∏ãËæìÂá∫„ÄÇ</p>
<p><code>Terminal</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202135757849.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202135757849"
	
	
></p>
<p>‰ª•‰∏äÂ∞±ÊòØ‰∏Ä‰∏™ÁÆÄÂçïÁöÑËôöÊãüÊú∫CPUÊ®°ÂûãÁöÑÂÖ®ÈÉ®ÂÜÖÂÆπÔºå‰ªãÁªç‰∫ÜCPUÊ®°ÂùóÁöÑËÆæËÆ°ÊÄùË∑ØÂíåÂäüËÉΩÊäΩË±°Ôºå‰ª•ÂèäÂú®StratoVirtÁ®ãÂ∫è‰∏≠CPUÁ∫øÁ®ãÊ®°ÂûãÁöÑÁÆÄÂçïÂÆûÁé∞„ÄÇ‰∏ãÈù¢Â∞Ü‰∏çÂÜçËøêË°åÁÆÄÂçïÁöÑÊ±áÁºñÂ∞èÁ®ãÂ∫èÔºåËÄåÊòØ<strong>ÈÄöËøáÂØπ BootLoader Ê®°ÂùóÁöÑÂÆûÁé∞Êù•ÂêØÂä®‰∏Ä‰∏™ÂÆåÊï¥ÁöÑ Linux Ê†áÂáÜÂÜÖÊ†∏„ÄÇ</strong></p>
<h2 id="45-bootloaderÂÆûÁé∞">4.5 BootLoaderÂÆûÁé∞
</h2><p>ÂâçÊñá‰∏≠Â∑≤ÁªèÂÆûÁé∞‰∫ÜÂØπCPUÊ®°ÂûãÁöÑÊäΩË±°ÔºåÂèØ‰ª•ÈÄöËøáÂêØÂä®Êõ¥Â§öÁöÑvCPUÁ∫øÁ®ãÊù•Âπ∂Ë°åÊâßË°åÊõ¥Â§öÁöÑ‰ªªÂä°„ÄÇÈÇ£‰πàÊòØÂê¶ÂèØ‰ª•ÈÄöËøáÂÆÉÊù•ËøêË°åÊõ¥Â§çÊùÇÁöÑÁ®ãÂ∫èÔºåËÄå‰∏çÂè™ÊòØÁÆÄÂçïÁöÑÊ±áÁºñ‰ª£Á†ÅÔºåÊØîÂ¶Ç‰∏Ä‰∏™ÂÆåÊï¥ÁöÑLinuxÂÜÖÊ†∏Ôºü‰∏ãÈù¢Â∞ÜÈÄêÊ≠•ÊûÑÂª∫ÂêØÂä®ÂºïÂØºÊ®°ÂùóBootLoaderÔºåÁõ¥Âà∞ËÉΩÂêØÂä®‰∏Ä‰∏™ÂÆåÊï¥ÁöÑLinuxÂÜÖÊ†∏„ÄÇ</p>
<h3 id="ÂÜÖÊ†∏Êñá‰ª∂ËØªÂÖ•ÂÜÖÂ≠ò">ÂÜÖÊ†∏Êñá‰ª∂ËØªÂÖ•ÂÜÖÂ≠ò
</h3><p>Êúâ‰∫Ü‰πãÂâçÁ´†ËäÇ‰∏≠ËøêË°åÊ±áÁºñ‰ª£Á†ÅÁöÑÁªèÈ™åÔºåÂèØ‰ª•ÁÆÄÂçïÊÄªÁªìÂá∫ÈÄöËøáKVMÊ®°ÂùóÊ®°ÊãüÂá∫ÁöÑvCPUÂíåËôöÊãüÊú∫ÂÜÖÂ≠òÊù•ËøêË°å‰ª£Á†ÅÁöÑÊñπÊ≥ïÔºö</p>
<ol>
<li><strong>Â∞ÜË¶ÅËøêË°åÁöÑ‰ª£Á†ÅËØªËøõËôöÊãüÊú∫ÂÜÖÂ≠òÔºõ</strong></li>
<li><strong>ËÆæÁΩÆvCPU‰∏≠ÁöÑÁõ∏ÂÖ≥ÂØÑÂ≠òÂô®ÊîØÊåÅ‰ª£Á†ÅËøêË°å„ÄÇ</strong></li>
</ol>
<p>È¶ñÂÖàËé∑Âèñ‰∏Ä‰∏™Ê†áÂáÜPEÊ†ºÂºèÁöÑLinuxÂÜÖÊ†∏ÈïúÂÉè <code>vmlinux.bin</code>ÔºåÈÄöËøáRust‰∏≠ÁöÑÊñá‰ª∂Êìç‰ΩúÊâìÂºÄÂÜÖÊ†∏ÈïúÂÉèÂπ∂ËØªÂÖ•ÂÜÖÂ≠ò‰∏≠„ÄÇ‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/main.rs</code></p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051757765.png" alt="image-20231202181502124" style="zoom: 33%;" />
<blockquote>
<p>RustÊ†áÂáÜÂ∫ì‰∏≠ÊúâÂØπÊñá‰ª∂Êìç‰ΩúÁöÑÂ∞ÅË£ÖÔºåÂ∞ÅË£Ö‰∫ÜÊâìÂºÄ„ÄÅÂÖ≥Èó≠„ÄÅËé∑ÂèñÊñá‰ª∂ÂÖÉÊï∞ÊçÆ‰ø°ÊÅØÁ≠â‰∏ÄÁ≥ªÂàóÊñá‰ª∂Êìç‰ΩúÔºåÈÄöËøáÂºïÂÖ• <code>std::fs</code> ËøõË°å‰ΩøÁî®„ÄÇ</p>
</blockquote>
<p>‰∏äÈù¢ËøôÊÆµ‰ª£Á†Å‰∏≠‰ΩøÁî®‰∫Ü <code>fs</code> ÁöÑ‰∏§‰∏™ÂáΩÊï∞ÔºåÂàÜÂà´ÊòØÊâìÂºÄÂÜÖÊ†∏ÈïúÂÉèÊñá‰ª∂ÂíåËé∑ÂèñÈïúÂÉèÁöÑÂ§ßÂ∞èÔºåÈÄöËøá <code>fs::File::open</code> ÂáΩÊï∞ÊâìÂºÄÁöÑÊñá‰ª∂‰∏∫ File Á±ªÂûãÔºåËØ•Á±ªÂûãÈªòËÆ§Áõ¥Êé•ÂÆûÁé∞‰∫ÜÊ†áÂáÜÂ∫ì‰∏≠ÁöÑ <code>Read</code> traitÔºåÊâÄ‰ª•ÂèØ‰ª•Áõ¥Êé•Ë¢´ËôöÊãüÊú∫ÂÜÖÂ≠òÊ®°ÂùóÁöÑGuestMemory ÁöÑ <code>write</code> ÂáΩÊï∞Ë∞ÉÁî®ÂÜôÂÖ•ËôöÊãüÊú∫ÂÜÖÂ≠ò‰∏≠ÔºåÈÄöËøáË∞ÉÁî®ËØ•ÂáΩÊï∞ÂèØ‰ª•ÊääÊï¥‰∏™ÂÜÖÊ†∏ÈïúÂÉèÂÜôÂÖ•ËôöÊãüÊú∫ÂÜÖÂ≠ò‰∏≠<code>0x1000</code> Â§ÑÔºåÂπ∂Â∞Ü vCPU0 ÈÄöÁî®ÂØÑÂ≠òÂô®‰∏≠Âú∞ÂùÄÂØÑÂ≠òÂô®ÁöÑÂÄºÊîπ‰∏∫ÂÜÖÊ†∏‰ª£Á†ÅÁöÑËµ∑ÂßãÂú∞ÂùÄ <code>0x1000</code>ÔºåÂºÄÂßãËøêË°å„ÄÇ</p>
<p>ËøêË°åÂêéÂç¥ÂèëÁé∞Â±èÂπï‰∏äÊ≤°Êúâ‰ªª‰ΩïËæìÂá∫ÔºåËøô‰ª£Ë°®ÂÜÖÊ†∏ÈïúÂÉèÂú®ÂêØÂä®ÂêéÊ≤°Êúâ‰ªª‰ΩïÁöÑ VM-Exit Èô∑Âá∫ÔºåËøôÊòæÁÑ∂Âπ∂‰∏çÁ¨¶ÂêàLinuxÂÜÖÊ†∏Ê≠£Â∏∏ÂêØÂä®ÁöÑÊÉÖÂΩ¢ÔºåÂà∞Â∫ïÊòØÂì™‰∏ÄÊ≠•Âá∫‰∫ÜÈóÆÈ¢òÂë¢Ôºü</p>
<h3 id="linuxÂÜÖÊ†∏ÂºïÂØºÊµÅÁ®ã">LinuxÂÜÖÊ†∏ÂºïÂØºÊµÅÁ®ã
</h3><p>Ë¶ÅÊÉ≥ÂõûÁ≠îËøô‰∏™ÈóÆÈ¢òÔºåÈúÄË¶ÅÂÖàÁÆÄÂçïÊ¢≥ÁêÜ‰∏Ä‰∏ãÁî± Linux ÂêØÂä®ÂçèËÆÆËßÑÂÆöÁöÑÂÜÖÊ†∏Âú®Áâ©ÁêÜÊú∫ <code>Intel x86_64</code> Âπ≥Âè∞‰∏äÁöÑÂºïÂØº-ÂêØÂä®ÊµÅÁ®ãÔºö</p>
<ol>
<li>ÂΩìÁ°¨‰ª∂ÁîµÊ∫êÊâìÂºÄÂêéÔºå8086ÁªìÊûÑÁöÑCPU‰ºöËá™Âä®ËøõÂÖ•ÂÆûÊ®°ÂºèÔºåÊ≠§Êó∂‰ªÖËÉΩËÆøÈóÆ1MBÁöÑÂÜÖÂ≠òÔºåÂπ∂‰∏î‰ºöÂä†ËΩΩBIOSÂà∞0xffff0Âà∞0xfffffÁöÑ‰ΩçÁΩÆÔºõ</li>
<li>CPUËá™Âä®‰ªé0xffff0ÂºÄÂßãÊâßË°å‰ª£Á†ÅËøêË°åBIOSÔºåBIOSÂ∞Ü‰ºöÊâßË°åÊüê‰∫õÁ°¨‰ª∂Ê£ÄÊµãÔºåÂàùÂßãÂåñÊüê‰∫õÁ°¨‰ª∂Áõ∏ÂÖ≥ÁöÑÈáçË¶Å‰ø°ÊÅØÔºåÂπ∂‰ªéÁâ©ÁêÜÂú∞ÂùÄ0Â§ÑÂºÄÂßãÂàùÂßãÂåñ‰∏≠Êñ≠ÂêëÈáèÔºõ</li>
<li>Âú®BIOSÊâßË°åÂÆåÊàêÂêéÔºåËØ•Âå∫ÂüüÂ∑≤ÁªèÂ°´ÂÖÖ‰∫ÜÂÜÖÊ†∏Â§¥ÈÉ®ÊâÄÈúÄË¶ÅÁöÑÊâÄÊúâÂèÇÊï∞ÔºåÂ∏∏ËßÅÁöÑBIOSÊâßË°åÂÆåÊàêÂêéÂÆûÊ®°Âºè‰ΩéÂú∞ÂùÄ‰Ωç1MBÂÜÖÂ≠òÂ∏ÉÂ±ÄÂ¶Ç‰∏ãË°®ÊâÄÁ§∫Ôºö</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202181646056.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202181646056"
	
	
></p>
<hr>
<p>BIOSÊâßË°åÂÆåÊàêÂêéÂ∞±Âà∞‰∫ÜË∑≥ËΩ¨Ëá≥ÂÜÖÊ†∏ÁöÑÂÖ•Âè£ÁÇπÔºåÊ≠§Êó∂ÂÜÖÊ†∏Â∞Ü‰ºöÊâßË°å‰∏§‰∏™ÂáΩÊï∞Ôºö<code>go_to_protected_mode</code> Âíå<code>protected_mode_jump</code>Ôºö</p>
<ul>
<li>ÂâçËÄÖ‰ºöÂ∞ÜCPUËÆæÁΩÆ‰∏∫‰øùÊä§Ê®°ÂºèÔºåÂú®ÂÆûÊ®°Âºè‰∏ãÔºåÂ§ÑÁêÜÂô®ÁöÑ‰∏≠Êñ≠ÂêëÈáèË°®ÊÄªÊòØ‰øùÂ≠òÂú®Áâ©ÁêÜÂú∞ÂùÄ0Â§ÑÔºå‰ΩÜÊòØÂú®‰øùÊä§Ê®°Âºè‰∏ãÔºå‰∏≠Êñ≠ÂêëÈáèË°®Â∞ÜÂ≠òÂÇ®Âú®CPUÂØÑÂ≠òÂô® <code>IDTR</code> ‰∏≠ÔºåÂêåÊó∂‰∏§ÁßçÊ®°ÂºèÁöÑÂÜÖÂ≠òÂØªÂùÄÊ®°Âºè‰πüÊòØ‰∏çÂêåÁöÑÔºå‰øùÊä§Ê®°ÂºèÈúÄË¶Å‰ΩøÁî®‰Ωç‰∫éCPU‰∏≠ <code>GDTR</code> ÂØÑÂ≠òÂô®‰∏≠ÁöÑÂÖ®Â±ÄÊèèËø∞Á¨¶Ë°®ÔºåÊâÄ‰ª•Âú®ËøõÂÖ•‰øùÊä§Ê®°ÂºèÂâçËøòÈúÄË¶ÅË∞ÉÁî® <code>setup_idt</code> Âíå <code>setup_gdt</code> ÂáΩÊï∞Êù•ÂÆâË£Ö‰∏¥Êó∂‰∏≠Êñ≠ÊèèËø∞Á¨¶Ë°®ÂíåÂÖ®Â±ÄÊèèËø∞Á¨¶Ë°®„ÄÇ</li>
<li>ÂÆåÊàêÂêéË∞ÉÁî® <code>protected_mode_jump</code> ÂáΩÊï∞Ê≠£ÂºèËøõÂÖ•‰øùÊä§Ê®°ÂºèÔºåËØ•ÂáΩÊï∞Â∞ÜËÆæÁΩÆCPU CR0ÂØÑÂ≠òÂô®‰∏≠ÁöÑ <code>PE</code> ‰ΩçÊù•ÂêØÁî®‰øùÊä§Ê®°ÂºèÔºåÊ≠§Êó∂ÊúÄÂ§öÂèØ‰ª•Â§ÑÁêÜ4GBÁöÑÂÜÖÂ≠ò„ÄÇ‰πãÂêéÂ∞Ü‰ºöË∑≥ËΩ¨Âà∞32‰ΩçÂÜÖÊ†∏ÂÖ•Âè£ÁÇπ <code>startup_32</code>ÔºåÊ≠£ÂºèËøõË°åLinuxÂÜÖÊ†∏ÁöÑÂêØÂä®ÊµÅÁ®ãÔºåÂºïÂØºÂÆåÊàê„ÄÇ</li>
</ul>
<hr>
<p>‰∫ÜËß£‰∫ÜLinuxÂÜÖÊ†∏ÁöÑÂü∫Êú¨ÂºïÂØºÊµÅÁ®ãÂêéÔºåÂ∞±ÂèØ‰ª•Áü•ÈÅì‰πãÂâçÂÜÖÊ†∏ÂêØÂä®Â§±Ë¥•ÁöÑÂéüÂõ†‰∫ÜÔºö</p>
<blockquote>
<p><strong><font color='red'>StratoVirt-mini Âú®ÊâßË°åÂÜÖÊ†∏Êó∂Áº∫Â∞ë‰∫ÜÂºïÂØºÁöÑÊ≠•È™§Ôºå‰πüÂ∞±ÊòØÁ±ª‰ºº‰∫éÁâ©ÁêÜÊú∫ÂêØÂä®ÊµÅÁ®ã‰∏≠BIOSÂäüËÉΩÁöÑÊ®°ÂùóÔºåÊ≤°ÊúâÂºïÂØºLinuxÂÜÖÊ†∏Âú®ÂÆûÊ®°Âºè‰∏ãÈÖçÁΩÆÂÜÖÊ†∏Â§¥ÈÉ®ÊâÄÈúÄË¶ÅÁöÑÂèÇÊï∞Ôºå‰πüÊ≤°ÊúâËøõË°å‰∏Ä‰∫õÈáçË¶ÅÂØÑÂ≠òÂô®ÁöÑËÆæÁΩÆÔºåLinuxÂÜÖÊ†∏ÂΩìÁÑ∂Êó†Ê≥ïÂêØÂä®„ÄÇ</font></strong></p>
</blockquote>
<p>Êé•‰∏ãÊù•ÈúÄË¶ÅËÆæËÆ°Âπ∂ÂÆûÁé∞‰∏Ä‰∏™ BootLoader Ê®°ÂùóÔºåÂºïÂØºÊ†áÂáÜPEÊ†ºÂºèÁöÑ Linux ÂÜÖÊ†∏ÂêØÂä®ÔºåÂÆûÁé∞Â∞ÜÂÜÖÊ†∏ÈïúÂÉèÂä†ËΩΩËøõÂÜÖÂ≠òÂπ∂Ê†πÊçÆÂêØÂä®ÂçèËÆÆËÆæÁΩÆÂêØÂä®ÊâÄÂøÖÈúÄÁöÑÂÜÖÂ≠òÂ∏ÉÂ±ÄÔºåÂπ∂ËÆæÁΩÆÁõ∏Â∫îÁöÑCPUÂØÑÂ≠òÂô®Ôºå‰ª•Ë∑≥ËøáÂÆûÊ®°ÂºèÁõ¥Êé•ËøõÂÖ•‰øùÊä§Ê®°ÂºèÂêØÂä®LinuxÂÜÖÊ†∏„ÄÇ</p>
<p>Âú®Ê≠£ÂºèÁºñÁ†ÅÂâçÔºåÂÖàÂú®È°πÁõÆÁöÑ <code>src</code> ÁõÆÂΩï‰∏ãÂàõÂª∫‰∏Ä‰∏™Âêç‰∏∫ <code>boot_loader</code> ÁöÑÊñá‰ª∂Â§π‰Ωú‰∏∫Ê®°ÂùóÁõÆÂΩïÔºåÊú¨ËäÇÁöÑ‰∏ªË¶ÅÁºñÁ†ÅÂ∞ÜÂú®ËØ•ÁõÆÂΩï‰∏ãËøõË°å„ÄÇ</p>
<p>È¶ñÂÖàÊ†πÊçÆLinux x86ÂêØÂä®ÂçèËÆÆÊù•ËÆæËÆ° <code>boot_loader</code> ÁöÑÂÜÖÂ≠òÂ∏ÉÂ±ÄÔºåËØ¶ËßÅ‰∏ãË°®ÊâÄÁ§∫Ôºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202181941534.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202181941534"
	
	
></p>
<ul>
<li>ÂÜÖÂ≠òÂ∏ÉÂ±Ä‰∏≠1MB‰ª•‰∏ãÁöÑÈÉ®ÂàÜ‰∏ªË¶ÅËøòÊòØÂÜÖÊ†∏ÂêØÂä®ÁöÑÁõ∏ÂÖ≥ÈÖçÁΩÆÔºåÂØπÁÖßBIOSÊâßË°åÂêéÁöÑ1MBÂÜÖÂ≠òÂ∏ÉÂ±ÄÂÅö‰∫ÜÁõ∏ÂΩìÂ§öÁöÑÁÆÄÂåñÔºõ</li>
<li>1MB‰ª•‰∏äÁöÑÈÉ®ÂàÜÂºÄÂßãËØªÂÖ•ÂÜÖÊ†∏‰øùÊä§Ê®°ÂºèÁöÑÂÖ•Âè£‰ª£Á†ÅÔºõ</li>
<li>Âú®ÂÜÖÂ≠òÊú´Â∞æÂ∞ÜÂ≠òÂÖ•‰∏Ä‰∏™ÁÆÄÊòìÊñá‰ª∂Á≥ªÁªü <code>initrd</code>Ôºå‰Ωú‰∏∫ÂÜÖÊ†∏ÂêØÂä®ÂêéÁöÑÂÜÖÂ≠òÊñá‰ª∂Á≥ªÁªüÊù•‰ΩøÁî®Ôºõ</li>
</ul>
<h3 id="ÈÖçÁΩÆzero-page">ÈÖçÁΩÆZero Page
</h3><p>Zero PageÔºàÈõ∂È°µÔºâÊòØ32‰ΩçÂÜÖÊ†∏ÂêØÂä®ÂèÇÊï∞ÁöÑ‰∏ÄÈÉ®ÂàÜÔºåÁî®Êù•Â≠òÊîæÂÜÖÊ†∏ÂêØÂä®ÁöÑÂêÑÁßçÈÖçÁΩÆÂíåÁ°¨‰ª∂‰ø°ÊÅØ„ÄÇÈõ∂È°µ‰πüË¢´Áß∞‰Ωú<code>Boot Params</code>ÔºåÂÆÉÂåÖÂê´‰∫ÜÂæàÂ§öÈÖçÁΩÆÁªìÊûÑ‰ΩìÔºåÂú®Ëøô‰∫õÁªìÊûÑ‰Ωì‰∏≠ÔºåÈô§‰∫ÜÈÖçÁΩÆ‰∏Ä‰∫õÁ≤æÁÆÄÁöÑÁ°¨‰ª∂‰ø°ÊÅØÂ§ñÔºåËøòÊúâ‰∏§‰∏™ÁªìÊûÑ‰ΩìÊòØÈúÄË¶ÅÁâπÂà´Â§ÑÁêÜÁöÑÔºåÂç≥ <code>RealModeKernelHeader</code> Âíå <code>E820Entry</code>Ôºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/boot_loader/zeropage.rs</code></p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051758357.png" alt="image-20231202182145747" style="zoom:33%;" />
<hr>
<p><code>KernelHeader</code> ‰Ωú‰∏∫ÂÆûÊ®°Âºè‰∏ãÂÜÖÊ†∏ÈïúÂÉèÁöÑÊñá‰ª∂Â§¥ÔºåÂåÖÂê´‰∫ÜËÆ∏Â§öÂÜÖÊ†∏ÁöÑÈÖçÁΩÆ‰ø°ÊÅØÔºåÂÖ∂‰∏≠ÊúâÂá†È°πÊòØÈúÄË¶ÅÁâπÂà´ËÆæÁΩÆÁöÑÔºåÂ¶Ç‰∏ãË°®ÊâÄÁ§∫Ôºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202182223026.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202182223026"
	
	
></p>
<hr>
<p>Êé•‰∏ãÊù•ËøòÈúÄË¶ÅËøõË°å <code>e820</code> Ë°®ÁöÑÈÖçÁΩÆ„ÄÇÂú®Áâ©ÁêÜÊú∫‰∏äÔºå<code>e820</code> ÊòØ‰∏Ä‰∏™ÂèØ‰ª•<strong>Êé¢ÊµãÁ°¨‰ª∂ÂÜÖÂ≠òÂàÜÂ∏É</strong>ÁöÑÁ°¨‰ª∂ÔºåBIOS‰∏ÄËà¨‰ºöÈÄöËøá<code>0x15</code> ‰∏≠Êñ≠‰∏é‰πãÈÄö‰ø°Êù•Ëé∑ÂèñÁ°¨‰ª∂ÂÜÖÂ≠òÂ∏ÉÂ±ÄÔºåÂú® <code>boot_loader</code> ‰∏≠‰∏çÈúÄË¶ÅÂÜçÈÄöËøáËøô‰∏™ÊµÅÁ®ãÊù•Ëé∑ÂèñÂ∏ÉÂ±ÄÔºåÁõ¥Êé•Ê†πÊçÆÂØπ<code>boot_loader</code> ÂÜÖÂ≠òÂ∏ÉÂ±Ä‰∏≠ÂáÜÂ§áÂ•ΩÁöÑÂÄºÊù•ËøõË°å <code>e820</code> Ë°®ÁöÑÈÖçÁΩÆ„ÄÇ</p>
<p><code>e820</code> Ë°®‰∏≠ÁöÑÊØè‰∏ÄÈ°πÈÉΩÊòØ‰∏Ä‰∏™ <code>E820Entry</code> Êï∞ÊçÆÁªìÊûÑÔºåË°®Á§∫‰∏ÄÊÆµÂÜÖÂ≠òÁ©∫Èó¥ÔºåÂåÖÂê´‰∫ÜËµ∑ÂßãÂú∞ÂùÄ„ÄÅÁªìÊùüÂú∞ÂùÄÂíåÁ±ªÂûã„ÄÇËøôÈáåÂ∞ÜÊ†πÊçÆÊï¥‰∏™ËôöÊãüÊú∫ÁöÑÂÜÖÂ≠òÂ∏ÉÂ±ÄÊù•ËøõË°å <code>e820</code> Ë°®ÁöÑÈÖçÁΩÆÔºå‰ª£Á†ÅÂ¶Ç‰∏ã„ÄÇ</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/boot_loader/zeropage.rs</code></p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051758957.png" alt="image-20231202182336020" style="zoom: 50%;" />
<p>Âú®ÂØπ <code>e820</code> Ë°®ÁöÑÈÖçÁΩÆ‰∏≠ÔºåË¶ÅÊääËôöÊãüÊú∫ÁöÑÂÜÖÂ≠òËøõË°åÂàÜÁ±ªÔºåÊ≠§Â§ÑÁöÑÂàÜÁ±ªËæÉ‰∏∫ÁÆÄÂçïÔºå‰ªÖÂàÜ‰∏∫‰∏§Á±ªÔºö</p>
<ul>
<li>‰∏ÄÁ±ªÊòØÂèØ‰ª•‰Ωú‰∏∫ÂÜÖÂ≠ò‰ΩøÁî®ÁöÑ <code>E820_RAM</code>Ôºõ</li>
<li>ËøòÊúâ‰∏ÄÁ±ªÊòØÂ∑≤Áªè‰øùÁïôÁªôÁâπÂÆöÂäüËÉΩ‰ΩøÁî®ÁöÑÂÜÖÂ≠ò <code>E820_RESERVED</code>Ôºõ</li>
</ul>
<p>‰ΩéÂú∞ÂùÄÊÆµÁöÑÂÜÖÂ≠òÂ∏ÉÂ±ÄÂíåÂâçÈù¢ÁöÑÂÜÖÂ≠òÂ∏ÉÂ±Ä‰øùÊåÅ‰∏ÄËá¥ÔºåÈ´òÂú∞ÂùÄÊÆµÁöÑÂÜÖÂ≠òË¶ÅÊ≥®ÊÑèÁöÑÂú∞ÊñπÊòØÂú® x86_64 Êû∂ÊûÑËôöÊãüÊú∫ÁöÑÂÜÖÂ≠òÂ∏ÉÂ±Ä‰∏≠Ôºå‰∏ÄËà¨‰ºöÂ≠òÂú®‰∏Ä‰∏™ÂÜÖÂ≠òÁ©∫Ê¥ûÔºåÂú®ÈÖçÁΩÆ <code>e820</code> Ë°®Êó∂ÔºåÈúÄË¶ÅÊ†πÊçÆËôöÊãüÊú∫ÁöÑÂÜÖÂ≠òÂ∏ÉÂ±ÄË∑≥ËøáÂÜÖÂ≠òÁ©∫Ê¥ûËøõË°åÈÖçÁΩÆ„ÄÇ</p>
<hr>
<p>ÂÆåÊàêÂØπÈõ∂È°µÁöÑÈÖçÁΩÆÂêéÔºåÂ∞ÜË∞ÉÁî®GuestMemoryÁöÑ <code>write_object</code> Êé•Âè£Â∞Ü <code>BootParams</code> Êï∞ÊçÆÁªìÊûÑÊï¥‰∏™ÂÜôÂÖ•ÂÜÖÂ≠ò‰∏≠„ÄÇ‰∏∫‰∫ÜËÉΩÊàêÂäüÂú∞Â∞ÜËøô‰∫õÊï∞ÊçÆÁªìÊûÑÂÜôÂÖ•ÂÜÖÂ≠òÔºåÈúÄË¶ÅÂØπ‰∏äËø∞ÊâÄÊúâÁöÑÊï∞ÊçÆÁªìÊûÑÈÉΩÂÆûÁé∞ ByteCode TraitÔºåÂÜôÂÖ•Âú∞ÂùÄ‰∏∫È¢ÑËÆæÁöÑ<code>0x7000</code>„ÄÇ</p>
<h3 id="ÈÖçÁΩÆmptable">ÈÖçÁΩÆMPtable
</h3><p>LinuxÂÜÖÊ†∏ÈÄöËøáÈõ∂È°µËé∑ÂèñÂà∞ÂêÑÁßçÁ°¨‰ª∂„ÄÅÂÜÖÂ≠ò‰ø°ÊÅØÂíåÈÖçÁΩÆÈ°π‰πãÂêéÔºåËøòÈúÄË¶ÅÈÄöËøáÊüêÁßçÊñπÂºèÊù•**Ëé∑ÂèñÂ§ÑÁêÜÂô®Âíå‰∏≠Êñ≠ÊéßÂà∂Âô®ÁöÑ‰ø°ÊÅØ„ÄÇ**ÁõÆÂâçÂÖ±Êúâ‰∏§ÁßçÁî®Êù•Ëé∑ÂèñÂ§ÑÁêÜÂô®‰ø°ÊÅØÁöÑÊñπÂºèÔºö</p>
<ul>
<li>ÊòØIntel x86Âπ≥Âè∞ÁöÑMP SpecÔºàMultiProcessor SpecificationÔºåÂ§öÂ§ÑÁêÜÂô®ÊäÄÊúØËßÑËåÉÔºâÁ∫¶ÂÆöÁöÑÊñπÂºèÔºõ</li>
<li>Âè¶‰∏ÄÁßçÊòØACPIÁöÑMADTË°®ÔºàMultiple APIC Description TableÔºåÂ§ö‰∏™È´òÁ∫ßÂèØÁºñÁ®ã‰∏≠Êñ≠ÊéßÂà∂Âô®ÊèèËø∞Ë°®ÔºâÁ∫¶ÂÆöÁöÑÊñπÂºè„ÄÇ</li>
</ul>
<blockquote>
<p>ËøôÈáåÈÄâÊã©ÊØîËæÉÂÆπÊòìÂÆûÁé∞ÁöÑMP SpecÁöÑÊñπÂºè„ÄÇ</p>
</blockquote>
<p>MP SpecÁöÑÊ†∏ÂøÉÊï∞ÊçÆÁªìÊûÑ‰∏ªË¶ÅÂåÖÂê´‰∏§‰∏™ÈÉ®ÂàÜÔºöMPFÔºàMP Floating PointerÔºåÂ§öÂ§ÑÁêÜÂô®ÊµÆÁÇπÊï∞ÊåáÈíàÔºâÂíåMP TableÔºàÂ§öÂ§ÑÁêÜÂô®ÁªìÊûÑË°®ÔºâÔºåÂ¶ÇÂõæ6-12ÊâÄÁ§∫„ÄÇ</p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051726387.png" alt="image-20231202182522778" style="zoom: 33%;" />
<hr>
<p>‰æãÂ¶ÇÂèØ‰ª•ÊåâÂ¶Ç‰∏ã‰ª£Á†ÅÁõ¥Êé•ÂàùÂßãÂåñMPFÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/boot_loader/mptable.rs</code></p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051759050.png" alt="image-20231202182553900" style="zoom:33%;" />
<p>ÂÖ∂‰∏≠ÂÖ≥ÈîÆÂ≠ó MP ÊòØÂõ∫ÂÆöÁöÑÔºåÁî®Êù•ÊêúÁ¥¢ MP ÁªìÊûÑË°®ÔºålengthË°®Á§∫Êï¥‰∏™ÁªìÊûÑÁöÑÈïøÂ∫¶Ôºå‰ª•16Â≠óËäÇ‰∏∫Âçï‰Ωç„ÄÇspecËßÑÂÆöÁâàÊú¨Âè∑Âõ∫ÂÆö‰∏∫1.4ÁâàÊú¨ÔºåÈô§‰∫Ü‰º†ÂÖ•ÁöÑpointerÂ§ñÔºåÂÖ∂‰ΩôÈ°πÂùáÁΩÆ‰∏∫0„ÄÇÊàêÂëòpointerÂ∞ÜÁõ¥Êé•ÊåáÂêëÂ≠òÊîæMP TableÁöÑÂÜÖÂ≠òÂú∞ÂùÄ„ÄÇ</p>
<hr>
<p>MP TableÁªìÊûÑÁî®Êù•ÁúüÂÆûÂèçÊò†Â§ÑÁêÜÂô®ÁöÑÁ°¨‰ª∂‰ø°ÊÅØÔºåÂÆÉÁî±‰∏Ä‰∏™HeaderÔºàË°®Â§¥ÔºâÂíåËã•Âπ≤‰∏™EntryÁªÑÊàêÔºåË°®Â§¥‰ø°ÊÅØÂÜÖÂÆπÂ¶Ç‰∏ãË°®ÊâÄÁ§∫Ôºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202182622342.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202182622342"
	
	
></p>
<p>Ëøô‰∏ÄÊ≠•‰ªÖËæìÂÖ•Âü∫Êú¨ÁöÑÁ°¨‰ª∂ÂéÇÂïÜÁõ∏ÂÖ≥‰ø°ÊÅØÔºªÂ¶ÇOEM_IDÔºàOriginal Equipment ManufacturerÔºåÂéüÂßãËÆæÂ§áÂà∂ÈÄ†ÂïÜIDÔºâ„ÄÅPRODUCT_IDÔºà‰∫ßÂìÅIDÔºâÔºΩÔºåÊîØÊåÅËá™ÂÆö‰πâÔºå‰ª•ÂèäÂõ∫ÂÆöÁöÑSPECÁâàÊú¨Âè∑„ÄÅSIGNATUREÂ≠óÁ¨¶„ÄÇ<code>BASE_TABLE_LENGTH</code> ‰ª•Âèä <code>CHECKSUM</code> ‰∏§È°πÂ∞ÜÂú®MP TableÊï¥‰∏™Â§ÑÁêÜÂÆåÊØïÂêéÂ°´ÂÖ•ÔºåÂÖ∂‰ΩôÈ°πÂú® BootLoader ‰∏≠‰∏çÁî®ÂÆûÁé∞ÔºåÁΩÆ‰∏∫0Âç≥ÂèØ„ÄÇ</p>
<p>Á¥ßË∑üÁùÄMP TableË°®Â§¥ÔºåÊòØ‰∏Ä‰∏≤EntryÁªìÊûÑÔºåÊØè‰∏™EntryÈÉΩ‰ª£Ë°®‰∏Ä‰∏™ÂçïÁã¨ÁöÑ‰∏éÂ§ÑÁêÜÂô®Áõ∏ÂÖ≥ÁöÑÁ°¨‰ª∂‰ø°ÊÅØÔºåÊØèÁßçÁ°¨‰ª∂Á±ªÂûãÈÉΩÊúâÂÖ∂ÁâπÂÆöÁöÑEntryÁªìÊûÑÔºåÂÆÉ‰ª¨ÂØπÂ∫îÁöÑEntry TypeÂè∑ÂíåÈïøÂ∫¶ËßÅ‰∏ãË°®„ÄÇ</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202182654153.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202182654153"
	
	
></p>
<p>ÊØè‰∏™ÁßçÁ±ªÁöÑ Entry ÈÉΩÊúâÂêÑËá™ÁöÑÊï∞ÊçÆÁªìÊûÑÔºåËøôÈáåÁªôÂá∫‰∏Ä‰ªΩÂÆÉ‰ª¨ÁöÑRustÂÆûÁé∞Ôºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/boot_loader/mptable.rs</code></p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051759509.png" alt="image-20231202182804842" style="zoom: 50%;" />
<hr>
<p>‰∏∫‰∫ÜÊàêÂäüÂêØÂä®LinuxÂÜÖÊ†∏ÔºåËøô 5 ÁßçEntryÈÉΩÊòØÂøÖÈúÄÁöÑÔºåÂØπ‰∫éÊØè‰∏™CPUÔºåÈÉΩÂøÖÈ°ªÂÜôÂÖ•‰∏ÄÊ¨° ProcessEntryÔºå‰ª£Á†ÅÂ¶Ç‰∏ã„ÄÇ</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/boot_loader/mptable.rs</code></p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051800363.png" alt="image-20231202182853625" style="zoom:33%;" />
<p>ÂÖ∂‰ΩôEntryÁöÑÈÖçÁΩÆÊñπÊ≥ïÂ§ßÂêåÂ∞èÂºÇÔºåÊ≠§Â§Ñ‰∏çÂÜçÈ¢ùÂ§ñËØ¥ÊòéÔºåËØªËÄÖËá™Ë°åÊü•ÈòÖÁõ∏ÂÖ≥SPECÊâãÂÜåÂíåÁ§∫‰æã‰ª£Á†ÅÊù•‰∫ÜËß£ÂêÑÈ°πÊï∞ÂÄºÁöÑÈÖçÁΩÆ„ÄÇ</p>
<p>Â∞ÜÂÖ®ÈÉ®ÁöÑMPÊµÆÁÇπÊåáÈíà (MP Floating Pointer) ÂíåMPË°® (MP Table) ÈÉΩÂÜôÂÖ•ÂÜÖÂ≠òÂú∞ÂùÄ <code>0x0009fc00</code> ÂêéÔºå<code>mptable</code> ÈÉ®ÂàÜÁöÑÈÖçÁΩÆÂÖ®ÈÉ®ÂÆåÊàê„ÄÇ<strong>Ê≠§Êó∂ÂÜÖÊ†∏Â∑≤ÁªèËÉΩËé∑ÂèñÂêØÂä®ÊâÄÂøÖÈúÄÁöÑÁ°¨‰ª∂‰ø°ÊÅØ„ÄÅÈÖçÁΩÆ‰ø°ÊÅØÂíåÂ§ÑÁêÜÂô®Áõ∏ÂÖ≥‰ø°ÊÅØ„ÄÇ</strong></p>
<h3 id="ÈÖçÁΩÆinitrdkernelÂíåÂÜÖÊ†∏ÂëΩ‰ª§Ë°å">ÈÖçÁΩÆInitrd„ÄÅKernelÂíåÂÜÖÊ†∏ÂëΩ‰ª§Ë°å
</h3><p>Áõ∏ÂÖ≥ÈÖçÁΩÆÂÖ®ÈÉ®ÂÆåÊàêÂêéÔºåËøòÈúÄË¶ÅÂ∞Ü‰∏Ä‰∫õÂêØÂä®ÊâÄÂøÖÈúÄÁöÑËµÑÊ∫êËØªÂÖ•ÂÜÖÂ≠òÔºåËøôÈáå<strong>‰∏ªË¶ÅÊúâ‰∏âÁßçËµÑÊ∫êÈúÄË¶ÅË¢´ËØªÂÖ•ÂÜÖÂ≠òÔºö</strong></p>
<ul>
<li><code>Initrd</code>ÔºöÁî®Êù•‰Ωú‰∏∫ÂÜÖÂ≠òÊñá‰ª∂Á≥ªÁªüÔºåËØªÂÖ•ÂÜÖÂ≠ò‰ΩçÁΩÆÂú®ÂÜÖÂ≠òÊú´Á´ØÔºõ</li>
<li><code>Kernel</code>ÔºöPEÊ†ºÂºèÁöÑLinuxÂÜÖÊ†∏ÈïúÂÉè <code>vmlinux.bin</code> ÂèØ‰ª•ÂÖ®ÈÉ®ËØªÂÖ•ÂÜÖÂ≠ò‰∏≠ÔºåËØªÂÖ•ÂÜÖÂ≠ò‰ΩçÁΩÆ‰∏∫ <code>0x00100000</code>Ôºõ</li>
<li>ÂÜÖÊ†∏ÂëΩ‰ª§Ë°åÔºöKernelÂêØÂä®È¢ùÂ§ñÁöÑÈÖçÁΩÆÈ°π‰Ωú‰∏∫ËæìÂÖ•Ôºå‰ª•Â≠óÁ¨¶‰∏≤ÁöÑÂΩ¢Âºè‰º†ÂÖ•ÔºåËØªÂÖ•ÂÜÖÂ≠ò‰ΩçÁΩÆ‰∏∫ <code>0x00020000</code>„ÄÇ</li>
</ul>
<p>ÂÜÖÊ†∏ÂëΩ‰ª§Ë°å‰Ωú‰∏∫ÂÜÖÊ†∏ÂêØÂä®ÊúÄÂêéÁöÑÂÖ•ÂèÇÔºåÁî®Êù•ÊéßÂà∂‰∏Ä‰∫õËæÉ‰∏∫‰∏äÂ±ÇÁöÑË°å‰∏∫ÔºåÂ¶ÇÂÜÖÊ†∏ÁöÑÂêØÂä®Áõò„ÄÅËæìÂá∫ËÆæÂ§áÁ≠âÔºåËøôÈáåÁªôÂá∫‰∏Ä‰∏™ËæÉ‰∏∫ÁÆÄÊòìÁöÑÊîØÊåÅ <code>Initrd</code> ÂêØÂä®ÁöÑÈÖçÁΩÆÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">console</span><span class="o">=</span>ttyS0  <span class="nv">panic</span><span class="o">=</span><span class="m">1</span>  <span class="nv">reboot</span><span class="o">=</span>k  <span class="nv">root</span><span class="o">=</span>/dev/ram  <span class="nv">rdinit</span><span class="o">=</span>/bin/sh
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÖ∂‰∏≠Ôºö</p>
<ul>
<li><code>console</code> Áî®Êù•Ê†áËØÜËØ•ÂÜÖÊ†∏ÁöÑËæìÂá∫ËÆæÂ§áÔºõ</li>
<li><code>panic</code> Âíå <code>reboot</code> ÂÆö‰πâ‰∫ÜÂÜÖÊ†∏Â§ÑÁêÜpanicÂíårebootË°å‰∏∫ÁöÑÊ®°ÂºèÔºõ</li>
<li><code>root</code> ÂÆö‰πâ‰∫ÜÂÜÖÊ†∏ÁöÑÂêØÂä®ÁõòÔºåËøôÈáå‰ΩøÁî®ÂÜÖÂ≠òÊñá‰ª∂Á≥ªÁªüÊù•ÂêØÂä®Ôºõ</li>
<li><code>rdinit</code> ÂÆö‰πâ‰∫ÜÂÜÖÊ†∏ÂêØÂä®ÂÆåÊàêÂêéÊâßË°åÁöÑÁ¨¨‰∏Ä‰∏™ËøõÁ®ãÁöÑË∑ØÂæÑ„ÄÇ</li>
</ul>
<blockquote>
<p>Ê≥®Ôºö</p>
<p>Âú®x86Êû∂ÊûÑ‰∏ãÔºå0x3f8Âíåttys0ÈÉΩ‰∏é‰∏≤Âè£ÈÄö‰ø°Áõ∏ÂÖ≥„ÄÇ</p>
<ol>
<li>
<p><code>0x3f8</code>Ôºö</p>
<ul>
<li>0x3f8 ÊòØ‰∏Ä‰∏™ÂçÅÂÖ≠ËøõÂà∂Êï∞ÔºåË°®Á§∫ËÆ°ÁÆóÊú∫‰∏≠‰∏≤Âè£UARTÔºàÈÄöÁî®ÂºÇÊ≠•Êî∂ÂèëÂô®ÔºâÁöÑÂü∫Âú∞ÂùÄÔºõ</li>
<li>ÂÆÉÊòØ‰∏≤Âè£ÈÄö‰ø°ÁöÑI/OÁ´ØÂè£Âú∞ÂùÄÔºåÁî®‰∫é‰∏é‰∏≤Âè£ËøõË°åÊï∞ÊçÆ‰∫§Êç¢Ôºõ</li>
<li>0x3f8ÂØπÂ∫îÁöÑÊòØÁ¨¨‰∏Ä‰∏™‰∏≤Âè£ÔºàCOM1Ôºâ„ÄÇ</li>
</ul>
</li>
<li>
<p><code>ttys0</code>Ôºö</p>
<ul>
<li>ttys0 ÊòØLinuxÊìç‰ΩúÁ≥ªÁªü‰∏≠ÂØπÂ∫î‰∫éÁ¨¨‰∏Ä‰∏™‰∏≤Âè£ÔºàCOM1ÔºâÁöÑËÆæÂ§áÊñá‰ª∂ÂêçÔºõ</li>
<li>Âú®LinuxÁ≥ªÁªü‰∏≠Ôºå‰∏≤Âè£ËÆæÂ§áÈÄöÂ∏∏‰ª• <code>ttys*</code>  ÁöÑÂΩ¢ÂºèÂëΩÂêçÔºåÂÖ∂‰∏≠ <code>*</code> ‰ª£Ë°®‰∏Ä‰∏™Êï∞Â≠óÔºàÂ¶Çttys0„ÄÅttys1Á≠âÔºâÔºõ</li>
<li>ttys0 ÂØπÂ∫îÁöÑÊòØÁ¨¨‰∏Ä‰∏™‰∏≤Âè£ÔºàCOM1ÔºâËÆæÂ§áÊñá‰ª∂„ÄÇ</li>
</ul>
</li>
</ol>
<p>‰∏§ËÄÖÁöÑÂÖ≥Á≥ªÔºö</p>
<ul>
<li>0x3f8ÊòØÁ°¨‰ª∂Â±ÇÈù¢‰∏äÁöÑ‰∏≤Âè£I/OÁ´ØÂè£Âú∞ÂùÄÔºåÁî®‰∫éËÆøÈóÆ‰∏≤Âè£Á°¨‰ª∂ËøõË°åÊï∞ÊçÆÊî∂ÂèëÔºõ</li>
<li>ttys0ÊòØLinuxÊìç‰ΩúÁ≥ªÁªü‰∏≠ÁöÑËÆæÂ§áÊñá‰ª∂ÂêçÔºåÁî®‰∫éÈÄöËøáÊñá‰ª∂Á≥ªÁªüÊé•Âè£ËÆøÈóÆ‰∏≤Âè£ËÆæÂ§áÔºõ</li>
<li>Âú®LinuxÁ≥ªÁªü‰∏≠ÔºåÂèØ‰ª•ÈÄöËøáÊâìÂºÄÂíåÊìç‰Ωúttys0ËÆæÂ§áÊñá‰ª∂Êù•ËøõË°åÂØπ‰∏≤Âè£ÁöÑËØªÂÜôÊìç‰ΩúÔºåÂÆûÁé∞‰∏≤Âè£ÈÄö‰ø°„ÄÇÂÖ∂‰∏≠Ôºåttys0ËÆæÂ§áÊñá‰ª∂‰∏é0x3f8ÂØπÂ∫îÁöÑ‰∏≤Âè£Á°¨‰ª∂Áõ∏ËøûÊé•„ÄÇ</li>
</ul>
<p>Áªº‰∏äÔºå0x3f8Âíåttys0ÂèØ‰ª•Áúã‰ΩúÊòØÁ°¨‰ª∂ÂíåËΩØ‰ª∂‰πãÈó¥ÁöÑÊé•Âè£ÔºåÁî®‰∫éÂú®x86Êû∂ÊûÑ‰∏ãÂÆûÁé∞‰∏é‰∏≤Âè£Áõ∏ÂÖ≥ÁöÑÊï∞ÊçÆÈÄö‰ø°„ÄÇ</p>
<hr>
<p>Âú®x86Êû∂ÊûÑ‰∏ãÔºåÂØπ0x3f8ÂèëÈÄÅÂ≠óÁ¨¶‰ºöÂ∞ÜÂ≠óÁ¨¶ÂèëÈÄÅÂà∞‰∏≤Âè£ËÆæÂ§áÔºàÂ¶ÇCOM1ÔºâËÄå‰∏çÊòØÁõ¥Êé•ÊòæÁ§∫Âú®ÁªàÁ´ØËÆæÂ§á‰∏ä„ÄÇ</p>
<p>ÁªàÁ´ØËÆæÂ§áÈÄöÂ∏∏ÊòØÊåáËÆ°ÁÆóÊú∫‰∏äÁöÑÊòæÁ§∫Âô®ÂíåÈîÆÁõò„ÄÇ‰∏≤Âè£ËÆæÂ§áÊòØ‰∏ÄÁßçÈÄöËøá‰∏≤Ë°åÈÄö‰ø°Êé•Âè£ËøõË°åÊï∞ÊçÆ‰º†ËæìÁöÑËÆæÂ§áÔºå‰∏ÄËà¨Áî®‰∫é‰∏éÂ§ñÈÉ®ËÆæÂ§áËøõË°åÊï∞ÊçÆ‰∫§Êç¢ÔºåÊØîÂ¶Ç‰∏≤Âè£ËøûÊé•ÁöÑÁªàÁ´ØËÆæÂ§áÔºàÂ¶ÇÁªàÁ´ØÊú∫Êàñ‰∏≤Âè£ÊéßÂà∂Âè∞Ôºâ„ÄÇ</p>
<p>ÂΩìÂêë0x3f8ÂÜôÂÖ•Â≠óÁ¨¶Êó∂ÔºåÂ≠óÁ¨¶‰ºöË¢´ÂèëÈÄÅÂà∞‰∏≤Âè£ËÆæÂ§áÁöÑÂèëÈÄÅÁºìÂÜ≤Âå∫‰∏≠„ÄÇÁÑ∂ÂêéÔºåÈÄöËøá‰∏≤Âè£ÁöÑÁâ©ÁêÜËøûÊé•ÔºàÂ¶Ç‰∏≤Âè£Á∫øÔºâÂ∞ÜÊï∞ÊçÆÂèëÈÄÅÂà∞ÁªàÁ´ØËÆæÂ§áÔºàÂ¶ÇÁªàÁ´ØÊú∫Êàñ‰∏≤Âè£ÊéßÂà∂Âè∞Ôºâ„ÄÇÂú®ÁªàÁ´ØËÆæÂ§á‰∏äÔºåÊé•Êî∂Âô®Â∞Ü‰∏≤Ë°åÊï∞ÊçÆÊµÅËΩ¨Êç¢‰∏∫Âπ∂Ë°åÊï∞ÊçÆÔºåÂπ∂Ê†πÊçÆÊï∞ÊçÆÁöÑASCIIÁ†ÅÂÄºÂ∞ÜÂ≠óÁ¨¶ÊòæÁ§∫Âú®ÁªàÁ´Ø‰∏ä„ÄÇ</p>
<p>ÊâÄ‰ª•ÔºåÈÄöËøáÂêë0x3f8ÂèëÈÄÅÂ≠óÁ¨¶ÔºåÂèØ‰ª•Â∞ÜÂ≠óÁ¨¶ÂèëÈÄÅÂà∞‰∏≤Âè£ËÆæÂ§áÔºåÁÑ∂ÂêéÈÄöËøá‰∏≤Âè£ËøûÊé•ÁöÑÁªàÁ´ØËÆæÂ§á‰∏äÊòæÁ§∫Âá∫Êù•„ÄÇËØ∑Ê≥®ÊÑèÔºåÁ°Æ‰øùÁªàÁ´ØËÆæÂ§áÁöÑËÆæÁΩÆÊ≠£Á°ÆÔºåÂπ∂‰∏î‰∏≤Âè£ÈÄö‰ø°ÁöÑÂèÇÊï∞ÔºàÂ¶ÇÊ≥¢ÁâπÁéá„ÄÅÊï∞ÊçÆ‰Ωç„ÄÅÂ•áÂÅ∂Ê†°È™å‰ΩçÁ≠âÔºâ‰∏éÁªàÁ´ØËÆæÂ§áÁöÑËÆæÁΩÆÂåπÈÖçÔºå‰ª•Á°Æ‰øùÊ≠£Á°ÆÁöÑÊï∞ÊçÆ‰º†ËæìÂíåÊòæÁ§∫„ÄÇ</p>
</blockquote>
<h3 id="ËøõÂÖ•‰øùÊä§Ê®°Âºè">ËøõÂÖ•‰øùÊä§Ê®°Âºè
</h3><p>Âú®ÂÆåÊàêÊâÄÊúâÁöÑÈÖçÁΩÆÂêéÔºåÂü∫Êú¨Â∑≤ÁªèÂÅöÂÆå‰∫Ü‰∏ÄÈÅçÂÜÖÊ†∏ÂêØÂä®ÊµÅÁ®ã‰∏≠ÂÆûÊ®°ÂºèÊâÄÂÅöÁöÑÂ∑•‰ΩúÔºåÊé•‰∏ãÊù•Â∞±ÊòØËÆ©CPU‰ªéÂÆûÊ®°ÂºèËøõÂÖ•‰øùÊä§Ê®°ÂºèÁöÑÊ≠•È™§‰∫Ü„ÄÇ</p>
<p>Âú®ÂÆûÊ®°ÂºèÂíå‰øùÊä§Ê®°Âºè‰∏ãÔºåCPUÂØªÂùÄÊñπÂºèÊòØ‰∏ç‰∏ÄÊ†∑ÁöÑÔºö</p>
<ul>
<li>
<p>**Âú®ÂÆûÊ®°Âºè‰∏ãÔºå**ÂÜÖÂ≠òË¢´ÂàíÂàÜ‰∏∫‰∏çÂêåÁöÑÊÆµÔºåÊØè‰∏™ÊÆµÁöÑÂ§ßÂ∞è‰∏∫64KBÔºåËøôÊ†∑ÁöÑÊÆµÂú∞ÂùÄÂèØ‰ª•Áî®16‰ΩçÊù•Ê†áËØÜÔºåÂÜÖÂ≠òÊÆµÁöÑÂ§ÑÁêÜÈÄöËøáÂíåÊÆµÂØÑÂ≠òÂô®ÂÖ≥ËÅîÁöÑÂÜÖÈÉ®Êú∫Âà∂Êù•ËøõË°åÔºåÂç≥Â∞ÜÊÆµÂØÑÂ≠òÂô®Êú¨Ë∫´ÁöÑÂÄº‰Ωú‰∏∫Áâ©ÁêÜÂú∞ÂùÄÁöÑ‰∏ÄÈÉ®ÂàÜÔºåÊ≠§Êó∂Ôºö<strong>Áâ©ÁêÜÂú∞ÂùÄ = Â∑¶Áßª4‰ΩçÁöÑÊÆµÂú∞ÂùÄ + ÂÅèÁßªÂú∞ÂùÄ</strong> Ôºõ</p>
</li>
<li>
<p>**ËÄåÂú®‰øùÊä§Ê®°Âºè‰∏ãÔºå**‰∏∫‰∫ÜËÉΩÊéßÂà∂Êõ¥Â§öÁöÑÂÜÖÂ≠òÔºåÂÜÖÂ≠òÊÆµË¢´‰∏ÄÁ≥ªÂàóÁß∞‰∏∫ÊèèËø∞Á¨¶Ë°®ÁöÑÁªìÊûÑÊâÄÂÆö‰πâÔºåÊÆµÂØÑÂ≠òÂô®Áî±Áõ¥Êé•Â≠òÂÇ®Âú∞ÂùÄÂèò‰∏∫‰∫ÜÂ≠òÂÇ®ÊåáÂêëËøô‰∫õË°®ÁöÑÊåáÈíà„ÄÇËøô‰∫õÊèèËø∞Á¨¶Ë°®‰∏≠ÔºåÊúÄÈáçË¶ÅÂ∞±ÊòØ <code>GDT</code>ÔºàGlobal Descriptor TableÔºåÂÖ®Â±ÄÊèèËø∞Á¨¶Ë°®Ôºâ„ÄÇ<code>GDT</code> ÊòØ‰∏Ä‰∏™ÊÆµÊèèËø∞Á¨¶Êï∞ÁªÑÔºåÂåÖÂê´‰∫ÜÊâÄÊúâÂ∫îÁî®Á®ãÂ∫èÈÉΩÂèØ‰ª•‰ΩøÁî®ÁöÑÂü∫Êú¨ÊèèËø∞Á¨¶„ÄÇ<code>GDT</code> ÂøÖÈ°ªÊòØÂ≠òÂú®‰∏îÂîØ‰∏ÄÁöÑÔºåÂÆÉÁöÑÂàùÂßãÂåñ‰∏ÄËà¨ÊòØÂú®ÂÆûÊ®°Âºè‰∏≠Áî±ÂÜÖÊ†∏Êù•ÂÆåÊàêÁöÑ„ÄÇÊÉ≥Ë¶ÅË∑≥ËøáÂÆûÊ®°ÂºèÂà∞‰øùÊä§Ê®°ÂºèÔºåÂøÖÈ°ªÂÆåÊàêÂØπ<code>GDT</code> ÁöÑÈÖçÁΩÆ„ÄÇ</p>
</li>
</ul>
<hr>
<p><code>GDT</code> Ë°®ÁöÑÊØè‰∏ÄÈ°πÁî±Â±ûÊÄßÔºàflagsÔºå12‰ΩçÔºâ„ÄÅÂü∫Âú∞ÂùÄÔºàbaseÔºå32‰ΩçÔºâÂíåÊÆµÁïåÈôêÔºàlimitÔºå20‰ΩçÔºâÁªÑÊàêÔºåÂÖ±64‰ΩçÔºåÂèØ‰ª•ÈÄöËøá64‰ΩçÊï∞ÊääÂÆÉË°®Á§∫Âá∫Êù•ÔºåÁõ∏ÂÖ≥‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/boot_loader/gdt.rs</code></p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051800417.png" alt="image-20231202183148177" style="zoom:33%;" />
<p>Âú®Êï¥‰∏™ËôöÊãüÊú∫ÂÜÖÂ≠ò‰∏≠ÔºåGDT Ë°®Âè™Êúâ‰∏ÄÂº†ÔºåÂπ∂‰∏îÂèØ‰ª•Â≠òÊîæÂú®ÂÜÖÂ≠òÁöÑ‰ªª‰Ωï‰ΩçÁΩÆ„ÄÇ‰ΩÜÊòØÂØπCPUÊù•ËØ¥ÔºåÂÆÉÂøÖÈ°ªÁü•ÈÅì GDT Ë°®ÁöÑ‰ΩçÁΩÆÔºåÂõ†Ê≠§CPU‰∏≠Â≠òÂú®‰∏Ä‰∏™ÁâπÂÆöÂØÑÂ≠òÂô® <code>GDTR</code> Áî®Êù•Â≠òÊîæGDTÁöÑÂÖ•Âè£‰ΩçÁΩÆ„ÄÇ‰πãÂêéÂú®CPUËøõÂÖ•‰øùÊä§Ê®°ÂºèÂêéÔºåÂÆÉÂ∞±ËÉΩÊ†πÊçÆËØ•ÂØÑÂ≠òÂô®‰∏≠ÁöÑÂÄºËÆøÈóÆ <code>GDT</code>„ÄÇÊ†πÊçÆÂØπÂÜÖÂ≠òÂ∏ÉÂ±ÄÁöÑËßÑÂàíÔºåËøôÈáåÂ∞ÜGDT Ë°®Â≠òÊîæÂú® <code>0x520</code> Â§ÑÔºåÂ∞ÜÁî®‰∫é‰∏≠Êñ≠ÁöÑ IDT Ë°®Â≠òÊîæÂú® <code>0x500</code> Â§Ñ„ÄÇ‰ΩÜÊ≠§Êó∂ IDT Ë°®ÁöÑÂÜÖÂÆπÂπ∂‰∏çÈáçË¶ÅÔºåÂèØ‰ª•Â∞Ü 64 ‰ΩçÂÖ®ÈÉ®ÁΩÆ 0„ÄÇ</p>
<hr>
<p>ËÆæÁΩÆÂÆåGDTË°®ÂêéÔºåÈúÄË¶ÅÊ†πÊçÆGDTË°®ÁöÑÂÖ•Âè£Âú∞ÂùÄÂíåÂÜÖÂÆπÊù•ËÆæÁΩÆCPUÁöÑÂØÑÂ≠òÂô®ÔºåËøôÈáå‰∏ªË¶ÅËÆæÁΩÆ <code>GDTR</code> ÂØÑÂ≠òÂô®ÁöÑ‰ø°ÊÅØÔºåÁõ∏ÂÖ≥‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/boot_loader/gdt.rs</code></p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051801107.png" alt="image-20231202183236883" style="zoom:33%;" />
<p>Ê†πÊçÆ GDT Ë°®ÁöÑÂÜÖÂÆπÁîüÊàê <code>GDTR</code> ÂØÑÂ≠òÂô®‰∏≠‰ª£Á†ÅÊÆµÂíåÊï∞ÊçÆÊÆµÁöÑÂÜÖÂÆπÔºåËøô‰∫õÂØÑÂ≠òÂô®ÊÆµ‰ø°ÊÅØÂåÖË£ÖÂ•ΩÂêéÂ∞Ü‰º†ÈÄíÂà∞CPUÊ®°Âùó‰∏≠ÔºåÂÆåÊàêÁõ∏ÂÖ≥ÂØÑÂ≠òÂô®ÁöÑËÆæÁΩÆ„ÄÇÈô§‰∫Ü<code>GDTR</code> ÂØÑÂ≠òÂô®Â§ñÔºåÈíàÂØπÂÜÖÂ≠òÂ∏ÉÂ±ÄÔºåËøòÊúâ‰∏Ä‰∫õÈ¢ùÂ§ñÁöÑ‰ø°ÊÅØÈúÄË¶Å‰º†ÈÄíÂà∞CPUÊ®°Âùó‰∏≠ÔºåÈúÄË¶ÅÂ∞ÜËøô‰∫õ‰ø°ÊÅØÂ∞ÅË£ÖËµ∑Êù•Ôºå‰Ωú‰∏∫ <code>boot_loader</code> Êï¥‰∏™Ê®°ÂùóÁöÑËæìÂá∫Ôºå‰æõÂà´ÁöÑÊ®°ÂùóÔºàÂ¶ÇCPUÊ®°ÂùóÔºâ‰ΩøÁî®„ÄÇÁõ∏ÂÖ≥‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051801145.png" alt="image-20231202183315814" style="zoom:33%;" />
<p><code>StratoVirt-mini_stratovirt_edu/src/boot_loader/loader.rs</code></p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051802333.png" alt="image-20231202183405294" style="zoom:33%;" />
<p>BootLoader ÁªìÊûÑ‰ΩìÂ∞ÜËÆ∞ÂΩï <code>boot_loader</code> ÂÆåÊàêÁöÑÈÉ®ÂàÜÂÜÖÂ≠òÂ∏ÉÂ±Ä‰ø°ÊÅØÂíåÈúÄË¶ÅÁöÑÂØÑÂ≠òÂô®ËÆæÁΩÆÔºåÂπ∂‰º†ÈÄíÁªô CPU Ê®°ÂùóÊù•ÂÆåÊàêÁõ∏ÂÖ≥ÂØÑÂ≠òÂô®ÁöÑËÆæÁΩÆ„ÄÇ</p>
<hr>
<p>ÂíåÊôÆÈÄöÊ±áÁºñÁ®ãÂ∫è‰∏ÄÊ†∑ÔºåËøôÈáå‰πüÈúÄË¶ÅËÆæÁΩÆÂú∞ÂùÄÂØÑÂ≠òÂô®Êù•ÂÆö‰πâÁ®ãÂ∫èÁöÑÂÖ•Âè£Âú∞ÂùÄÔºåÂêåÊó∂Â∞ÜÈõ∂È°µÁöÑÂ≠òÊîæÂú∞ÂùÄÂëäËØâ <code>RSI</code> ÂØÑÂ≠òÂô®Ôºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/cpu/mod.rs</code></p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051802734.png" alt="image-20231202183701139" style="zoom:33%;" />
<p>‰∏∫‰∫ÜÊàêÂäüËøõÂÖ•‰øùÊä§Ê®°ÂºèÔºåÈúÄË¶ÅËÆæÁΩÆÊÆµÂØÑÂ≠òÂô®ÁöÑÁõ∏ÂÖ≥ÂÄºÔºåÂ∞ÜGDTË°®ÁöÑ‰ø°ÊÅØ‰º†ÈÄíÁªô <code>GDTR</code> ÂØÑÂ≠òÂô®Âíå‰ª£Á†ÅÊÆµÂØÑÂ≠òÂô®ÔºåËÆ©‰øùÊä§Ê®°Âºè‰∏ãÁöÑ vCPU ËÉΩÊ≠£Á°ÆÂØªÂùÄÔºåÁõ∏ÂÖ≥‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/cpu/mod.rs</code></p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051802699.png" alt="image-20231202183736533" style="zoom:33%;" />
<hr>
<p>Ê≠§Êó∂ CPU Â∑≤ÁªèÂèØ‰ª•Ê≠£Â∏∏ËøõÂÖ•‰øùÊä§Ê®°Âºè‰∫ÜÔºåÂπ∂ËÆæÁΩÆÂ•Ω‰∫Ü‰ΩéÂú∞ÂùÄÊÆµÁöÑÂÜÖÂ≠òÂ∏ÉÂ±ÄÊù•ÂºïÂØºÂÜÖÊ†∏Ê≠£Â∏∏ËøêË°å„ÄÇÂú®Ê≠£ÂºèÂºÄÂßãËøêË°åÂÜÖÊ†∏ÂâçÔºåËøòÈúÄË¶ÅÂÅö‰∏§‰ª∂‰∫ãÔºö</p>
<ul>
<li>
<p>**ÂàùÂßãÂåñÊõ¥Â§öÁöÑ vCPU ÂØÑÂ≠òÂô®‰ø°ÊÅØÔºö**Èô§‰∫ÜÈÄöÁî®ÂØÑÂ≠òÂô®ÂíåÊÆµÂØÑÂ≠òÂô®Â§ñÔºå‰∏∫‰∫ÜÊàêÂäüËøêË°åLinuxÂÜÖÊ†∏ÔºåËøòÈúÄË¶ÅÂàùÂßãÂåñÂÖ∂‰ªñCPUÂØÑÂ≠òÂô®ÔºåÂ¶Ç <code>fpu</code>„ÄÅ<code>mp_state</code>„ÄÅ<code>lapic</code>„ÄÅ<code>msr</code> ÂØÑÂ≠òÂô®‰ª•ÂèäÁî®Êù•ÂëàÁé∞ËôöÊãüÊú∫CPUÁâπÊÄßÁöÑ <code>cpuid</code>ÔºåËøôÈÉ®ÂàÜ‰ª£Á†Å‰∏∫ CPU Êú¨Ë∫´Á°¨‰ª∂‰ø°ÊÅØÁöÑÂàùÂßãÂåñË¢´Â∞ÅË£ÖÂú®<code>src/cpu/register.rs</code> ‰∏≠ÔºåÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®„ÄÇ</p>
</li>
<li>
<p>**ÈÄöËøá 0x3f8 Á´ØÂè£Ëé∑ÂèñÂÜÖÊ†∏ÁöÑËæìÂá∫Ôºö**Âú®ÂÜÖÊ†∏ÂêØÂä®ÂèÇÊï∞‰∏≠ËÆæÁΩÆ‰∫Ü <code>console=ttyS0</code>ÔºåÊ≠§Êó∂ÂÜÖÊ†∏Âú®ÂêØÂä®ÂêéÔºå‰ºöÈÄöËøá <code>ISA_SERIAL</code> Ê†áÂáÜ‰∏≤Âè£ËøõË°åËæìÂá∫ÔºåËØ•Ê†áÂáÜ‰∏≤Âè£‰ºöÂú®ËôöÊãüÊú∫ÈÄÄÂá∫Êó∂ÈÄöËøá 0x3f8 ‰∏≤Âè£ËæìÂá∫Â≠óÁ¨¶‰ø°ÊÅØÔºåÂèØ‰ª•ÈÄöËøá‰øÆÊîπ IO_OUT ÈÄÄÂá∫‰∫ã‰ª∂ÁöÑÂ§ÑÁêÜÂáΩÊï∞Êù•ÊçïËé∑Ëøô‰∫õ‰ø°ÊÅØÔºåÁõ∏ÂÖ≥‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
</li>
</ul>
<p><code>StratoVirt-mini_stratovirt_edu/src/cpu/mod.rs</code></p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051802431.png" alt="image-20231202183909778" style="zoom:33%;" />
<p>Â∞ÜPEÊ†ºÂºèÂÜÖÊ†∏ÈïúÂÉè <code>vmlinux.bin</code> Âíå <code>initrd</code> Êñá‰ª∂ÊîæÂú®‰ª£Á†Å‰∏≠ÊåáÂÆöÁöÑÂú∞ÂùÄÔºåËøêË°åÁ®ãÂ∫èÂêØÂä®ÂÜÖÊ†∏ÈïúÂÉèÔºåËæìÂá∫Â¶Ç‰∏ãÔºö</p>
<p><code>Terminal</code></p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051803124.png" alt="image-20231202183937355" style="zoom:33%;" />
<p>ÂèØ‰ª•ÂèëÁé∞ÂÜÖÊ†∏ÊàêÂäüÂêØÂä®ÔºåÈ°∫Âà©ËøõÂÖ• initrd ‰∏≠ <code>init</code> ÁöÑÊ≠•È™§Ôºå‰ΩÜÊòØÂç¥Êó†Ê≥ïËæìÂÖ•‰ªª‰ΩïÂëΩ‰ª§„ÄÇËøôÊòØÂõ†‰∏∫ÂØπ‰∫éÂÜÖÊ†∏Êù•ËØ¥ÔºåËôöÊãüÊú∫Âè™ÊòØÊçïËé∑‰∫Ü <code>0x3f8</code> Á´ØÂè£ÁöÑËæìÂá∫ÔºåÂç¥Ê≤°ÊúâÁúüÊ≠£ÂÆûÁé∞ <code>ISA_SERIAL</code> Ê†áÂáÜ‰∏≤Âè£Ëøô‰∏ÄËÆæÂ§áÔºåËôöÊãüÊú∫‰∏≠ÁöÑÁî®Êà∑ÊÄÅÁ®ãÂ∫èÊó†Ê≥ïËØÜÂà´Âà∞Ëøô‰∏™ËÆæÂ§áÔºå‰πüÊ≤°ÊúâÂäûÊ≥ïÁúüÊ≠£ËæìÂÖ•ÂëΩ‰ª§„ÄÇ</p>
<hr>
<p>‰ª•‰∏äÂ∞±ÊòØ‰∏Ä‰∏™ÁÆÄÂçïÁöÑËôöÊãüÊú∫ BootLoader ÁöÑÂÖ®ÈÉ®ÂÜÖÂÆπ„ÄÇÊú¨Â∞èËäÇ‰ªãÁªç‰∫ÜLinuxÊ†áÂáÜÂÜÖÊ†∏ÂºïÂØºÈò∂ÊÆµÁöÑÊµÅÁ®ã‰ª•Âèä BootLoader Ê®°ÂùóÁöÑËÆæËÆ°ÊÄùË∑ØÂíåÁÆÄÂçïÂÆûÁé∞ÔºåÊàêÂäüÁî®ÁÆÄÊòìÁöÑ Hypervisor ÂêØÂä®‰∫Ü‰∏Ä‰∏™Ê†áÂáÜLinuxÂÜÖÊ†∏ËôöÊãüÊú∫„ÄÇ‰∏ãÈù¢Â∞ÜÊõ¥Ëøõ‰∏ÄÊ≠•Ôºå**ÂÆåÊàêÊ†áÂáÜËæìÂÖ•ËæìÂá∫ËÆæÂ§áÁöÑÂÆûÁé∞Ôºå**ËÆ©ËôöÊãüÊú∫ÁúüÊ≠£ÂèØÁî®„ÄÇ</p>
<h2 id="46-‰∏≤Âè£ÂÆûÁé∞">4.6 ‰∏≤Âè£ÂÆûÁé∞
</h2><p>‰∏äÊñáÂ∑≤ÁªèÂÆûÁé∞‰∫ÜBootLoaderÂäüËÉΩÔºåÂÜÖÊ†∏‰∏éÊñá‰ª∂Á≥ªÁªüÂ∑≤ÁªèËÉΩÂ§üÊ≠£Â∏∏ÂêØÂä®Ôºå‰ΩÜÊòØÂèëÁé∞ÂêØÂä®‰ø°ÊÅØÊâìÂç∞ÈùûÂ∏∏ÊÖ¢„ÄÇÂéüÂõ†ÊòØÂΩìÂâç‰ªÖÂ∞Ü‰∏≤Âè£I/OÁ´ØÂè£ <code>0x3f8</code> ÁöÑÂÜÖÂÆπ‰ΩøÁî® <code>println</code> ÂáΩÊï∞ËæìÂá∫ÔºåËÄåÊ≤°ÊúâÁúüÊ≠£ÂÆûÁé∞‰∏≤Âè£ËÆæÂ§áÂäüËÉΩ„ÄÇËøô‰∏ÄÂ∞èËäÇÂ∞Ü‰ºöËØ¶ÁªÜ‰ªãÁªç‰∏≤Âè£ËÆæÂ§áÁöÑÂÆûÁé∞„ÄÇ</p>
<hr>
<p>È¶ñÂÖà‰ªãÁªç‰∏≤Âè£ËÆæÂ§á‰ΩøÁî®ÁöÑÊâÄÊúâÂØÑÂ≠òÂô®ÔºåÂ¶Ç‰∏ãË°®ÊâÄÁ§∫„ÄÇ</p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051803497.png" alt="image-20231202184108678" style="zoom:33%;" />
<p>‰∏≤Âè£ËÆæÂ§áÁöÑÂØÑÂ≠òÂô®‰∏ªË¶ÅÁî®‰∫éÂàùÂßãÂåñÂçèÂïÜÂíå‰∏≤Âè£ËÆæÂ§áÊî∂ÂèëÊï∞ÊçÆÂ§ÑÁêÜÔºå‰∏ãÈù¢‰ªãÁªç<strong>‰∏≤Âè£ËÆæÂ§áÁöÑÂàùÂßãÂåñËøáÁ®ãÔºö</strong></p>
<ol>
<li>È¶ñÂÖàÔºåÂàõÂª∫ËôöÊãüÊú∫ÂÜÖÈÉ®ÈÄöÁü•ÂêéÁ´ØÁöÑ‰∫ã‰ª∂ÔºåÁî®‰∫éÈÄöÁü•ËôöÊãüÊú∫Â∞ÜÂÜÖÈÉ®Êï∞ÊçÆËæìÂá∫Âà∞Ê†áÂáÜËæìÂá∫Êé•Âè£‰∏äÔºõ</li>
<li>ÂÖ∂Ê¨°Âêë KVM Ê≥®ÂÜå‰∏≤Âè£ËÆæÂ§á‰∏≠Êñ≠Âè∑Ôºå‰∏≠Êñ≠Áî®‰∫éÈÄöÁü•ËôöÊãüÊú∫ÂÜÖÈÉ®Â∑≤ÊúâÊé•Êî∂Êï∞ÊçÆÈúÄË¶ÅÂ§ÑÁêÜÔºõ</li>
<li>ÁÑ∂ÂêéÂàùÂßãÂåñ‰∏≤Âè£ÂØÑÂ≠òÂô®Ôºå‰æãÂ¶Ç <code>LCR</code> ÂØÑÂ≠òÂô®ËÆæÁΩÆÊï∞ÊçÆÈïøÂ∫¶‰∏∫8‰ΩçÔºå<code>LSR</code> ÂØÑÂ≠òÂô®ËÆæÁΩÆÂèëÈÄÅÊï∞ÊçÆÂØÑÂ≠òÂô®‰∏∫Á©∫‰∏îÁ∫øË∑ØÁ©∫Èó≤Ôºå<code>MSR</code> ÂØÑÂ≠òÂô®ËÆæÁΩÆÂèëÈÄÅÂ§ÑÁêÜÂ∞±Áª™„ÄÅÊ£ÄÊµãÁîµËØùÂìçËµ∑‰ª•ÂèäÊ£ÄÊµãÂ∑≤ËøûÈÄöÔºåÊ≥¢ÁâπÁéáËÆæÁΩÆ‰∏∫9600Ôºõ</li>
<li>ÊúÄÂêéÂàõÂª∫Á∫øÁ®ãÔºåÁõëÂê¨Ê†áÂáÜËæìÂÖ•Êé•Âè£ÔºàÁªàÁ´ØËæìÂÖ•ÔºâÊòØÂê¶ÊúâÊï∞ÊçÆÂ§ÑÁêÜÔºåÂ∞ÜÊï∞ÊçÆÂÜôÂÖ•ÁºìÂ≠ò‰∏≠ÔºåÈÄöËøáÂØÑÂ≠òÂô® <code>RBR</code> ËØªÊìç‰ΩúÔºåÈÄöÁü•Âà∞ËôöÊãüÊú∫ÂÜÖÈÉ®„ÄÇ</li>
</ol>
<p><code>StratoVirt-mini_stratovirt_edu/src/device/serial.rs</code></p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051805404.png" alt="image-20231202184151213" style="zoom:33%;" />
<hr>
<p>Êé•‰∏ãÊù•‰ªãÁªç**ÂØÑÂ≠òÂô®ÁöÑËØªÊìç‰ΩúÂÆûÁé∞„ÄÇ**ÂÅèÁßªÈáè0~7ÁöÑÂÄºÂàÜÂà´ÂØπÂ∫îÁùÄ <code>0x3f8~0x3ff</code> ÂØÑÂ≠òÂô®ÔºåÂêÑÂØÑÂ≠òÂô®‰ªãÁªçÂ¶Ç‰∏ãË°®ÊâÄÁ§∫Ôºö</p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202184214885.png" alt="image-20231202184214885" style="zoom:50%;" />
<p><code>StratoVirt-mini_stratovirt_edu/src/device/serial.rs</code></p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051805596.png" alt="image-20231202184324815" style="zoom: 50%;" />
<hr>
<p>ÊúÄÂêé‰ªãÁªçÂØÑÂ≠òÂô®ÁöÑÂÜôÊìç‰ΩúÂÆûÁé∞„ÄÇÂÅèÁßªÈáè0~7ÁöÑÂÄºÂàÜÂà´ÂØπÂ∫îÁùÄ <code>0x3f8~0x3ff</code> ÂØÑÂ≠òÂô®ÔºåÂØÑÂ≠òÂô®‰ªãÁªçÂ¶Ç‰∏ãË°®ÊâÄÁ§∫„ÄÇ</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051807047.png"
	
	
	
	loading="lazy"
	
		alt="image-20231205180701982"
	
	
></p>
<p><code>StratoVirt-mini_stratovirt_edu/src/device/serial.rs</code></p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051807994.png" alt="image-20231202184516059" style="zoom: 50%;" />
<hr>
<p>ËØ¶ÁªÜ‰ª£Á†ÅÂèØÂàáÊç¢Ëá≥StratoVirt‰∏ªÈ°µ <code>mini_stratovirt_edu</code> ÂàÜÊîØ‰∏≠ÁöÑ‰∏≤Âè£ÂÆûÁé∞„ÄÇ‰ΩøÁî®Ê≠§ commit ËäÇÁÇπËøõË°åÁºñËØëÔºåÊâßË°åÁºñËØëÂá∫Êù•ÁöÑstratovirt‰∫åËøõÂà∂ÔºåÁªìÊûúÂ¶Ç‰∏ãÔºö</p>
<p><code>Terminal</code></p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051808890.png" alt="image-20231205180757063" style="zoom:33%;" />
<p>Ê≠§Êó∂‰ªçÊúâ‰∏Ä‰∏™ÈóÆÈ¢òÔºåÂè™ÊúâÂú®ËæìÂÖ•Â≠óÁ¨¶ÁöÑÊó∂ÂÄôÔºå‰∏≤Âè£ÁöÑËæìÂá∫‰ø°ÊÅØÊâç‰ºöÊòæÁ§∫Âá∫Êù•ÔºåËØ•ÈóÆÈ¢òÂ∞ÜÂú®‰∏ã‰∏ÄÂ∞èËäÇ‰∏≠ËøõË°åËØ¶ÁªÜÂàÜÊûê„ÄÇ</p>
<h2 id="47-epollÂÆûÁé∞">4.7 EpollÂÆûÁé∞
</h2><p>‰∏ä‰∏ÄÂ∞èËäÇÂÆûÁé∞‰∫Ü‰∏≤Âè£ËÆæÂ§áÔºå‰ΩÜÊòØËøêË°åÁöÑÁªìÊûúÂç¥ËøòÊòØ‰∏çÂ¶Ç‰∫∫ÊÑèÔºåÂè™ÊúâÂú®‰∫∫Â∑•ËæìÂÖ•Â≠óÁ¨¶ÁöÑÊó∂ÂÄôÔºå‰∏≤Âè£ÁöÑËæìÂá∫‰ø°ÊÅØÊâç‰ºöÊòæÁ§∫Âá∫Êù•„ÄÇ</p>
<p>ÈÄöËøá‰ª£Á†ÅÈÄªËæëÂàÜÊûêÔºåÂàõÂª∫ Serial ÁªìÊûÑ‰ΩìÊó∂‰ΩøÁî®‰∫Ü‰∫íÊñ• (Mutex) ÈîÅÔºåÂΩìÂâç<strong>Êúâ‰∏§Á±ªÁ∫øÁ®ã‰ºöÂêåÊó∂ËÆøÈóÆ Serial Êï∞ÊçÆÁªìÊûÑÔºö</strong></p>
<ul>
<li>‰∏Ä‰∏™ÊòØËøõË°åËôöÊãüÊú∫ÂÜÖÈÉ®‰∏≤Âè£Êï∞ÊçÆÁöÑËæìÂÖ•ÂíåËæìÂá∫Â§ÑÁêÜÁöÑ vCPU Á∫øÁ®ãÔºõ</li>
<li>Âè¶‰∏Ä‰∏™ÊòØ‰∏≤Ë°åÊ†áÂáÜËæìÂÖ•ÔºàÁªàÁ´ØËæìÂÖ•ÔºâÂ§ÑÁêÜÁ∫øÁ®ãÔºõ</li>
</ul>
<p>Âú®‰∏≤Ë°åÊ†áÂáÜËæìÂÖ•Â§ÑÁêÜÁ∫øÁ®ã‰∏≠ÔºåÈ¶ñÂÖà‰ºöÊåÅÊúâ Serial Êï∞ÊçÆÁªìÊûÑÁöÑ‰∫íÊñ•ÈîÅÔºåÁÑ∂Âêé‰ΩøÁî® <code>std::io::stdin().lock().read_raw()</code> ÈòªÂ°ûÁ≠âÂæÖÊ†áÂáÜËæìÂÖ•ÔºåÊ≠§Êó∂ vCPU Á∫øÁ®ãÊó†Ê≥ïËé∑Âèñ‰∫íÊñ•ÈîÅËøõË°åËôöÊãüÊú∫ÂÜÖÁöÑËæìÂÖ•ÂíåËæìÂá∫Â§ÑÁêÜÔºõÂΩìÊ†áÂáÜËæìÂÖ•Â§ÑÁêÜÂÆåÊï∞ÊçÆÂêéÔºåÊâç‰ºöÈáäÊîæ‰∫íÊñ•ÈîÅÔºåvCPU Á∫øÁ®ãÊâçËÉΩÂ§üËé∑Âèñ‰∫íÊñ•ÈîÅËøõË°åËôöÊãüÊú∫ÂÜÖÁöÑËæìÂÖ•ÂíåËæìÂá∫Â§ÑÁêÜÔºåËøôÂ∞±ÂØºËá¥Âè™ÊúâÂú®‰∫∫Â∑•ËæìÂÖ•Â≠óÁ¨¶ÊâçÊúâ‰∏≤Âè£‰ø°ÊÅØËæìÂá∫ÈóÆÈ¢ò„ÄÇ</p>
<blockquote>
<p><strong>Ëß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÊ†∏ÂøÉÊÄùË∑ØÊòØ Serial Ê†áÂáÜËæìÂÖ•Â§ÑÁêÜÁ∫øÁ®ã‰∏çË¶ÅÂ§Ñ‰∫éÈïøÊúüÈòªÂ°ûÁ≠âÂæÖÂ§ÑÁêÜÁöÑÁä∂ÊÄÅÔºåÂØºËá¥ Serial Êï∞ÊçÆÁªìÊûÑÁöÑ‰∫íÊñ•ÈîÅÊó†Ê≥ïÈáäÊîæÁªôÂÖ∂‰ªñÁ∫øÁ®ãËÆøÈóÆ„ÄÇËøôÂ∞±ÈúÄË¶ÅÂºïÂÖ• Epoll Êú∫Âà∂ÔºåÂè™ÊúâÂú®‰∫ßÁîüÊ†áÂáÜËæìÂÖ•‰∫ã‰ª∂ÁöÑÊÉÖÂÜµ‰∏ãÔºåÊâçÈúÄË¶ÅËøõË°åÊ†áÂáÜËæìÂÖ•ÁöÑËØªÂèñÊìç‰ΩúÔºåËøôÊ†∑Â∞±ËÉΩÂèäÊó∂ËÆ©Âá∫‰∫íÊñ•ÈîÅËµÑÊ∫ê„ÄÇ</strong></p>
</blockquote>
<p>‰∏ãÈù¢Â∞±‰ªãÁªçÂ¶Ç‰ΩïÁÆÄÊòìÂÆûÁé∞ Epoll Â§ÑÁêÜÔºåÂΩìÂâç‰ΩøÁî®ÁöÑÊòØ Crates.io ‰∏≠ <code>vmm_sys_util</code> Â∞ÅË£ÖÁÆ±ÔºåÂÆÉÂ∑≤ÁªèÊèê‰æõ‰∫Ü Epoll ÂÆâÂÖ®APIÊé•Âè£ ( <code>new/ctl,/wait</code> )„ÄÇ</p>
<hr>
<h4 id="epollÊ°ÜÊû∂ÁÆÄÂçïÂ∞ÅË£Ö">EpollÊ°ÜÊû∂ÁÆÄÂçïÂ∞ÅË£Ö
</h4><p>È¶ñÂÖàÔºåÂàõÂª∫EpollÁÆ°ÁêÜÁªìÊûÑ‰ΩìÂÜÖÂÆπÁöÑÂØπË±°ÔºåÁî®‰∫é‰øùÂ≠òEpollÂØπË±°„ÄÅÁõëÂê¨‰∫ã‰ª∂Âíå‰∫ã‰ª∂ÂèëÁîüÊó∂ÁöÑÈó≠ÂåÖÂ§ÑÁêÜÔºà‰∫ã‰ª∂ÂõûË∞ÉÂáΩÊï∞Â§ÑÁêÜÔºâ„ÄÇ</p>
<blockquote>
<p><strong>EpollÁÆ°ÁêÜÁªìÊûÑ</strong></p>
</blockquote>
<p><code>StratoVirt-mini_stratovirt_edu/src/helper/epoll.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051810634.png"
	
	
	
	loading="lazy"
	
		alt="image-20231205181018569"
	
	
></p>
<blockquote>
<p><strong>‰∫ã‰ª∂ÂõûË∞ÉÂáΩÊï∞</strong></p>
</blockquote>
<p><code>StratoVirt-mini_stratovirt_edu/src/helper/epoll.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051810318.png"
	
	
	
	loading="lazy"
	
		alt="image-20231205181044240"
	
	
></p>
<blockquote>
<p><strong>ÂàõÂª∫EpollÁÆ°ÁêÜÁªìÊûÑ‰ΩìÂÜÖÂÆπÁöÑÂØπË±°</strong></p>
</blockquote>
<p><code>StratoVirt-mini_stratovirt_edu/src/helper/epoll.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051811241.png"
	
	
	
	loading="lazy"
	
		alt="image-20231205181105201"
	
	
></p>
<hr>
<blockquote>
<p><strong>Â∞ÜÁõëÂê¨ÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶Âä†ÂÖ•Epoll</strong></p>
</blockquote>
<p>ÂÖ∂Ê¨°ÔºåÈúÄË¶ÅÂ∞ÜÁõëÂê¨ÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶Âä†ÂÖ•Epoll‰∏≠Ôºå‰º†ÂÖ•ÁöÑÂèÇÊï∞ÊòØ‰∏äËø∞‰ª£Á†ÅÂùóÂÆö‰πâ‰∏≠ÁöÑ <code>EventNotifier</code> ÁªìÊûÑ‰ΩìÔºåÂ∞ÜÂÖ∂ËÆæÁΩÆ‰∏∫ÁõëÂê¨‰∫ã‰ª∂ÁöÑÊï∞ÊçÆÊåáÈíà„ÄÇ‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202185153329.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202185153329"
	
	
></p>
<hr>
<blockquote>
<p><strong>‰∫ã‰ª∂ÁõëÂê¨Âæ™ÁéØ</strong></p>
</blockquote>
<p>ÊúÄÂêéÔºåÂàõÂª∫‰∏Ä‰∏™Á∫øÁ®ãËøõË°å‰∫ã‰ª∂ÁõëÂê¨Âæ™ÁéØÂ§ÑÁêÜÔºåÂΩìÁõëÂê¨‰∫ã‰ª∂ÂèëÁîüÊó∂ÔºåËé∑ÂèñÁõëÂê¨‰∫ã‰ª∂ÁöÑÊï∞ÊçÆÊåáÈíàÔºåË∞ÉÁî®ÂÖ∂Â≠òÂÇ®ÁöÑÈó≠ÂåÖÂáΩÊï∞ÔºåËøõË°å‰∫ã‰ª∂ÂáΩÊï∞Â§ÑÁêÜÔºå‰ª•‰∏ã‰ª£Á†ÅÂùó‰∏∫‰∫ã‰ª∂ÁõëÂê¨Â§ÑÁêÜÂáΩÊï∞Ôºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/helper/epoll.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051811690.png"
	
	
	
	loading="lazy"
	
		alt="image-20231205181138599"
	
	
></p>
<hr>
<h4 id="‰∏≤Ë°åËÆæÂ§áÂ§ÑÁêÜÈõÜÊàêepollÊú∫Âà∂">‰∏≤Ë°åËÆæÂ§áÂ§ÑÁêÜÈõÜÊàêEpollÊú∫Âà∂
</h4><p>‰ª•‰∏≤Ë°åËÆæÂ§áÂ§ÑÁêÜ‰∏∫‰æãÔºå‰ΩøÁî®EpollÊú∫Âà∂ÁöÑÂ¶Ç‰∏ãÁ§∫‰æã‰ª£Á†ÅÔºö</p>
<p><code>StratoVirt-mini_stratovirt_edu/src/device/serial.rs</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202185350929.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202185350929"
	
	
></p>
<blockquote>
<p>ËØ¶ÁªÜ‰ª£Á†ÅÂèØÂàáÊç¢Ëá≥StratoVirt‰∏ªÈ°µÁöÑ <code>mini_stratovirt_edu</code> ÂàÜÊîØ‰∏≠ÁöÑEpollÂÆûÁé∞Êü•Áúã„ÄÇ</p>
</blockquote>
<p>ÈáçÊñ∞ÁºñËØëËøêË°åÔºåÂ∞±È°∫Âà©Âú∞Ëß£ÂÜ≥‰∫ÜÂè™ÊúâÂú®ËæìÂÖ•Â≠óÁ¨¶ÁöÑÊó∂ÂÄôÔºå‰∏≤Âè£ÁöÑËæìÂá∫‰ø°ÊÅØÊâç‰ºöÊòæÁ§∫Âá∫Êù•ÁöÑÈóÆÈ¢ò„ÄÇ‰øÆÊîπÂÆåÊàêÂêéÔºåÂêØÂä®‰ø°ÊÅØÂæàÂø´Â∞±ËæìÂá∫Âà∞ÁªàÁ´Ø‰∏äÔºåËøêË°åÁªìÊûúÂ¶Ç‰∏ãÔºö</p>
<p><code>Terminal</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051812654.png"
	
	
	
	loading="lazy"
	
		alt="image-20231205181227568"
	
	
></p>
<h2 id="todo-48-È≤≤ÈπèÂπ≥Âè∞ÊîØÊåÅ-aarch64">//TODO: 4.8 È≤≤ÈπèÂπ≥Âè∞ÊîØÊåÅ: AArch64
</h2><p>6.4.1~6.4.7ËäÇÂÆûÁé∞‰∫Ü‰∏Ä‰∏™Á≤æÁÆÄÁöÑVMMÔºåÂπ∂‰∏îÂèØ‰ª•Âú®x86_64Âπ≥Âè∞‰∏äÊàêÂäüÂêØÂä®ÂÆ¢Êà∑Êú∫„ÄÇÊú¨Â∞èËäÇÂ∞ÜÈÄöËøáÊâ©Â±ïÁé∞ÊúâÁöÑÊ®°ÂùóÂÆûÁé∞ÔºåÂú®È≤≤ÈπèÊúçÂä°Âô®‰∏äÂêØÂä®ÂÆ¢Êà∑Êú∫„ÄÇÊú¨ËäÇÊâ©Â±ïÂÜÖÂÆπ‰∏ªË¶ÅÂåÖÊã¨‰∏≠Êñ≠ÊéßÂà∂Âô®„ÄÅBootLoader„ÄÅCPUÊ®°ÂûãÂíåËÆæÂ§áÊ†ë(Device Tree)ÁöÑÂÆûÁé∞„ÄÇ</p>
<h3 id="‰∏≠Êñ≠ÊéßÂà∂Âô®">‰∏≠Êñ≠ÊéßÂà∂Âô®
</h3><p>KVMÊèê‰æõ‰∫ÜAArch64Âπ≥Âè∞‰∏≠Êñ≠ÊéßÂà∂Âô®GICÁöÑÊ®°ÊãüËÉΩÂäõÔºåÂõ†Ê≠§ÂèØ‰ª•Áõ¥Êé•ÂàõÂª∫VGICÔºàVirtual General Interrupt ControllerÔºåËôöÊãüÈÄöÁî®‰∏≠Êñ≠ÊéßÂà∂Âô®ÔºâÔºåÂπ∂ÈÖçÁΩÆËØ•KVMËÆæÂ§áÁöÑÂ±ûÊÄß„ÄÇÂõ†‰∏∫Âú®ÊåÅÁª≠Ëø≠‰ª£ËøáÁ®ã‰∏≠ÔºåStratoVirt‰ºöÈÄêÊ≠•Â¢ûÂä†Êñ∞ÁâπÊÄßÔºåMSI‰∏çÂèØÊàñÁº∫ÔºåÂõ†Ê≠§‰∏≠Êñ≠ÊéßÂà∂Âô®Ê®°ÂùóÈÄâÊã©GICv3ÁâàÊú¨ÔºåÂπ∂Ê∑ªÂä†GICv3 ITSËÆæÂ§á„ÄÇ</p>
<p>‰ª•‰∏ã‰ª£Á†ÅÊèèËø∞‰∫ÜVGICÁöÑÁªìÊûÑ‰ΩìÔºåÂåÖÂê´ËÆæÁΩÆKVM VGICËÆæÂ§áÂ±ûÊÄßÁöÑDeviceFd„ÄÅVGIC‰∏≠Êñ≠ÂàÜÂèëÂô®„ÄÅVGIC‰∏≠Êñ≠ÂÜçÂàÜÂèëÂô®ÁöÑÂú∞ÂùÄÂå∫Èó¥Á≠â„ÄÇ</p>
<p>StratoVirt-mini_stratovirt_edu/src/device/gicv3.rs</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051813786.png"
	
	
	
	loading="lazy"
	
		alt="image-20231205181318732"
	
	
></p>
<p>(1)ÂàõÂª∫GICv3‰∏≠Êñ≠ÊéßÂà∂Âô®ÂíåITS„ÄÇÈÄöËøáÁ¨¨‰∏âÊñπkvm-ioctlsÂ∫ìÔºåÂàõÂª∫VGIC‰ª•ÂèäITSÂØπÂ∫îÁöÑKVMËÆæÂ§á„ÄÇÂàõÂª∫ËÆæÂ§áÊó∂ÔºåÂèØ‰ª•Áõ¥Êé•Ë∞ÉÁî®ËôöÊãüÊú∫Âè•ÊüÑVmFdÁöÑÊàêÂëòÊñπÊ≥ïÔºåÂú®‰º†ÂÖ•ÁöÑÂèÇÊï∞‰∏≠ÊåáÂÆöÈúÄË¶ÅÂàõÂª∫ÁöÑËÆæÂ§áÁ±ªÂûã„ÄÇ‰ª£Á†ÅÂ¶Ç‰∏ã„ÄÇ</p>
<p>StratoVirt-mini_stratovirt_edu/src/device/gicv3.rs</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051813896.png"
	
	
	
	loading="lazy"
	
		alt="image-20231205181339823"
	
	
></p>
<p>(2)Â±ûÊÄßËÆæÁΩÆ‰∏éÂàùÂßãÂåñ„ÄÇËÆæÁΩÆKVMËÆæÂ§áÂ±ûÊÄßÔºåÂåÖÂê´VGIC‰∏≠Êñ≠ÂÜçÂàÜÂèëÂô®„ÄÅITSÁöÑÂú∞ÂùÄ‰ø°ÊÅØ‰ª•Âèä‰∏≠Êñ≠Êï∞ÁõÆÁ≠â„ÄÇ‰∏≠Êñ≠ÊéßÂà∂Âô®Ê®°Âùó‰ΩøÁî®Âà∞ÁöÑGroupÂ±ûÊÄßÂíåGroup‰∏ãÈúÄË¶ÅËÆæÁΩÆÁöÑÂ±ûÊÄßÂÄºÂ¶Ç‰∏ãÔºåËØªËÄÖÂèØ‰ª•ÂèÇËÄÉVGIC v3ÁöÑLinuxÂÜÖÊ†∏ÊñáÊ°£[ÊèíÂõæ]ÂíåVGIC ITSÁöÑÂÜÖÊ†∏ÊñáÊ°£[ÊèíÂõæ]„ÄÇ</p>
<p>‚ë†KVM_DEV_ARM_VGIC_GRP_ADDRÔºàGroupÂ±ûÊÄßÔºâ„ÄÇÂÆÉÂåÖÊã¨Ôºö</p>
<p>¬∑ KVM_VGIC_V3_ADDR_TYPE_DISTÔºöVGIC‰∏≠Êñ≠ÂàÜÂèëÂô®ÁöÑÂü∫Âú∞ÂùÄÂ±ûÊÄßÔºàËØ•Âü∫Âú∞ÂùÄ‰∏∫ËôöÊãüÊú∫ÂÜÖÈÉ®Áâ©ÁêÜÂú∞ÂùÄÁ©∫Èó¥ÁöÑÂú∞ÂùÄÔºâÔºåÂøÖÈ°ª64KBÂØπÈΩê„ÄÇVGIC‰∏≠Êñ≠ÂàÜÂèëÂô®ÁöÑÈïøÂ∫¶Âõ∫ÂÆö‰∏∫64KB„ÄÇ¬∑ KVM_VGIC_V3_ADDR_TYPE_DISTÔºöVGIC‰∏≠Êñ≠ÂÜçÂàÜÂèëÂô®ÁöÑÂü∫Âú∞ÂùÄÂ±ûÊÄßÔºàËØ•Âü∫Âú∞ÂùÄ‰∏∫ËôöÊãüÊú∫ÂÜÖÈÉ®Áâ©ÁêÜÂú∞ÂùÄÁ©∫Èó¥ÁöÑÂú∞ÂùÄÔºâÔºåÂøÖÈ°ª64KBÂØπÈΩê„ÄÇVGIC‰∏≠Êñ≠ÂÜçÂàÜÂèëÂô®ÁöÑÈïøÂ∫¶Âõ∫ÂÆö‰∏∫128KB„ÄÇ¬∑ KVM_DEV_ARM_VGIC_GRP_NR_IRQSÔºö‰∏≠Êñ≠Êï∞ÁõÆÂ±ûÊÄß„ÄÇËØ•Â±ûÊÄßËÆæÁΩÆVGICËÆæÂ§áÂÆû‰æãÁÆ°ÁêÜÁöÑÊÄª‰∏≠Êñ≠Êï∞ÁõÆÔºåÊúÄÂ§ßÂÄº‰∏∫1024„ÄÇ¬∑ KVM_VGIC_ITS_ADDR_TYPEÔºöITSÁöÑÂü∫Âú∞ÂùÄÂ±ûÊÄßÔºåÂøÖÈ°ª64KBÂØπÈΩê„ÄÇITSÁöÑÈïøÂ∫¶Âõ∫ÂÆö‰∏∫128KB„ÄÇ</p>
<p>‚ë°KVM_DEV_ARM_VGIC_GRP_CTRLÔºàGroupÂ±ûÊÄßÔºâÊúâ„ÄÇÂÆÉÔºö</p>
<p>KVM_DEV_ARM_VGIC_CTRL_INITÔºöÂàùÂßãÂåñVGICËÆæÂ§áÂíåITSÈúÄË¶ÅËÆæÁΩÆËØ•ÂØÑÂ≠òÂô®ÔºåËØ∑Ê±ÇKVMÂàùÂßãÂåñVGICËÆæÂ§áÂíåITSËÆæÂ§á„ÄÇÂàùÂßãÂåñËÆæÂ§áËØ∑Ê±ÇÔºåÂú®ËÆæÂ§áÂ±ûÊÄßËÆæÁΩÆÂÆåÊàêÂêéËøõË°å„ÄÇÂÆåÊàêÂàùÂßãÂåñ‰πãÂêéÔºåStratoVirt‰∏≠Êñ≠ÊéßÂà∂Âô®Ê®°ÂùóÁöÑÂàùÂßãÂåñÂ∞±ÂÖ®ÈÉ®ÂÆåÊàê„ÄÇ‰ª£Á†ÅÂ¶Ç‰∏ã„ÄÇ</p>
<p>StratoVirt-mini_stratovirt_edu/src/device/gicv3.rs</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051814028.png"
	
	
	
	loading="lazy"
	
		alt="image-20231205181405968"
	
	
></p>
<h3 id="bootloader">BootLoader
</h3><p>‰∏éx86_64‰∏çÂêåÔºåAArch64Âπ≥Âè∞‰∏äÁöÑ‰ΩéÁ´ØÂú∞ÂùÄÂå∫Èó¥Êèê‰æõÁªôËÆæÂ§á‰ΩøÁî®ÔºåÂÆ¢Êà∑Êú∫Áâ©ÁêÜÂÜÖÂ≠òËµ∑Âßã‰ΩçÁΩÆ‰∏∫1GBÔºåÂ¶ÇÂõæ6-13ÊâÄÁ§∫„ÄÇAArch64Âπ≥Âè∞ÁöÑÂú∞ÂùÄÁ©∫Èó¥Â∏ÉÂ±ÄÂêåÊ†∑ÂÆö‰πâÂú®ÂÜÖÂ≠òÂ≠êÊ®°Âùó‰∏≠„ÄÇ</p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051816393.png" style="zoom:50%;" />
<p>AArch64Âπ≥Âè∞ÁöÑBootLoaderÂÆûÁé∞ËæÉ‰∏∫ÁÆÄÂçïÔºå‰∏ªË¶ÅÂåÖÊã¨Ôºö‚ë†Â∞ÜËôöÊãüÊú∫ÂÜÖÊ†∏ÂíåinitrdÈïúÂÉè‰øùÂ≠òÂà∞ÂÜÖÂ≠ò‰∏≠Ôºõ‚ë°Âú®ËôöÊãüÊú∫ÂÜÖÂ≠ò‰∏≠‰∏∫ËÆæÂ§áÊ†ëÈ¢ÑÁïôÁ©∫Èó¥ÔºåÂ§ßÂ∞è‰∏∫64KB„ÄÇËôöÊãüÊú∫ÂÜÖÊ†∏ÈïúÂÉè„ÄÅinitrdÈïúÂÉèÂíåËÆæÂ§áÊ†ëÂú®ÂÜÖÂ≠ò‰∏≠ÁöÑÂ∏ÉÂ±ÄÂ¶Ç6-13ÊâÄÁ§∫„ÄÇÂÖ∂‰∏≠ÔºåËÆæÂ§áÊ†ëÂíåinitrdÈïúÂÉèÂ≠òÊîæÂú®ÂÜÖÂ≠òÁöÑÁªìÊùü‰ΩçÁΩÆÂ§ÑÔºåÂÜÖÊ†∏ÈïúÂÉèÂ≠òÊîæÂú®ÂÜÖÂ≠òËµ∑Âßã‰ΩçÁΩÆÂ§Ñ„ÄÇ</p>
<p>Â∞ÜËôöÊãüÊú∫ÂÜÖÊ†∏ÈïúÂÉèÂíåinitrdÈïúÂÉè‰øùÂ≠òÂà∞ÂÜÖÂ≠ò‰∏≠ÂêéÔºåÂ∞ÜÂÜÖÊ†∏Ëµ∑ÂßãÂú∞ÂùÄ„ÄÅinitrdÂú∞ÂùÄÂíåËÆæÂ§áÊ†ëÂ≠òÊîæÂú∞ÂùÄ‰øùÂ≠òÂú®AArch64BootLoaderÁªìÊûÑ‰Ωì‰∏≠ÔºåÁõ∏ÂÖ≥‰ª£Á†ÅÂ¶Ç‰∏ã„ÄÇ</p>
<p>StratoVirt-mini_stratovirt_edu/src/boot_loader/aarch64/mod.rs</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202194723819.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202194723819"
	
	
></p>
<h3 id="cpuÊ®°Âûã">CPUÊ®°Âûã
</h3><p>AArch64Âπ≥Âè∞ÁöÑCPUÂü∫Êú¨ÁªìÊûÑÂèØ‰ª•Â§çÁî®6.4.4ËäÇ‰∏≠ÁöÑÂÜÖÂÆπÔºåÂîØ‰∏ÄÁöÑ‰∏çÂêåÊòØÂØÑÂ≠òÂô®Êï∞ÊçÆÁªìÊûÑÁöÑ‰∏çÂêåÔºåËøôÈáåÈááÁî®‰∫ÜRust‰∏≠ÁºñËØëÂÆèÁöÑÁºñËØëÊäÄÂ∑ßÔºåÂ∞Üx86_64ÂíåAArch64ÁöÑÂØÑÂ≠òÂô®‰ø°ÊÅØÂ∞ÅË£ÖÂú®‰∏çÂêåÁöÑÁªìÊûÑ‰∏≠ÔºåÂπ∂Ê∑ªÂä†Âà∞CPUÊï∞ÊçÆÁªìÊûÑ‰∏≠ÁöÑÂêå‰∏ÄÊàêÂëòÂ§Ñ‰∏≠ÔºåÈÄöËøáÁºñËØëÂÆèÈöîÂºÄ„ÄÇ‰ΩøÁî®#[cfg(target_arch=&ldquo;x86_64&rdquo;)]ÔºåË°®Á§∫‰ªÖÂú®x86_64ÁöÑÁºñËØëÁéØÂ¢É‰∏≠ÁºñËØë‰∏ã‰∏Ä‰ª£Á†ÅÂùóÁöÑ‰ª£Á†ÅÔºå#[cfg(target_arch=&ldquo;aarch64&rdquo;)]ÂàôË°®Á§∫Âú®AArch64Âπ≥Âè∞ÈúÄË¶ÅÁºñËØëÁöÑ‰ª£Á†ÅÂùóÔºåËøôÊ†∑Â∞±ÂèØ‰ª•ÈÄöËøá‰∏ÄÂ•ó‰ª£Á†ÅÊù•ÊîØÊåÅ‰∏§‰∏™Âπ≥Âè∞ÁöÑCPUÊ®°Âûã„ÄÇ</p>
<p>Âíåx86_64Áõ∏ÂêåÔºåAArch64ËøêË°åÂÜÖÊ†∏‰ª£Á†ÅÂâç‰πüÈúÄË¶ÅËÆæÁΩÆÁõ∏ÂÖ≥vCPUÂØÑÂ≠òÂô®ÁöÑ‰ø°ÊÅØÔºåÂÖ∂‰ΩúÁî®‰∏ªË¶ÅÊòØËÆ©vCPUÂèØ‰ª•Ëé∑ÂèñÂÜÖÊ†∏ÂíåËÆæÂ§áÊ†ëÁöÑËµ∑ÂßãÂú∞ÂùÄ‰ø°ÊÅØÔºåËøô‰∏§‰∏™ÂÄºÂ∞ÜË¢´ËÆæÁΩÆÂà∞USER_PT_REG_PCÂØÑÂ≠òÂô®ÂíåUSER_PT_REG_REGSÂØÑÂ≠òÂô®ÁöÑÈ¶ñ‰Ωç„ÄÇÂíåx86_64Âπ≥Âè∞‰∏çÂêåÁöÑÊòØÔºåRust‰∏≠ÁöÑÁ¨¨‰∏âÊñπkvm-ioctlsÂ∫ìÂØπAArch64Âπ≥Âè∞ÁöÑÊîØÊåÅËæÉÂ∑ÆÔºåÂè™Êèê‰æõ‰∫ÜÊúÄÂü∫Êú¨ÁöÑËé∑ÂèñÂØÑÂ≠òÂô®‰ø°ÊÅØÂíåËÆæÁΩÆÂØÑÂ≠òÂô®‰ø°ÊÅØÁöÑÂáΩÊï∞„ÄÇÂõ†Ê≠§CPUÊ®°ÂùóÂØπAArch64 vCPUÂØÑÂ≠òÂô®ÂÜÖÂÆπËøõË°å‰∫ÜÂ∞ÅË£ÖÔºå‰ª£Á†ÅÂ¶Ç‰∏ã„ÄÇ</p>
<p>StratoVirt-mini_stratovirt_edu/src/cpu/aarch64/mod.rs</p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051815781.png" style="zoom:50%;" />
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051816856.png" style="zoom: 33%;" />
<p>ÈÄöËøáÂ∞ÅË£ÖÂ•ΩÁöÑÂÜÖÊ†∏ÂØÑÂ≠òÂô®ÁªìÊûÑÔºåÂ∞±ÂèØ‰ª•Áõ¥Êé•Ë∞ÉÁî®VcpuFdÁöÑset_one_regÊé•Âè£Ëé∑ÂèñÂíåËÆæÁΩÆÊåáÂÆöÂØÑÂ≠òÂô®ÁöÑÂÄº„ÄÇ</p>
<p>Èô§‰∫ÜÈÄöËøáBootLoaderÂæóÂà∞ÁöÑÂÜÖÊ†∏Ëµ∑Âßã‰ΩçÁΩÆ‰ø°ÊÅØÂíåËÆæÂ§áÊ†ë‰ΩçÁΩÆ‰ª•Â§ñÔºåCPUËøòÈúÄË¶ÅÂàùÂßãÂåñ‰∏Ä‰∫õÂÖ∂‰ªñÂÜÖÂÆπÔºåÁî®Êù•ÂÆåÊàêCPUÂü∫Êú¨Á°¨‰ª∂Áä∂ÊÄÅÁöÑËÆæÁΩÆÔºåÂåÖÊã¨MPIDRÔºàÂ§öÂ§ÑÁêÜÂô®‰∫≤ÂíåÂØÑÂ≠òÂô®ÔºâÁöÑÂàùÂßãÂåñÁ≠â„ÄÇËØªËÄÖÂèØ‰ª•ÈÄöËøáÊü•ÁúãStratoVirtÈ°πÁõÆmini_stratovirt_eduÂàÜÊîØËé∑ÂèñËØ¶ÁªÜ‰ø°ÊÅØ„ÄÇ</p>
<h3 id="ÊûÑÂª∫ËÆæÂ§áÊ†ë">ÊûÑÂª∫ËÆæÂ§áÊ†ë
</h3><p>6.4.5ËäÇ‰∏≠ÊèêÂà∞ÔºåÂú®x86_64Âπ≥Âè∞‰∏äBootLoaderÈÄöËøáe820Ë°®Â∞ÜÈÖçÁΩÆÁöÑËôöÊãüÊú∫ÂÜÖÂ≠ò‰ø°ÊÅØ‰º†ÈÄíÁªôÂÆ¢Êà∑Êú∫ÂÜÖÊ†∏ÔºåÈÄöËøáMPË°®Â∞ÜÂ§ÑÁêÜÂô®Âíå‰∏≠Êñ≠ÊéßÂà∂Âô®‰ø°ÊÅØ‰º†ÈÄíÁªôËôöÊãüÊú∫ÂÜÖÊ†∏ÔºåÈÄöËøáÂëΩ‰ª§Ë°å‰º†ÈÄíÂÖ∂‰ªñ‰∏Ä‰∫õÂøÖË¶ÅÁöÑÈÖçÁΩÆÈ°π„ÄÇ‰∏éx86_64Âπ≥Âè∞‰∏çÂêåÁöÑÊòØÔºåAArch64Âπ≥Âè∞ÈÄöËøáËÆæÂ§áÊ†ëÂ∞ÜÁ°¨‰ª∂‰ø°ÊÅØÔºà‰æãÂ¶ÇÂÜÖÂ≠ò‰ø°ÊÅØ„ÄÅCPU‰ø°ÊÅØÁ≠âÔºâ‰º†ÈÄíÁªôÂÆ¢Êà∑Êú∫ÂÜÖÊ†∏„ÄÇ</p>
<p>ËÆæÂ§áÊ†ëÊòØ‰∏ÄÁßçËÉΩÂ§üÊèèËø∞Á°¨‰ª∂‰ø°ÊÅØÁöÑÊï∞ÊçÆÁªìÊûÑ[ÊèíÂõæ]ÔºåËØ•ÁªìÊûÑÂèØ‰ª•ËΩ¨Êç¢ÊàêÂ≠óËäÇÊµÅ‰º†ÈÄíÁªôÊìç‰ΩúÁ≥ªÁªüÔºåÊìç‰ΩúÁ≥ªÁªüÂèØ‰ª•Ëß£ÊûêÂπ∂Ëé∑ÂæóÁ°¨‰ª∂‰ø°ÊÅØÔºåËøõËÄåÊâßË°å‰∏ÄÁ≥ªÂàóÁöÑÂàùÂßãÂåñÂä®‰Ωú„ÄÇËÆæÂ§áÊ†ëÔºåÈ°æÂêçÊÄù‰πâÔºå‰∏∫Ê†ëÁä∂ÁªìÊûÑÔºåÂÖ∂‰∏≠Â≠òÂú®‰∏ÄÁ≥ªÂàóÁöÑËäÇÁÇπÔºåÊØè‰∏™ËäÇÁÇπÊúâ‰∏ÄÁ≥ªÂàóÂ±ûÊÄßÔºåÂπ∂‰∏îÂèØ‰ª•Â≠òÂú®Ëã•Âπ≤Â≠êËäÇÁÇπ„ÄÇ</p>
<p>Âú®StratoVirtÈ°πÁõÆ‰∏≠ÔºåËÆæÂ§áÊ†ëÁöÑÊûÑÂª∫Áõ¥Êé•ÈÄöËøáË∞ÉÁî®lfdt CÊé•Âè£ÂÆåÊàêÔºåÂõ†Ê≠§Âú®ÁºñËØëStratoVirt CargoÈ°πÁõÆÊó∂ÔºåÈúÄË¶ÅÂ∞ÜÁî®Âà∞ÁöÑÂ∫ìÂä†ÂÖ•rustcÁöÑÈìæÊé•ÈÄâÈ°πÈìæË°®‰∏≠ÔºåÂØπÂ∫îÁöÑÁºñËØëÂëΩ‰ª§‰∏∫Ôºöcargo rustc-link-args=‚Äú-lfdt‚Äù„ÄÇÂ¶ÇÊûú‰ªçÂ∏åÊúõÈÄöËøáÊâßË°åcargo buildÂëΩ‰ª§Êù•ÁºñËØëÈ°πÁõÆÔºåÂèØ‰ª•Â∞ÜÈìæÊé•ÈÄâÈ°πÂÜôÂà∞È°πÁõÆÈªòËÆ§ÁºñËØëÈÖçÁΩÆ„ÄÇcargo/configÊñá‰ª∂‰∏≠ÔºåËÆæÁΩÆÊñπÊ≥ïÂèØÂèÇÁÖßStratoVirtÈ°πÁõÆmini_stratovirt_eduÂàÜÊîØ„ÄÇ</p>
<p>ÊûÑÂª∫ËÆæÂ§áÊ†ë‰ΩøÁî®Âà∞ÁöÑCÊé•Âè£ÂÆö‰πâÂú®src/helper/device_tree.rs‰∏≠Ôºå‰ª£Á†ÅÂ¶Ç‰∏ã„ÄÇÂèØ‰ª•ÁúãÂà∞ÔºåËøô‰∫õÂáΩÊï∞‰∏∫ÂàõÂª∫ËäÇÁÇπÁöÑÊúÄÂü∫Êú¨ÁöÑÂáΩÊï∞ÔºåË∞ÉÁî®Ëøô‰∫õÂáΩÊï∞ÈúÄË¶ÅÂä†RustËØ≠Ë®Ä‰∏≠ÁöÑunsafeÊ†áÂøóÔºå‰∏∫‰∫Ü‰øùËØÅËÆæÂ§áÊ†ëÊ®°ÂùóÂü∫Êú¨ÂäüËÉΩÂáΩÊï∞ÁöÑÂÆâÂÖ®ÊÄßÂíåÂ∞ÅË£ÖÊÄßÔºåÈúÄË¶ÅÂØπCÊé•Âè£ÂáΩÊï∞ËøõË°åÂ∞ÅË£ÖÔºåÂπ∂ËææÂà∞‰ª•‰∏ãÁõÆÊ†áÔºö‚ë†CÈ£éÊ†ºÁöÑÂèÇÊï∞Á±ªÂûãÔºåÂ∞ÅË£ÖÂêéÂ∫î‰∏∫RustÁöÑÊï∞ÊçÆÁªìÊûÑÔºõ‚ë°‰øùËØÅÂ∞ÅË£ÖÂáΩÊï∞ÁöÑÂäüËÉΩÂÆåÊï¥ÔºåÈîôËØØÂ§ÑÁêÜ‰∏•Ë∞®ÔºåÁ°Æ‰øùÂú®Ë∞ÉÁî®CÊé•Âè£ÁöÑ‰ΩúÁî®ÂüüÂÜÖ‰∏ç‰ºöÂèëÁîüÂÜÖÂ≠òÊ≥ÑÊºè„ÄÅË∂äÁïåËÆøÈóÆÁ≠âÈóÆÈ¢ò„ÄÇ</p>
<p>‰∏∫ÊûÑÂª∫ËÆæÂ§áÊ†ëÔºåÈúÄË¶ÅÁî®Âà∞ÁöÑ‰∏ªË¶ÅÊé•Âè£ÂåÖÊã¨Ôºö‚ë†ÂàõÂª∫Á©∫ËÆæÂ§áÊ†ëÔºõ‚ë°Ê∑ªÂä†Â≠êËäÇÁÇπÔºõ‚ë¢ËÆæÁΩÆËäÇÁÇπÂ±ûÊÄßÂÄº„ÄÇËØªËÄÖÂèØÊåâÁÖßËøô‰∫õÈúÄÊ±ÇËá™Ë°åÂÆûÁé∞ÔºåÂèØÂèÇËÄÉStratoVirtÈ°πÁõÆmini_stratovirt_eduÂàÜÊîØ‰∏≠ÁöÑsrc/helper/device_tree.rsÊñá‰ª∂„ÄÇ</p>
<p>StratoVirt-mini_stratovirt_edu/src/helper/device_tree.rs</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202195133807.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202195133807"
	
	
></p>
<p>ÈÄöÂ∏∏ÔºåÊûÑÂª∫Â•ΩÁöÑËÆæÂ§áÊ†ëÊï∞ÊçÆÁß∞‰∏∫DTBÔºàDevice Tree BlobÔºåËÆæÂ§áÊ†ëÂÆπÂô®Ôºâ„ÄÇ‰∏éDTBÂØπÂ∫îÁöÑÊòØDTSÔºàDevice Tree SourceÔºåËÆæÂ§áÊ†ëÊ∫êÔºâÔºåDTSÊòØÊñáÊú¨Ê†ºÂºèÁöÑËÆæÂ§áÊ†ëÊèèËø∞ÔºåÊõ¥Âä†ÂèØËßÜÂåñÔºåÁ¨¶ÂêàÈòÖËØª‰π†ÊÉØ„ÄÇÂà©Áî®DTCÔºàdevice tree compilerÔºåËÆæÂ§áÊ†ëÁºñËØëÂô®ÔºâÂ∑•ÂÖ∑[ÊèíÂõæ]ÔºåÂèØ‰ª•Êñπ‰æøÂú∞Âú®DTS„ÄÅDTB‰∏§ÁßçÊ†ºÂºè‰πãÈó¥ËΩ¨Êç¢„ÄÇ</p>
<p>Âú®src/helper/device_tree.rsÊñá‰ª∂‰∏≠ÔºåÊèê‰æõ‰∫ÜÊé•Âè£ÂáΩÊï∞dump_dtbÔºåÁî®‰∫éÂ∞ÜDTB‰øùÂ≠òÂà∞ÊåáÂÆöÊñá‰ª∂‰∏≠„ÄÇÂú®src/main.rs‰∏≠ÔºåÂ∞ÜÊûÑÂª∫Â•ΩÁöÑDTBÊï∞ÊçÆ‰øùÂ≠òÂú®ÊåáÂÆöÊñá‰ª∂‰∏≠„ÄÇÊâßË°åÂëΩ‰ª§dtc-I dtb-O dts input.dtb-o output.dtsÔºåÂèØ‰ª•ÂæóÂà∞DTSÊñá‰ª∂„ÄÇ</p>
<p>‰∏ãÈù¢‰ª£Á†ÅÂ±ïÁé∞‰∫ÜDTB‰∏≠ÁöÑÈÉ®ÂàÜËäÇÁÇπÁ§∫‰æãÔºåÂÖ∂‰∏≠‚Äú/‚Äù‰∏∫Ê†πËäÇÁÇπÔºàÊúâ‰∏î‰ªÖÊúâ‰∏Ä‰∏™Ôºâ„ÄÇÈô§Ê†πËäÇÁÇπ‰πãÂ§ñÔºåÂÖ∂‰ªñËäÇÁÇπÊúâ‰∏îÂè™Êúâ‰∏Ä‰∏™Áà∂ËäÇÁÇπ„ÄÇËäÇÁÇπÁöÑÂëΩÂêçËßÑÂàô‰∏∫‚Äúnode_name@addr‚ÄùÔºåÂÖ∂‰∏≠‚Äúnode_name‚Äù‰∏∫ËäÇÁÇπÂêçÂ≠óÔºåaddr‰∏∫ËäÇÁÇπregÂ±ûÊÄßÂØπÂ∫îÁöÑÂÄº„ÄÇËäÇÁÇπÂÜÖÈÉ®ÂåÖÂê´‰∫ÜËã•Âπ≤ËäÇÁÇπÂ±ûÊÄßÂíåÂØπÂ∫îÁöÑÂÄº„ÄÇ‰Ωú‰∏∫ÂÜÖÂ≠òËäÇÁÇπÁöÑÁà∂ËäÇÁÇπÔºåÊ†πËäÇÁÇπ‰∏≠ÂÆö‰πâ‰∫Ü#address-cellsÂíå#size-cellsÔºåÂàÜÂà´‰ª£Ë°®Âú®Â≠êËäÇÁÇπÁöÑregÂ±ûÊÄß‰∏≠Âú∞ÂùÄ„ÄÅÂú∞ÂùÄËåÉÂõ¥ÈïøÂ∫¶ÊâÄÂç†Áî®ÁöÑ‰∏ãÊ†áÊï∞ÁõÆ„ÄÇ‰ª•ÂÜÖÂ≠òËäÇÁÇπ‰∏∫‰æãÔºåregÂ±ûÊÄßÊèèËø∞‰∫ÜËäÇÁÇπÁöÑÂú∞ÂùÄËåÉÂõ¥ÔºåÂú®&lt;0x000x40000000 0x00 0x20000000&gt;‰∏≠ÔºåÂâç‰∏§‰∏™Êï∞Â≠ó‰ª£Ë°®Âú∞ÂùÄÔºåÂêé‰∏§‰∏™Êï∞Â≠ó‰ª£Ë°®Âú∞ÂùÄËåÉÂõ¥ÈïøÂ∫¶„ÄÇ</p>
<p>StratoVirt-mini_stratovirt_edu stratovirtÁöÑÈÉ®ÂàÜDTSÔºö</p>
<p><img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/image-20231202195252999.png"
	
	
	
	loading="lazy"
	
		alt="image-20231202195252999"
	
	
></p>
<p>Âú®src/main.rs‰∏≠Ê∑ªÂä†ËÆæÂ§áÊ†ëÁöÑÊûÑÂª∫‰πãÂêéÔºåÂú®ÂÆø‰∏ªÊú∫‰∏äÂ∞ÜPEÊ†ºÂºèÂÜÖÊ†∏ÈïúÂÉèvmlinux.binÂíåinitrdÊñá‰ª∂ÊîæÂú®ÊåáÂÆöÁõÆÂΩï‰∏ãÔºàsrc/main.rs‰∏≠ÊåáÂÆöÁöÑÁõÆÂΩï‰∏∫/tmpÔºåÂèØ‰øÆÊîπÔºâÔºåËøêË°åÁ®ãÂ∫èÂêØÂä®ÂÜÖÊ†∏ÈïúÂÉèÂèØ‰ª•ÂæóÂà∞Â¶Ç‰∏ãËæìÂá∫ÔºåËØªËÄÖÂèØ‰ª•‰ªéÊó•Âøó‰∏≠ÁúãÂà∞ÂÜÖÂ≠ò„ÄÅ‰∏≠Êñ≠ÊéßÂà∂Âô®„ÄÅ‰∏≤Âè£Á≠âÁöÑÂÜÖÊ†∏Êó•Âøó„ÄÇ</p>
<p>Terminal</p>
<img src="https://cdn.jsdelivr.net/gh/MaskerDad/BlogImage@main/202312051816239.png" alt="image-20231202195529135" style="zoom: 50%;" />
<h1 id="5-mini_stratovirt_eduÁÆÄ‰ªã">5 mini_stratovirt_eduÁÆÄ‰ªã
</h1><h2 id="51-Êû∂ÊûÑËÆæËÆ°">5.1 Êû∂ÊûÑËÆæËÆ°
</h2><p><code>mini_stratovirt_edu</code> ÁöÑÁõÆÁöÑÂú®‰∫é‰ΩøÁî® Rust ËØ≠Ë®ÄÂ≠¶‰π†‰ªéÈõ∂ÂºÄÂßãÂºÄÂèëÂá∫Â∞ΩÂèØËÉΩÁ≤æÁÆÄÁöÑËôöÊãüÊú∫ËΩØ‰ª∂ÔºåÂÖÖÂàÜÂà©Áî® Linux ÂÜÖÊ†∏‰∏≠ÁöÑ KVM Ê®°ÂùóÊâÄÊèê‰æõÁöÑÁ°¨‰ª∂ËæÖÂä©ËôöÊãüÂåñËÉΩÂäõÔºåÂÆûÁé∞ËôöÊãüÊú∫Âú®Â§öÂπ≥Âè∞Ôºà <code>x86_64/aarch64</code> ÔºâÁöÑËøêË°å„ÄÇÈ¢ÑÊúüÁªìÊûú‰∏∫Áî®Êà∑ÂèØ‰ª•ÈÄöËøá‰∏≤Âè£ÁôªÂΩïËôöÊãüÊú∫ÂÜÖÈÉ®ÔºåÂπ∂‰∏îÂèØ‰ª•ÊâßË°åÂü∫Êú¨ÁöÑ Linux ÂëΩ‰ª§„ÄÇ</p>
<p><code>mini_stratovirt_edu</code> ÁöÑ‰∏ªË¶ÅÊµÅÁ®ãÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö</p>
<blockquote>
<ol>
<li>
<p><strong>Âà©Áî® KVM Ê®°ÂùóÊé•Âè£ÂàõÂª∫ËôöÊãüÊú∫Âè•ÊüÑÔºõ</strong></p>
</li>
<li>
<p><strong>ÂàùÂßãÂåñËôöÊãüÊú∫Âè•ÊüÑÂØπÂ∫îÁöÑÂÜÖÂ≠òÂå∫ÂüüÔºõ</strong></p>
</li>
<li>
<p><strong>ÂàùÂßãÂåñ vCPUÔºõ</strong></p>
</li>
<li>
<p><strong>‰ΩøÁî® BootLoader Âä†ËΩΩÂÜÖÊ†∏ÈïúÂÉèÂíåÂä†ËΩΩ initrd ÈïúÂÉèÔºåÂπ∂‰∏îÂÆû‰æãÂåñ vCPUÔºõ</strong></p>
</li>
<li>
<p><strong>ÂàõÂª∫Áõ∏ÂÖ≥ÁöÑÊ®°ÊãüËÆæÂ§áÔºåÂåÖÊã¨‰∏≤Âè£„ÄÅGICv3Ôºõ</strong></p>
</li>
<li>
<p><strong>ÂêØÂä®ËôöÊãüÊú∫ÁöÑ vCPU„ÄÇ</strong></p>
</li>
</ol>
</blockquote>
<p><code>mini_stratovirt_edu</code> ÁöÑÂÆûÁé∞ÂåÖÊã¨‰∫Ü: <strong>KVM Ê®°ÂûãÂÆûÁé∞„ÄÅÂÜÖÂ≠òÊ®°ÂûãÂÆûÁé∞„ÄÅCPU Ê®°ÂûãÂÆûÁé∞„ÄÅBootLoader Ê®°ÂûãÂÆûÁé∞„ÄÅ‰∏≤Âè£ËÆæÂ§áÂÆûÁé∞‰ª•ÂèäÂØπ aarch64 Âπ≥Âè∞ÁöÑÈ¢ùÂ§ñÊîØÊåÅ„ÄÇ</strong></p>
<h3 id="kvmÊ®°Âùó">KVMÊ®°Âùó
</h3><p>Linux ÂÜÖÊ†∏‰∏≠ÁöÑ KVM Ê®°ÂùóÊèê‰æõ‰∫ÜÁ°¨‰ª∂ËæÖÂä©ËôöÊãüÂåñÁöÑËÉΩÂäõÔºåÂπ∂‰∏îÊèê‰æõ‰∫Ü CPU„ÄÅÂÜÖÂ≠òÂíå‰∏≠Êñ≠ÁöÑËôöÊãüÂåñÊîØÊåÅÔºåÂÖ∂ÂØπÂ§ñÊèê‰æõÁöÑÊé•Âè£‰∏∫ ioctl ÂáΩÊï∞ÔºåÂÖ∑‰ΩìÁªÜËäÇÂèØ‰ª•ÂèÇËÄÉÂÜÖÊ†∏Á§æÂå∫ÁöÑÊñáÊ°£Ôºö<a class="link" href="https://www.kernel.org/doc/Documentation/virtual/kvm/api.txt"  target="_blank" rel="noopener"
    >kernel.org/doc/Documentation/virtual/kvm/api.txt</a></p>
<p>Rust Êèê‰æõ‰∫Ü KVM Ê®°ÂùóÁöÑÂ∞ÅË£ÖÂ∫ìÔºåÂàÜÂà´ÊòØ <code>kvm-bindings</code> Âíå <code>kvm-ioctls</code> „ÄÇÂÖ∂‰∏≠ <code>kvm-bindings</code> ÂØπ KVM Ê®°Âùó‰ΩøÁî®ÁöÑÁªìÊûÑ‰ΩìËøõË°å‰∫ÜÂ∞ÅË£ÖÔºå<code>kvm-ioctls</code> ÂØπ KVM Ê®°ÂùóÊèê‰æõÁöÑ API ËøõË°å‰∫ÜÂ∞ÅË£Ö„ÄÇ</p>
<p>src/main.rs ÁöÑ <code>main</code> ÂáΩÊï∞‰∏≠Â±ïÁ§∫‰∫ÜÂÖ∂Âü∫Êú¨Áî®Ê≥ïÔºö</p>
<ol>
<li>È¶ñÂÖàÊâìÂºÄ <code>/dev/kvm</code> ÁöÑËÆæÂ§áÊèèËø∞Á¨¶ kvm ÔºåÈöèÂêéÂà©Áî®ËØ•ÊèèËø∞Á¨¶ÂàõÂª∫ËôöÊãüÊú∫Âè•ÊüÑÔºå <code>kvm.create_vm()</code> ÔºåËØ•Êé•Âè£Êú¨Ë¥®‰∏äÊòØÂ∞ÅË£Ö‰∫Ü <code>ioctl(fd, KVM_CREATE_VM, param)</code> Ôºõ</li>
<li>ÁÑ∂ÂêéÂõ∫ÂÆöÂàÜÈÖç 64KB ÁöÑÂÜÖÂ≠òÁªôËôöÊãüÊú∫‰ΩøÁî®ÔºåÂ∞Ü HVA ‰∏é GPA ÁöÑÊò†Â∞ÑÂÖ≥Á≥ªÈÄöËøáËôöÊãüÊú∫Âè•ÊüÑ vm_fd ÁöÑ <code>set_user_memory_region</code> ÊàêÂëòÊñπÊ≥ïÈÄöÁü• KVMÔºõ</li>
<li>Êé•ÁùÄ‰ΩøÁî®ËôöÊãüÊú∫Âè•ÊüÑ vm_fd ÁöÑ <code>create_vcpu</code> ÊàêÂëòÂáΩÊï∞ÂàõÂª∫ vCPUÔºåËÆæÁΩÆ vCPU ÂØÑÂ≠òÂô®Ôºõ</li>
<li>ÊúÄÂêé‰Ωø vCPU ÊâßË°å‰∏ÄÊÆµÊ±áÁºñ‰ª£Á†ÅÂπ∂Â§ÑÁêÜ vCPU ÈÄÄÂá∫‰∫ã‰ª∂ÔºåËøôÊ†∑ÂÄüÂä© <code>KVM API</code> ÊûÑÂª∫Âá∫‰∏Ä‰∏™ÊúÄÂ∞èÂåñ‰∏îÂèØËøêË°åÁöÑËôöÊãüÊú∫„ÄÇ</li>
</ol>
<h3 id="ÂÜÖÂ≠òÊ®°Âùó">ÂÜÖÂ≠òÊ®°Âùó
</h3><p>ÂÜÖÂ≠òÊ®°Âùó‰ª£Á†Å‰Ωç‰∫é <code>src/memory</code> ÔºåÂÖ∂Êèê‰æõ‰∫ÜÂÜÖÂ≠òÁÆ°ÁêÜ„ÄÅÂÜÖÂ≠òËÆøÈóÆÁ≠âÂäüËÉΩ„ÄÇËØ•Ê®°ÂùóÁöÑÂÖ≥ÈîÆÂú®‰∫é<strong>Áª¥Êä§ HVA ‰∏é GPA ‰πãÈó¥ÁöÑÊò†Â∞ÑÂÖ≥Á≥ª„ÄÇ</strong></p>
<p><code>mini_stratovirt_edu</code> ÂàÜÊîØ‰∏≠ÂÜÖÂ≠òÊ®°ÂùóÈÄöËøá <code>HostMemMapping</code> ÁªìÊûÑ‰ΩìÊù•ÂÆûÁé∞ËØ•ÂäüËÉΩÔºåËØ•ÁªìÊûÑ‰ΩìÂà©Áî® <code>mmap</code> Á≥ªÁªüË∞ÉÁî®ÂàÜÈÖç Host ÁöÑËôöÊãüÂÜÖÂ≠òÔºå Âπ∂‰∏îÂ∞ÜÂÖ∂‰∏éËôöÊãüÊú∫ÁöÑÁâ©ÁêÜÂú∞ÂùÄÁ©∫Èó¥ÁöÑÊò†Â∞ÑÂÖ≥Á≥ª‰øùÂ≠ò‰∏ãÊù•„ÄÇÂú® <code>HostMemMapping</code> ÁöÑÊûêÊûÑÂáΩÊï∞‰∏≠‰ºöË∞ÉÁî® <code>unmap</code> Êù•ÈáäÊîæÂÆø‰∏ªÊú∫ÁöÑËôöÊãüÂÜÖÂ≠òËµÑÊ∫ê„ÄÇ</p>
<p>Ê≠§Â§ñÔºåÂÜÖÂ≠òÊ®°ÂùóÈÄöËøá <code>GuestMemory</code> ÁªìÊûÑ‰ΩìÂêëÂÖ∂‰ªñÊ®°ÂùóÊèê‰æõÁÆÄÂçïÊòìÁî®ÁöÑÂÜÖÂ≠òËÆøÈóÆÊé•Âè£Ôºå‰æãÂ¶Ç <code>read</code> ÂáΩÊï∞Âíå <code>write</code> ÂáΩÊï∞„ÄÇ</p>
<h3 id="cpuÊ®°Âùó">CPUÊ®°Âùó
</h3><p>CPU Ê®°Âùó‰ª£Á†Å‰Ωç‰∫é <code>src/cpu</code> Ôºå CPU ËôöÊãüÂåñÁöÑÊ†∏ÂøÉÂú®‰∫éÂÆåÊàê**ÂØπÂü∫Êú¨ËÆ°ÁÆóÊú∫Êåá‰ª§ÁöÑÊ®°ÊãüÂíåÂ§ÑÁêÜÂØÑÂ≠òÂô®Êï∞ÊçÆÔºå**‰∏ªË¶ÅÂ∑•‰ΩúÂ¶Ç‰∏ãÔºö</p>
<ul>
<li>
<p>Êåá‰ª§Ê®°ÊãüËøô‰∏ÄÈÉ®ÂàÜ‰∏ªË¶Å‰∫§Áî± KVM Ê®°ÂùóÂÆåÊàêÔºåCPU Ê®°ÂùóÂè™ÈúÄË¶ÅÂ§ÑÁêÜÁõ∏ÂÖ≥ÁöÑ VM_EXIT Èô∑Âá∫‰∫ã‰ª∂Ôºõ</p>
</li>
<li>
<p>vCPU ÁöÑÂàùÂßãÂåñËøáÁ®ãÂç≥Ë∞ÉÁî® CPU Ê®°Âùó‰∏≠ÁöÑ <code>new</code> ÂáΩÊï∞ÔºåÂ∞±ÊòØË∞ÉÁî® KVM Ê®°ÂùóÁöÑ <code>create_vcpu</code> Êé•Âè£ÂáΩÊï∞ÔºåÂáΩÊï∞ËøîÂõû vCPU ÁöÑÂè•ÊüÑÔºåËØ•Êé•Âè£ÂÆûÈôÖÂ∫ïÂ±ÇÂ∞ÅË£ÖÁöÑÊòØ <code>ioctl(fd, KVM_CREATE_VCPU)</code> Ôºõ</p>
</li>
<li>
<p>vCPU ÁöÑÂÆû‰æãÂåñ‰ºöË∞ÉÁî® <code>realize</code> ÂáΩÊï∞ÔºåËØ•ÂáΩÊï∞ÁöÑ‰∏ªË¶ÅÂÜÖÂÆπÂ∞±ÊòØÊ†πÊçÆ BootLoader Ê®°ÂùóÊâÄÁªôÁöÑÊï∞ÊçÆ‰ø°ÊÅØËÆæÁΩÆÁõ∏ÂÖ≥ÂØÑÂ≠òÂô®ÔºåÂÖ∑‰ΩìÊ≠•È™§ÂàÜ‰∏∫‰∏âÊ≠•Ôºö</p>
<ul>
<li>Ëé∑Âèñ vCPU Âè•ÊüÑ‰∏≠ÁöÑÂØÑÂ≠òÂô®ÂÄºÔºõ</li>
<li>‰øÆÊîπ vCPU Âè•ÊüÑ‰∏≠ÁöÑÂØÑÂ≠òÂô®ÂÄºÔºõ</li>
<li>ÂõûÂÜô vCPU Âè•ÊüÑ‰∏≠ÁöÑÂØÑÂ≠òÂô®ÂÄº„ÄÇ</li>
</ul>
</li>
<li>
<p>ÂêØÂä® CPUÔºåÂç≥Ë∞ÉÁî® CPU Ê®°Âùó‰∏≠ÁöÑ <code>start</code> ÂáΩÊï∞„ÄÇËØ•ÂáΩÊï∞ÁöÑ‰∏ªË¶ÅÂÜÖÂÆπÂ∞±ÊòØÂàõÂª∫‰∏Ä‰∏™Áî®Êà∑ÊÄÅÁ∫øÁ®ãÔºåÁ∫øÁ®ãÂÜÖÂåÖÂê´‰∏Ä‰∏™Âæ™ÁéØ loop ÔºåÂæ™ÁéØ‰πã‰∏≠ËøêË°å <code>cpu.kvm_vcpu_exec</code> ÂáΩÊï∞Áî®‰∫éÂ§ÑÁêÜ KVM ÁöÑÈô∑Âá∫‰∫ã‰ª∂„ÄÇ</p>
</li>
</ul>
<h3 id="bootloaderÊ®°Âùó">BootLoaderÊ®°Âùó
</h3><p>BootLoader Ê®°Âùó‰ª£Á†Å‰Ωç‰∫é <code>src/boot_loader</code> ÔºåËØ•Ê®°ÂùóË¥üË¥£**Êìç‰ΩúÁ≥ªÁªüÂÜÖÊ†∏ÁöÑÂêØÂä®ÂºïÂØºÔºå**‰∏ªË¶ÅÈúÄË¶ÅÂÆûÁé∞‰∏â‰ª∂‰∫ãÔºö</p>
<ul>
<li>ÊåâÁÖß Linux Boot Procotol ËÆæËÆ° <code>1</code> MB‰ΩéÂú∞ÂùÄËôöÊãüÊú∫Áâ©ÁêÜÂÜÖÂ≠òÂ∏ÉÂ±ÄÔºåÊ†πÊçÆÂêØÂä®ÊâÄÈúÄÁöÑ‰ø°ÊÅØÈÖçÁΩÆÂ°´ÂÖÖÁõ∏Â∫îÁöÑÊï∞ÊçÆÁªìÊûÑÔºõ</li>
<li>Â∞ÜÂÜÖÊ†∏ÈïúÂÉèÊñá‰ª∂Âíå <code>initrd</code> ÂÜôÂÖ•ËôöÊãüÊú∫ÂÜÖÂ≠òÔºõ</li>
<li>Â∞ÜÂÜôÂÖ•ÂÜÖÂ≠òÁöÑÊï∞ÊçÆ‰ø°ÊÅØ‰º†ÈÄíÁªô CPU Ê®°ÂùóÁî®‰∫éÂØÑÂ≠òÂô®ËÆæÁΩÆ„ÄÇ</li>
</ul>
<p>BootLoader Ê®°ÂùóÁöÑÂ∑•‰ΩúÊµÅÁ®ãÂ¶Ç‰∏ãÔºö</p>
<ol>
<li>È¶ñÂÖàÂú® src/main.rs ÁöÑ <code>main</code> ÂáΩÊï∞ÊåâÁÖß‰∏çÂêåÁöÑÂ§ÑÁêÜÂô®Êû∂ÊûÑÈÄâÊã©ÂØπÂ∫îÁöÑ <code>load_boot_source</code> ÂáΩÊï∞ÂÆûÁé∞Ôºõ</li>
<li>ÈöèÂêéÊåâÁÖßÊâÄÂØπÂ∫îÁöÑÂêØÂä®ÂçèËÆÆËøõË°åÁõ∏ÂÖ≥ÈÖçÁΩÆÔºåË∞ÉÁî® BootLoader Ê®°ÂùóÁöÑ <code>load_kernel</code> ÂáΩÊï∞Ôºõ</li>
<li>ËØ•ÂáΩÊï∞Â∞ÜÊâÄÈúÄÁöÑÊï∞ÊçÆÁªìÊûÑÂíåÂÜÖÊ†∏ÈïúÂÉèÊñá‰ª∂ÂÜôÂÖ•ËôöÊãüÊú∫ÂÜÖÂ≠òÂΩì‰∏≠Ôºõ</li>
<li>ÊúÄÂêéÂ∞Ü‰πãÂâçÈÖçÁΩÆÁöÑÁõ∏ÂÖ≥Êï∞ÊçÆ‰ø°ÊÅØËøîÂõûÂπ∂‰∏î‰Ωú‰∏∫ÂèÇÊï∞‰º†ÈÄíÁªô vCPU ÂÆû‰æãÂåñÂáΩÊï∞„ÄÇ</li>
</ol>
<h3 id="ËÆæÂ§áÊ®°Âùó">ËÆæÂ§áÊ®°Âùó
</h3><p>ËÆæÂ§áÊ®°Âùó‰ª£Á†Å‰Ωç‰∫é <code>src/device</code> Ë∑ØÂæÑ‰∏ãÔºåËÆæÂ§áÂØπÂ§ñÊö¥Èú≤ÁöÑÊé•Âè£‰∏ÄËà¨ÂåÖÊã¨ <code>new</code> ÂáΩÊï∞„ÄÅ<code>realize</code> ÂáΩÊï∞„ÄÅ<code>read</code> ÂáΩÊï∞Âíå <code>write</code> ÂáΩÊï∞„ÄÇ</p>
<p>BootLoader Ê®°ÂùóÂèØ‰ª•ËÆ©ËôöÊãüÊú∫ÂÆåÊàêÂÜÖÊ†∏ÁöÑÂºïÂØºÂêØÂä®Ôºå‰ΩÜÊòØÊÉ≥Ë¶ÅÂíåËôöÊãüÊú∫‰∫§‰∫íÂπ∂‰∏îËÆ©ÂÖ∂ÊâßË°åÂü∫Êú¨ Linux ÂëΩ‰ª§ÔºåËøòÈúÄË¶Å‰∏≤Âè£ËÆæÂ§á„ÄÇ‰∏≤Âè£ËÆæÂ§áÁî®‰∫éËæìÂÖ•ËæìÂá∫„ÄÇ</p>
<p>‰∏≤Âè£ËÆæÂ§áÊúâ‰ºóÂ§öÁöÑÂØÑÂ≠òÂô®ÔºåËøô‰∫õÂØÑÂ≠òÂô®‰∏ªË¶ÅÁî®‰∫éÂàùÂßãÂåñÂçèÂïÜÂíåÊî∂ÂèëÊï∞ÊçÆÂ§ÑÁêÜ„ÄÇÂàùÂßãÂåñËøáÁ®ã‰∏ªË¶ÅÂåÖÊã¨Ôºö</p>
<ul>
<li>ÂàõÂª∫ËôöÊãüÊú∫ÂêëÂêéÁ´ØÂèëÈÄÅÈÄöÁü•ÁöÑ‰∫ã‰ª∂</li>
<li>Âêë KVM Ê®°ÂùóÊ≥®ÂÜå‰∏≠Êñ≠Âè∑Áî®‰∫éÂêéÁ´ØÂêëËôöÊãüÊú∫ÂèëÈÄÅ‰∏≠Êñ≠</li>
<li>ÊúÄÂêéÂàùÂßãÂåñÁõ∏ÂÖ≥ÂØÑÂ≠òÂô®</li>
</ul>
<p>Êï∞ÊçÆÊî∂ÂèëÂàôÊòØÈÄöËøáË∞ÉÁî® <code>read</code> ÂáΩÊï∞Âíå <code>write</code> ÂáΩÊï∞ÂÆûÁé∞„ÄÇ</p>
<h3 id="todo-aarch64Êû∂ÊûÑÈ¢ùÂ§ñÊîØÊåÅ">//TODO: AArch64Êû∂ÊûÑÈ¢ùÂ§ñÊîØÊåÅ
</h3><p>Áî±‰∫é aarch64 Êû∂ÊûÑÂíå x86_64 Êû∂ÊûÑÁöÑÂ∑ÆÂºÇÔºåÈúÄË¶ÅÂØπ aarch64 Êû∂ÊûÑÂÅö‰∏Ä‰∫õÈ¢ùÂ§ñÊîØÊåÅÔºå‰∏ªË¶ÅÂåÖÊã¨‰∏≠Êñ≠ÊéßÂà∂Âô®„ÄÅ BootLoader Ê®°Âùó„ÄÅCPU Ê®°Âûã‰ª•ÂèäËÆæÂ§áÊ†ë ( Device Tree )„ÄÇ</p>
<p>KVM Êèê‰æõ‰∫Ü aarch64 Âπ≥Âè∞‰∏≠Êñ≠ÊéßÂà∂Âô® GIC ÁöÑÊ®°ÊãüËÉΩÂäõÔºåÂõ†Ê≠§ÂèØ‰ª•Áõ¥Êé•Âà©Áî® KVM Êé•Âè£ÂàõÂª∫ vGIC v3ËÆæÂ§áÔºåÂπ∂‰∏îÈÖçÁΩÆËØ•ËÆæÂ§áÁöÑÁõ∏ÂÖ≥Â±ûÊÄß„ÄÇ</p>
<p>aarch64 ÁöÑ BootLoader ËÆæËÆ°Áõ∏ÂØπ x86_64Êõ¥ÁÆÄÂçïÔºåÂè™ÈúÄË¶ÅÂ∞Ü Device Tree „ÄÅÂÜÖÊ†∏ÈïúÂÉèÂíå initrd Êñá‰ª∂ÂÜôÂÖ•ÂÜÖÂ≠òÔºåÂπ∂‰∏îÂ∞Ü‰∏âËÄÖÁöÑÂú∞ÂùÄ‰ø°ÊÅØËøîÂõûÂπ∂Êèê‰æõÁªô CPU Ê®°ÂùóÂíå Device Tree ‰ΩøÁî®„ÄÇ</p>
<p>aarch64 Âπ≥Âè∞ÈÄöËøá Device Tree Êù•ÂêëÂÜÖÊ†∏‰º†ÈÄíÁ°¨‰ª∂‰ø°ÊÅØ„ÄÇ Device Tree ÊòØ‰∏ÄÁßçËÉΩÂ§üÊèèËø∞Á°¨‰ª∂‰ø°ÊÅØÁöÑÊï∞ÊçÆÁªìÊûÑÔºåËØ•ÁªìÊûÑÂèØ‰ª•ËΩ¨Êç¢ÊàêÂ≠óËäÇÊµÅ‰º†ÈÄíÁªôÂÜÖÊ†∏„ÄÇÂÜÖÊ†∏ÂèØ‰ª•Ëß£ÊûêËØ•Â≠óËäÇÊµÅÔºåËé∑ÂæóÂøÖË¶ÅÁöÑÁ°¨‰ª∂‰ø°ÊÅØÂπ∂ÊâßË°å‰∏ÄÁ≥ªÂàóÁöÑÂàùÂßãÂåñÂä®‰Ωú„ÄÇ</p>
<p>ÂØπ‰∫é CPU Ê®°ÂùóÔºåaarch64 Êû∂ÊûÑ‰∏é x86_64 Êû∂ÊûÑÁõ∏ÂêåÔºåÂú®ËøêË°åÂÜÖÊ†∏‰ª£Á†ÅÂâç‰πüÈúÄË¶ÅËÆæÁΩÆ‰∏ÄÂÆöÁöÑ vCPU ÂØÑÂ≠òÂô®‰ø°ÊÅØÔºåÂÖ∂‰ΩúÁî®‰∏ªË¶ÅÊòØËÆ© vCPU Áü•ÈÅìÂÜÖÊ†∏ÁöÑËµ∑ÂßãÂú∞ÂùÄÂíå Device Tree ÁöÑÂ≠òÊîæÂú∞ÂùÄ„ÄÇÁî±‰∫é Rust kvm-ioctls Â∫ìÂØπ aarch64 Âπ≥Âè∞ÁöÑÊîØÊåÅËæÉÂ∑ÆÔºåÂ§ßÈÉ®ÂàÜ CPU ÂØÑÂ≠òÂô®ÁöÑ‰ø°ÊÅØÂú® CPU Ê®°Âùó‰∏≠ËøõË°å‰∫ÜÊâãÂä®Â∞ÅË£Ö„ÄÇ</p>
<h3 id="ÊÄªÁªì">ÊÄªÁªì
</h3><p>Âú®‰ª•‰∏äÊ®°ÂùóÁöÑÊîØÊåÅ‰∏ãÔºå<code>mini_stratovirt_edu</code> ÂÆûÁé∞‰∫Ü‰∏Ä‰∏™ÊûÅÂÖ∂Á≤æÁÆÄÁöÑËôöÊãüÊú∫ÔºåÂπ∂‰∏îÂèØ‰ª•ÂÆûÁé∞‰∏éÁî®Êà∑ÁöÑÁÆÄÂçï‰∫§‰∫íÔºåÂèØ‰ª•ÊâßË°åÂü∫Á°ÄÁöÑ Linux ÂëΩ‰ª§ÔºåËææÂà∞‰∫ÜÈ¢ÑÊúüÁªìÊûú„ÄÇ</p>
<h2 id="52-‰ΩøÁî®ÊåáÂçó">5.2 ‰ΩøÁî®ÊåáÂçó
</h2><h3 id="ËΩØÁ°¨‰ª∂Ë¶ÅÊ±Ç">ËΩØÁ°¨‰ª∂Ë¶ÅÊ±Ç
</h3><blockquote>
<p>ÊúÄ‰ΩéÁ°¨‰ª∂Ë¶ÅÊ±Ç</p>
</blockquote>
<ul>
<li>Â§ÑÁêÜÂô®Êû∂ÊûÑÔºöÁõÆÂâç‰ªÖÊîØÊåÅ aarch64 Âíå x86_64 Â§ÑÁêÜÂô®Êû∂ÊûÑ„ÄÇaarch64 ÈúÄË¶Å ARMv8 ÂèäÊõ¥È´òÁâàÊú¨‰∏îÊîØÊåÅËôöÊãüÂåñÊâ©Â±ïÔºõx86_64 ÊîØÊåÅ VT-xÔºõ</li>
<li>2 Ê†∏ CPUÔºõ</li>
<li>4 GiB ÂÜÖÂ≠òÔºõ</li>
<li>16 GiB ÂèØÁî®Á£ÅÁõòÁ©∫Èó¥„ÄÇ</li>
</ul>
<blockquote>
<p>ËΩØ‰ª∂Ë¶ÅÊ±Ç</p>
</blockquote>
<ul>
<li>
<p>Êìç‰ΩúÁ≥ªÁªü: openEuler-20.03-LTS Âèä openEuler Êõ¥È´òÁâàÊú¨Ôºõ</p>
</li>
<li>
<p>rust ËØ≠Ë®ÄÊîØÊåÅÔºöÂÆâË£Ö rust ËØ≠Ë®Ä‰ª•Âèä cargo ÂåÖÁÆ°ÁêÜÂô®„ÄÇ</p>
</li>
</ul>
<h3 id="ÂÖ∑‰ΩìÂÆâË£ÖËøáÁ®ã">ÂÖ∑‰ΩìÂÆâË£ÖËøáÁ®ã
</h3><p>‰∏ãËΩΩ mini_stratovirt_edu Ê∫ê‰ª£Á†ÅÔºåÂëΩ‰ª§Â¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git clone https://gitee.com/openeuler/stratovirt.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> stratovirt
</span></span><span class="line"><span class="cl">git checkout -b mini_stratovirt_edu remotes/origin/mini_stratovirt_edu
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁºñËØë mini_stratovirt_edu Ê∫ê‰ª£Á†ÅÔºåÂÖ∑‰ΩìÂëΩ‰ª§Â¶Ç‰∏ãÊâÄÁ§∫Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">cargo build --release
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁºñËØëÊàêÂäü‰πãÂêéÔºåÂèØ‰ª•Âú® target/release/stratovirt Ë∑ØÂæÑ‰∏ãÊâæÂà∞ÁîüÊàêÁöÑ‰∫åËøõÂà∂Êñá‰ª∂„ÄÇ</p>
<hr>
<p>‰∏∫‰∫ÜÊàêÂäüËøêË°å mini_stratovirt_eduÔºå ÈúÄË¶ÅÂáÜÂ§áÔºö</p>
<ul>
<li>
<p>PE Ê†ºÂºèÁöÑ Linux ÂÜÖÊ†∏ÈïúÂÉè</p>
</li>
<li>
<p>ext4 Êñá‰ª∂Á≥ªÁªüÔºåinitrd ÁöÑÊñá‰ª∂Á≥ªÁªüÈïúÂÉè</p>
</li>
</ul>
<blockquote>
<p>Linux ÂÜÖÊ†∏ÈïúÂÉè‰∏ãËΩΩÂú∞ÂùÄÔºöhttps://repo.openeuler.org/openEuler-21.03/stratovirt_img/</p>
<p>initrd Êñá‰ª∂Á≥ªÁªüÈïúÂÉèÂà∂‰ΩúÊñπÊ≥ïÔºö<a class="link" href="https://gitee.com/openeuler/stratovirt/blob/master/docs/mk_initrd.ch.md"  target="_blank" rel="noopener"
    >docs/mk_initrd.ch.md ¬∑ openEuler/stratovirt - Á†Å‰∫ë - ÂºÄÊ∫ê‰∏≠ÂõΩ (gitee.com)</a></p>
<p><a class="link" href="https://tinylab.org/riscv-kvm-qemu-spike-linux-usage/"  target="_blank" rel="noopener"
    >Áî® QEMU/Spike+KVM ËøêË°å RISC-V Host/Guest Linux - Ê≥∞ÊôìÁßëÊäÄ (tinylab.org)</a></p>
</blockquote>
<p>ÂèØ‰ª•Ê†πÊçÆÂ§ÑÁêÜÂô®Êû∂ÊûÑÈÄâÊã©ÂØπÂ∫îÁöÑÂÜÖÊ†∏ÈïúÂÉè‰∏ãËΩΩÈìæÊé•Âíå‰ΩøÁî®Âà∂‰ΩúÊñπÊ≥ïÁîüÊàêÁöÑ initrd ÈïúÂÉè ( <code>initrd.img </code>)ÔºåÈúÄË¶ÅÂ∞Ü‰∏§‰∏™ÈïúÂÉèÊñá‰ª∂ÊîæÁΩÆÂà∞ÊåáÂÆöË∑ØÂæÑ <code>/tmp/</code> ÔºåÊï¥‰∏™ËøáÁ®ãÁöÑÂÖ∑‰ΩìÂëΩ‰ª§ÁºñÂÜô‰∏∫ËÑöÊú¨ÔºåÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">arch</span><span class="o">=</span><span class="sb">`</span>uname -m<span class="sb">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> <span class="si">${</span><span class="nv">arch</span><span class="si">}</span> <span class="o">=</span> <span class="s2">&#34;x86_64&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	wget https://repo.openeuler.org/openEuler-21.03/stratovirt_img/x86_64/vmlinux.bin 
</span></span><span class="line"><span class="cl">	mv vmlinux.bin /tmp/vmlinux.bin
</span></span><span class="line"><span class="cl"><span class="k">elif</span> <span class="o">[</span> <span class="si">${</span><span class="nv">arch</span><span class="si">}</span> <span class="o">=</span> <span class="s2">&#34;aarch64&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	wget https://repo.openeuler.org/openEuler-21.03/stratovirt_img/aarch64/vmlinux.bin 
</span></span><span class="line"><span class="cl">	mv vmlinux.bin /tmp/vmlinux.bin
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøêË°åËØ•ËÑöÊú¨‰πãÂêéÔºå <code>/tmp/</code> Â∞±Â§ö‰∫Ü <code>vmlinux.bin</code> Êñá‰ª∂ÔºõÂêåÊó∂Â∞ÜÂà∂‰ΩúÁöÑ <code>initrd.img</code> ‰πüÊîæÂÖ• <code>/tmp/</code> ÔºåÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ls /tmp
</span></span><span class="line"><span class="cl">initrd.img
</span></span><span class="line"><span class="cl">vmlinux.bin
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<p>Â∞Ü‰∏ãËΩΩ‰∏ãÊù•ÁöÑ‰∏§‰∏™ÈïúÂÉèÊñá‰ª∂ÊîæÂà∞ÊåáÂÆö‰ΩçÁΩÆ‰πãÂêéÔºåÂ∞±ÂèØ‰ª•ËøêË°å <code>mini_stratovirt_edu</code> ÁöÑ‰∫åËøõÂà∂Á®ãÂ∫è‰∫ÜÔºåÂÖ∑‰ΩìÂëΩ‰ª§Â¶Ç‰∏ãÊâÄÁ§∫Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> stratovirt
</span></span><span class="line"><span class="cl">./target/release/stratovirt
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ëá≥Ê≠§ÔºåÂ∞±ÂÆåÊàê‰∫ÜËôöÊãüÊú∫ÁöÑÂêØÂä®ÔºåÂπ∂ËøõÂÖ•ËôöÊãüÊú∫ÁéØÂ¢É‰∏≠„ÄÇ</p>
<h1 id="6-ÊÄªÁªì">6 ÊÄªÁªì
</h1><p>Êú¨Á´†‰∏ªË¶Å‰ªãÁªç‰∫Ü‰ªéÈõ∂ÂºÄÂßãÊûÑÂª∫ËôöÊãüÂåñÂπ≥Âè∞StratoVirtÁöÑÂÆåÊï¥ÊµÅÁ®ã„ÄÇÈ¶ñÂÖàÔºåÁÆÄË¶Å‰ªãÁªç‰∫ÜStratoVirtÁöÑ‰ΩøÁî®Âú∫ÊôØ„ÄÅÊäÄÊúØ‰ºòÂäø‰ª•ÂèäÂèëÂ±ïËÉåÊôØÔºõÁÑ∂Âêé‰ªãÁªç‰∫ÜStratoVirtÁöÑÊû∂ÊûÑËÆæËÆ°Ôºå‰∏ªË¶ÅÂàÜ‰∏∫CPUÂ≠êÁ≥ªÁªü„ÄÅÂÜÖÂ≠òÂ≠êÁ≥ªÁªü„ÄÅI/OÂ≠êÁ≥ªÁªü‰∏âÈÉ®ÂàÜËøõË°åÈòêËø∞ÔºõÊúÄÂêéÂü∫‰∫éÁ°¨‰ª∂ËôöÊãüÂåñÊäÄÊúØÔºå‰ΩøÁî®RustËØ≠Ë®ÄÂÆûÁé∞‰∫ÜÁ≤æÁÆÄÁâàÁöÑStratoVirtËôöÊãüÂåñËΩØ‰ª∂ÔºåÈÄöËøáKVMÊ®°Âûã„ÄÅÂÜÖÂ≠òÊ®°Âûã„ÄÅCPUÊ®°Âûã„ÄÅBootLoaderÂÆûÁé∞‰ª•Âèä‰∏≤Âè£ËÆæÂ§áÂÆûÁé∞‰∫ÜÁªÑÊàêËôöÊãüÂåñËΩØ‰ª∂ÁöÑÊúÄÂ∞èÈõÜÔºåÂèØ‰ª•ÊîØÊåÅx86ÂíåÈ≤≤ÈπèÂèåÂπ≥Âè∞ÁöÑËøêË°å„ÄÇ</p>
<hr>
<h1 id="7-todoÂºÄÂèëÊµÅÁ®ã">7 //TODOÔºöÂºÄÂèëÊµÅÁ®ã
</h1><h2 id="71-Âú®qemu-armÁ≥ªÁªü‰∏äËøêË°å">7.1 Âú®QEMU ARMÁ≥ªÁªü‰∏äËøêË°å
</h2><p>Áî±‰∫é <code>mini_stratovirt_edu</code> ÈíàÂØπARMÁ≥ªÁªüÁöÑÊï¥‰ΩìËÆæËÆ°ÊØîËæÉÁ≤æÁÆÄÔºåÂÖàË∑ë‰∏Ä‰∏ãARMÊû∂ÊûÑÁöÑÔºåÊûÑÂª∫ÊµÅÁ®ãÂ¶Ç‰∏ãÔºö</p>
<ol>
<li>ÂÆâË£ÖÂπ∂ÁºñËØë qemu-system-arm64Ôºõ</li>
<li>ÂÆâË£Ö‰∫§ÂèâÁºñËØëÂ∑•ÂÖ∑Èìæ toolchainÔºõ</li>
<li>ÊûÑÂª∫ qemu ÊâÄÈúÄÁöÑËµÑÊ∫êÊñá‰ª∂Ôºö
<ul>
<li>ÂÜÖÊ†∏ÈïúÂÉè</li>
<li>Ê†πÊñá‰ª∂Á≥ªÁªü</li>
</ul>
</li>
<li>Âú®qemu armÁ≥ªÁªü‰∏≠ÊûÑÂª∫Âπ∂ËøêË°å <code>mini_stratovirt_edu</code>„ÄÇ</li>
</ol>
<hr>
<p><a class="link" href="https://www.openeuler.org/zh/blog/luoyuzhe/001Auto-build-vm-enviroment/index.html"  target="_blank" rel="noopener"
    >Á¨¨‰∏ÄÊúüËá™Âä®Êê≠Âª∫openEulerËôöÊãüÊú∫ËøêË°åQEMUËøêË°åÁéØÂ¢É</a></p>
<p><a class="link" href="https://blog.csdn.net/benkaoya/article/details/129509269"  target="_blank" rel="noopener"
    >QEMUÂêØÂä®ARM64 LinuxÂÜÖÊ†∏_qemu-system-aarch64-CSDNÂçöÂÆ¢</a></p>
<h2 id="72-‰æùÊ¨°ÊµãËØï‰∏ãÂêÑcommit">7.2 ‰æùÊ¨°ÊµãËØï‰∏ãÂêÑcommit
</h2><blockquote>
<p>Â∞ÜÂêÑ commit ÂÅöÊàêPATCHÔºå‰æùÊ¨°ÊµãËØïÂäüËÉΩ</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">./configure --prefix<span class="o">=</span>/opt/riscv64_gdb --with-arch<span class="o">=</span>rv64imc --with-abi<span class="o">=</span>xxx --enable-tui
</span></span><span class="line"><span class="cl">make 
</span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    

    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2024 zcxGGmu
    </section>
    
    <section class="powerby">
        ‰ΩøÁî® <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> ÊûÑÂª∫ <br />
        ‰∏ªÈ¢ò <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.27.0">Stack</a></b> Áî± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> ËÆæËÆ°
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>
<div id="particles-js"></div>

<script src=https://zcxggmu.github.io/background/particles.min.js></script>
<script>
  particlesJS.load('particles-js', "https://zcxggmu.github.io/background/particlesjs-config.json", function() {
    console.log('particles.js loaded - callback');
  });
</script>

<style>
  #particles-js {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: -1;
  }
</style>


    </body>
</html>
